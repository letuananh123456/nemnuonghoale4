function isMobileDevice(){var isMobile;return isMobile={Android:function(){return null!==navigator.userAgent.match(/Android/i)},BlackBerry:function(){return null!==navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return null!==navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return null!==navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return null!==navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},isMobile.any()}function quotesController($scope,$rootScope,$location,$mdToast,$routeParams,$timeout,$cookies,$localStorage,GenericService,CustomerService,QuotesService,$q,$filter,PlanService,CommonServiceTerm,CompareService,$document,$window,$sce,RiderService,PreQuotesService){function resetCity(countryCodeId,isPageLoad){$scope.modifySelection.city||($scope.modifySelection.city={}),392!=countryCodeId&&($scope.modifySelection.city.id=9999,$scope.modifySelection.city.name="Others",$scope.modifySelection.city.stateId=99)}function toggleSortingKey(filterArrayLocal){var allMonthlyPremiumIndex,allTotalPremiumIndex,excludeFromMonthlySortingIndex;return $scope.quotesObj.isMonthly?(allTotalPremiumIndex=filterArrayLocal.indexOf("allTotalPremium"),allTotalPremiumIndex>-1&&filterArrayLocal.splice(allTotalPremiumIndex,0,"allMonthlyPremium"),allTotalPremiumIndex=filterArrayLocal.indexOf("-allTotalPremium"),allTotalPremiumIndex>-1&&filterArrayLocal.splice(allTotalPremiumIndex,0,"-allMonthlyPremium"),filterArrayLocal.splice(0,0,"excludeFromMonthlySorting")):(allMonthlyPremiumIndex=filterArrayLocal.indexOf("allMonthlyPremium"),allMonthlyPremiumIndex>-1&&filterArrayLocal.splice(allMonthlyPremiumIndex,1),allMonthlyPremiumIndex=filterArrayLocal.indexOf("-allMonthlyPremium"),allMonthlyPremiumIndex>-1&&filterArrayLocal.splice(allMonthlyPremiumIndex,1),excludeFromMonthlySortingIndex=filterArrayLocal.indexOf("excludeFromMonthlySorting"),excludeFromMonthlySortingIndex>-1&&filterArrayLocal.splice(excludeFromMonthlySortingIndex,1)),filterArrayLocal}function populateDummyPlans(){callMultiple=QuotesService.callMultipleTimes()&&1*$scope.type.payType===1,$rootScope.pTabName.onetimePlans&&callMultiple?($scope.loadingQuotes=!0,dummyPlansExist||QuotesService.populateDummyPlans().then(function(dummyPlans){$scope.quotes=dummyPlans,$scope.isQuotesLoaded=!0,dummyPlansExist=!0,$scope.object.showLoader=!0,$rootScope.profile&&$rootScope.profile.spouse&&($scope.quotes=sortDummyObject(dummyPlans))})):$scope.customerChangeInitiated||($scope.quotes=[],$scope.isQuotesLoaded=!1,dummyPlansExist=!1,$scope.object.showLoader=!1)}function sortDummyObject(dummyPlans){var dummyTop=dummyPlans.filter(function(dum){return 1*dum.Plan_Id==818||1*dum.Plan_Id==749||1*dum.Plan_Id==911}),dummyBottom=dummyPlans.filter(function(dum){return 1*dum.Plan_Id!=818&&1*dum.Plan_Id!=749&&1*dum.Plan_Id!=911});return dummyTop.concat(dummyBottom)}function showMessageForCoverageSort(){var isNRI=1*$scope.modifySelection.countryId!=392;$scope.messageIndex=[],null!==filterChanged.match("Coverage")?(_.each($scope.quotes,function(quote,index){1*quote.newCoverageUpto===1*$scope.modifySelection.policyCoverage&&($scope.messageIndex[0]=index)}),_.each($scope.newQuotes,function(quote,index){1*quote.newCoverageUpto===1*$scope.modifySelection.policyCoverage&&($scope.messageIndex[1]=index)})):$scope.messageIndex=[],isNRI&&($scope.quotes=QuotesService.showNriPlansSeperation($scope.quotes,$scope.isNonTropPlanVisible),$scope.newQuotes=QuotesService.showNriPlansSeperation($scope.newQuotes,$scope.isNonTropPlanVisible))}function removeAllRidersSelected(){var isAnyTrue=!1;_.each($scope.types,function(val){val.status&&(isAnyTrue=!0,val.status=!1)}),optimizeRiderService?addRiderValuesToThePlans():isAnyTrue&&callRiderChangeCategoryList(),isAnyTrue&&(addRiderValuesToThePlans(),callRiderChangeCategoryList())}function getSelectedRidersList(){var selectedRiders=[];return _.each($scope.types,function(val){val.status&&(15==val.id&&selectedRiders.push(20),selectedRiders.push(val.id))}),selectedRiders}function assignRiderPremiums(quotes,riderPremiumRespone){for(var i=0;i<=quotes.length;i++)"undefined"!=typeof quotes[i]&&(quotes[i]=RiderService.assignRiderPremiums(quotes[i],riderPremiumRespone,$scope.quotesObj));return quotes}function riderUpdateCall(){var deferred=$q.defer();return optimizeRiderService?RiderService.getRidersPremium($scope.quotes,$scope.preQuotesInfo).then(function(response){optimizeAddonServiceInitiated=!0;var riderPremiumResponse=RiderService.formatRiderPremiumResponse(response.data);$scope.quotes=assignRiderPremiums($scope.quotes,riderPremiumResponse),$routeParams.isProgressiveJourney||$timeout(function(){$scope.showRidersSuggestionStachel=!0},1e3),$scope.newQuotes.length>0?RiderService.getRidersPremium($scope.newQuotes,$scope.preQuotesInfo).then(function(response){var riderPremiumResponse=RiderService.formatRiderPremiumResponse(response.data);$scope.newQuotes=assignRiderPremiums($scope.newQuotes,riderPremiumResponse),deferred.resolve()}):deferred.resolve()}):getDefaultRidersPremium($scope.quotes).then(function(data){$scope.quotes=angular.copy(data),$scope.newQuotes.length>0?getDefaultRidersPremium($scope.newQuotes).then(function(newData){$scope.newQuotes=angular.copy(newData),deferred.resolve()}):deferred.resolve()}),deferred.promise}function getDefaultRidersPremium(quotes){var deferred=$q.defer(),requestArray=[];return _.each(quotes,function(quote){818==quote.Plan_Id&&[819,820,821].forEach(function(val){var tempQuote=angular.copy(quote);tempQuote=GenericService.modifyAegonItermPlusPlanDetails(tempQuote,val),tempQuote.riderIdCategory&&tempQuote.riderIdCategory.length>0&&tempQuote.isQuotesVisible&&requestArray.push(QuotesService.createDefaultRiderCallRequest(tempQuote,$scope.preQuotesInfo))}),quote.riderIdCategory&&quote.riderIdCategory.length>0&&quote.isQuotesVisible&&requestArray.push(QuotesService.createDefaultRiderCallRequest(quote,$scope.preQuotesInfo))}),QuotesService.getAllRiderValues(requestArray).success(function(response){_.each(quotes,function(quote){getValueForQuote(quote,response)}),deferred.resolve(quotes)}),deferred.promise}function getValueForQuote(quote,response){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id),isPnbPlan=CommonServiceTerm.isPNBPlan(quote.Plan_Id),adbPremium={riderPremium:0,monthlyRiderPremium:0},ciPremium={riderPremium:0,monthlyRiderPremium:0},resp=response[quote.Plan_Id];_.each(quote.riderPremiumObject,function(rider){_.each(resp,function(resRider){resRider&&(1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium),isDHFLPlan&&1*resRider.categoryId==10&&(adbPremium.riderPremium+=resRider.riderPremium,adbPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium),isDHFLPlan&&1*resRider.categoryId==15&&(ciPremium.riderPremium+=resRider.riderPremium,ciPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium)),isPnbPlan&&1*resRider.categoryId==16&&(quote.sIRiderObj=angular.copy(resRider))),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)}),isDHFLPlan&&110==rider.categoryId&&(rider.premium="LimitedPay"===quote.payOptionType?0:adbPremium.riderPremium+ciPremium.riderPremium,rider.monthlyPremium="LimitedPay"===quote.payOptionType?0:adbPremium.monthlyRiderPremium+ciPremium.monthlyRiderPremium)}),818==quote.Plan_Id&&(quote.adbObj={818:{premium:0,monthlyPremium:0,sumAssured:0},819:{premium:0,monthlyPremium:0,sumAssured:0}},_.each(quote.riderPremiumObject,function(rider){_.each(response[818],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId==10&&(quote.adbObj[818].premium=resRider.riderPremium,quote.adbObj[818].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[818].riderSumAssured=resRider.riderSumAssured)}),_.each(response[819],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(quote.adbObj[819].premium=resRider.riderPremium,quote.adbObj[819].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[819].riderSumAssured=resRider.riderSumAssured),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)}),_.each(response[820],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)}),_.each(response[821],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)})})),quote.isRiderLoaded=!0}function callIndiInusrerFunc(quotes){$scope.aegonObj=_.find(quotes,function(val){return 1*val.Plan_Id===787||1*val.Plan_Id===818});var hdfcObj=_.find(quotes,function(val){return 1*val.Plan_Id===849});hdfcObj&&($scope.baseHDFCPlanPremium.yearly=hdfcObj.ComboTotalPremium,$scope.baseHDFCPlanPremium.monthly=hdfcObj.monthlyTotalPremium);var doNotCallSelection=function(supplierId){return!(!$cookies.get("pidWithSelection")||"donotcall"!=$cookies.get("pidWithSelection"))||(supplierId===termConfigObj.getBAXASupplier()||10===supplierId)};$cookies.get("pid")&&_.each($scope.quotes,function(quote){doNotCallSelection(quote.Supplier_Id)||GenericService.priorityObject[quote.Supplier_Id]!=$cookies.get("pid")||$scope.saveQuoteSelection(quote)});var kotakPlan=(_.find(quotes,function(val){return 1*val.Supplier_Id===117}),_.find(quotes,function(val){return 1*val.Supplier_Id===3}));if(kotakPlan){var x=document.createElement("IFRAME"),styles="visibility:hidden;display:none";x.setAttribute("style",styles),x.setAttribute("src","https://insurance.kotak.com/einsurance/aggregators/kotakcookie.html"),x.setAttribute("height",0),x.setAttribute("width",0),document.body.appendChild(x),CommonServiceTerm.callKotakAttributionApi($scope.modifySelection,!1,kotakPlan)}}function fetchMedicalGridData(preQuotesData){var input=buildQuotesInputObject(preQuotesData);$rootScope.pTabName.monthlyPlans&&(input.planSADetails=QuotesService.buildMonthlyMedicalGridData($scope.quotes)),QuotesService.getMedicalGridData(input).success(function(data,status,headers,config){return $scope.medicalGridInfo=data,!angular.isDefined(data.status)||"failed"!=data.status&&"fail"!=data.status?angular.isDefined(data.msg)&&data.msg.indexOf("failed")>=0?void($scope.medicalGridData=[]):($scope.quotes=QuotesService.assignMedicalInfo($scope.quotes,data,$scope.isAffiliates),void($scope.newQuotes.length>0&&($scope.newQuotes=QuotesService.assignMedicalInfo($scope.newQuotes,data,$scope.isAffiliates)))):void($scope.medicalGridData=[])})}function callQuotesApi(){var lastQuestionAnswered=void 0!==$cookies.get("last_question_answered")?$cookies.get("last_question_answered"):"",response=$scope.isCityPopupEnabled?"city":"professiontype";return!!(!$routeParams.isProgressiveJourney||"spouse"===lastQuestionAnswered||"annualincome"===lastQuestionAnswered||lastQuestionAnswered===response||$routeParams.LeadId&&$routeParams.AgentId)}function updateDropDownValues(){$scope.totalPayoutOptions=CommonServiceTerm.checkForValueAndPush($scope.totalPayoutOptions,$scope.modifySelection.totalPayout),$scope.monthlyPayoutOptions=CommonServiceTerm.checkForValueAndPush($scope.monthlyPayoutOptions,$scope.modifySelection.monthlyIncome),$scope.modifySelection.totalPayout=String($scope.modifySelection.totalPayout),$scope.modifySelection.monthlyIncome=String($scope.modifySelection.monthlyIncome),$scope.modifySelection.policyCoverage=String($scope.modifySelection.policyCoverage)}function toggleGroupTermJourney(){if(7!==$scope.preQuotesInfo.annualIncome||$scope.isNRI){var totalPayoutOptionTop=CommonServiceTerm.populateOptionsList(totalPayoutLimit(),9999999,5e5),totalPayoutOptionbottom=CommonServiceTerm.populateOptionsList(1e7,2e8,1e6);$scope.totalPayoutOptions=totalPayoutOptionTop.concat(totalPayoutOptionbottom),$scope.groupTermJourney=!1,updateDropDownValues()}else $scope.totalPayoutOptions=[{name:5e4,id:5e4}],$timeout(function(){var list=CommonServiceTerm.populateOptionsList(1e5,3e6,1e5);$scope.totalPayoutOptions=$scope.totalPayoutOptions.concat(list),$scope.totalPayoutOptions.push({name:35e5,id:35e5}),$scope.groupTermJourney=!0,$scope.tab.tabValue=1,$scope.changeTabRadio(),$scope.reversePremiumType(!0),updateDropDownValues()},0)}function showMdToast(message,timeDelay){var timeDelay=timeDelay||5e3;$mdToast.show($mdToast.simple().content(message).position($scope.getToastPosition()).hideDelay(timeDelay))}function getAllPlansData(){var input=buildQuotesInputObject($scope.modifySelection);input.monthlyIncome=0,QuotesService.getQuotes(input).success(function(data,status,headers,config){!angular.isDefined(data.status)||"failed"!=data.status&&"fail"!=data.status?angular.isDefined(data.msg)&&data.msg.indexOf("failed")>=0?allPlansData=[]:(allPlansData=data,allPlansData=_.uniq(allPlansData,"Plan_Id"),_.each(allPlansData,function(value){value.riderPremiumAdded=0,value.numInterestRate=value.interestRate?1*value.interestRate.split("%")[0]:0,value.monthlyRiderPremiumAdded=0,value.OneTimePayout=parseInt(value.OneTimePayout),value.SumAssured=parseInt(value.SumAssured),value.TotalCover=parseInt(value.TotalCover),value.maxOneTimePayout=parseInt(value.maxOneTimePayout),value.maxSumAssured=parseInt(value.maxSumAssured),value.maxTotalCover=parseInt(value.maxTotalCover),value.orgSumassured=parseInt(value.orgSumassured),value.maxAnnualReturn=parseInt(value.maxAnnualReturn),value.isRiderLoaded=!1,value.isRiderSelectedForMobile=!1,$rootScope.pTabName.allPlans?value.allTotalPremium=value.maxTotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?value.allTotalPremium=value.TotalPremium:value.allTotalPremium=value.maxTotalPremium,value.profileSort=3,void 0!==typeof $scope.preQuotesInfo.spouse&&null!=$scope.preQuotesInfo.spouse&&($rootScope.profile.spouse&&"SNW"==value.planProfile&&!$scope.preQuotesInfo.spouse.isWorking||"SW"==value.planProfile&&$scope.preQuotesInfo.spouse.isWorking)&&(value.profileSort=1),$rootScope.profile.child&&"C"==value.planProfile&&(value.profileSort=2)}),allPlansData=GenericService.filterAllObjs(allPlansData,$scope.modifySelection)):allPlansData=[]})}function hideQuestions(){$scope.toggleModal("progressiveModal","hide"),$timeout(function(){$scope.showRidersSuggestionStachel=!0},1e3)}function showQuestions(){$scope.progressiveJourney.show=!0,$scope.toggleModal("progressiveModal","show")}function productPageRedirect(plan,planName,index){var isMobileDefault=!!$location.$$search.isMobileDefault,productPageUrl="/product/"+planName;termConfigObj.showNewMobileProductPage(plan.Supplier_Id)&&$rootScope.isMobileDevice&&(productPageUrl="/productDetails/"+planName),plan.payOptionType?"LimitedPay"===plan.payOptionType?$location.path(productPageUrl).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:plan.ppt,isMobileDefault:isMobileDefault?"true":null}):$location.path(productPageUrl).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:1,isMobileDefault:isMobileDefault?"true":null}):(delete $localStorage.payOptionType,$location.path(productPageUrl).search({tabName:$cookies.get("pTabName"),index:index,isMobileDefault:isMobileDefault?"true":null}))}function modifyRiderIds(plan){return plan.riderIdCategory&&plan.riderIdCategory.length>0&&_.each(plan.riderPremiumObject,function(rider){_.each(plan.riderIdCategory,function(planRiderIdCategory){if(rider.categoryId===planRiderIdCategory.catrgoryId){if(plan.selectedRiderIds){var riderIndex=plan.selectedRiderIds.indexOf(rider.riderId);riderIndex!=-1&&(plan.selectedRiderIds[riderIndex]=planRiderIdCategory.riderId)}rider.riderId=planRiderIdCategory.riderId}})}),plan}function proceed(plan,index){optimizeRiderService&&(plan=modifyRiderIds(plan));var isMobileDefault=!!$location.$$search.isMobileDefault;pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Selection click",pageName:"Quotes",basicPremium:plan.BasicPremium,planId:plan.Plan_Id,supplierName:plan.Supplier_Name,supplierId:plan.Supplier_Id,planName:plan.Plan_Name,monthlyPremium:plan.monthlyTotalPremium?plan.monthlyTotalPremium:0,planShortName:plan.planShortName,click:"Click"}),$scope.showRidersSuggestionStachel&&$scope.previousRiderSelection.length>0&&$scope.closeRestoreSessionMsg(),1*plan.Supplier_Id!==16&&1*plan.Supplier_Id!==116||CommonServiceTerm.callAttributionApi($scope.modifySelection,!1,plan),1*plan.Supplier_Id===5&&(0===ipAddress?QuotesService.getIp().success(function(data){ipAddress=data.ip,CommonServiceTerm.loadICICITracking([plan],$scope.preQuotesInfo,ipAddress)}):CommonServiceTerm.loadICICITracking([plan],$scope.preQuotesInfo,ipAddress)),gaTagsNew.quotesSelectionTrack("ProductSelect",plan,index+1,$scope.modifySelection.custId);var custId=$scope.modifySelection.custId||$cookies.get("custId")||-1;gtmObj.quotesSelection(plan,$scope.modifySelection.matrixLeadId,custId,index,!1),$scope.clickedPlanId=plan.Plan_Id,$scope.setArrowLoaderObject(!1,!0),$scope.planOrder=index+1,CustomerService.saveSelectedFilters($scope.enquiryId,$scope.types,filterParam,$scope.planOrder),$scope.saveQuoteSelection(plan);var planIds=termConfigObj.getE2EPlanIds();if(angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1){var preQuotesInfoObj=angular.copy($scope.preQuotesInfo);preQuotesInfoObj.monthlyIncome=plan.monthlyIncome,preQuotesInfoObj.totalPayout=plan.TotalCover,preQuotesInfoObj.oneTimePayout=plan.OneTimePayout,preQuotesInfoObj.sumAssured=plan.SumAssured,preQuotesInfoObj.isMonthly=$scope.quotesObj.isMonthly,preQuotesInfoObj.payOptionType=1*$scope.type.payType===3?"Limited":1*$scope.type.payType===2?"Single":"Regular",preQuotesInfoObj.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),CommonServiceTerm.setFilterTypes($scope.types);var totalPremium=$scope.quotesObj.isMonthly?plan.BasicPremium:plan.BasicPremium;CommonServiceTerm.isAegonItermForeverPlan(plan.Plan_Id)&&1*$scope.type.payType===3&&$scope.modifySelection.customerAge<=60&&($scope.preQuotesInfo.customerAge&&plan.ppt&&$scope.preQuotesInfo.customerAge+plan.ppt<65?plan.Plan_Id=8792:plan.Plan_Id=8791),PlanService.getInsurerDetails(preQuotesInfoObj,plan,$scope.enquiryId,totalPremium).success(function(data,status,headers,config){var leadId=preQuotesInfoObj.matrixLeadId,isE2ePlan=plan.Plan_Id?termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)!=-1:void 0;if(leadId&&CommonServiceTerm.createRevisit({leadId:leadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:isE2ePlan?"E2eRedirect":"InsurerRedirect"}),data.InsurerDetails&&data.InsurerDetails.action&&"POST"===data.InsurerDetails.action){var redirectUrl="";if(void 0!==data.InsurerDetails.url&&null!==data.InsurerDetails.url&&""!==data.InsurerDetails.url)if(redirectUrl=data.InsurerDetails.url,CommonServiceTerm.isHdfc3dPlan(plan.Plan_Id))if(data.InsurerDetails.fields.isMobileDefault=""+isMobileDefault,plan.selectedRiderIds&&plan.selectedRiderIds.length>0)CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,$scope.modifySelection,$scope.type.payType).then(function(){var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));849!=plan.Plan_Id&&8491!=plan.Plan_Id&&8492!=plan.Plan_Id||(jInput=$("<input type='hidden'>"),jInput.attr("name","isExtrLifePlanSelected"),jInput.attr("value","yes"),jForm.append(jInput)),jForm.appendTo("body").submit()});else{var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));849!=plan.Plan_Id&&8491!=plan.Plan_Id&&8492!=plan.Plan_Id||(jInput=$("<input type='hidden'>"),jInput.attr("name","isExtrLifePlanSelected"),jInput.attr("value","yes"),jForm.append(jInput)),jForm.appendTo("body").submit()}else{var jForm=$('<form type="hidden"></form>');jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html");var jInput=$("<input type='hidden'>");if(jInput.attr("name","term"),jInput.attr("value",data.InsurerDetails.fields.term),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","do-you-smoke"),jInput.attr("value",data.InsurerDetails.fields.doyousmoke),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","monthly-payout"),jInput.attr("value",data.InsurerDetails.fields.monthlyincome),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","total-payout"),jInput.attr("value",data.InsurerDetails.fields.totalcover||data.InsurerDetails.fields.sumassured),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","one-time-payout"),jInput.attr("value",data.InsurerDetails.fields.onetimepayout),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","date-of-birth"),jInput.attr("value",data.InsurerDetails.fields.dateofbirth),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","gender"),jInput.attr("value",data.InsurerDetails.fields.gender),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","city"),jInput.attr("value",isMobileDefault?"":CommonServiceTerm.getCityName(data.InsurerDetails.fields.city,plan)),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","mobile"),jInput.attr("value",data.InsurerDetails.fields.mobile),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","cityid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.cityId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","stateid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.stateid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","custid"),jInput.attr("value",data.InsurerDetails.fields.custid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","firstname"),jInput.attr("value",data.InsurerDetails.fields.firstname),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","lumpsumbenefit"),jInput.attr("value",data.InsurerDetails.fields.lumpsumbenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","incomebenefit"),jInput.attr("value",data.InsurerDetails.fields.incomebenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","email"),jInput.attr("value",data.InsurerDetails.fields.email),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","name"),jInput.attr("value",data.InsurerDetails.fields.name),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","agetillcovered"),jInput.attr("value",data.InsurerDetails.fields.agetillcovered),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","country"),jInput.attr("value",data.InsurerDetails.fields.country),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","basepremium"),jInput.attr("value",""),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","leadid"),jInput.attr("value",data.InsurerDetails.fields.leadId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","enquiryid"),jInput.attr("value",decodeURIComponent(data.InsurerDetails.fields.enquiryid)),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.cover?(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid0&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid0),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid1&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid1),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid2&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid2),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid3&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid3),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.sumAssured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumAssured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid4&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid4),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.middlename&&(jInput=$("<input type='hidden'>"),jInput.attr("name","middlename"),jInput.attr("value",data.InsurerDetails.fields.middlename),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.lastname&&(jInput=$("<input type='hidden'>"),jInput.attr("name","lastname"),jInput.attr("value",data.InsurerDetails.fields.lastname),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.planId&&(jInput=$("<input type='hidden'>"),jInput.attr("name","planId"),jInput.attr("value",data.InsurerDetails.fields.planId),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.sumassured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercareterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-term"),jInput.attr("value",data.InsurerDetails.fields.cancercareterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.modeofpremium){jInput=$("<input type='hidden'>"),jInput.attr("name","mode-of-premium");var modeOfPremium=$scope.quotesObj.isMonthly?"12":"1";jInput.attr("value",modeOfPremium),jForm.append(jInput)}"undefined"!=typeof data.InsurerDetails.fields.planoption&&(jInput=$("<input type='hidden'>"),jInput.attr("name","plan-option"),jInput.attr("value",data.InsurerDetails.fields.planoption),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercaretype&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-type"),jInput.attr("value",data.InsurerDetails.fields.cancercaretype),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.premiumpaymentterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","premium-payment-term"),jInput.attr("value",data.InsurerDetails.fields.premiumpaymentterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.ppt&&(jInput=$("<input type='hidden'>"),jInput.attr("name","ppt"),jInput.attr("value",data.InsurerDetails.fields.ppt),jForm.append(jInput)),$scope.setArrowLoaderObject(!0,!1),jForm.appendTo("body").submit()}else $scope.setArrowLoaderObject(!0,!1)}else $scope.setArrowLoaderObject(!0,!1),isE2ePlan?((CommonServiceTerm.isDHFLMonthlyPlan(plan.Plan_Id)||GenericService.isIPruSmartPlan(plan.Plan_Id)||GenericService.isMAXPlan(plan.Plan_Id))&&$rootScope.pTabName&&$rootScope.pTabName.monthlyPlans&&($scope.modifySelection.totalPayout=plan.TotalCover,CustomerService.updateCustomerSelection($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){})),plan.selectedRiderIds&&plan.selectedRiderIds.length>0?(CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,$scope.modifySelection,$scope.type.payType).then(function(){isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true":window.location=data.InsurerDetails.url})):isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true":window.location=data.InsurerDetails.url):isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true":window.location=data.InsurerDetails.url})}else openPlanDetail(plan,$scope.planOrder);GenericService.isHDFCPlan(plan.Plan_Id)&&(planName=plan.Plan_Name)}function executeICICITracking(){0===ipAddress?QuotesService.getIp().success(function(data){ipAddress=data.ip,CommonServiceTerm.loadICICITracking(quotes,$scope.preQuotesInfo,ipAddress)}):CommonServiceTerm.loadICICITracking(quotes,$scope.preQuotesInfo,ipAddress)}function forceRiderSelect(id,status){var deferred=$q.defer();return _.each($scope.types,function(val){val.id==id&&(val.status=angular.copy(status))}),callRiderChangeCategoryList().then(function(){deferred.resolve()}),deferred.promise}function callRiderChangeCategoryList(){var deferred=$q.defer(),selectedRiders=getSelectedRidersList();return pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Select Riders click",pageName:"Quotes",selected_riders:selectedRiders,click:"Click"}),selectedRiders.length>0&&CommonServiceTerm.dropRiderSelectionCookie(),CommonServiceTerm.setRiderSelected($scope.modifySelection.custId,selectedRiders).success(function(data){deferred.resolve()}),deferred.promise}function addRiderValuesToThePlans(onPageLoad){var deferred=$q.defer();$scope.checked.disableRadio=!0,$scope.addOn={isClicked:!0};var selectedRiders=getSelectedRidersList();return onPageLoad&&selectedRiders.length>0?$scope.setArrowLoaderObject(!1,!0):onPageLoad||$scope.setArrowLoaderObject(!1,!0),optimizeRiderService?$timeout(function(){
RiderService.addRiderValues($scope.quotes,selectedRiders,$scope.quotesObj.isMonthly,$scope.modifySelection,$scope.enquiryId).then(function(data){var quotesData=GenericService.getRidersPremiumForQuotes(data,$scope.types,$scope.quotesObj.isMonthly);$scope.quotes=GenericService.addADBOnATPBSelectForMAX(quotesData,selectedRiders),$scope.newQuotes.length>0?$timeout(function(){RiderService.addRiderValues($scope.newQuotes,selectedRiders,$scope.quotesObj.isMonthly,$scope.modifySelection,$scope.enquiryId).then(function(data){var newQuotesData=GenericService.getRidersPremiumForQuotes(data,$scope.types,$scope.quotesObj.isMonthly);$scope.newQuotes=GenericService.addADBOnATPBSelectForMAX(newQuotesData,selectedRiders),$scope.setArrowLoaderObject(!0,!1),$scope.addOn={isClicked:!1},$scope.checked.disableRadio=!1,deferred.resolve()})},100):($scope.setArrowLoaderObject(!0,!1),$scope.addOn={isClicked:!1},$scope.checked.disableRadio=!1,deferred.resolve())})},400):QuotesService.addRiderValues($scope.quotes,selectedRiders,$scope.quotesObj.isMonthly,$scope.modifySelection,$scope.enquiryId).then(function(data){var quotesData=GenericService.getRidersPremiumForQuotes(data,$scope.types,$scope.quotesObj.isMonthly);$scope.quotes=GenericService.addADBOnATPBSelectForMAX(quotesData,selectedRiders),$scope.newQuotes.length>0?QuotesService.addRiderValues($scope.newQuotes,selectedRiders,$scope.quotesObj.isMonthly,$scope.modifySelection,$scope.enquiryId).then(function(data){var newQuotesData=GenericService.getRidersPremiumForQuotes(data,$scope.types,$scope.quotesObj.isMonthly);$scope.newQuotes=GenericService.addADBOnATPBSelectForMAX(newQuotesData,selectedRiders),$scope.setArrowLoaderObject(!0,!1),$scope.addOn={isClicked:!1},$scope.checked.disableRadio=!1,deferred.resolve()}):($scope.setArrowLoaderObject(!0,!1),$scope.addOn={isClicked:!1},$scope.checked.disableRadio=!1,deferred.resolve())}),deferred.promise}function callGTMImpression(){if(void 0!==$scope.quotes){var allQuotes=$scope.quotes.concat($scope.newQuotes);allQuotes.length>0&&gtmObj.quotesImpression(allQuotes,$scope.preQuotesInfo.matrixLeadId,$scope.preQuotesInfo.custId,!1)}}function clearComparePlans(){$scope.comparePlanIds=[],CompareService.setComparePlanIds($scope.comparePlanIds),$scope.comparePlans=[],pbTrackerObj.logEvent({leadId:$scope.modifySelection.matrixLeadId,custId:$scope.modifySelection.custId,visitId:$scope.modifySelection.visitId,event:"Remove All Comparing Plans",pageName:"Quotes"}),setComparePlans(!1),CompareService.saveComparingPlanIds($scope.modifySelection.custId,$scope.comparePlanIds)}function setComparePlans(comingBackFromComparePage){$scope.comparePlanIds&&$scope.comparePlanIds.length>2&&$rootScope.isMobileDevice&&($scope.comparePlanIds=$scope.comparePlanIds.splice(0,2),CompareService.saveComparingPlanIds($scope.modifySelection.custId,$scope.comparePlanIds));var ids=angular.copy($scope.comparePlanIds);$scope.quotes=CompareService.markCompareSelectedPlans($scope.quotes,ids,comingBackFromComparePage),$scope.newQuotes=CompareService.markCompareSelectedPlans($scope.newQuotes,ids,comingBackFromComparePage),comingBackFromComparePage&&updateCompareStachel()}function updateCompareStachel(){$rootScope.pTabName.monthlyPlans?(_.each(allPlansData,function(plan,index){checkForExistenceAndPush(plan)}),_.each(quotes,function(plan){checkForExistenceAndPush(plan)})):_.each(quotes,function(plan){checkForExistenceAndPush(plan)})}function checkForExistenceAndPush(plan){var planId=plan.Plan_Id||plan.planId,index=$scope.comparePlanIds&&$scope.comparePlanIds.length>0?$scope.comparePlanIds.indexOf(planId):-1;index!=-1&&(CompareService.isPlanAlreadyPushedToStachel($scope.comparePlans,plan)||$scope.comparePlans.length<$scope.compareLimit&&($scope.comparePlans=CompareService.pushPlansToComparingList($scope.comparePlans,plan))),orderComparedPlans()}function orderComparedPlans(){$scope.comparePlans&&$scope.comparePlans.length>0&&$scope.comparePlanIds&&$scope.comparePlanIds.length>0&&_.each($scope.comparePlans,function(comparedPlan){comparedPlan.comparedOrder=$scope.comparePlanIds.indexOf(comparedPlan.planId)}),$scope.comparePlans=$filter("orderBy")($scope.comparePlans,["comparedOrder"])}$(".modal-backdrop").hide(),angular.element("body").removeAttr("style"),$scope.object={showArrow:!0,showLoader:!0,showQuotesPage:!1},$scope.groupTermJourney=!1,$scope.showCallOutText=!1,$scope.showQuotesPagePBButton=!1,$scope.showRidersSuggestionStachel=!1,$scope.knowMorePlan,$scope.isValidppt=!0,$scope.isValidCover=!0,$scope.nomineeBanner=!0,$scope.policyBanner=!0,$scope.isReferralLead=!1,$scope.visitUse=!!$location.$$search.visitUse&&$location.$$search.visitUse;var optimizeRiderService=termConfigObj.optimizeRiderService(),dummyCustId=termConfigObj.getFakeCustId();$scope.isSpouseJourney=!!angular.isDefined($routeParams.isSpouseJourney)&&$routeParams.isSpouseJourney,$scope.nriPlansSeperationMessage=QuotesService.nriPlansSeperationMessage;var customizeAnnualIncomeArray=CommonServiceTerm.populateOptionsList(2e5,5e6,1e5);$scope.isCityPopupEnabled=termConfigObj.showCityPopup()&&$cookies.get("custState"),$scope.progressiveJourney={show:!1,stage:"smoker",annualIncomeList:customizeAnnualIncomeArray,annualIncome:null,toLeft:!1,toRight:!1,secondVariant:!1,mobileNo:null,countryCode:392,otherCountryCode:null,smoker:null,visibleScreens:[],isNri:!1,spouse:null,city:null,cityName:$scope.isCityPopupEnabled?$cookies.get("custState"):null},$scope.countryCodes=[],$scope.minMobileNoLength=10,$scope.maxMobileNoLength=10,$scope.regexForMobileNo=new RegExp("^[6789]\\d{9}$"),$cookies.get("progressiveSecondVariant")&&($scope.progressiveJourney.secondVariant=!0),$scope.progressiveJourney.secondVariant&&($scope.progressiveJourney.stage="mobile"),$scope.isProgressiveJourney=function(){return QuotesService.callMultipleTimes()&&1*$scope.type.payType===1};var getCountryValidations=function(countryCodeId){GenericService.getRegexForCountry(countryCodeId).success(function(data,status,headers,config){if(data.regexInfo){$scope.minMobileNoLength=data.regexInfo.minLength,$scope.maxMobileNoLength=data.regexInfo.maxLength;var re=new RegExp(data.regexInfo.regex);$scope.regexForMobileNo=re}else $scope.minMobileNoLength=10,$scope.maxMobileNoLength=10,$scope.regexForMobileNo=new RegExp("^[6789]\\d{9}$")})},updateNRICountryInfo=function(countryCodeId){$scope.isNRI=392!=countryCodeId,$scope.isCountryOthers=999==countryCodeId,$scope.progressiveJourney.isNri=$scope.isNRI},setOtherCountryInfo=function(countryCodeId){resetCity(countryCodeId),$scope.modifySelection.mobileNo=null,$scope.modifySelection.otherCountryCode=null};$scope.getMobileNumberRegexForCountry=function(countryCodeId){setOtherCountryInfo(countryCodeId),updateNRICountryInfo(countryCodeId),getCountryValidations(countryCodeId)},$scope.getCountryCode=function(countryCodeId){return void 0!==countryCodeId&&null!==countryCodeId||(countryCodeId=392,$scope.modifySelection.countryId=392),$scope.modifySelection.countryId=parseInt($scope.modifySelection.countryId),PreQuotesService.getCountryCode($scope.countryCodes,countryCodeId)},$scope.changeCountryCode=function(){var countryCodeId=getCountryIdByCode($scope.modifySelection.otherCountryCode);countryCodeId?($scope.modifySelection.countryId=countryCodeId,getCountryValidations(countryCodeId),resetCity(countryCodeId,!1)):($scope.modifySelection.countryId=999,getCountryValidations(999),resetCity(999,!1)),$scope.isNRI=91!=$scope.modifySelection.otherCountryCode},$scope.getCountryList=function(){var detectedCountry;$rootScope.detectedCountry&&(detectedCountry=$rootScope.detectedCountry.toLowerCase()),CommonServiceTerm.getCountryCodes().then(function(data){$scope.countryCodes=data,$routeParams.isProgressiveJourney&&detectedCountry&&"india"!=detectedCountry&&"zz"!=detectedCountry&&_.each($scope.countryCodes,function(countryObj){var country=countryObj.CountryName.toLowerCase();country.indexOf(detectedCountry)!=-1&&392!=countryObj.CountryCodeId&&$scope.getMobileNumberRegexForCountry(countryObj.CountryCodeId)})})}(),$scope.progressiveQuestionsLeft=function(){return $scope.isSpouseJourney?"spouse"===$scope.progressiveJourney.stage?$scope.isNRI?1:$scope.isCityPopupEnabled?2:1:"annualIncome"===$scope.progressiveJourney.stage?$scope.isNRI?2:$scope.isCityPopupEnabled?4:3:"occupationType"===$scope.progressiveJourney.stage?$scope.isCityPopupEnabled?3:2:"city"===$scope.progressiveJourney.stage?1:"smoker"===$scope.progressiveJourney.stage?$scope.isNRI?3:$scope.isCityPopupEnabled?5:4:5:"annualIncome"===$scope.progressiveJourney.stage?$scope.isNRI?1:$scope.isCityPopupEnabled?3:2:"occupationType"===$scope.progressiveJourney.stage?$scope.isCityPopupEnabled?2:1:"city"===$scope.progressiveJourney.stage?1:"smoker"===$scope.progressiveJourney.stage?$scope.isNRI?2:$scope.isCityPopupEnabled?4:3:4},$scope.progressiveQuotes={loading:!1},$timeout(function(){$scope.object.showQuotesPage=!0},100),$rootScope.quotesVariant=1,$scope.object.showQuotesPage=!0,$scope.object.showLoader=!1;var pid=angular.isDefined($routeParams.pid)?$routeParams.pid:"";if(pid){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("pid",pid,{expires:expireDate})}$rootScope.quotesVariant=0,$scope.totalPayoutOptions=[],$scope.monthlyPayoutOptions=[],$scope.coverageUptoOptions=CommonServiceTerm.populateOptionsList(28,99,1),$scope.payTypeOptions=[{value:1,displayValue:"Regular"},{value:2,displayValue:"Single Pay"},{value:3,displayValue:"Limited Pay"}],$scope.payTypeOptions=[{value:1,displayValue:"Regular"},{value:2,displayValue:"Single Pay"},{value:3,displayValue:"Limited Pay"}],$scope.payOutOptions=[{value:1,displayValue:"Lumpsum"},{value:2,displayValue:"Monthly"},{value:4,displayValue:"Return of Premium"}],$scope.payTermOptions=[{value:"5",displayValue:"5"},{value:"10",displayValue:"10"},{value:"15",displayValue:"15"},{value:"20",displayValue:"20"},{value:"R",displayValue:"Regular Pay"}],$scope.addOn={isClicked:!1},$scope.isCallBackAlreadyInitiated=!0,$scope.isAllRiderLoaded=!1,$scope.quotesObj={isMonthly:void 0===$cookies.get("monthPrem")||"monthly"==$cookies.get("monthPrem")},$scope.expressServiceText="Post sale customer queries will be resolved in the first call through a fast lane customer service team.",$scope.paymentModeDropdown={isMonthly:$scope.quotesObj.isMonthly?"monthly":"yearly"},$rootScope.isMobileDevice&&($scope.quotesObj.isMonthly=!0),$scope.previousRiderSelection=[];var previousSelectedRiderIds=[];$scope.showCompareStachel=!1,$scope.payTill60Clicked=!1,$scope.tollFreeNumber="1800-419-7713";var sudoSelectedRiderList=[];$scope.filterMobile=!1,$scope.filterQuotesObj={},$scope.filterQuotesObjType={},$scope.filterQuotesObjDate={dobDate:null,dobMonth:null,dobYear:null},$scope.annualIncomeList=[{id:6,name:"15 Lac +"},{id:5,name:"10-15 Lac"},{id:4,name:"7-10 Lac"},{id:3,name:"5-7 Lac"},{id:2,name:"3-5 Lac"},{id:8,name:"2-3 Lac"},{id:7,name:"< 2 Lac"}],$scope.spouseAge=[{id:18,value:18},{id:19,value:19},{id:20,value:20},{id:21,value:21},{id:22,value:22},{id:23,value:23},{id:24,value:24},{id:25,value:25},{id:26,value:26},{id:27,value:27},{id:28,value:28},{id:29,value:29},{id:30,value:30},{id:31,value:31},{id:32,value:32},{id:33,value:33},{id:34,value:34},{id:35,value:35},{id:36,value:36},{id:37,value:37},{id:38,value:38},{id:39,value:39},{id:40,value:40},{id:41,value:41},{id:42,value:42},{id:43,value:43},{id:44,value:44},{id:45,value:45},{id:46,value:46},{id:47,value:47},{id:48,value:48},{id:49,value:49},{id:50,value:50},{id:51,value:51},{id:52,value:52},{id:53,value:53},{id:54,value:54},{id:55,value:55},{id:56,value:56},{id:57,value:57},{id:58,value:58},{id:59,value:59},{id:60,value:60},{id:61,value:61},{id:62,value:62},{id:63,value:63},{id:64,value:64},{id:65,value:65}],$scope.annualIncomeError={status:!1,errorMessage:""},$scope.filterReverseDataMobile={},$scope.tabMobile={filterQuotesObjTab:"1"},$scope.filterQuotesObjMonthly=!1,$scope.mobileSectionUpdateStatus={profile:!1,selection:!1,paytype:!1,riders:!1,tab:!1,coverage:!1},$scope.expressServiceText="Post sale customer queries will be resolved in the first call through a fast lane customer service team.",$scope.baseHDFCPlanPremium={yearly:0,monthly:0},$scope.hdfc3dPlanCollapsed=!1,$scope.type={payType:$localStorage.payOptionType||1,ppt:$localStorage.selectedPayTerm&&"Pay Till 60"!=$localStorage.selectedPayTerm?$localStorage.selectedPayTerm:"10"},$cookies.put("changedOnce",!1);var ipAddress=0;$scope.aegonObj={},$scope.messageIndex=[];var premMode=$scope.quotesObj.isMonthly?"monthly":"yearly";$cookies.put("monthPrem",premMode);var filterChanged="";$scope.isAffiliates=!1;var saveJRFlags={};$scope.isInternalIP=!0;var jointLifeRiderClicked=!1;$location.$$search.refId;$rootScope.updateCss=!!$location.$$search.updCss;var filteredPnb99Obj=[],filteredAegon100Obj=[];$location.$$search.refId&&($localStorage.enquiryId=$routeParams.enquiryId),$location.$$search.AgentId&&($localStorage.AgentId=$location.$$search.AgentId),$location.search("refId",null).replace(),gtmObj.callGAOnPageLoad($location.$$url);var parentTabName=$cookies.get("pTabName")||"",defaultProfile=(GenericService.planCategoryTextMappingObject(),{spouse:!1,child:!1}),filterParam="",policyChangedByClick=!1,defaultRiderPremiums=[],planIdsArray=[];$scope.arrowName="";var quotes=[],allPlansData=[],dummyPlansExist=!1,dummyPlansReplaced=!1,callMultiple=QuotesService.callMultipleTimes()&&1*$scope.type.payType===1;$scope.quotes=[],$scope.medicalGridInfo={},$scope.newQuotes=[],$scope.setToDefaultVisible=!1,$scope.sortObj={},$scope.comparePlanIds=[],$scope.loadingQuotes=!1,$scope.comparePlans=[],$scope.compareLimit=$rootScope.isMobileDevice?2:5,$scope.riderAddOns={wholeLifeChecbox:!1,payTillSixtyChecbox:!1},$scope.sixtyYearRiderText="Pay till 60 years",$scope.tenYearRiderText="Pay for 10 years",$scope.reverseData=GenericService.reverseData(),$scope.checked={},$scope.checked.disableRadio=!1,$scope.agentObj={},$scope.filterArray=[],$scope.showRiders={},$scope.showRiders.showRidersToSelect=!1,$scope.showRiders.showProfileToSelect=!1,$scope.agentObj.isAgent=!0,$rootScope.enquiryId=CommonServiceTerm.getEnquiryId()||$routeParams.enquiryId,$scope.enquiryId=CommonServiceTerm.getEnquiryId()||$routeParams.enquiryId,$rootScope.pageClass=$rootScope.isMobileDevice?"quotes-mobile":"quote",$scope.showMobileChatButton=!1,$scope.showPnb99Plan=termConfigObj.showPnb99Plan(),$scope.types=[{key:"basic_critical_illness",status:!1,id:11,name:"Critical illness"},{key:"accidental_death",status:!1,id:10,name:"Death due to accident"},{key:"waiver_of_premium",status:!1,id:38,name:"Waiver Of Premium"},{key:"accidental_disability",status:!1,id:12,name:"Disability due to accident"},{key:"hospitalization_benefit",status:!1,id:47,name:"Cash for hospitalization"},{key:"terminal_illness",status:!1,id:101,name:"Terminal Illness"},{key:"joint_life",status:!1,id:13,name:"Cover for spouse"},{key:"enchanced_critical_illness",status:!1,id:15,name:"Enhanced Critical Illness"},{key:"cancer_care",status:!1,id:14,name:"Cancer Cover"},{key:"heart_cancer_care",status:!1,id:18,name:"Heart and Cancer Cover"}],$scope.isSpouseWorking=null,$scope.tab={},$scope.tab.tabValue="1",$scope.filteredCityList=[],$scope.termSwitchBackValue=null,$rootScope.pTabName={onetimePlans:!(!angular.isDefined($cookies.get("pTabName"))||"onetimePlans"!=$cookies.get("pTabName")),monthlyPlans:!(!angular.isDefined($cookies.get("pTabName"))||"monthlyPlans"!=$cookies.get("pTabName")),tropPlans:!(!angular.isDefined($cookies.get("pTabName"))||"tropPlans"!=$cookies.get("pTabName")),allPlans:!(!angular.isDefined($cookies.get("pTabName"))||"allPlans"!=$cookies.get("pTabName")),wholeLifePlans:!(!angular.isDefined($cookies.get("pTabName"))||"wholeLifePlans"!=$cookies.get("pTabName"))},($cookies.get("pid")&&(111==$cookies.get("pid")||31==$cookies.get("pid"))||$cookies.get("pid")==-1)&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!0,parentTabName="wholeLifePlans"),$cookies.get("pid")&&($scope.type.payType=1),$cookies.get("pidWithPayType")&&($scope.type.payType=$cookies.get("pidWithPayType")),$scope.isContinue={disabled:!1},$rootScope.pTabName.onetimePlans?$scope.tab.tabValue="1":$rootScope.pTabName.monthlyPlans?$scope.tab.tabValue="2":$rootScope.pTabName.allPlans?$scope.tab.tabValue="3":$rootScope.pTabName.tropPlans?$scope.tab.tabValue="4":$rootScope.pTabName.wholeLifePlans?$scope.tab.tabValue="5":($rootScope.pTabName.onetimePlans=!0,$scope.tab.tabValue="1"),$rootScope.tabName={maxPayout:!(!angular.isDefined($cookies.get("tabName"))||"maxPayout"!=$cookies.get("tabName"))},$rootScope.tabName.maxPayout||($rootScope.tabName.maxPayout=!0),$rootScope.isMonthlyIncomeJourney&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1),$rootScope.profile=angular.isDefined($rootScope.profile)?$rootScope.profile:defaultProfile;var totalPayoutLimit=function(){return $rootScope.pTabName.tropPlans?15e5:1e6},totalPayoutOptionTop=CommonServiceTerm.populateOptionsList(totalPayoutLimit(),9999999,5e5),totalPayoutOptionbottom=CommonServiceTerm.populateOptionsList(1e7,2e8,1e6);$scope.totalPayoutOptions=totalPayoutOptionTop.concat(totalPayoutOptionbottom),$scope.monthlyPayoutOptions=CommonServiceTerm.populateOptionsList(3e4,2e6,1e4),$scope.changeSorting=function(){var filterArrayLocal=$scope.filterArray,payTillSixtyQuotes=[],coverageUptoQuotes=[];if(filterChanged.length>0&&($scope.setToDefaultVisible=!0,$scope.sortObj.sortByDropdownValue=1,$scope.filterArray=[filterChanged,"-Priority","allTotalPremium"],null===filterChanged.match("Coverage")||$scope.reverseData.coverUptoReverse||($localStorage.filterArray=$scope.filterArray)),_.each($scope.quotes,function(quote){delete quote.quoteHide,delete quote.showViewMorePlansLink,delete quote.showMore}),1*$scope.type.payType!==1){var dividedQuotesArray=[],allQuotesDum=$scope.quotes.concat($scope.newQuotes);dividedQuotesArray=GenericService.divideQuotesInTwo(allQuotesDum),$scope.quotes=dividedQuotesArray[0],$scope.newQuotes=dividedQuotesArray[1]}if(filterArrayLocal=$scope.filterArray,null===filterChanged.match("allTotalPremium")&&(null!=filterChanged.match("Coverage")||filterArrayLocal.indexOf("allTotalPremium")==-1&&filterArrayLocal.indexOf("-allTotalPremium")==-1)||(filterArrayLocal=toggleSortingKey(filterArrayLocal)),null==filterChanged.match("Coverage")&&$localStorage.filterArray&&$localStorage.filterArray.length>0&&$localStorage.filterArray.indexOf("-newCoverageUpto")>-1&&filterArrayLocal.splice(0,0,"-newCoverageUpto"),$scope.quotes=$filter("orderBy")($scope.quotes,filterArrayLocal),$scope.quotes=QuotesService.groupByInsurer($scope.quotes),coverageUptoQuotes=$scope.quotes.filter(function(quote){return!quote.newCoverageUpto||quote.newCoverageUpto!=$scope.modifySelection.policyCoverage}),$scope.quotes=$scope.quotes.filter(function(quote){return quote.newCoverageUpto&&quote.newCoverageUpto==$scope.modifySelection.policyCoverage}),$scope.quotes=$scope.quotes.concat(coverageUptoQuotes),$scope.newQuotes.length>0&&($scope.newQuotes=$filter("orderBy")($scope.newQuotes,filterArrayLocal),$scope.newQuotes=QuotesService.groupByInsurer($scope.newQuotes)),1*$scope.type.payType==3&&"Pay Till 60"!=$localStorage.selectedPayTerm&&(payTillSixtyQuotes=$scope.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)>-1}),payTillSixtyQuotes&&payTillSixtyQuotes.length>0?payTillSixtyQuotes[0].message=!0:"",$scope.quotes=$scope.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)==-1}),$scope.quotes=payTillSixtyQuotes&&payTillSixtyQuotes.length>0?$scope.quotes.concat(payTillSixtyQuotes):$scope.quotes),void 0!==$scope.quotes){var allQuotes=$scope.quotes.concat($scope.newQuotes);allQuotes.length>0&&(gtmObj.quotesImpression(allQuotes,$scope.preQuotesInfo.matrixLeadId,$scope.preQuotesInfo.custId,!1),showMessageForCoverageSort())}},$scope.mobileFilterOpenTrack=function(value){pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Filter click",pageName:"Quotes",click:"Click"}),gaTagsNew.payTypeChange("MobileFilterClick",value,$scope.modifySelection.custId)},$scope.toggleIcon=function(instance){$scope[instance]=!$scope[instance]},$scope.toggleFilterMobile=function(value){updateDropDownValues();var show="show"==value;show?($scope.preQuotesInfo.city=angular.copy($scope.selectedCityItem.name),angular.copy($scope.preQuotesInfo,$scope.modifySelection),$scope.filterQuotesObj=angular.copy($scope.modifySelection),$timeout(function(){$scope.filterQuotesObj.annualIncome=String($scope.filterQuotesObj.annualIncome)},0),$scope.filterQuotesObjRiders=angular.copy($scope.types),$scope.filterQuotesObjType.payType=angular.copy($scope.type.payType),$scope.filterQuotesObjDate=CommonServiceTerm.extractDOB($scope.filterQuotesObj.dob),$scope.filterReverseDataMobile=angular.copy($scope.reverseData),$scope.filterQuotesObjMonthly=$rootScope.pTabName.monthlyPlans,$rootScope.pTabName.onetimePlans||$rootScope.pTabName.allPlans?$scope.tabMobile.filterQuotesObjTab="1":$rootScope.pTabName.monthlyPlans?$scope.tabMobile.filterQuotesObjTab="2":$rootScope.pTabName.tropPlans?$scope.tabMobile.filterQuotesObjTab="4":$rootScope.pTabName.wholeLifePlans&&($scope.tabMobile.filterQuotesObjTab="5"),$rootScope.footerLoad=!1,$scope.filterMobile=show,$scope.filterQuotesObj.city||$scope.focusEditProfile()):($scope.filterMobile=show,$scope.handlePayoutFocusBlur("isReadable"),$scope.handleMonthlyIncomeFocusBlur("isReadable"),$scope.handlePolicyDurationFocusBlur("isReadable"),$timeout(function(){var someElement=angular.element("body").focus();someElement&&$document.scrollToElement(someElement,10,300)},100),$rootScope.footerLoad=!0)},$scope.updateAnnualIncome=function(){$scope.mobileSectionUpdateStatus.profile=!0,$scope.modifySelection.annualIncome=$scope.filterQuotesObj.annualIncome},$scope.focusEditProfile=function(){$timeout(function(){var someElement=angular.element("#filter-edit-profile").focus();someElement&&$document.scrollToElement(someElement,10,300)},100)},$scope.focusRiderSelection=function(){$timeout(function(){var someElement=angular.element("#divFeatureFilter").focus();someElement&&$document.scrollToElement(someElement,50,300)},100)},$scope.hideShowPlans=function(plan,flag,$event){function start(counter){counter<15&&setTimeout(function(){counter++,window.scrollBy(0,20),start(counter)},50)}$(window).height()-$event.target.getBoundingClientRect().top<200&&start(0),_.each($scope.quotes,function(quote){quote.Supplier_Id==plan.Supplier_Id&&void 0!==quote.quoteHide&&null!==quote.quoteHide&&(quote.quoteHide=flag)}),_.each($scope.newQuotes,function(quote){quote.Supplier_Id==plan.Supplier_Id&&void 0!==quote.quoteHide&&null!==quote.quoteHide&&(quote.quoteHide=flag)}),plan.showMore=!flag},$routeParams.pTabName&&(angular.forEach($rootScope.pTabName,function(value,key){$rootScope.pTabName[key]=!1}),$rootScope.pTabName[$routeParams.pTabName]=!0,$cookies.put("pTabName",$routeParams.pTabName),angular.forEach($rootScope.tabName,function(value,key){$rootScope.tabName[key]=!1}),"allPlans"==$routeParams.pTabName&&($rootScope.tabName[$routeParams.tabName]=!0,$cookies.put("tabName",$routeParams.tabName)),$routeParams.pTabName=null,$routeParams.tabName=null,$rootScope.pTabName.onetimePlans?$scope.tab.tabValue="1":$rootScope.pTabName.monthlyPlans?$scope.tab.tabValue="2":$rootScope.pTabName.allPlans?$scope.tab.tabValue="3":$rootScope.pTabName.tropPlans?$scope.tab.tabValue="4":$rootScope.pTabName.wholeLifePlans?$scope.tab.tabValue="5":($rootScope.pTabName.onetimePlans=!0,$scope.tab.tabValue="1"),$location.url($location.path())),$scope.changeSingleSorting=function(planId,showLoader){var filterArrayLocal=$scope.filterArray,payTillSixtyQuotes=[],coverageUptoQuotes=[];if(filterChanged.length>0&&(planId=void 0,$scope.setToDefaultVisible=!0,$scope.sortObj.sortByDropdownValue=1,null==filterChanged.match("allTotalPremium")?$scope.filterArray=[filterChanged,"-Priority","allTotalPremium"]:(showLoader&&$timeout(function(){$scope.isQuotesLoaded=!1,$scope.hideObject.quotes=!0},0),$scope.filterArray=[filterChanged],$scope.filterArray.push("-Priority")),null===filterChanged.match("Coverage")||$scope.reverseData.coverUptoReverse||($localStorage.filterArray=$scope.filterArray)),filterArrayLocal=$scope.filterArray,null===filterChanged.match("allTotalPremium")&&(null!=filterChanged.match("Coverage")||filterArrayLocal.indexOf("allTotalPremium")==-1&&filterArrayLocal.indexOf("-allTotalPremium")==-1)||(filterArrayLocal=toggleSortingKey(filterArrayLocal)),null==filterChanged.match("Coverage")&&$localStorage.filterArray&&$localStorage.filterArray.length>0&&$localStorage.filterArray.indexOf("-newCoverageUpto")>-1&&filterArrayLocal.splice(0,0,"-newCoverageUpto"),1*$scope.type.payType!==1){var dividedQuotesArray=[],allQuotesDum=$scope.quotes.concat($scope.newQuotes);dividedQuotesArray=GenericService.divideQuotesInTwo(allQuotesDum),$scope.quotes=dividedQuotesArray[0],$scope.newQuotes=dividedQuotesArray[1]}if($rootScope.pTabName.onetimePlans)$scope.quotes=$filter("orderBy")($scope.quotes,filterArrayLocal),$scope.quotes=QuotesService.groupTropTogether($scope.quotes,planId),coverageUptoQuotes=$scope.quotes.filter(function(quote){return!quote.newCoverageUpto||quote.newCoverageUpto!=$scope.modifySelection.policyCoverage}),$scope.quotes=$scope.quotes.filter(function(quote){return quote.newCoverageUpto&&quote.newCoverageUpto==$scope.modifySelection.policyCoverage}),$scope.quotes=$scope.quotes.concat(coverageUptoQuotes),(1*$scope.preQuotesInfo.policyCoverage>85||1*$scope.preQuotesInfo.policyCoverage-1*$scope.preQuotesInfo.customerAge>50)&&($scope.quotes=QuotesService.groupWholeLifeTogether($scope.quotes,$scope.preQuotesInfo.policyCoverage)),$scope.newQuotes.length>0&&($scope.newQuotes=$filter("orderBy")($scope.newQuotes,filterArrayLocal));else if($rootScope.pTabName.tropPlans){if($scope.quotes=$filter("orderBy")($scope.quotes,filterArrayLocal),!$scope.setToDefaultVisible){var indexOfAegonIreturn=$scope.quotes.getIndexBy("Plan_Id",736),indexOfAegonItermForever=$scope.quotes.getIndexBy("Plan_Id",879);indexOfAegonIreturn!=-1&&indexOfAegonItermForever!=-1&&($scope.quotes=$scope.quotes.move(indexOfAegonItermForever,indexOfAegonIreturn))}if($scope.newQuotes.length>0&&($scope.newQuotes=$filter("orderBy")($scope.newQuotes,filterArrayLocal),!$scope.setToDefaultVisible)){var indexOfAegonIreturnNewQuotes=$scope.newQuotes.getIndexBy("Plan_Id",736),indexOfAegonItermForeverNewQuotes=$scope.newQuotes.getIndexBy("Plan_Id",879);indexOfAegonIreturnNewQuotes!=-1&&indexOfAegonItermForeverNewQuotes!=-1&&($scope.newQuotes=$scope.newQuotes.move(indexOfAegonItermForeverNewQuotes,indexOfAegonIreturnNewQuotes))}}else $scope.quotes=GenericService.showMonthlyPremiumTop($scope.quotes,$scope.filterArray),$scope.newQuotes.length>0&&($scope.newQuotes=GenericService.showMonthlyPremiumTop($scope.newQuotes,$scope.filterArray));if(1*$scope.type.payType==3&&"Pay Till 60"!=$localStorage.selectedPayTerm&&(payTillSixtyQuotes=$scope.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)>-1}),payTillSixtyQuotes&&payTillSixtyQuotes.length>0?payTillSixtyQuotes[0].message=!0:"",$scope.quotes=$scope.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)==-1}),$scope.quotes=payTillSixtyQuotes&&payTillSixtyQuotes.length>0?$scope.quotes.concat(payTillSixtyQuotes):$scope.quotes),void 0!==$scope.quotes){var allQuotes=$scope.quotes.concat($scope.newQuotes);allQuotes.length>0&&(gtmObj.quotesImpression(allQuotes,$scope.preQuotesInfo.matrixLeadId,$scope.preQuotesInfo.custId,!1),showMessageForCoverageSort())}showLoader&&$timeout(function(){$scope.isQuotesLoaded=!0,$scope.hideObject.quotes=!1},1e3)},$scope.collapseAegon=function(){$scope.checked.disableRadio||($scope.tab.tabValue=4,$scope.changeTabRadio(),gaTagsNew.trackBlueStripClick("tropPlans"),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Blue Sliver - TROP click",pageName:"Quotes",click:"Click"}))},$scope.collapseWholeLife=function(eventName){$scope.checked.disableRadio||($scope.tab.tabValue=5,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!0,$scope.changeTabRadio(),gaTagsNew.trackBlueStripClick(eventName),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"wholeLifePlans"===eventName?"On Blue Sliver - Whole Life click":"On Blue Sliver - PNB 99 Plan click",pageName:"Quotes",click:"Click"}))},$scope.returnToOneTimeTab=function(){$scope.checked.disableRadio||($scope.tab.tabValue=1,$scope.changeTabRadio(),gaTagsNew.trackBlueStripClick("onetimePlans"))},$scope.isAegonTropPlan=function(planId){return!!$rootScope.pTabName.onetimePlans&&GenericService.isAegoniReturnPlan(planId)},$scope.isAegoniTermStickerVisible=function(planId,term){return term<75&&$scope.isAegoniTermPlan(planId)},$scope.isAegoniTermPlan=function(planId){return!!$rootScope.pTabName.onetimePlans&&GenericService.isAegoniTermPlan(planId)},$scope.isCustomerDataLoaded=!1,$scope.sortObj.sortByDropdownValue=15,$scope.object={showArrow:!0,showLoader:!1},$scope.setArrowLoaderObject=function(showArrow,showLoader){$scope.object.showArrow=showArrow,$scope.object.showLoader=showLoader},$scope.setToDefault=function(clicked){if(clicked&&($scope.riderAddOns.wholeLifeChecbox=!1,$scope.riderAddOns.payTillSixtyChecbox=!1,filterChanged="",$scope.sortObj.sortByDropdownValue=15,$scope.setToDefaultVisible=!1,$localStorage.filterArray=null,pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Set to default click",pageName:"Quotes",click:"Click"})),clicked&&($scope.modifySelection.customerAge>=35&&1*$scope.modifySelection.policyCoverage!==75||$scope.modifySelection.customerAge<35&&1*$scope.modifySelection.policyCoverage!==70)){var isAnyTrue=!1;_.each($scope.types,function(val){val.status&&(isAnyTrue=!0,val.status=!1)}),callRiderChangeCategoryList().then(function(){$scope.modifySelection.customerAge<=50?$scope.modifySelection.policyCoverage=60:$scope.modifySelection.customerAge>50&&($scope.modifySelection.policyCoverage=$scope.modifySelection.customerAge+10),$scope.sortObj.sortByDropdownValue=1,$scope.saveCustomerSelection()})}else{if(gaTagsNew.editProfileTrack("SetToDefault",-1,$scope.modifySelection.custId),$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?(policyChangedByClick?($scope.filterArray=["-Priority","allTotalPremium"],filterParam="BasicPremium",$scope.arrowName="BasicPremium"):($rootScope.profile.spouse||$rootScope.profile.child?$scope.filterArray=["profileSort","-Priority","allTotalPremium"]:$scope.filterArray=["-Priority","allTotalPremium"],filterParam="BasicPremium"),policyChangedByClick=!1):($rootScope.profile.spouse||$rootScope.profile.child?$scope.filterArray=["profileSort","-Priority","CostPerLac","allTotalPremium"]:$scope.filterArray=["-Priority","CostPerLac","allTotalPremium"],filterParam="CostPerLac"),!clicked&&!$rootScope.profile.spouse&&!$rootScope.profile.child){var sortByCoverage=!1;sortByCoverage=$scope.preQuotesInfo.policyTerm>75||$scope.preQuotesInfo.policyTerm>1*$scope.preQuotesInfo.customerAge+40,!$rootScope.pTabName.wholeLifePlans||1*$scope.modifySelection.policyCoverage!==99&&1*$scope.modifySelection.policyCoverage!==100||(sortByCoverage=!1),$localStorage.filterArray&&(sortByCoverage?($scope.filterArray=$localStorage.filterArray,filterChanged="-newCoverageUpto"):(filterChanged="",
$scope.filterArray=["-Priority","allTotalPremium"]))}if($rootScope.pTabName.allPlans||$rootScope.pTabName.monthlyPlans)$scope.changeSorting();else{var plnId=831;$cookies.get("pid")&&$cookies.get("pid")==termConfigObj.getBAXASupplier()&&(plnId=749),$scope.changeSingleSorting(plnId)}$scope.sortObj.sortByDropdownValue=15,$scope.arrowName="",GenericService.saveSortApplied(filterParam),clicked&&removeAllRidersSelected()}},$scope.payout={isEditable:!1,isReadable:!0},$scope.policyDuration={isEditable:!1,isReadable:!0},$scope.monthlyIncome={isEditable:!1,isReadable:!0},$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.spouse={tobacco:[{value:1,label:"Yes"},{value:0,label:"No"}],isWorking:[{value:1,label:"Yes"},{value:0,label:"No"}]},$scope.genderOptions=[{value:1,label:"Male"},{value:2,label:"Female"}],$scope.showLink={email:!0,callback:GenericService.isTimeWithRange(),emailback:!0,call:!1,showMobileChatButton:!1,showCallbackButton:!1},$scope.toggleRidersFn=function(flag){if($scope.isAllRiderLoaded&&($scope.showRiders.showRidersToSelect=flag,!flag&&($scope.payTill60Clicked&&$scope.payTill60Click(),getSelectedRidersList().sort().join(",")!==sudoSelectedRiderList.sort().join(",")))){var selectedRiders=getSelectedRidersList();sudoSelectedRiderList=angular.copy(getSelectedRidersList()),callRiderChangeCategoryList(),$scope.handleFilterEvents(flag),selectedRiders.length>0&&CommonServiceTerm.dropRiderSelectionCookie()}},$scope.togglePayType=function(flag){$scope.showPayType=flag},$scope.proceedToRegularPay=function(){pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"Regular Payout Popup Proceed",pageName:"Quotes",click:"Click"}),$scope.type.payType=1,$scope.changePayType()},$scope.onCloseLimitedPayoutProceed=function(){$scope.toggleModal("term_popup_modal2","hide"),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"Limited Payout Popup Proceed Close",pageName:"Quotes",click:"Click"}),$scope.type.payType=3,$scope.changePayType()},$scope.limitedPayoutProceed=function(){$scope.toggleModal("term_popup_modal2","hide"),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"Limited Payout Popup Proceed",pageName:"Quotes",click:"Click"}),$scope.type.payType=3,$scope.changePayType()},$scope.validatePayTerm=function(payTerm,coverageUpto){var errorMsg,isValid=!0;if(1*$scope.type.payType===3){var payTermValue=payTerm?payTerm:1*$scope.type.ppt,coverageUptoValue=coverageUpto?coverageUpto:1*$scope.preQuotesInfo.policyCoverage;isValid=coverageUptoValue>1*$scope.preQuotesInfo.customerAge+1*payTermValue,!isValid&&coverageUpto&&(errorMsg="Cover should be greater than "+($scope.preQuotesInfo.customerAge+payTermValue)),!isValid&&payTerm&&(errorMsg="Pay term should be less than "+(coverageUptoValue-$scope.preQuotesInfo.customerAge))}return isValid+":"+errorMsg},$scope.changePPT=function(option){if("Regular Pay"==$scope.type.ppt)$scope.type.ppt="10",$scope.proceedToRegularPay();else{var value=$scope.type.ppt;$localStorage.selectedPayTerm=value,"Pay Till 60"===value&&(value=60-$scope.preQuotesInfo.customerAge),$scope.type.ppt=value;var isValidpptDesc=$scope.validatePayTerm($scope.type.ppt,void 0);$scope.isValidppt="true"==isValidpptDesc.split(":")[0],$scope.isValidppt||($scope.pptErrorDesc=isValidpptDesc.split(":")[1]),$scope.isValidppt&&($scope.isQuotesLoaded=!1,$scope.getQuotes($scope.modifySelection))}},$scope.changePayType=function(){var payType;switch(1*$scope.type.payType){case 2:payType="Single";break;case 3:payType="Limited";break;default:payType="Regular"}$localStorage.payOptionType=$scope.type.payType,$scope.mobileSectionUpdateStatus.riders&&callRiderChangeCategoryList(),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:1*$scope.type.payType===1?"On Regular Paytype click":1*$scope.type.payType===2?"On Single Paytype click":"On Limted Paytype click",pageName:"Quotes",click:"Click"}),$scope.isQuotesLoaded=!1,gaTagsNew.payTypeChange("PayTypeFilterClick",payType,$scope.modifySelection.custId),1*$scope.type.payType==3&&$scope.modifySelection.policyCoverage<65?($scope.quotes=[],$scope.newQuotes=[],allPlansData=[],$scope.modifySelection.policyCoverage=65,CustomerService.updateCustomerSelection($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){"success"==data.status&&successCallbackCustomerSelection()})):$scope.getQuotes($scope.preQuotesInfo),clearComparePlans()},$scope.toggleProfileFn=function(flag){$scope.showRiders.showProfileToSelect=flag},$scope.showChat={},$scope.showChat.showMobileChatButton=!1,$scope.showAddOnCoverHelpSection=!1,$scope.planOrder=0,$scope.citySearchText="",$scope.city="",$scope.cityerror=!1,$scope.maxAllowedPolicyCoverage=$scope.showPnb99Plan?99:85,$scope.modifySelection=QuotesService.buildDefaultModifySelectionObject(),$scope.data={dobDate:null,dobMonth:null,dobYear:null},$scope.dob={date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()},$scope.hideObject={loadSummaryPage:!1,isNoQuotesPresent:!1,isTropNotPresent:!1,singleComparePlanMessage:!0},$scope.showAddOn=!1,$scope.whatsThis={totalPayout:!1,policyCoverage:!1},$scope.isQuotesLoaded=!1,$scope.clickedPlanId=-1,$scope.customizePlan={stage:1,direction:1,tab:$scope.tab.tabValue,ciType:"none",accidentalDeathProtection:0,payType:1,highClaimSettlements:!1,annualIncomeList:customizeAnnualIncomeArray,apply:!1,minPlanPremium:680,fetchMsg:{status:!1,msg:"Calculating best quotes for you ... "},bannerText:[{heading:"",paragraph:""},{heading:"Term Life Insurance",paragraph:"Get a 1 Crore term insurance plan that covers against death, disease & disability for as low as"},{heading:"Term Life Insurance",paragraph:"Get a 1 Crore term insurance plan that covers against death, disease & disability for as low as"},{heading:"Term Life Insurance",paragraph:"Get a 1 Crore term insurance plan that covers against death, disease & disability for as low as"}]};var setContinueButtonDisabled=function(flag){$scope.isContinue.disabled=flag};$scope.toggleWhatsThis=function(keyName){$scope.whatsThis[keyName]=!$scope.whatsThis[keyName]},$scope.showHideAddOn=function(flag){$scope.showAddOn=flag},$scope.changeDate=function(model){$scope.data.dobDate=model,$scope.changeDateOfBirth()},$scope.changeMonth=function(model){$scope.data.dobMonth=model,$scope.changeDateOfBirth()},$scope.changeYear=function(model){$scope.data.dobYear=model,$scope.changeDateOfBirth()},$scope.customModalToggle=function(modalName,status,plan){$scope.knowMorePlan=plan,$scope.toggleModal(modalName,status)},$scope.changeDateOfBirth=function(){$scope.modifySelection.dob=$scope.data.dobDate+"-"+$scope.data.dobMonth+"-"+$scope.data.dobYear},$scope.isYearSelected=function(index,dobYear){return index==$scope.dob.year.indexOf(parseInt(dobYear))},$scope.isDOBMissing=function(){return!$scope.data.dobDate||!$scope.data.dobMonth||!$scope.data.dobYear},$scope.isValidDateOfBirth=function(){return $scope.modifySelection.dob&&GenericService.isValidDateOfBirth($scope.modifySelection.dob)},$scope.isMAXPlan=function(plan){return CommonServiceTerm.isMAXPlan(plan.Plan_Id)},$scope.isSbiPoornaSuraksha=function(plan){return CommonServiceTerm.isSbiPoornaSuraksha(plan.Plan_Id)},$scope.isTataPlan=function(plan){return CommonServiceTerm.isTataPlan(plan.Plan_Id)},$scope.AllowExpress=function(supplierId){var supplierIds=[5,10];return supplierIds.indexOf(1*supplierId)>-1},$scope.isAgeBelowMinimum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySelection.dob)<18},$scope.isAgeAboveMaximum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySelection.dob)>65},$scope.isValidAge=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySelection.dob)>=18&&CommonServiceTerm.getAge($scope.modifySelection.dob)<=65};var changeTabVisibility=function(isMonthlyIncomeJourney){isMonthlyIncomeJourney&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1)};$scope.preFillModifySelectionModel=function(data){$scope.modifySelection=GenericService.buildModifySelectionModel(data,$scope.enquiryId),extractDOB()};var getValue=function(value){return angular.isDefined(value)?value:null},extractDOB=function(){$scope.data.dobDate=getValue($scope.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB($scope.modifySelection.dob,0):null,$scope.data.dobMonth=getValue($scope.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB($scope.modifySelection.dob,1):null,$scope.data.dobYear=getValue($scope.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB($scope.modifySelection.dob,2):null},setSelectedCityItem=function(data){angular.copy(data,$scope.selectedCityItem)};$scope.onCityInputChange=function(){$scope.cityerror=!0},$scope.selectedCityCallBack=function($item,$model,$label,$event){$scope.modifySelection.cityId=$item.cityId,$scope.modifySelection.city=$item.value,$scope.modifySelection.stateId=$item.stateId,$scope.cityerror=!1},$scope.toggleAddOnCoverSection=function(flag){flag&&gaTagsNew.editProfileTrack("RiderWhatisThis",-1,$scope.modifySelection.custId),$scope.showAddOnCoverHelpSection=flag,pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"On What are these? click",pageName:"Quotes",click:"Click"})},$scope.minAllowedPolicyCoverage=function(){if(angular.isDefined($scope.preQuotesInfo)){var minPolicyTerm=10;return parseInt($scope.preQuotesInfo.customerAge,10)+minPolicyTerm}};var buildQuotesInputObject=function(data,nonPriorityPlans){var quotesInputObject=null,isSpouseAdded=$scope.isSpouseAdded(data),isChildAdded=$scope.isChildAdded(data),callMultiple=QuotesService.callMultipleTimes()&&1*$scope.type.payType===1;return $scope.isSpouseWorking=null,quotesInputObject=QuotesService.buildQuotesInputObject(data),$rootScope.profile.spouse&&isSpouseAdded&&$rootScope.profile.child&&isChildAdded?(quotesInputObject.policyTerm=QuotesService.getPolicyTermForSpouse(data),quotesInputObject.spouseAge=data.spouse.age,quotesInputObject.spouseTobacco=data.spouse.tobacco,quotesInputObject.isSpouseWorking=data.spouse.isWorking,quotesInputObject.childAge=data.child.age,$scope.isSpouseWorking=data.spouse.isWorking):$rootScope.profile.spouse&&isSpouseAdded?(quotesInputObject.policyTerm=QuotesService.getPolicyTermForSpouse(data),quotesInputObject.spouseAge=data.spouse.age,quotesInputObject.spouseTobacco=data.spouse.tobacco,quotesInputObject.isSpouseWorking=data.spouse.isWorking,$scope.isSpouseWorking=data.spouse.isWorking):$rootScope.profile.child&&isChildAdded&&(quotesInputObject.childAge=data.child.age,$scope.isSpouseWorking=null),quotesInputObject.refId=$localStorage.enquiryId,quotesInputObject.stateId=data.stateId,quotesInputObject.nri=1*data.countryId!==392?1:0,1*$scope.type.payType===2?(quotesInputObject.payOptionType="SinglePay",quotesInputObject.ppt=1):1*$scope.type.payType===3&&(quotesInputObject.payOptionType="LimitedPay",quotesInputObject.ppt=$scope.type.ppt||10),quotesInputObject.utmSource=data.utmSource,quotesInputObject.name=data.name,quotesInputObject.mobileNo=data.mobileNo,termConfigObj.getOptimizedQuotesApi()&&(quotesInputObject.isV2=!0),callMultiple&&(nonPriorityPlans?(quotesInputObject.isLumpsumOnly=!0,quotesInputObject.isTopLumSumPlanOnly=!1):(quotesInputObject.isLumpsumOnly=!1,quotesInputObject.isTopLumSumPlanOnly=!0)),quotesInputObject},initilizeZopim=function(){var isMobileDefault=!!$location.$$search.isMobileDefault,lead=$scope.preQuotesInfo.matrixLeadId;CustomerService.getChatInformation(lead).success(function(data){var obj={ChatTime:data.custInfo.chatTime,startTime:"10:00:00",endTime:"21:30:00"},workingHrs=(getFiltersForChat(),$scope.modifySelection.customerAge,GenericService.isWorkingHours(obj.ChatTime,obj.endTime,obj.startTime));!$scope.agentObj.isAgent&&(isMobileDefault||1*$scope.modifySelection.countryId!=392||GenericService.isChatAvailableInCity($scope.modifySelection.cityId))&&callQuotesApi()&&($scope.isInternalIP||"Zopim"===termConfigObj.getChatEnv()||CommonServiceTerm.loadScript("../../scripts/common-scripts/ScriptLiveChat.js","text/javascript","utf-8",function(){$rootScope.isMobileDevice?workingHrs&&($scope.showChat.showMobileChatButton=!0,ShowMobilechat($scope.modifySelection.userInfoId)):ShowDesktopchat($scope.modifySelection.userInfoId)}))})},getFiltersForChat=function(){var checkedFilters="";return angular.forEach($scope.types,function(value){value.status&&(checkedFilters+=value.name+" ; ")}),checkedFilters.length>0&&(checkedFilters=checkedFilters.replace(/;\s*$/,""),checkedFilters="["+checkedFilters+"]"),checkedFilters};$scope.getDisplayValue=function(plan,isMonthly,isDiscountValue){var offlinePremium=isMonthly&&plan.monthlyOfflinePremium?plan.monthlyOfflinePremium+plan.monthlyRiderPremiumAdded:plan.annualOfflinePremium+plan.riderPremiumAdded;return isMonthly&&"SinglePay"!=plan.payOptionType?GenericService.calculateDiscount(plan,plan.monthlyTotalPremium+plan.monthlyRiderPremiumAdded,isDiscountValue,offlinePremium):GenericService.calculateDiscount(plan,plan.ComboTotalPremium+plan.riderPremiumAdded,isDiscountValue,offlinePremium)},$scope.showSpouseCover=function(planId){return 787===planId||776===planId};var processPlans=function(plansToBeProcessed){if(plansToBeProcessed=_.uniq(plansToBeProcessed,"Plan_Id"),$scope.hideObject.isNoQuotesPresent=!(plansToBeProcessed.length>0),_.each(plansToBeProcessed,function(value){value.riderPremiumAdded=0,value.numInterestRate=value.interestRate?1*value.interestRate.split("%")[0]:0,value.monthlyRiderPremiumAdded=0,value.OneTimePayout=parseInt(value.OneTimePayout),value.SumAssured=parseInt(value.SumAssured),value.TotalCover=parseInt(value.TotalCover),value.maxOneTimePayout=parseInt(value.maxOneTimePayout),value.maxSumAssured=parseInt(value.maxSumAssured),value.maxTotalCover=parseInt(value.maxTotalCover),value.orgSumassured=parseInt(value.orgSumassured),value.maxAnnualReturn=parseInt(value.maxAnnualReturn),value.annualIncomeSort=QuotesService.sortPlanByAnnualIncome(value,$scope.preQuotesInfo),value.isRiderLoaded=!1,value.isRiderSelectedForMobile=!1,value.allMonthlyPremium=value.monthlyTotalPremium,value.excludeFromMonthlySorting=0,10===value.Supplier_Id&&$routeParams.isSpouseJourney&&(value.planProfile="SNW"),value.allMonthlyPremium||(delete value.allMonthlyPremium,value.excludeFromMonthlySorting=100),$rootScope.pTabName.allPlans?value.allTotalPremium=value.maxTotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?value.allTotalPremium=value.TotalPremium:value.allTotalPremium=value.maxTotalPremium,value.profileSort=3,void 0!==typeof $scope.preQuotesInfo.spouse&&null!=$scope.preQuotesInfo.spouse&&($rootScope.profile.spouse&&"SNW"==value.planProfile&&!$scope.preQuotesInfo.spouse.isWorking||"SW"==value.planProfile&&$scope.preQuotesInfo.spouse.isWorking)&&(value.profileSort=1),$rootScope.profile.child&&"C"==value.planProfile&&(value.profileSort=2)}),$rootScope.pTabName.monthlyPlans&&getAllPlansData(),$routeParams.AgentId||($localStorage.enquiryId=$scope.enquiryId),quotes=angular.copy(plansToBeProcessed),"undefined"!=typeof cxApi){var chosenVariation=cxApi.chooseVariation();$scope.isNotPrioritySorting=void 0!=chosenVariation&&1*chosenVariation===1}var filteredObj=GenericService.filterAllObjs(quotes,$scope.modifySelection,$scope.isNotPrioritySorting);return $rootScope.pTabName.tropPlans&&$scope.callIciciTrop(filteredObj),plansToBeProcessed=angular.copy(filteredObj),1*$scope.modifySelection.policyCoverage>=75?$rootScope.coverUptoDisplay=!0:$rootScope.coverUptoDisplay=!1,$scope.isQuotesLoaded=!0,$rootScope.quotesLoad=!0,$rootScope.pTabName.tropPlans?$scope.hideObject.isTropNotPresent=!(plansToBeProcessed.length>0):$scope.hideObject.isTropNotPresent=!1,window.prerenderReady=!0,plansToBeProcessed},quotesSuccessCallback=function(data,nonPriorityPlans){$timeout(function(){$scope.showQuotesPagePBButton=!0},2e3);var processedPlans=angular.copy(processPlans(data));processedPlans.length>0&&$scope.customerChangeInitiated&&($scope.quotes=[],$scope.newQuotes=[]),nonPriorityPlans?($scope.quotes=$scope.quotes.concat(processedPlans),$scope.object.showLoader=!1,$scope.loadingQuotes=!1):($scope.quotes=processedPlans,$scope.loadingQuotes=!1),1*$scope.modifySelection.annualIncome===7&&($scope.isReferralLead&&1==$scope.isReferralLead||$scope.isAffiliates)&&($scope.quotes=[],$scope.newQuotes=[]),$scope.setToDefault(),$scope.quotes=GenericService.setRiderObject($scope.quotes,$scope.preQuotesInfo,$scope.quotesObj.isMonthly),$scope.newQuotes=GenericService.setRiderObject($scope.newQuotes,$scope.preQuotesInfo,$scope.quotesObj.isMonthly),$scope.checked.disableRadio=!0,riderUpdateCall().then(function(){$scope.isAllRiderLoaded=!0,executeCommonScript(),callIndiInusrerFunc(quotes);var selectedRiders=getSelectedRidersList();sudoSelectedRiderList=angular.copy(selectedRiders),$scope.quotes=GenericService.getRidersPremiumForQuotes($scope.quotes,$scope.types,$scope.quotesObj.isMonthly),$scope.newQuotes.length>0?($scope.newQuotes=GenericService.getRidersPremiumForQuotes($scope.newQuotes,$scope.types,$scope.quotesObj.isMonthly),$scope.checked.disableRadio=!1):$scope.checked.disableRadio=!1,optimizeRiderService?addRiderValuesToThePlans(!0):selectedRiders.length>0&&addRiderValuesToThePlans()}),$location.$$search.isMatrixLeadCreated&&(CommonServiceTerm.callLeadGenerationTracking($scope.preQuotesInfo.matrixLeadId,$scope.preQuotesInfo.custId,$location.$$search.isMatrixLeadCreated,!1),$location.search("isMatrixLeadCreated",null).replace()),$routeParams.isCTC&&"true"==$routeParams.isCTC&&$scope.callBack(!1,!0),fetchMedicalGridData($scope.modifySelection)};$scope.openProgressiveJourneyQuestion=function(){var lastQuestionAnswered=void 0!==$cookies.get("last_question_answered")?$cookies.get("last_question_answered"):"",response=$scope.isCityPopupEnabled?"city":$scope.isSpouseJourney?"spouse":"professiontype";$scope.isSpouseJourney||lastQuestionAnswered===response||"annualincome"===lastQuestionAnswered||$routeParams.LeadId&&$routeParams.AgentId||showQuestions(),!$scope.isSpouseJourney||lastQuestionAnswered===response||$routeParams.LeadId&&$routeParams.AgentId||showQuestions(),"smoker"===lastQuestionAnswered?$scope.switchProgressiveQuestions("annualIncome"):"annualincome"===lastQuestionAnswered?$scope.switchProgressiveQuestions("occupationType"):"occupationType"===lastQuestionAnswered&&$scope.isCityPopupEnabled&&$scope.switchProgressiveQuestions("city")},$scope.callIciciTrop=function(filteredObj){var tropObject=QuotesService.buildIpruTropObject($scope.modifySelection,filteredObj);QuotesService.getIpruTropPlan(tropObject).success(function(data,status,headers,config){var index;"success"==data.status?(data.planDetail.riderPremiumObject=[],data.planDetail=GenericService.filterAllObjs([data.planDetail],$scope.modifySelection)[0],filteredObj.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?filteredObj.splice(index,1,data.planDetail):"",$scope.quotes.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?$scope.quotes.splice(index,1,data.planDetail):"",fetchMedicalGridData($scope.modifySelection)):(filteredObj.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?filteredObj.splice(index,1):"",$scope.quotes.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?$scope.quotes.splice(index,1):"")})},$scope.getComboTotalPremiumDifference=function(plan){if(749===plan.Plan_Id){if(filteredPnb99Obj[0])return $scope.addCommas(filteredPnb99Obj[0].ComboTotalPremium-plan.ComboTotalPremium)}else if(CommonServiceTerm.isAegonPlan(plan.Plan_Id)&&filteredAegon100Obj[0])return $scope.addCommas(filteredAegon100Obj[0].ComboTotalPremium-plan.ComboTotalPremium)},$scope.hideARider=function(quote,preQuotesInfo,rider){var categoryId=1*rider.categoryId,countryId=1*preQuotesInfo.countryId;return 392!=countryId&&(11===categoryId||15===categoryId)&&(10!==quote.Supplier_Id||378!==countryId&&376!==countryId&&24!==countryId&&999!==countryId)},$scope.getMonthlyTotalPremiumDifference=function(plan){if(749===plan.Plan_Id){if(filteredPnb99Obj[0])return $scope.addCommas(filteredPnb99Obj[0].monthlyTotalPremium-plan.monthlyTotalPremium)}else if(CommonServiceTerm.isAegonPlan(plan.Plan_Id)&&filteredAegon100Obj[0])return $scope.addCommas(filteredAegon100Obj[0].monthlyTotalPremium-plan.monthlyTotalPremium)},$scope.chat=function(){HideNewMessage(),"Zopim"===termConfigObj.getChatEnv()||(document.getElementsByClassName("rocketchat-widget")[0].style.display="inline",document.getElementsByClassName("rocketchat-widget")[0].style.zIndex="12345",document.getElementsByClassName("rocketchat-widget")[0].style.position="fixed")},$scope.getQuotes=function(preQuotesData,isFirst,nonPriorityPlans){if(callMultiple=QuotesService.callMultipleTimes()&&1*$scope.type.payType===1,populateDummyPlans(),dummyPlansExist||$scope.customerChangeInitiated||($scope.quotes=[],$scope.newQuotes=[],allPlansData=[],$scope.isQuotesLoaded=!1),callMultiple&&!nonPriorityPlans&&$timeout(function(){$scope.getQuotes($scope.modifySelection,!1,!0)},0),$scope.isValidPolicyCoverage()){var input=buildQuotesInputObject(preQuotesData,nonPriorityPlans);QuotesService.getQuotes(input).success(function(data,status,headers,config){!angular.isDefined(data.status)||"failed"!=data.status&&"fail"!=data.status?angular.isDefined(data.msg)&&data.msg.indexOf("failed")>=0?quotesSuccessCallback(null):(quotesSuccessCallback(data,nonPriorityPlans),$scope.isNRI||1*$scope.modifySelection.annualIncome!==7||($scope.groupQuotes=angular.copy($scope.quotes)),isFirst&&$timeout(function(){if($scope.customerChangeInitiated=!1,preQuotesData.categoriesLastUpdatedTime&&preQuotesData.categoriesLastUpdatedTime>0){var date=new Date;(date.getTime()-preQuotesData.categoriesLastUpdatedTime)/864e5>=1&&$mdToast.show($mdToast.simple().content("Premium includes riders chosen by you!").position($scope.getToastPosition()).hideDelay(3e3))}$scope.isNRI||1*$scope.modifySelection.annualIncome!==7||($scope.quotes=$scope.isReferralLead&&1==$scope.isReferralLead||$scope.isAffiliates?[]:angular.copy($scope.groupQuotes))},3e3),$scope.showLink.emailback=!0):quotesSuccessCallback(null)})}else $scope.isQuotesLoaded=!0};var getCityObject=function(cityId){var obj=null;return angular.forEach($scope.city,function(value,key){cityId!=value.cityId&&cityId!=value.id||(obj=value)}),obj},policyCoverageDataSyncup=function(){$scope.preQuotesInfo.policyCoverage=angular.copy($scope.preQuotesInfo.policyTerm)},handleAddSpouse=function(){gaTagsNew.editProfileTrack("AddSpouse",-1,$scope.modifySelection.custId),$scope.toggleModal("spouse","show")},handleAddChild=function(){gaTagsNew.editProfileTrack("AddChild",-1,$scope.modifySelection.custId),$scope.toggleModal("child","show")},handleChildAgeZeroCase=function(data){data.child&&angular.isDefined(data.child.age)&&1*data.child.age===100&&($scope.preQuotesInfo.child={age:0})},isAgeChanged=function(){var info=$scope.preQuotesInfo,customerAge=info.customerAge?info.customerAge:"",getAge=$scope.getAge(info.dob);getAge=getAge?getAge:"",customerAge!==getAge&&$location.path("/").replace()},setIsMobileDefault=function(existUrl){existUrl&&existUrl.indexOf("isMobileDefault=false")!=-1&&$location.search("isMobileDefault",null).replace()},mobileDefaultCheck=function(){var isMobileDefault=!!$location.$$search.isMobileDefault;$scope.preQuotesInfo.city=isMobileDefault?null:$scope.preQuotesInfo.city,$scope.preQuotesInfo.cityId=isMobileDefault?null:$scope.preQuotesInfo.cityId,$scope.preQuotesInfo.state=isMobileDefault?null:$scope.preQuotesInfo.state,$scope.preQuotesInfo.stateId=isMobileDefault?null:$scope.preQuotesInfo.stateId,$scope.cityerror=!!isMobileDefault||$scope.cityerror,$scope.modifySelection.city=isMobileDefault?null:$scope.modifySelection.city,$scope.modifySelection.stateId=isMobileDefault?null:$scope.modifySelection.stateId,$scope.modifySelection.cityId=isMobileDefault?null:$scope.modifySelection.cityId,$scope.selectedCityItem={display:$scope.modifySelection.city,value:$scope.modifySelection.city,searchString:$scope.modifySelection.city,stateId:$scope.modifySelection.stateId,cityId:$scope.modifySelection.cityId}};$scope.restoreSession=function(){_.each($scope.types,function(val){previousSelectedRiderIds.indexOf(val.id)>-1&&(val.status=!0)}),previousSelectedRiderIds=[],$scope.previousRiderSelection=[],$scope.toggleRidersFn(!1),$scope.showRidersSuggestionStachel=!1,CommonServiceTerm.dropRiderSelectionCookie()},$scope.closeRestoreSessionMsg=function(){previousSelectedRiderIds=[],$scope.previousRiderSelection=[],callRiderChangeCategoryList(),$cookies.remove("Rider_Selected"),$scope.showRidersSuggestionStachel=!1,CommonServiceTerm.dropRiderSelectionCookie()};var checkForPreviousSession=function(data){return(data&&data.categoryIds&&data.categoryIds.length<=0||!data.categoryIds)&&CommonServiceTerm.dropRiderSelectionCookie(),data.categoryIds&&data.categoryIds.length>0&&"undefined"==typeof $cookies.get("Rider_Selected")&&(previousSelectedRiderIds=[],$scope.previousRiderSelection=[],_.each($scope.types,function(type){data.categoryIds.indexOf(type.id)>-1&&($scope.previousRiderSelection.push(type),previousSelectedRiderIds.push(type.id))}),data.categoryIds||$cookies.remove("Rider_Selected"),data.categoryIds=[]),data},checkAnnualIncomeEligibility=function(){7===$scope.preQuotesInfo.annualIncome?($scope.annualIncomeError.status=!0,$scope.annualIncomeError.errorMessage=""):$scope.annualIncomeError.status=!1};$scope.openAnnualIncomeModal=function(){$scope.modifySelection.annualIncome=$scope.modifySelection.annualIncome.toString(),$scope.toggleModal("annualIncomeModal","show")},$scope.saveSpouseAgeFromProgressive=function(){$scope.quotes=[],$scope.isQuotesLoaded=!1,$scope.modifySelection.spouse.age=1*$scope.progressiveJourney.spouse,$scope.modifySelection.spouse.spouseTobacco=0,$scope.modifySelection.spouse.isWorking=0,$scope.modifySelection.isSpouseJourney=$scope.isSpouseJourney,$scope.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1,$scope.mobileSectionUpdateStatus.profile=!0,$scope.progressiveJourney.visibleScreens.indexOf("spouse")===-1&&$scope.progressiveJourney.visibleScreens.push("spouse"),CustomerService.updateSpouseDetails($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){$rootScope.profile.spouse=!0,$cookies.put("isSpouseSelected",!0),!$scope.isNRI&&$scope.isCityPopupEnabled||CustomerService.saveProfessionType($scope.modifySelection.userInfoId,$scope.modifySelection.professionType).then(function(){$scope.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange($scope.modifySelection.annualIncome)),$scope.updateProfileDetails(!0,!0)})});var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","spouse",{expires:expireDate}),$scope.isNRI||!$scope.isCityPopupEnabled?hideQuestions():$scope.isCityPopupEnabled&&($timeout(function(){$scope.progressiveJourney.stage="city",$scope.progressiveCitySelected=!1,$scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1},0),$scope.progressiveJourney.visibleScreens.push("city"))},$scope.saveAnnualIncomeProgressive=function(){var timeout=0;$scope.modifySelection.annualIncome=1*$scope.progressiveJourney.annualIncome,1*$scope.modifySelection.annualIncome===7&&(timeout=2e3),$scope.modifySelection.recommendedCover=!0,$scope.isNRI||$timeout(function(){$scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1,$scope.progressiveJourney.stage="occupationType"},timeout),$scope.isNRI?$scope.progressiveJourney.visibleScreens.push("spouse"):$scope.progressiveJourney.visibleScreens.push("occupationType"),1*$scope.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:$scope.modifySelection.visitId,event:"On Annual Income Save",newValue:$scope.modifySelection.annualIncome,pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Annual Income Save",newValue:$scope.modifySelection.annualIncome,pageName:"Quotes",collection:"progressive_term"});var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","annualincome",{expires:expireDate}),$scope.isNRI&&($scope.isSpouseJourney?$timeout(function(){$scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1,$scope.progressiveJourney.stage="spouse"},timeout):hideQuestions()),$scope.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange($scope.modifySelection.annualIncome)),$scope.modifySelection.isMobileSinglePage=!0,$scope.progressiveJourney.isNri=$scope.modifySelection.nri,$scope.mobileSectionUpdateStatus.selection=!0,$scope.modifySelection.isSpouseJourney=$scope.isSpouseJourney,$scope.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1,$scope.isNRI||$scope.isSpouseJourney?$scope.isNRI&&!$scope.isSpouseJourney&&($scope.mobileSectionUpdateStatus.profile=!0,$scope.updateProfileDetails(!0,!0)):($scope.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1,$scope.modifySelection.nri=0,$scope.modifySelection.cityId=551,$scope.modifySelection.stateId=35,$scope.mobileSectionUpdateStatus.profile=!0,$scope.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange($scope.modifySelection.annualIncome)),$scope.updateProfileDetails(!0,!0))},$scope.saveAnnualIncome=function(){$routeParams.isProgressiveJourney&&"true"==$routeParams.isProgressiveJourney&&($scope.modifySelection.recommendedCover=!0),$scope.modifySelection.annualIncome=1*$scope.modifySelection.annualIncome,$scope.mobileSectionUpdateStatus.profile=!0,$scope.updateProfileDetails(!0)},$scope.progressiveCityClicked=function(){$scope.cityClicked=!0},$scope.progressiveCityError=function(){var value=!1;return $scope.progressiveJourney.city&&$scope.progressiveJourney.city.length>=3&&$('ul[role="listbox"]').length>0&&$('ul[role="listbox"]')[0].children&&$('ul[role="listbox"]')[0].children.length<=0&&!$scope.progressiveCitySelected&&(value=!0),value},$scope.saveCityProgressive=function($item,$model,$label,$event){$scope.progressiveJourney.city=$item,"yes"==$item?$scope.modifySelection.isStateChange=!0:$scope.modifySelection.isStateChange=!1;var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","city",{expires:expireDate}),$cookies.put("isStateChanged",$scope.modifySelection.isStateChange,{expires:expireDate}),$scope.progressiveJourney.visibleScreens.indexOf("city")===-1&&$scope.progressiveJourney.visibleScreens.push("city"),$timeout(function(){hideQuestions()},0),$scope.updateProfileDetails(!0,!0)},$scope.saveProfessionType=function(value){$scope.progressiveJourney.visibleScreens.push("spouse"),$scope.$$phase||$scope.$apply(),$scope.isNRI?($scope.progressiveJourney.stage="spouse",$scope.modifySelection.cityId=9999,$scope.modifySelection.nri=1*value,$scope.progressiveJourney.isNri=$scope.modifySelection.nri,1*$scope.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:$scope.modifySelection.visitId,event:"On is Nri Save",newValue:$scope.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,
visitId:$scope.modifySelection.visitId,event:"On is Nri Save",newValue:$scope.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"})):($scope.modifySelection.professionType=value,392!=$scope.modifySelection.countryId?($scope.modifySelection.cityId=9999,$scope.modifySelection.nri=1):($scope.modifySelection.nri=0,$scope.modifySelection.cityId=551),1*$scope.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:$scope.modifySelection.visitId,event:"On Profession Type Save",newValue:$scope.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Profession Type Save",newValue:$scope.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"}));var expireDate=new Date;if(expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","professiontype",{expires:expireDate}),$scope.isNri||$scope.isSpouseJourney)$scope.isSpouseJourney&&$timeout(function(){$scope.progressiveJourney.stage="spouse"},0);else{var localProfessionType=angular.copy($scope.modifySelection.professionType);setTimeout(function(){$scope.modifySelection.professionType=localProfessionType},2e3),$scope.isCityPopupEnabled?$scope.progressiveJourney.visibleScreens.push("city"):CustomerService.saveProfessionType($scope.modifySelection.userInfoId,$scope.modifySelection.professionType),setTimeout(function(){$scope.isCityPopupEnabled?($scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1,$scope.progressiveJourney.stage="city",$scope.progressiveCitySelected=!1):hideQuestions()},10)}},$scope.saveSmoker=function(value){var value=1*value;$scope.modifySelection.isTobaccoUser=1*value,$scope.progressiveJourney.smoker=1*value,$scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1,$timeout(function(){$scope.progressiveJourney.stage="annualIncome"},0),$scope.progressiveJourney.visibleScreens.indexOf("smoker")===-1&&$scope.progressiveJourney.visibleScreens.push("smoker"),$scope.progressiveJourney.visibleScreens.push("annualIncome"),1*$scope.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:$scope.modifySelection.visitId,newValue:$scope.modifySelection.isTobaccoUser,event:"On Smoker Question Save",pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,newValue:$scope.modifySelection.isTobaccoUser,event:"On Smoker Question Save",pageName:"Quotes",collection:"progressive_term"});var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","smoker",{expires:expireDate})},$scope.switchProgressiveQuestions=function(stage){return $scope.progressiveJourney.visibleScreens.indexOf(stage)!==-1&&("city"!=stage&&($scope.cityClicked=!1),"annualIncome"===stage?($scope.progressiveJourney.toLeft=!1,$scope.progressiveJourney.toRight=!0):"occupationType"===stage?($scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1):"smoker"===stage?($scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1):"mobile"===stage?($scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1):$scope.isSpouseJourney&&"spouse"===stage?($scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1):"city"===stage?($scope.progressiveJourney.toLeft=!1,$scope.progressiveJourney.toRight=!0):($scope.progressiveJourney.toLeft=!1,$scope.progressiveJourney.toRight=!1),void $timeout(function(){$scope.progressiveJourney.stage=stage},100))},$routeParams.isProgressiveJourney&&"true"==$routeParams.isProgressiveJourney&&($scope.progressiveJourney.show=!0);var customerSuccessCallback=function(data,isCalledOnApply){data=checkForPreviousSession(data),setIsMobileDefault(data.existUrl),$scope.preQuotesInfo=data,$scope.isReferralLead=!(!$scope.isAffiliates||1*$scope.preQuotesInfo.annualIncome!==7),isAgeChanged(),$scope.isCityPopupEnabled||mobileDefaultCheck(),null==$scope.preQuotesInfo.spouse||"null"==$scope.preQuotesInfo.spouse?($cookies.remove("spouseDob"),$scope.preQuotesInfo.spouse={isWorking:0,tobacco:0,age:null}):$rootScope.profile.spouse="true"===$cookies.get("isSpouseSelected"),$scope.payTermOptions.indexOf("pushed")===-1&&($scope.payTermOptions&&$scope.payTermOptions.filter(function(val){return"R"==val.value}).length>0?$scope.payTermOptions.splice($scope.payTermOptions.length-1,0,{value:60-$scope.preQuotesInfo.customerAge,displayValue:"Pay Till 60"}):$scope.payTermOptions.push({value:60-$scope.preQuotesInfo.customerAge,displayValue:"Pay Till 60"}),$scope.payTermOptions.push("pushed")),"Pay Till 60"===$localStorage.selectedPayTerm&&($scope.type.ppt=60-$scope.preQuotesInfo.customerAge,1*$scope.preQuotesInfo.policyTerm<=60&&($localStorage.selectedPayTerm="10",$scope.type.ppt="10")),setTimeout(function(){executeICICITracking();var x=document.createElement("IFRAME"),styles="visibility:hidden;display:none";x.setAttribute("style",styles),x.setAttribute("src","https://www.aegonlife.com/sfapi/api/lead-restrict-pb?source=policybazar"),x.setAttribute("height",0),x.setAttribute("width",0),document.body.appendChild(x)},0),checkAnnualIncomeEligibility(),$rootScope.profile.child=!(null==$scope.preQuotesInfo.child||"null"==$scope.preQuotesInfo.child),handleChildAgeZeroCase(data);var yahooUrl="https://sp.analytics.yahoo.com/spp.pl?a=10000&.yp=430240&ea="+data.matrixLeadId+"&gv=";if(CommonServiceTerm.addYahooTag(yahooUrl),$rootScope.isMonthlyIncomeJourney=1==data.subProductTypeId,changeTabVisibility($rootScope.isMonthlyIncomeJourney),policyCoverageDataSyncup(),$scope.preFillModifySelectionModel($scope.preQuotesInfo),$scope.isCustomerDataLoaded=!0,handleModalPopupClose(),getAllCityList().then(function(){if($scope.modifySelection.cityId){var selectedCityItem=getCityObject($scope.modifySelection.cityId);setSelectedCityItem(selectedCityItem)}$scope.modifySelection.cityId&&($scope.cityerror=!1)}),100===data.policyTerm&&$scope.changePolicyTerm(!0,99),Math.abs(data.policyTerm-data.customerAge)<10&&(data.customerAge<50?$scope.changePolicyTerm(!0,60):$scope.changePolicyTerm(!0,75)),$cookies.get("pid")&&$cookies.get("pid")==termConfigObj.getBAXASupplier()&&85==$scope.preQuotesInfo.policyTerm?$cookies.put("changedOnce",!0):!$cookies.get("pid")||111!=$cookies.get("pid")&&31!=$cookies.get("pid")||$scope.preQuotesInfo.policyTerm!=$scope.maxAllowedPolicyCoverage||$cookies.put("changedOnce",!0),$cookies.get("pid")&&$cookies.get("pid")==termConfigObj.getBAXASupplier()&&85!=$scope.preQuotesInfo.policyTerm&&"true"!=$cookies.get("changedOnce"))$cookies.put("changedOnce",!0),$scope.changePolicyTerm(!0,85);else if(!$cookies.get("pid")||111!=$cookies.get("pid")&&31!=$cookies.get("pid")||$scope.preQuotesInfo.policyTerm==$scope.maxAllowedPolicyCoverage||"true"==$cookies.get("changedOnce")){$scope.customerChangeInitiated?"":$scope.getQuotes($scope.preQuotesInfo,"first"),CommonServiceTerm.loadInvincibleScript($scope.preQuotesInfo.matrixLeadId),CustomerService.trackCustomerJourneyService($scope.enquiryId),null!==data.categoryIds&&($scope.types=GenericService.setSelectedTypes(data.categoryIds,$scope.types));var reqObj={uniqueId:$scope.modifySelection.encryptedMobileNo,userInfoId:$scope.modifySelection.userInfoId};$scope.isAffiliates||QuotesService.isCustomerExist(reqObj).then(function(data){data.childLeadExists||data.previousBookingExist?($scope.modifySelection.annualIncome>2||$scope.modifySelection.totalPayout>25e5)&&1*$scope.modifySelection.annualIncome!==7&&initilizeZopim():($scope.modifySelection.annualIncome>2||$scope.modifySelection.totalPayout>25e5)&&1*$scope.modifySelection.annualIncome!==7&&initilizeZopim()})}else $cookies.put("changedOnce",!0),$scope.changePolicyTerm(!0,$scope.maxAllowedPolicyCoverage);if($rootScope.isMobileDevice&&isCalledOnApply&&$scope.handleFilterEvents(),$routeParams.isRevisit&&"true"==$routeParams.isRevisit&&CommonServiceTerm.saveRevisitLog($scope.preQuotesInfo.matrixLeadId,termConfigObj.getTermProductId()),$routeParams.isProgressiveJourney?$scope.progressiveJourney.secondVariant?1*$scope.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:$scope.preQuotesInfo.visitId,collection:"progressive_term",event:"Landing",pageName:"Quotes",variant:"second"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.preQuotesInfo.visitId,collection:"progressive_term",event:"Landing",pageName:"Quotes",variant:"second"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.preQuotesInfo.visitId,collection:"progressive_term",event:"Landing",pageName:"Quotes",variant:"first"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.preQuotesInfo.visitId,event:"Landing",pageName:"Quotes"}),$routeParams.smsEvent&&"true"==$routeParams.smsEvent&&pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On SMS event Landing",collection:"CRM_SMS_CAMPAIGN",stage:$routeParams.stage,pageName:"Quotes"}),$routeParams.clicktocall&&"true"==$routeParams.clicktocall&&$scope.preQuotesInfo.userInfoId&&CommonServiceTerm.clickToCall($scope.preQuotesInfo.userInfoId),$scope.isNRI=392!=$scope.preQuotesInfo.countryId,$scope.isCountryOthers=999==$scope.preQuotesInfo.countryId,$scope.progressiveJourney.isNri=$scope.isNRI,$scope.isNRI){var incomeArray=$scope.annualIncomeList.filter(function(val){return 7!=val.id&&8!=val.id});incomeArray.push({id:8,name:"< 3 Lac"}),$scope.annualIncomeList=incomeArray}7!==$scope.preQuotesInfo.annualIncome||$scope.isNRI||$scope.isAffiliates||CommonServiceTerm.getReferralLead($scope.preQuotesInfo.matrixLeadId).then(function(data){$scope.isReferralLead=data}),$cookies.get("showPayoutCallOut")?($scope.showCallOutText=!0,$cookies.remove("showPayoutCallOut"),$timeout(function(){$scope.showCallOutText=!1},2e3)):$scope.showCallOutText=!1,toggleGroupTermJourney()};$scope.getCustomerInformation=function(enquiryId,isCalledOnApply){var deferred=$q.defer();return CustomerService.getCustomerInformation(enquiryId).success(function(data,status,headers,config){if(data){CommonServiceTerm.saveUTMSourcesToScope(data),$scope.isAffiliates=$rootScope.utmSource&&"offlineaffiliate"==$rootScope.utmSource.toLowerCase();var agentId=data.agentId||0;$scope.agentObj.isAgent=agentId>0||void 0!=$routeParams.LeadId||null!=$routeParams.LeadId;var cookieVal=$cookies.get("callBack"+data.enquiryId);if(custID=data.custId,$scope.visitUse&&data.visitId){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("Cookie_VisitLog",data.visitId,{expires:expireDate,domain:"policybazaar.com"})}$scope.isCallBackAlreadyInitiated=angular.isDefined(cookieVal),GenericService.verifyMobileNumber(data).success(function(verifyMobileNumberObj,status,headers,config){$scope.isInternalIP=!verifyMobileNumberObj.isValidMobile,$scope.isInternalIP&&($scope.showLink.callback=!1)}),customerSuccessCallback(data,isCalledOnApply),deferred.resolve(data)}}),deferred.promise},$scope.getCustomerInformation($scope.enquiryId).then(function(data){if(data.matrixLeadId){try{dataLayer.push({LeadID:data.matrixLeadId}),dataLayer.push({event:"termLead"})}catch(err){}CommonServiceTerm.createRevisit({leadId:data.matrixLeadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:"QuotesPage"})}}),$scope.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},$scope.addCommas=function(nStr){return GenericService.addCommas(nStr)},$scope.getAge=function(dateString){return dateString?CommonServiceTerm.getAge(dateString):""},$scope.handlePayoutFocusBlur=function(keyName,id){angular.forEach($scope.payout,function(value,key){$scope.payout[key]=!1}),$scope.payout[keyName]=!0,$timeout(function(){QuotesService.saveAndEditButton(keyName,"#totalPayout-edit",$scope.modifySelection.totalPayout,$scope.modifySelection.custId)},100)},$scope.handleMonthlyIncomeFocusBlur=function(keyName){angular.forEach($scope.monthlyIncome,function(value,key){$scope.monthlyIncome[key]=!1}),$scope.monthlyIncome[keyName]=!0,$timeout(function(){QuotesService.saveAndEditButton(keyName,"#monthlyIncome-edit",$scope.modifySelection.totalPayout,$scope.modifySelection.custId)},100)},$scope.handlePolicyDurationFocusBlur=function(keyName){angular.forEach($scope.policyDuration,function(value,key){$scope.policyDuration[key]=!1}),$scope.policyDuration[keyName]=!0,$timeout(function(){"isEditable"==keyName?($(".save-btn").addClass("rightm3"),$(".edit-btn2").addClass("leftm3"),$rootScope.isMobileDevice||$("#policyTerm-edit").focus(),gaTagsNew.trackEditOrSavePayOrCover("CoverDurationFilterClick",$scope.modifySelection.policyCoverage,$cookies.get("pTabName"),$scope.modifySelection.custId)):($(".save-btn").removeClass("rightm3"),$(".edit-btn2").removeClass("leftm3"))},100)},$scope.focusField=function(id){$timeout(function(){$("#"+id).focus()},100)},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},$scope.emailQuotesSuccessCallback=function(){$mdToast.show($mdToast.simple().content("Email has been sent successfully!").position($scope.getToastPosition()).hideDelay(3e3)),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Email click",pageName:"Quotes",click:"Click"})},$scope.emailQuotesFailureCallback=function(){$mdToast.show($mdToast.simple().content("Failed to send email!").position($scope.getToastPosition()).hideDelay(3e3))},$scope.emailQuotes=function(){$scope.showLink.emailback=!1,gaTagsNew.editProfileTrack("EmailPlans",-1,$scope.modifySelection.custId);var allQuotes=$scope.quotes.concat($scope.newQuotes);QuotesService.emailQuotes(allQuotes,$scope.modifySelection).success(function(data,status,headers,config){$timeout(function(){"success"==data.status?$scope.emailQuotesSuccessCallback():$scope.emailQuotesFailureCallback()},100)}).error(function(data,status,headers,config){$scope.emailQuotesFailureCallback()})},$scope.callBack=function($event,waitForMessage){$scope.createTwoCallBackCookie($scope.preQuotesInfo.enquiryId),$scope.showLink.callback=!1,pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"On Call now click",pageName:"Quotes",click:"Click"}),waitForMessage||showMdToast("Thank You! We will call you back shortly",5e3),CustomerService.callbackUrl($scope.preQuotesInfo).then(function(data){data.data&&waitForMessage&&data.data.message&&data.data.message.length>0?showMdToast(data.data.message,5e3):showMdToast("Thank You! We will call you back shortly",5e3)})},$scope.removeArrow=function(plan,val){return plan.ComboTotalPremium+plan.riderPremiumAdded>=val},$scope.isMonthlyIncomePlan=function(){return $rootScope.pTabName.monthlyPlans},$scope.changeTabRadio=function(){var pbTrackerEvent;1*$scope.tab.tabValue===1?($rootScope.pTabName.onetimePlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$scope.changeParentTab("onetimePlans"),pbTrackerEvent="On Lumpsum click"):1*$scope.tab.tabValue===2?($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$scope.changeParentTab("monthlyPlans"),pbTrackerEvent="On Monthly income plans click"):1*$scope.tab.tabValue===3?($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$scope.changeParentTab("allPlans"),pbTrackerEvent="On All Plans click"):1*$scope.tab.tabValue===4?($rootScope.pTabName.tropPlans=!0,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$scope.changeParentTab("tropPlans"),pbTrackerEvent="On Return of premium click"):1*$scope.tab.tabValue===5&&($rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!0,$scope.changeParentTab("wholeLifePlans"),pbTrackerEvent="On Plan for 100 years click",$scope.checked.disableRadio=!1,$scope.changePolicyTerm(!1,$scope.maxAllowedPolicyCoverage)),$scope.payout.isEditable=$scope.monthlyIncome.isEditable=$scope.policyDuration.isEditable=!1,$scope.payout.isReadable=$scope.monthlyIncome.isReadable=$scope.policyDuration.isReadable=!0,$(".save-btn").removeClass("rightm3"),$(".edit-btn1").removeClass("leftm3"),$(".edit-btn2").removeClass("leftm3"),defaultRiderPremiums=[],planIdsArray=[],QuotesService.setPlanIdsArray(),$("body").scrollTop(0),$("html, body").animate({scrollTop:0},"fast"),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:pbTrackerEvent,pageName:"Quotes",click:"Click"})},$scope.changeParentTab=function(keyName){if($scope.isAllRiderLoaded=!1,$scope.quotes=[],$scope.newQuotes=[],allPlansData=[],$scope.isQuotesLoaded=!1,$scope.checked.disableRadio=!0,parentTabName!==keyName){if($scope.isMonthlyIncomePlan()?angular.isUndefined($scope.modifySelection.monthlyIncome)&&($scope.modifySelection.monthlyIncome=$scope.preQuotesInfo.monthlyIncome):angular.isUndefined($scope.modifySelection.totalPayout)&&($scope.modifySelection.totalPayout=$scope.preQuotesInfo.totalPayout),"monthlyPlans"===parentTabName||"monthlyPlans"===keyName)$scope.getQuotes($scope.modifySelection),parentTabName=keyName,$scope.setToDefault();else{parentTabName=keyName;var filteredObj=GenericService.filterAllObjs(quotes,$scope.modifySelection);filteredObj=QuotesService.assignMedicalInfo(filteredObj,$scope.medicalGridInfo,$scope.isAffiliates),"tropPlans"==keyName&&$scope.callIciciTrop(filteredObj),$timeout(function(){$scope.quotes=angular.copy(filteredObj),$scope.isQuotesLoaded=!0,$scope.setToDefault(),$scope.quotes=GenericService.setRiderObject($scope.quotes,$scope.preQuotesInfo,$scope.quotesObj.isMonthly),$scope.newQuotes.length>0&&($scope.newQuotes=GenericService.setRiderObject($scope.newQuotes,$scope.preQuotesInfo,$scope.quotesObj.isMonthly)),$rootScope.pTabName.tropPlans?$scope.hideObject.isTropNotPresent=!($scope.quotes.length>0):$scope.hideObject.isTropNotPresent=!1,setComparePlans(!1),$timeout(function(){$scope.quotes=GenericService.setRiderObject($scope.quotes,$scope.preQuotesInfo.customerAge,$scope.quotesObj.isMonthly),$scope.newQuotes.length>0&&($scope.newQuotes=GenericService.setRiderObject($scope.newQuotes,$scope.preQuotesInfo.customerAge,$scope.quotesObj.isMonthly)),riderUpdateCall().then(function(){$scope.isAllRiderLoaded=!0;var selectedRiders=getSelectedRidersList();$scope.quotes=GenericService.getRidersPremiumForQuotes($scope.quotes,$scope.types,$scope.quotesObj.isMonthly),$scope.newQuotes.length>0?($scope.newQuotes=GenericService.getRidersPremiumForQuotes($scope.newQuotes,$scope.types,$scope.quotesObj.isMonthly),$scope.checked.disableRadio=!1):$scope.checked.disableRadio=!1,optimizeRiderService?addRiderValuesToThePlans(!0):selectedRiders.length>0&&addRiderValuesToThePlans()})},10)},0)}angular.forEach($rootScope.pTabName,function(value,key){$rootScope.pTabName[key]=!1}),gaTagsNew.trackTabNameChange(keyName),$rootScope.pTabName[keyName]=!0,$cookies.put("pTabName",keyName),"allPlans"==keyName&&($rootScope.tabName.maxPayout=!0)}};var modelDataSyncup=function(){angular.copy($scope.modifySelection,$scope.preQuotesInfo),$rootScope.isMobileDevice&&$scope.filterQuotesObj.enquiryId&&$scope.filterQuotesObj.enquiryId.length>0&&angular.copy($scope.filterQuotesObj,$scope.modifySelection)};$scope.progressiveMobileNumberFormSubmit=function(isValid){if(isValid){$scope.progressiveJourney.toLeft=!0,$scope.progressiveJourney.toRight=!1,$timeout(function(){$scope.progressiveJourney.stage="smoker"},0),$scope.modifySelection.mobileNo=$scope.progressiveJourney.mobileNo,$scope.modifySelection.countryId=$scope.progressiveJourney.countryCode,$scope.modifySelection.otherCountryCode=$scope.progressiveJourney.otherCountryCode,$scope.progressiveJourney.visibleScreens.push("mobile"),$scope.progressiveJourney.visibleScreens.push("smoker");var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),1*$scope.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:$scope.modifySelection.visitId,mobile:$scope.modifySelection.mobileNo,event:"On Mobile Number Save",pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,mobile:$scope.modifySelection.mobileNo,event:"On Mobile Number Save",pageName:"Quotes",collection:"progressive_term"}),$cookies.put("last_question_answered","annualincome",{expires:expireDate}),PreQuotesService.updateMobileNumber($scope.progressiveJourney.mobileNo,$scope.modifySelection).then(function(){})}},$scope.toggleModal=function(modalName,status){var modalHashMap={profile:"profileModal",spouse:"spouseProfileModal",child:"childProfileModal",planSelection:"planSelectionModal",planDetail:"planDetailModal",annualIncomeModal:"annualIncomeModal",progressiveModal:"progressiveModal",term_popup_modal2:"term_popup_modal2"};"payoutModal"===modalName||"progressiveModal"===modalName?"hide"===status?$("#"+modalHashMap[modalName]).modal(status):$("#"+modalHashMap[modalName]).modal({backdrop:"static",keyboard:!1}):$("#"+modalHashMap[modalName]).modal(status)};var successCallbackProfile=function(isCalledOnApply){setContinueButtonDisabled(!1),modelDataSyncup(),$scope.setArrowLoaderObject(!0,!1),$scope.toggleModal("profile","hide");var policyTerm=QuotesService.getPolicyTerm($scope.modifySelection);policyTerm>=10?$scope.getCustomerInformation($scope.enquiryId,isCalledOnApply):($scope.modifySelection.policyCoverage=parseInt($scope.modifySelection.customerAge,10)+10,$scope.saveCustomerSelection(isCalledOnApply))};$scope.updateProfileDetails=function(isCalledOnApply,isCalledFromProgressive){!!$location.$$search.isMobileDefault;if(CustomerService.retainIsMobileDefault=!1,$scope.cityerror&&!isCalledFromProgressive?(CustomerService.retainIsMobileDefault=!0,$scope.modifySelection&&392!=$scope.modifySelection.countryId?($scope.modifySelection.cityId=9999,$scope.modifySelection.stateId=99):($scope.modifySelection.cityId=551,$scope.modifySelection.stateId=35),$scope.isNRI||($scope.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1)):(CustomerService.retainIsMobileDefault=!1,isCalledFromProgressive||($scope.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1)),isCalledFromProgressive&&(CustomerService.retainIsMobileDefault=!0),($scope.progressiveJourney.isNri||$scope.modifySelection&&392!=$scope.modifySelection.countryId)&&($scope.modifySelection.cityId=9999,$scope.modifySelection.stateId=99),$scope.modifySelection.isSpouseJourney=$scope.isSpouseJourney,$scope.isValidProfileDetails($scope.modifySelection)||"true"==$scope.isValidProfileDetails($scope.modifySelection)){$scope.quotes=[],$scope.newQuotes=[],quotes=[],setContinueButtonDisabled(!0),$scope.setArrowLoaderObject(!1,!0),$scope.modifySelection.customerAge=CommonServiceTerm.getAge($scope.modifySelection.dob);var policyTerm=QuotesService.getPolicyTerm($scope.modifySelection);policyTerm<10&&($scope.modifySelection.policyCoverage=parseInt($scope.modifySelection.customerAge,10)+10),$scope.modifySelection.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),$scope.modifySelection.gaTrackerClientId=GenericService.getTrackerId();var profileUpdated=!$rootScope.isMobileDevice||$scope.mobileSectionUpdateStatus.profile,selectionUpdated=$scope.mobileSectionUpdateStatus.selection;$scope.isCustomerDataLoaded=!1,$scope.isQuotesLoaded=!1,$scope.modifySelection.mobileNo=$scope.preQuotesInfo.mobileNo,$scope.modifySelection.encryptedMobileNo=$scope.preQuotesInfo.encryptedMobileNo,isCalledFromProgressive&&($scope.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange(1*$scope.modifySelection.annualIncome))),CustomerService.updateCustomerProfile($scope.modifySelection,$scope.enquiryId,profileUpdated,selectionUpdated).success(function(data,status,headers,config){if("success"==data.status){CommonServiceTerm.callLeadGenerationTracking(data.matrixleadId,data.customerId,data.isMatrixLeadCreated,!1),gaTagsNew.editProfileTrack("ProfileFilterChange",-1,$scope.modifySelection.custId);var enquiryId=data.enquiryId;if($location.$$search.litePage||$localStorage.enquiryId==enquiryId)$location.search("litePage",null).replace(),successCallbackProfile(isCalledOnApply);else{$rootScope.profile.spouse=!1,$rootScope.profile.child=!1;try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"termLead"})}catch(err){}$localStorage.enquiryId=data.enquiryId,$timeout(function(){$scope.toggleModal("profile","hide"),$routeParams.enquiryId=data.enquiryId;var currentRoute=$location.path(),exitPointUrl=GenericService.buildExitPointUrlPrequotes(location.href,currentRoute,data.enquiryId);if(data.enquiryId&&CustomerService.setExitPointUrl(data.enquiryId,exitPointUrl,$scope.modifySelection.productId).success(function(data,status,headers,config){}),$scope.setArrowLoaderObject(!0,!1),setContinueButtonDisabled(!1),$rootScope.isMobileDevice)if($scope.enquiryId=data.enquiryId||$scope.enquiryId,$scope.mobileSectionUpdateStatus.profile||$scope.mobileSectionUpdateStatus.selection){if($scope.mobileSectionUpdateStatus.coverage){var sortByCoverage=!1;sortByCoverage=$scope.modifySelection.policyCoverage>75||$scope.modifySelection.policyCoverage>1*$scope.modifySelection.customerAge+40,!$rootScope.pTabName.wholeLifePlans||1*$scope.modifySelection.policyCoverage!==99&&1*$scope.modifySelection.policyCoverage!==100||(sortByCoverage=!1),filterChanged=sortByCoverage?"-newCoverageUpto":""}successCallbackCustomerSelection(isCalledOnApply)}else $scope.mobileSectionUpdateStatus.riders?$scope.mobileSectionUpdateStatus.paytype?$scope.changePayType():$scope.changeInRiderSelect():$scope.mobileSectionUpdateStatus.paytype?$scope.changePayType():$scope.getQuotes($scope.modifySelection);else $location.path("/quotes/"+data.enquiryId).replace()},3e3)}}else $scope.setArrowLoaderObject(!0,!1),setContinueButtonDisabled(!1),$scope.isQuotesLoaded=!0,$scope.hideObject.isNoQuotesPresent=!($scope.quotes.length>0)})}};var successCallbackSpouse=function(){setContinueButtonDisabled(!1),modelDataSyncup(),$scope.toggleModal("spouse","hide"),$rootScope.profile.spouse=!0,$cookies.put("isSpouseSelected",!0),$rootScope.isMobileDevice||$scope.getQuotes($scope.modifySelection),jointLifeRiderClicked&&($scope.changeInRiderSelect(saveJRFlags.flag,saveJRFlags.name,saveJRFlags.nameFlag),jointLifeRiderClicked=!1,saveJRFlags={})};$scope.updateSpouseDetails=function(form){form.$valid&&GenericService.isSpouseAgeValid(form.age.$modelValue)&&(setContinueButtonDisabled(!0),gaTagsNew.editProfileTrack("SpouseDetailsSave",$scope.modifySelection.spouse.age,$scope.modifySelection.custId),CustomerService.updateSpouseDetails($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){successCallbackSpouse()}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)}))};var successCallbackChild=function(){setContinueButtonDisabled(!1),modelDataSyncup(),$scope.toggleModal("child","hide"),$rootScope.profile.child=!0,$cookies.put("isChildSelected",!0),$scope.getQuotes($scope.modifySelection)};$scope.updateChildDetails=function(form){form.$valid&&GenericService.isChildAgeValid(form.age.$modelValue)&&(setContinueButtonDisabled(!0),gaTagsNew.editProfileTrack("ChildDetailsSave",$scope.modifySelection.child.age,$scope.modifySelection.custId),CustomerService.updateChildDetails($scope.modifySelection).success(function(data,status,headers,config){successCallbackChild()}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)}))},$scope.isSpouseAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.spouse)&&(angular.isDefined(data.spouse)&&data.spouse&&angular.isDefined(data.spouse.age)&&data.spouse.age&&GenericService.isSpouseAgeValid(data.spouse.age)&&null!==data.spouse.tobacco&&null!==data.spouse.isWorking)},$scope.isChildAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.child)&&(angular.isDefined(data.child)&&data.child&&angular.isDefined(data.child.age)&&data.child.age>=0&&GenericService.isChildAgeValid(data.child.age))},$scope.editProfile=function(){gaTagsNew.editProfileTrack("ProfileFilterClick",-1,$scope.modifySelection.custId),$scope.setArrowLoaderObject(!0,!1),$scope.toggleModal("profile","show"),angular.isDefined($scope.selectedCityItem)&&$scope.selectedCityItem.value&&($scope.cityerror=!1),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Edit Profile click",pageName:"Quotes",Click:"Click"})};$scope.addEditSpouse=function(model){$scope.isSpouseAdded($scope.preQuotesInfo)?($cookies.put("isSpouseSelected",model),$scope.getQuotes($scope.modifySelection)):handleAddSpouse();var modifySelection=angular.copy($scope.modifySelection);CustomerService.updateSpouseDetails(modifySelection,$scope.enquiryId).success(function(data,status,headers,config){}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)})};$scope.addEditChild=function(model){$scope.isChildAdded($scope.preQuotesInfo)?($cookies.put("isChildSelected",model),$scope.getQuotes($scope.modifySelection)):handleAddChild()};var showTheModal=function(plan){var deferred=$q.defer();return $scope.hideObject.loadSummaryPage=!0,deferred.resolve(!0),deferred.promise},openPlanDetail=function(plan,index){GenericService.setPlanId(plan.Plan_Id);var planName=plan.Plan_Name.split(" ").join("-");plan.selectedRiderIds&&plan.selectedRiderIds.length>0?(CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,$scope.modifySelection,$scope.type.payType).success(function(data){showTheModal(plan).then(function(){$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,planName,index)})})):(CommonServiceTerm.setUpdateCalled("updateNotCalled"),showTheModal(plan).then(function(){$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,planName,index)}))};$scope.isE2EPlans=function(plan){return termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)>-1},$scope.isPNBPlan=function(planId){return CommonServiceTerm.isPNBPlan(planId)},$scope.isAegoniTermPlanNew=function(planId){return CommonServiceTerm.isAegonPlan(planId)},$scope.isAegonItermPlusPlan=function(planId){return CommonServiceTerm.isAegonItermPlusPlan(planId)},$scope.isHdfc3DPlan=function(planId){CommonServiceTerm.isHdfc3dPlan($scope.planDetails.planId)},$scope.proceed=function(plan,index){$scope.toggleModal("term_popup_modal2","hide"),819==plan.Plan_Id||820==plan.Plan_Id||821==plan.Plan_Id?forceRiderSelect(38,!0).then(function(){819==plan.Plan_Id&&plan.selectedRiderIds&&plan.selectedRiderIds.indexOf(208)==-1&&plan.selectedRiderIds.push(208),820==plan.Plan_Id&&plan.selectedRiderIds&&plan.selectedRiderIds.indexOf(209)==-1&&plan.selectedRiderIds.push(209),821==plan.Plan_Id&&plan.selectedRiderIds&&plan.selectedRiderIds.indexOf(211)==-1&&plan.selectedRiderIds.push(211),
proceed(plan,index)}):proceed(plan,index)},$scope.isValidSpouseDetails=function(){return $scope.isSpouseAdded($scope.modifySelection)},$scope.isValidChildDetails=function(){return $scope.isChildAdded($scope.modifySelection)},$scope.isQuotesEditable=function(){return $scope.payout.isEditable||$scope.monthlyIncome.isEditable},$scope.isPayTermEditable=function(){return $scope.policyDuration.isEditable},$scope.isValidTotalPayout=function(){return!!$scope.modifySelection.totalPayout&&($rootScope.pTabName.tropPlans?$scope.modifySelection.totalPayout>=15e5&&$scope.modifySelection.totalPayout<=2e8:$scope.groupTermJourney?$scope.modifySelection.totalPayout>=5e4&&$scope.modifySelection.totalPayout<=35e5:$scope.modifySelection.totalPayout>=1e6&&$scope.modifySelection.totalPayout<=2e8)},$scope.getLowerLimit=function(){return $rootScope.pTabName.tropPlans?"15L":"10L"},$scope.isValidMonthlyIncome=function(){return $scope.modifySelection.monthlyIncome&&$scope.modifySelection.monthlyIncome>=1e4&&$scope.modifySelection.monthlyIncome<=2e6},$scope.isValidPolicyCoverage=function(){return $scope.modifySelection.policyCoverage&&$scope.modifySelection.policyCoverage>=$scope.minAllowedPolicyCoverage()&&$scope.modifySelection.policyCoverage<=$scope.maxAllowedPolicyCoverage},$scope.isQuotesInputValid=function(){return $rootScope.pTabName.monthlyPlans?$scope.isValidMonthlyIncome()&&$scope.isValidPolicyCoverage():$scope.isValidTotalPayout()&&$scope.isValidPolicyCoverage()};var successCallbackCustomerSelection=function(isCalledOnApply){$rootScope.isMobileDevice?$scope.mobileSectionUpdateStatus.profile&&angular.copy($scope.modifySelection,$scope.preQuotesInfo):angular.copy($scope.modifySelection,$scope.preQuotesInfo),$scope.handlePayoutFocusBlur("isReadable"),$scope.handleMonthlyIncomeFocusBlur("isReadable"),$scope.handlePolicyDurationFocusBlur("isReadable"),$scope.getCustomerInformation($scope.enquiryId,isCalledOnApply)};$scope.isValidTerm=function(payTerm,coverage){var isValidpptDesc=$scope.validatePayTerm(void 0,coverage);return $scope.isValidCover="true"==isValidpptDesc.split(":")[0],$scope.isValidCover},$scope.saveCustomerSelection=function(type,isCalledOnApply){var isValidpptDesc=$scope.validatePayTerm(void 0,$scope.modifySelection.policyCoverage);if($scope.isValidCover="true"==isValidpptDesc.split(":")[0],$scope.isValidCover||($scope.CoverErrorDesc=isValidpptDesc.split(":")[1]),$scope.isValidCover){void 0!==type&&gaTagsNew.populateDataToTrackOnSave($scope.modifySelection,type,$cookies.get("pTabName")),$scope.termSwitchBackValue=null;var sortByCoverage=!1;sortByCoverage=$scope.modifySelection.policyCoverage>75||$scope.modifySelection.policyCoverage>1*$scope.modifySelection.customerAge+40,!$rootScope.pTabName.wholeLifePlans||1*$scope.modifySelection.policyCoverage!==99&&1*$scope.modifySelection.policyCoverage!==100||(sortByCoverage=!1),filterChanged="payTerm"==type&&sortByCoverage?"-newCoverageUpto":"",$scope.isQuotesInputValid()&&(defaultRiderPremiums=[],"totalPayout"===type?(pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Payout click",pageName:"Quotes",previous_payout:$scope.preQuotesInfo.totalPayout,new_payout:$scope.modifySelection.totalPayout}),dummyPlansReplaced=!1):"payTerm"===type&&(pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Coverage period click",pageName:"Quotes",previous_coverage:$scope.preQuotesInfo.policyCoverage,new_coverage:$scope.modifySelection.policyCoverage}),1*$scope.modifySelection.policyCoverage>=99&&($scope.termSwitchBackValue=angular.copy($scope.preQuotesInfo.policyCoverage))),"payTerm"==type||"totalPayout"===type||"monthly"===type?($scope.customerChangeInitiated=!0,$scope.isQuotesLoaded=!0,$scope.quotes=$scope.quotes.map(function(val){return val.isDummyPlan=!0,val}),$scope.newQuotes=$scope.newQuotes.map(function(val){return val.isDummyPlan=!0,val}),$scope.getQuotes($scope.modifySelection,"first")):($scope.quotes=[],$scope.newQuotes=[],allPlansData=[],$scope.isQuotesLoaded=!1),CustomerService.updateCustomerSelection($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){"success"==data.status&&successCallbackCustomerSelection(isCalledOnApply)}))}},$scope.undoChanges=function(){angular.copy($scope.preQuotesInfo,$scope.modifySelection),$scope.handlePayoutFocusBlur("isReadable"),$scope.handleMonthlyIncomeFocusBlur("isReadable"),$scope.handlePolicyDurationFocusBlur("isReadable"),updateDropDownValues()};var executeCommonScript=function(){CustomerService.saveSelectedFilters($scope.enquiryId,$scope.types,filterParam)};$scope.quoteRiderSelect=function(id,status,name){$scope.riderSelectCallback(id,status,name),_.each($scope.types,function(type){type.id===id&&(type.status=status)}),$scope.toggleRidersFn(!1)},$scope.riderSelectCallback=function(id,status,name){13==id&&(!$scope.isSpouseAdded($scope.preQuotesInfo)&&status&&$scope.toggleModal("spouse","show"),jointLifeRiderClicked=!0),name&&name.length>0&&gaTagsNew.trackRiderSelectQuotes(name,status,$scope.modifySelection.custId)},$scope.changePaymentMode=function(){$scope.reversePremiumType("monthly"!=$scope.paymentModeDropdown.isMonthly)},$scope.changeInRiderSelect=function(flag,name,nameFlag,id){13==id?changeInJointLifeRider(flag,name,nameFlag):(name&&name.length>0&&gaTagsNew.trackRiderSelectQuotes(name,flag,$scope.modifySelection.custId),callRiderChangeCategoryList(),$scope.handleFilterEvents(flag))};var changeInJointLifeRider=function(flag,name,nameFlag){var isJointLifeSelected=!1;_.each($scope.types,function(val){13==val.id&&val.status&&(isJointLifeSelected=!0)}),!$scope.isSpouseAdded($scope.preQuotesInfo)&&isJointLifeSelected?($scope.toggleModal("spouse","show"),jointLifeRiderClicked=!0,saveJRFlags={flag:flag,name:name,nameFlag:nameFlag}):$scope.changeInRiderSelect(flag,name,nameFlag)};$scope.handleFilterEvents=function(flag){$scope.checked.disableRadio=!0,addRiderValuesToThePlans(),executeCommonScript()},$scope.updateTypes=function(types){$scope.types=angular.copy(types)},$scope.updateReverseData=function(reverseData){$scope.reverseData=angular.copy(reverseData)},$scope.updatePayType=function(paytype){$scope.type.payType=paytype},$scope.updateModifySelection=function(obj){$scope.modifySelection=angular.copy(obj),$scope.modifySelection.cityId&&($scope.cityerror=!1)},$scope.saveQuoteSelection=function(plan){var input={planId:plan.Plan_Id,refId:$scope.enquiryId,productId:"7",premium:plan.FinalPremium,supplierId:plan.Supplier_Id,leadId:$scope.preQuotesInfo.matrixLeadId,mobileNo:$scope.preQuotesInfo.mobileNo,encryptedMobileNo:$scope.preQuotesInfo.encryptedMobileNo,selectedBy:$routeParams.AgentId&&window.atob?window.atob($routeParams.AgentId):"0",ipAddress:"127.0.0.1",sourcePage:"Quotes",enquiryId:$routeParams.enquiryId};CustomerService.saveQuoteSelection(input).success(function(data,status,headers,config){})},$scope.selectedCityItem={display:$scope.modifySelection.city,value:$scope.modifySelection.city,searchString:$scope.modifySelection.city,stateId:$scope.modifySelection.stateId,cityId:$scope.modifySelection.cityId},$scope.isValidProfileDetails=function(data){return angular.isDefined(data)&&$scope.isValidAge()&&null!==data.isTobaccoUser},$scope.renderTATData=function(plan){return angular.isDefined(plan.tATData)?plan.tATData:""},$scope.getPlanCategoryType=function(plan){return QuotesService.getPlanCategoryType(plan)},$scope.collapseHDFC3DPlan=function(){$scope.hdfc3dPlanCollapsed=!0},$scope.isHdfc3dPlan=function(planId){return CommonServiceTerm.isHdfc3dPlan(planId)};var handleModalPopupClose=function(){$timeout(function(){$("#profileModal").on("hide.bs.modal",function(e){var selectedCityItem=getCityObject($scope.preQuotesInfo.cityId);setSelectedCityItem(selectedCityItem),angular.copy($scope.preQuotesInfo,$scope.modifySelection)}),$("#spouseProfileModal").on("hide.bs.modal",function(e){$scope.isSpouseAdded($scope.preQuotesInfo)?(angular.copy($scope.preQuotesInfo,$scope.modifySelection),$scope.filterQuotesObj=angular.copy($scope.modifySelection)):($rootScope.profile.spouse=!1,angular.copy($scope.preQuotesInfo,$scope.modifySelection),$scope.filterQuotesObj=angular.copy($scope.modifySelection),$rootScope.isMobileDevice&&_.each($scope.filterQuotesObjRiders,function(rider){13===rider.id&&(rider.status=!1,$scope.$apply())}))}),$("#childProfileModal").on("hide.bs.modal",function(e){$scope.isChildAdded($scope.preQuotesInfo)?angular.copy($scope.preQuotesInfo,$scope.modifySelection):($rootScope.profile.child=!1,angular.copy($scope.preQuotesInfo,$scope.modifySelection))})},1e3)};$scope.showSwitchToWholeLifeLink=function(selectedCoverage,planId,isWholeLife){var show=!1,tabs=!!$rootScope.pTabName.onetimePlans,plans=!(!GenericService.isAegoniTermPlan(planId)&&!CommonServiceTerm.isPNBPlan(planId));return selectedCoverage<99&&tabs&&plans&&(show=!0),show},$scope.switchToWholeLifeLinkText=function(planId,isWholeLife){return GenericService.isAegoniTermPlan(planId)?"Upgrade to 100 years ":CommonServiceTerm.isPNBPlan(planId)?"Upgrade to 99 years ":""},$scope.clickToSwitchWholeLife=function(planId,isWholeLife){$scope.changePolicyTerm(!1,$scope.maxAllowedPolicyCoverage),$scope.termSwitchBackValue=angular.copy($scope.preQuotesInfo.policyCoverage)},$scope.wholeLifeCheckboxClick=function(){$scope.riderAddOns.wholeLifeChecbox&&$scope.changePolicyTerm(!1,99)},$scope.togglePayTill60Clicked=function(){$scope.payTill60Clicked=!0},$scope.payTill60Click=function(){$scope.payTill60Clicked=!1,$scope.riderAddOns.payTillSixtyChecbox?$scope.preQuotesInfo.policyCoverage<=60?(1*$scope.type.payType!=3&&($scope.type.payType=3,$mdToast.show($mdToast.simple().content("Paytype has been changed to limited pay").position($scope.getToastPosition()).hideDelay(2e3))),$scope.changePolicyTerm(!1,65)):1*$scope.type.payType!=3&&($scope.type.payType=3,$scope.changePayType(),$mdToast.show($mdToast.simple().content("Paytype has been changed to limited pay").position($scope.getToastPosition()).hideDelay(2e3))):1*$scope.type.payType!=1&&($scope.type.payType=1,$scope.changePayType(),$mdToast.show($mdToast.simple().content("Paytype has been changed to regular pay").position($scope.getToastPosition()).hideDelay(2500)))},$scope.getSurvivalBenefit=function(plan){var survivalBenefit=0;if(survivalBenefit=plan.survivalBenefit&&1*plan.survivalBenefit>0?1*plan.survivalBenefit:0,survivalBenefit>0)return $scope.quotesObj.isMonthly?survivalBenefit=plan.survivalBenefitMonthly&&1*plan.survivalBenefitMonthly>0?1*plan.survivalBenefitMonthly:0:survivalBenefit;switch(plan.payOptionType){case"SinglePay":survivalBenefit=plan.ComboTotalPremium/1.045;break;case"LimitedPay":survivalBenefit=$scope.quotesObj.isMonthly&&1*plan.monthlyPremiumWGST>0?12*plan.monthlyPremiumWGST*plan.ppt:plan.ComboTotalPremium/1.045*plan.ppt;break;default:survivalBenefit=$scope.quotesObj.isMonthly&&1*plan.monthlyPremiumWGST>0?12*plan.monthlyPremiumWGST*plan.PolicyTerm:plan.ComboTotalPremium/1.045*plan.PolicyTerm}return survivalBenefit=CommonServiceTerm.isAvivaPlan(plan.Plan_Id)?1.2*survivalBenefit:survivalBenefit},$scope.isChildPlan=function(plan){return GenericService.isChildPlan(plan)},$scope.renderPlanInterestRate=function(plan){return GenericService.isSBIIncomePlans(plan.Plan_Id)?plan.interestRate:(angular.isDefined(plan.interestRate)&&plan.interestRate?parseFloat(plan.interestRate.toString().replace(/%/g,""),10):0)+"%"},$scope.renderPlanInterestType=function(plan){return angular.isDefined(plan.interestType)&&plan.interestType?plan.interestType:""},$scope.renderPlanIncreasingValue=function(plan){return GenericService.renderPlanIncreasingValue(plan)},$scope.renderPlanAnnualIncomeTerm=function(plan){return GenericService.renderPlanAnnualIncomeTerm(plan)},$scope.renderPlanEnhancedSumAssured=function(plan){var enhancedText=GenericService.renderPlanEnhancedSumAssured(plan);return enhancedText&&(enhancedText=enhancedText.replace("%SA_MSG%",$scope.changeDisplayNumberFormat(plan.SumAssured)),enhancedText=enhancedText.replace("%TP_MSG",$scope.changeDisplayNumberFormat(plan.TotalCover)),enhancedText=enhancedText.replace("%Term_MSG%",plan.PolicyTerm<=20?plan.PolicyTerm:21)),enhancedText},$scope.renderPlanAnnualIncomeTermTillYear=function(plan){return GenericService.renderPlanAnnualIncomeTermTillYear(plan)},$scope.renderPlanAnnualIncomeTermTillYearText=function(plan){return GenericService.renderPlanAnnualIncomeTermTillYearText(plan)},$scope.renderPlanAnnualIncomeTermOrTillYrText=function(plan){return GenericService.renderPlanAnnualIncomeTermOrTillYrText(plan)},$scope.renderPlanAnnualIncomeTermOrYrText=function(plan){return GenericService.renderPlanAnnualIncomeTermOrYrText(plan)},$scope.renderPlanAnnualIncomeTermOrTillYr=function(plan){return GenericService.renderPlanAnnualIncomeTermOrTillYr(plan)},$scope.rendePlanAnnualIncomeMonthTerm=function(plan){return GenericService.rendePlanAnnualIncomeMonthTerm(plan)},$scope.handleElementFocusIn=function(event){!$rootScope.isMobileDevice},$scope.changeSort=function(name,reverse,prem){gaTagsNew.trackSorting(name,reverse,$scope.modifySelection.custId);var eventName;"TotalCover"===name?eventName="On Payout click":"Claims_Settled"===name&&(eventName="On Claims Settled click"),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:eventName,pageName:"Quotes",click:"Click"});var arr=[],sortparam=name;reverse?(arr.push(sortparam),arr.push(prem)):(sortparam="-"+sortparam,arr.push(sortparam),arr.push(prem)),filterChanged=sortparam,reverse=!reverse,$scope.filterArray=arr,$scope.sortObj.sortByDropdownValue=1,filterParam=name.replace(/-/g,""),GenericService.saveSortApplied(filterParam),executeCommonScript(),$scope.arrowName=name,$scope.setToDefaultVisible=!0,$rootScope.pTabName.monthlyPlans&&callGTMImpression()},$scope.changePremiumSort=function(name,reverse,prem){gaTagsNew.trackSorting(name,reverse,$scope.modifySelection.custId),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Premium click",pageName:"Quotes",click:"Click"});var arr=[],sortparam=name;reverse?(sortparam="-"+sortparam,arr.push(sortparam)):arr.push(sortparam),void 0!=prem&&arr.push(prem),filterChanged=sortparam,reverse=!reverse,$scope.filterArray=arr,$scope.sortObj.sortByDropdownValue=1,filterParam=name.replace(/-/g,""),$scope.arrowName=name,GenericService.saveSortApplied(filterParam),executeCommonScript(),$scope.setToDefaultVisible=!0,$rootScope.pTabName.monthlyPlans&&callGTMImpression()},$scope.trimSpecialCharacter=function(str,delimeter){return delimeter=angular.isDefined(delimeter)?delimeter:"_",angular.isDefined(str)&&str?str.replace(delimeter," "):""},$scope.navigateToHome=function(){$location.path("/")},$scope.isAnyCategoryAndInbuildRiderExists=function(plan){var freeRiderExist=!1;return _.each(plan.inbuildAddOns,function(val,key){val&&(freeRiderExist=!0)}),angular.isDefined(plan.riderIdCategory)&&plan.riderIdCategory.length||freeRiderExist},$scope.addRemoveAddOn=function(rider){_.each($scope.types,function(type){1*rider.categoryId===type.id&&(type.status=!!rider.isSelected)}),13==rider.categoryId?changeInJointLifeRider(!0,rider.name,rider.name):(callRiderChangeCategoryList(),addRiderValuesToThePlans(),executeCommonScript())},$scope.isSelected=function(val,model){return 1*val===1*model},$scope.showHundredCoverage=function(plan){var planId=plan.Plan_Id||plan.planId,notHundredCoveragePlans=[749,752,753,756,787,789,814,815,816,817];return!!plan.isWholeLifePlan&&notHundredCoveragePlans.indexOf(planId)==-1},$scope.showHundredText=function(plan){var planId=plan.Plan_Id||plan.planId,plansToHide=[934,935,936,937];return plansToHide.indexOf(planId)==-1},$scope.isNonTropPlanVisible=function(plan){var sumAssured=plan.SumAssured?plan.SumAssured:plan.maxSumAssured?plan.maxSumAssured:$scope.preQuotesInfo.totalPayout,isVisible=plan.isQuotesVisible;return $rootScope.pTabName.onetimePlans?(plan.isTrop||761==plan.Plan_Id)&&(isVisible=!1):$rootScope.pTabName.tropPlans?plan.isLifeLongProtection&&plan.isTrop&&(isVisible=!1):$rootScope.pTabName.wholeLifePlans&&(isVisible=!!plan.isWholeLifePlan),CommonServiceTerm.isSbiPoornaSuraksha(plan.Plan_Id)&&(isVisible=$scope.quotesObj.isMonthly?plan.monthlyPremiumWGST>250:plan.annualPremiumWGST>3e3),(CommonServiceTerm.isPNBPlan(plan.Plan_Id)||CommonServiceTerm.isIndiaFirstPlan(plan.Plan_Id))&&$rootScope.utmSource&&(isVisible="offlineaffiliate"!=$rootScope.utmSource.toLowerCase()),"Self-Employed"===$scope.preQuotesInfo.professionType&&CommonServiceTerm.isPNBPlan(plan.Plan_Id)&&sumAssured<=25e5&&(isVisible=!1),$scope.quotesObj.isMonthly?plan.minimumMonthlyPremium&&plan.minimumMonthlyPremium>plan.monthlyPremiumWGST&&(isVisible=!1):plan.minimumAnnualPremium&&plan.minimumAnnualPremium>plan.annualPremiumWGST&&(isVisible=!1),isVisible},$scope.isAegoniTermForverPlan=function(planId){return CommonServiceTerm.isAegoniTermForverPlan(planId)},$scope.isAvivaPlan=function(planId){return CommonServiceTerm.isAvivaPlan(planId)},$scope.showTillSixtyYearsRider=function(plan){return $scope.isMAXPlan(plan)&&1*$scope.type.payType===1},$scope.showInstaClaims=function(plan){return $scope.isMAXPlan(plan)&&plan.TotalCover&&plan.TotalCover<=1e7},$scope.showPayForTenYearsRider=function(plan){return $scope.isTataPlan(plan)&&1*$scope.type.payType===1},$scope.showStepDownOption=function(planId){return CommonServiceTerm.isKotakPlan(planId)},$scope.showExtendedTermOption=function(planId){return CommonServiceTerm.isExidePlan(planId)};var cityCallback=function(data){var newDelhiObject={CityId:"551",CityName:"New Delhi",StateId:"35",state:"Delhi"},newData=_.uniq(data.response.CityList,function(item){return item.CityId});newData.unshift(newDelhiObject),$scope.city=$rootScope.isMobileDevice?GenericService.formatCityMobile(newData):GenericService.formatCity(newData)},getAllCityList=function(){var deferred=$q.defer(),cityData={};return CommonServiceTerm.getCityData().then(function(cityObj){cityData=cityObj,CommonServiceTerm.isEmptyObject(cityData)?CommonServiceTerm.getCity().success(function(data){cityCallback(data),deferred.resolve()}).error(function(data){}):(cityCallback(cityData),deferred.resolve())}),deferred.promise};$scope.createTwoCallBackCookie=function(enquiryId){var expireDate=new Date;expireDate.setTime(expireDate.getTime()+12e4),$cookies.put("callBack"+enquiryId,enquiryId,{expires:expireDate,domain:"policybazaar.com"})},$scope.changePolicyTerm=function(dontSort,value){1*value>=60&&($localStorage.selectedPayTerm=10,$scope.type.ppt=10),!$scope.checked.disableRadio&&value&&1*$scope.modifySelection.policyCoverage!==1*value&&($scope.isQuotesLoaded=!1,$scope.modifySelection.policyCoverage=1*value,dontSort?$scope.saveCustomerSelection():($scope.saveCustomerSelection("payTerm"),policyChangedByClick=!0,filterChanged="-newCoverageUpto",pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Max Coverage click",pageName:"Quotes",click:"Click"}))),$("html, body").animate({scrollTop:0},"slow")},$scope.changePolicyTermToMin=function(){$scope.checked.disableRadio||1*$scope.modifySelection.policyTerm!==10&&($scope.isQuotesLoaded=!1,$scope.modifySelection.policyCoverage=10+1*$scope.modifySelection.customerAge,$scope.saveCustomerSelection(),policyChangedByClick=!0,$localStorage.filterArray=null,pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Min Coverage click",pageName:"Quotes",click:"Click"}))},$scope.riderPremiumAdded=function(plan){var show=!1;return _.each(plan.selectedRiderIds,function(val,key){_.each(plan.riderPremiumObject,function(riderVal,riderKey){1*val===riderVal.riderId&&riderVal.premium>0&&(show=!0)})}),show},$scope.reversePremiumType=function(flag,plan){$scope.object.showLoader=!0,$timeout(function(){$scope.quotesObj.isMonthly=!flag;var premMode1=$scope.quotesObj.isMonthly?"monthly":"yearly";if($scope.paymentModeDropdown={isMonthly:$scope.quotesObj.isMonthly?"monthly":"yearly"},$cookies.put("monthPrem",premMode1),plan){var name=$scope.quotesObj.isMonthly?"monthly":"yearly",array=[];array.push(name),array.push(plan.Plan_Id);var premium=0;premium=$scope.quotesObj.isMonthly?$rootScope.pTabName.monthlyPlans||$rootScope.pTabName.allPlans?plan.maxMonthlyTotalPremium:plan.monthlyTotalPremium:plan.ComboTotalPremium,array.push(premium),gaTagsNew.trackChangePremiumType(array,"QuotesPage",$scope.modifySelection.custId)}pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,custId:$scope.preQuotesInfo.custId,event:"On Payment freq. change click",pageName:"Quotes",click:"Click"}),$scope.quotes=GenericService.checkIFADBOrATPDSelected($scope.quotes,$scope.quotesObj.isMonthly,$scope.types),$scope.newQuotes=GenericService.checkIFADBOrATPDSelected($scope.newQuotes,$scope.quotesObj.isMonthly,$scope.types),$scope.changeSingleSorting(null,!0),$timeout(function(){$scope.object.showLoader=!1},500)},500)},$scope.changeComparedPlanName=function(plan){return $scope.isHdfc3dPlan(plan.planId)?853==plan.planId?"Income Option Increasing Monthly Income":855==plan.planId?"Income Replacement Option Increasing Monthly Income":plan.planShortName:plan.planName},$scope.changeComparedSupplierName=function(plan){return 700===plan.supplierId||77===plan.supplierId?"SBI Life":plan.E2EName},$scope.compareCheckboxClick=function(plan){plan.isCompareSelected?$scope.checkToCompare(plan):$scope.removePlanFromCompare(plan)},$scope.showStarOnPlan=function(plan){var isNRI=1*$scope.preQuotesInfo.countryId!=392;return QuotesService.showStarOnPlan(plan,isNRI)},$scope.checkToCompare=function(plan,comingBackFromComparePage){var planId=plan.Plan_Id||plan.planId;if(CommonServiceTerm.isAegonItermPlusPlan(planId)&&(planId=818),$scope.hideObject.singleComparePlanMessage=!0,$scope.showCompareStachel=!0,$scope.comparePlans.length>=$scope.compareLimit)return $mdToast.show($mdToast.simple().content("Maximum Plans Selected For Comparison").position($scope.getToastPosition()).hideDelay(3e3)),!1;var index=$scope.comparePlanIds&&$scope.comparePlanIds.length>0?$scope.comparePlanIds.indexOf(planId):-1;index==-1&&($scope.comparePlanIds.push(planId),CompareService.setComparePlanIds($scope.comparePlanIds),$scope.comparePlans=CompareService.pushPlansToComparingList($scope.comparePlans,plan),pbTrackerObj.logEvent({leadId:$scope.modifySelection.matrixLeadId,custId:$scope.modifySelection.custId,visitId:$scope.modifySelection.visitId,event:"Add To Compare",pageName:"Quotes",planId:plan.Plan_Id}),comingBackFromComparePage||($scope.showCompareStachel=$scope.comparePlanIds.length>0),CompareService.saveComparingPlanIds($scope.modifySelection.custId,$scope.comparePlanIds)),setComparePlans(!1)},$scope.removePlanFromCompare=function(plan){var planId=plan.Plan_Id||plan.planId,index=$scope.comparePlanIds.indexOf(planId);$scope.hideObject.singleComparePlanMessage=!0,$scope.comparePlanIds.splice(index,1),CompareService.setComparePlanIds($scope.comparePlanIds),pbTrackerObj.logEvent({leadId:$scope.modifySelection.matrixLeadId,custId:$scope.modifySelection.custId,visitId:$scope.modifySelection.visitId,event:"Remove From Compare",pageName:"Quotes",planId:plan.planId}),$scope.comparePlans&&$scope.comparePlans.length>0&&($scope.comparePlans=$scope.comparePlans.filter(function(comparedPlan){return comparedPlan.planId!=planId})),CompareService.saveComparingPlanIds($scope.modifySelection.custId,$scope.comparePlanIds),$scope.showCompareStachel=$scope.comparePlanIds.length>0,setComparePlans(!1)},$scope.removeAllComparePlans=function(){clearComparePlans()},$scope.goToCompare=function(){if($scope.comparePlanIds.length>=2){$scope.isQuotesLoaded=!1;var tabName="ONETIMEPLANS";"1"==$scope.tab.tabValue?tabName="ONETIMEPLANS":"2"==$scope.tab.tabValue?tabName="MONTHLYPLANS":"3"==$scope.tab.tabValue?tabName="ALLPLANS":($scope.tab.tabValue="4")&&(tabName="TROPPLANS");var allPlans=[];allPlans=allPlansData&&allPlansData.length>0?CompareService.filterAllObjs(allPlansData,$scope.modifySelection):CompareService.filterAllObjs(quotes,$scope.modifySelection);var isAllMonthlyPlan=!0;_.each($scope.comparePlans,function(plan){plan.isMonthlyPlan||(isAllMonthlyPlan=!1)}),isAllMonthlyPlan=!(!isAllMonthlyPlan||"2"!=$scope.tab.tabValue),isAllMonthlyPlan&&(allPlans=[]),pbTrackerObj.logEvent({leadId:$scope.modifySelection.matrixLeadId,custId:$scope.modifySelection.custId,visitId:$scope.modifySelection.visitId,event:"Go To Compare page",pageName:"Quotes",comparingPlanIds:$scope.comparePlanIds}),CompareService.setComparePlanIds($scope.comparePlanIds),CompareService.setIsAllMonthlyPlan(isAllMonthlyPlan),CompareService.saveComparingPlanIds($scope.modifySelection.custId,$scope.comparePlanIds,isAllMonthlyPlan),CompareService.saveCustomerInfo($scope.modifySelection.customerAge),CompareService.saveQuotesOrder($scope.enquiryId,tabName,$scope.quotes,allPlans).success(function(data,status){GenericService.isUndefinedOrNull(data)?clearComparePlans():"success"==data.status?$location.path("/compare/"+$scope.enquiryId).search("quotesVariant",0):clearComparePlans()}).error(function(data,success){clearComparePlans()})}else $mdToast.show($mdToast.simple().content("Select 1 More Plan To Compare").position($scope.getToastPosition()).hideDelay(3e3)),$scope.hideObject.singleComparePlanMessage=!1},$scope.changeName=function(id,plan,name){var supplierId=plan.Supplier_Idis,aegonNotVisiblePlans=[818,819,820,821],planId=plan.Plan_Id;if(11==supplierId){if(10==id)return"Accidental Death and Disability";if(11==id)return"Critical Illness and Disability"}if(aegonNotVisiblePlans.indexOf(planId)>-1){if(1*id===11)return"Basic CI + Waiver Of Premium";if(1*id===15)return"Enhanced CI + Waiver Of Premium"}return 1*planId===819&&1*id===10?"Accidental Death + Waiver Of Premium":1!=supplierId||12!=id||$rootScope.isMobileDevice?GenericService.isMAXPlan(planId)&&38==id?"Waiver of Premiums":CommonServiceTerm.isTataPlan(planId)&&12==id?"Death and disability due to accident":116!=supplierId&&10!=supplierId||38!=id?10==supplierId&&10==id?"Death and disability due to accident":CommonServiceTerm.isHdfc3dPlan(planId)&&101==id?"Waiver of premium and terminal illness":$scope.isPNBPlan(planId)&&11==id?"Serious illness":name:"Waiver of premium on critical illness":"Death & Disability due to accident"},$scope.isAegonObjAvailable=function(){return null!==$scope.aegonObj&&void 0!==$scope.aegonObj&&!CommonServiceTerm.isEmptyObject($scope.aegonObj)},$scope.getNameAccordingToPayType=function(){return 2==$scope.type.payType?"Single Pay":3==$scope.type.payType?"Limited Pay":""},$scope.sortByPlanType=function(){$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?$scope.changeSingleSorting():$scope.changeSorting()},$scope.showDiscount=function(plan){return plan.onlineDiscount},$scope.riderAvailabilityStatus=function(rider,plan){if(rider){var premium=$scope.quotesObj.isMonthly?rider.monthlyPremium:rider.premium,isIncluded=rider.isIncluded;return $scope.isPNBPlan(plan.Plan_Id)&&13==rider.categoryId?$scope.modifySelection.policyCoverage>75?"-":"Available":premium||isIncluded?"Available":"-"}return"-"},$scope.dontUpdateSpouseRider=function(){$rootScope.profile.spouse||jointLifeRiderClicked&&(_.each($scope.types,function(val){1*val.id===13&&(val.status=!1)}),jointLifeRiderClicked=!1)},$scope.onClickFaqLink=function(){pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Faq link Click",pageName:"Quotes",click:"Click"})},$scope.onPreviousSessionClick=function(e){e.preventDefault(),e.stopPropagation()},$scope.clickedOnModal=function(elem){$timeout(function(){!$scope.progressiveJourney.mobileNo&&$("#mobileNumberSubmitButton")&&$("#mobileNumberSubmitButton").click()},0)},angular.element(document).ready(function(){$(document).click(function(){$scope.showRidersSuggestionStachel&&$scope.previousRiderSelection.length>0&&$scope.closeRestoreSessionMsg()}),$timeout(function(){$scope.showRidersSuggestionStachel&&$scope.previousRiderSelection.length>0&&$scope.closeRestoreSessionMsg()},4e4),$("#spouseProfileModal").on("hidden.bs.modal",function(){$scope.$apply(function(){$rootScope.profile.spouse||jointLifeRiderClicked&&(_.each($scope.types,function(val){1*val.id===13&&(val.status=!1)}),jointLifeRiderClicked=!1)})}),$(function(){$("body").scrollTop(0)}),$timeout(function(){$scope.showLink.call=!0},2e3),$timeout(function(){$rootScope.pageLoaded=!0,$("pbheader").css({position:"relative",top:"-150px"}),$("pbheader").delay(100).animate({top:"0px"},1e3)},500)})}function totalPayoutDropDown(CommonServiceTerm,$timeout){return{scope:{options:"=",value:"=",onChange:"&",showCustomInput:"@",toggleModal:"&",isDisabled:"=",customizePlan:"=",showCallout:"="},replace:!0,template:'<div class="selctbox" id="totalPayoutdd" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">Total Payout</span><label class="selectvla" ng-click="toggleDropDown($event)">{{changeDisplayNumberFormat(value.totalPayout)}}</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle"><li ng-click="updateValue($event,option.name)" id="option-{{option.name}}" ng-repeat="option in options track by $index">{{changeDisplayNumberFormat(option.name)}}</li></ul><div class="custom-input-button" ng-if="showCustomInput==\'true\'"><p ng-click="clickToShowCustomModal();toggleDropDown($event)">Enter Custom</p></div><div ng-show="showCallout" class="callout-message">Updated total payout, <em>Click to change.</em></div></div>',link:function(scope,elem,attrs){function scrollToValue(){$timeout(function(){var value=scope.value.totalPayout,li=elem.find("#option-"+value),ul=elem.find(".slidetoggle");if(li[0]){var topPos=li[0].offsetTop;ul.animate({scrollTop:topPos},200)}},100)}scope.showdropdown=!1,scope.mouseenter=!1,scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||(elem.toggleClass("shown"),scrollToValue())},scope.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},scope.updateValue=function(e,value){e.stopPropagation(),elem.removeClass("shown"),scope.value.totalPayout!=value&&(scope.value.totalPayout=value,scope.onChange(),scope.customizePlan.apply=!1)},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0}),scope.clickToShowCustomModal=function(){scope.toggleModal({payoutModal:"payoutModal",status:"show"})}}}}function monthlyPayoutDropDown(CommonServiceTerm,$timeout){return{scope:{options:"=",value:"=",onChange:"&",showCustomInput:"@",toggleModal:"&",isDisabled:"=",customizePlan:"="},replace:!0,template:'<div class="selctbox" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">Monthly Payout</span><label class="selectvla" id="monthlyPayoutdd" ng-click="toggleDropDown($event)">{{changeDisplayNumberFormat(value.monthlyIncome)}}</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle"  ng-click="toggleDropDown($event)"><li ng-click="updateValue($event,option.name)" id="option-{{option.name}}" ng-repeat="option in options track by $index">{{changeDisplayNumberFormat(option.name)}}</li></ul><div class="custom-input-button" ng-if="showCustomInput==\'true\'"><p ng-click="clickToShowCustomModal();toggleDropDown($event)">Enter Custom</p></div></div>',link:function(scope,elem,attrs){function scrollToValue(){$timeout(function(){var value=scope.value.monthlyIncome,li=elem.find("#option-"+value),ul=elem.find(".slidetoggle");
if(li[0]){var topPos=li[0].offsetTop;ul.animate({scrollTop:topPos},200)}},100)}scope.showdropdown=!1,scope.mouseenter=!1,scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||(elem.toggleClass("shown"),scrollToValue())},scope.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},scope.updateValue=function(e,value){e.stopPropagation(),elem.removeClass("shown"),scope.value.monthlyIncome!=value&&(scope.value.monthlyIncome=value,scope.onChange(),scope.customizePlan.apply=!1)},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0}),scope.clickToShowCustomModal=function(){scope.toggleModal({payoutModal:"payoutModal",status:"show"})}}}}function coverUptoDropDown($timeout){return{scope:{options:"=",value:"=",onChange:"&",clickToSwitchWholeLife:"&",showSwitchToWholeLife:"@",isDisabled:"=",customizePlan:"=",validatePayTerm:"&",type:"="},replace:!0,template:'<div class="selctbox" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">Cover Upto</span><label class="selectvla" id="coverUptodd" ng-click="toggleDropDown($event)">{{value.policyCoverage}} yrs</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle" ><li ng-click="updateValue($event,option.name)" id="option-{{option.name}}" ng-repeat="option in options track by $index">{{option.name}} yrs</li></ul><div class="switch-to-whole-life-container" ng-if="showSwitchToWholeLife==\'true\'"><p ng-click="clickToSwitchWholeLife();toggleDropDown($event)">Switch to WholeLife</p></div><div class="error" ng-if="type.payType == 3" ng-hide="isValid">{{errorMsg}}</div></div>',link:function(scope,elem,attrs){function scrollToValue(){$timeout(function(){var value=scope.value.policyCoverage,li=elem.find("#option-"+value),ul=elem.find(".slidetoggle");if(li[0]){var topPos=li[0].offsetTop;ul.animate({scrollTop:topPos},200)}},100)}scope.showdropdown=!1,scope.mouseenter=!1,scope.isValid=!0,scope.errorMsg,scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||(elem.toggleClass("shown"),scrollToValue())},scope.updateValue=function(e,value){if(e.stopPropagation(),elem.removeClass("shown"),scope.value.policyCoverage!=value){var errorDesc=scope.validatePayTerm({payTermValue:void 0,coverageUpto:value});scope.isValid="true"==errorDesc.split(":")[0],scope.isValid||(scope.errorMsg=errorDesc.split(":")[1]),scope.value.policyCoverage=value,scope.isValid&&(scope.onChange(),scope.customizePlan.apply=!1)}},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0})}}}function payTypeDropDown($timeout){return{scope:{options:"=",value:"=",onChange:"&",isDisabled:"=",customizePlan:"=",showOverlap:"=",customToggleModal:"&",knowMorePlan:"="},replace:!0,template:'<div class="selctbox" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">PayType</span><label class="selectvla" id="payTypedd" ng-click="toggleDropDown($event)">{{changeDisplay(value.payType)}}</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle"  ng-click="toggleDropDown($event)"><li ng-click="updateValue($event,option.value)" ng-repeat="option in options track by $index">{{option.displayValue}}</li></ul><div ng-if="showOverlap" ng-click="customModalToggle()" class="paytype_tooltop"><p>Save money with limited pay</p><a class="no-more" style="font-size: 11px; text-decoration: underline !important; font-weight:600; cursor: pointer; color:#ffff;">Know More</a></div></div>',link:function(scope,elem,attrs){scope.showdropdown=!1,scope.mouseenter=!1,scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||elem.toggleClass("shown")},scope.customModalToggle=function(){scope.showOverlap=!1,scope.knowMorePlan={},scope.customToggleModal({modalName:"term_popup_modal2",status:"show"})},scope.changeDisplay=function(value){return 1*value===3?"Limited Pay":1*value===2?"Single Pay":1*value===1?"Regular":void 0},scope.updateValue=function(e,value){e.stopPropagation(),elem.removeClass("shown"),scope.value.payType!=value&&(scope.value.payType=value,scope.onChange(),scope.customizePlan.apply=!1)},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0})}}}function payOutDropDown($timeout){return{scope:{options:"=",value:"=",onChange:"&",isDisabled:"=",customizePlan:"="},replace:!0,template:'<div class="selctbox" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">Payout</span><label class="selectvla" id="payoutdd" ng-click="toggleDropDown($event)">{{changeDisplay(value.tabValue)}}</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle"  ng-click="toggleDropDown($event)"><li ng-click="updateValue($event,option.value)" ng-repeat="option in options track by $index">{{option.displayValue}}</li></ul></div>',link:function(scope,elem,attrs){scope.showdropdown=!1,scope.mouseenter=!1,scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||elem.toggleClass("shown")},scope.changeDisplay=function(value){return 4==value?"Return of Premium":2==value?"Monthly":"Lumpsum"},scope.updateValue=function(e,value){e.stopPropagation(),elem.removeClass("shown"),scope.value.tabValue!=value&&(scope.value.tabValue=value,scope.onChange(),scope.customizePlan.apply=!1)},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0})}}}function payTermDropDown($timeout,$localStorage){return{scope:{options:"=",value:"=",onChange:"&",isDisabled:"=",customizePlan:"=",preQuotesInfo:"=",validatePayTerm:"&"},replace:!0,template:'<div class="selctbox paytrm" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">Pay Term</span><label class="selectvla" id="payoutdd" ng-click="toggleDropDown($event)">{{changeDisplay(value.ppt)}} yrs</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle"  ng-click="toggleDropDown($event)"><li ng-click="updateValue($event,option)" ng-repeat="option in options track by $index" ng-hide="hideOption(option)">{{option.displayValue}} yrs</li></ul><div class="error" ng-hide="isValid">{{errorMsg}}</div></div>',link:function(scope,elem,attrs){scope.isValid=!0,scope.showdropdown=!1,scope.mouseenter=!1,scope.errorMsg,scope.hideOption=function(option){return"Pay Till 60"===option.displayValue&&scope.preQuotesInfo.policyCoverage<=60},scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||elem.toggleClass("shown")},scope.changeDisplay=function(value){return"Pay Till 60"===$localStorage.selectedPayTerm?"Pay Till 60":value},scope.updateValue=function(e,option){e.stopPropagation(),elem.removeClass("shown");var value=option.value;if("Pay Till 60"===option.displayValue&&(value=60-scope.preQuotesInfo.customerAge),scope.value.ppt!=value){var errorDesc=scope.validatePayTerm({payTermValue:value,coverageUpto:void 0});scope.isValid="true"==errorDesc.split(":")[0],scope.isValid||(scope.errorMsg=errorDesc.split(":")[1]),scope.value.ppt=value,$localStorage.selectedPayTerm=option.displayValue,scope.isValid&&scope.onChange()}},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0})}}}function tabSwitcher($timeout){return{scope:{value:"=",onChange:"&",tabName:"@",disableRadio:"=",customizePlan:"="},template:'<aside class="left-tab"><ul><li ng-click="updateValue(4)" ng-class="{\'active\':isActive(\'tropPlans\')}"><i class="planyear"></i><p>Return of Premium</p><div class="ribbon"><span>New</span></div></li><li ng-click="updateValue(1)" ng-class="{\'active\':isActive(\'onetimePlans\')}"><i class="planyear"></i><p>Lumpsum Plan</p></li><li ng-click="updateValue(2)" ng-class="{\'active\':isActive(\'monthlyPlans\')}"><i class="planyear"></i><p>Monthly Income Plan</p></li><li ng-click="updateValue(5)" ng-class="{\'active\':isActive(\'wholeLifePlans\')}"><i class="planyear"></i><p>Plans for<br/> 100 yrs +</p></li></ul></aside>',link:function(scope,elem,attrs){scope.updateValue=function(value){scope.disableRadio||(scope.value.tabValue=value,scope.onChange(),scope.customizePlan.apply=!1)},scope.isActive=function(val){var tabName=JSON.parse(scope.tabName);return tabName[val]}}}}function sortByDropDown($timeout){return{scope:{options:"=",value:"=",onChange:"&",isDisabled:"="},replace:!0,template:'<div class="selctbox" ng-click="toggleDropDown($event)"><span ng-click="toggleDropDown($event)">Sort by</span><label class="selectvla" id="sortbydd" ng-click="toggleDropDown($event)">{{changeDisplay(value.value)}}</label><i class="fa fa-angle-down" ng-click="toggleDropDown($event)"></i><ul class="slidetoggle"  ng-click="toggleDropDown($event)"><li ng-click="updateValue($event,option.value)" ng-repeat="option in options track by $index">{{option.displayValue}}</li></ul></div>',link:function(scope,elem,attrs){scope.showdropdown=!1,scope.mouseenter=!1,scope.toggleDropDown=function(e){e.preventDefault(),e.stopPropagation(),$(".selctbox").not(elem).removeClass("shown"),scope.isDisabled||elem.toggleClass("shown")},scope.changeDisplay=function(value){return 1*value===3?"Coverage":1*value===2?"Premium":1*value===1?"Popularity":void 0},scope.updateValue=function(e,value){e.stopPropagation(),elem.removeClass("shown"),scope.value.value!=value&&(scope.value.value=value,scope.onChange())},elem.on("mouseleave",function(){scope.mouseenter=!1,$timeout(function(){scope.mouseenter||elem.removeClass("shown")},800)}),elem.on("mouseenter",function(){scope.mouseenter=!0})}}}function quoteTile($timeout,QuotesService,GenericService,CommonServiceTerm,$rootScope,$mdToast,$interval,$filter,$routeParams,$cookies){return{scope:{plan:"=",compareCheckboxClick:"&",hideShowPlans:"&",preQuotesInfo:"=",isSpouseWorking:"=",clickToSwitchWholeLife:"&",showPnb99Plan:"=",getComboTotalPremiumDifference:"&",getMonthlyTotalPremiumDifference:"&",quotesObj:"=",riderAvailabilityStatus:"&",showTillSixtyYearsRider:"&",showPayForTenYearsRider:"&",proceed:"&",type:"=",object:"=",clickedPlanId:"=",addOn:"=",reversePremiumType:"&",modifySelection:"=",quoteType:"@",quotes:"=",messageIndex:"=",termSwitchBackValue:"=",pTabName:"=",planIndex:"=",quoteRiderSelect:"&",hideShowPlans:"&",getSurvivalBenefit:"&",profile:"=",isSpouseWorking:"=",showCompareToolTip:"@",riderDescription:"@",updateRidersCount:"=",showStarOnPlan:"&",customToggleModal:"&",knowMorePlan:"=",customerChangeInitiated:"=",customerEligibility:"="},controller:function($scope){$scope.getDisplayValue=function(plan,isMonthly,isDiscountValue){var offlinePremium=isMonthly&&plan.monthlyOfflinePremium?plan.monthlyOfflinePremium+plan.monthlyRiderPremiumAdded:plan.annualOfflinePremium+plan.riderPremiumAdded;return isMonthly&&"SinglePay"!=plan.payOptionType?GenericService.calculateDiscount(plan,plan.monthlyTotalPremium+plan.monthlyRiderPremiumAdded,isDiscountValue,offlinePremium):GenericService.calculateDiscount(plan,plan.ComboTotalPremium+plan.riderPremiumAdded,isDiscountValue,offlinePremium)},$scope.hiddenRidersCount=0,$scope.isNonTropPlanVisible=function(plan){var sumAssured=plan.SumAssured?plan.SumAssured:plan.maxSumAssured?plan.maxSumAssured:$scope.preQuotesInfo.totalPayout,isVisible=plan.isQuotesVisible;return $rootScope.pTabName.onetimePlans?(plan.isTrop||761==plan.Plan_Id)&&(isVisible=!1):$rootScope.pTabName.tropPlans?plan.isLifeLongProtection&&plan.isTrop&&(isVisible=!1):$rootScope.pTabName.wholeLifePlans&&(isVisible=!(!plan.isWholeLifePlan||!plan.isOneTimePlan)),CommonServiceTerm.isSbiPoornaSuraksha(plan.Plan_Id)&&(isVisible=$scope.quotesObj.isMonthly?plan.monthlyPremiumWGST>250:plan.annualPremiumWGST>3e3),(CommonServiceTerm.isPNBPlan(plan.Plan_Id)||CommonServiceTerm.isIndiaFirstPlan(plan.Plan_Id))&&$rootScope.utmSource&&(isVisible="offlineaffiliate"!=$rootScope.utmSource.toLowerCase()),"Self-Employed"===$scope.preQuotesInfo.professionType&&CommonServiceTerm.isPNBPlan(plan.Plan_Id)&&sumAssured<=25e5&&(isVisible=!1),$scope.quotesObj.isMonthly?plan.minimumMonthlyPremium&&plan.minimumMonthlyPremium>plan.monthlyTotalPremium/1.18&&(isVisible=!1):plan.minimumAnnualPremium&&plan.minimumAnnualPremium>plan.BasicPremium/1.18&&(isVisible=!1),isVisible},$scope.addCommas=function(nStr){return GenericService.addCommas(nStr)},$scope.isHdfc3DPlan=function(planId){CommonServiceTerm.isHdfc3dPlan($scope.planDetails.planId)},$scope.sixtyYearRiderText="Pay till 60 years",$scope.tenYearRiderText="Pay for 10 years",$scope.expressServiceText="Post sale customer queries will be resolved in the first call through a fast lane customer service team.",$scope.getPlanCategoryType=function(plan){return QuotesService.getPlanCategoryType(plan)},$scope.isChildPlan=function(plan){return GenericService.isChildPlan(plan)},$scope.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},$scope.isAegoniTermForverPlan=function(planId){return CommonServiceTerm.isAegoniTermForverPlan(planId)},$scope.isSpouseAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.spouse)&&(angular.isDefined(data.spouse)&&data.spouse&&angular.isDefined(data.spouse.age)&&data.spouse.age&&GenericService.isSpouseAgeValid(data.spouse.age)&&null!==data.spouse.tobacco&&null!==data.spouse.isWorking)},$scope.isChildAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.child)&&(angular.isDefined(data.child)&&data.child&&angular.isDefined(data.child.age)&&data.child.age>=0&&GenericService.isChildAgeValid(data.child.age))},$scope.showHundredCoverage=function(plan){var planId=plan.Plan_Id||plan.planId,notHundredCoveragePlans=[749,752,753,756,787,789,814,815,816,817];return!!plan.isWholeLifePlan&&notHundredCoveragePlans.indexOf(planId)==-1},$scope.showHundredText=function(plan){var planId=plan.Plan_Id||plan.planId,plansToHide=[934,935,936,937];return plansToHide.indexOf(planId)==-1},$scope.AllowExpress=function(supplierId){var supplierIds=[5,10];return supplierIds.indexOf(1*supplierId)>-1},$scope.renderTATData=function(plan){return angular.isDefined(plan.tATData)?plan.tATData:""},$scope.showSwitchToWholeLifeLink=function(selectedCoverage,planId,isWholeLife){var show=!1,tabs=!!$rootScope.pTabName.onetimePlans,plans=!(!GenericService.isAegoniTermPlan(planId)&&!CommonServiceTerm.isPNBPlan(planId));return selectedCoverage<99&&tabs&&plans&&(show=!0),show},$scope.switchToWholeLifeLinkText=function(planId,isWholeLife){return GenericService.isAegoniTermPlan(planId)?"Upgrade to 100 years ":CommonServiceTerm.isPNBPlan(planId)?"Upgrade to 99 years ":""},$scope.isE2EPlans=function(plan){return termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)>-1},$scope.isPNBPlan=function(planId){return CommonServiceTerm.isPNBPlan(planId)},$scope.isTataSRPlan=function(planId){return GenericService.isTATASampoornaRakshaPlan(planId)},$scope.isAegoniTermPlanNew=function(planId){return CommonServiceTerm.isAegonPlan(planId)},$scope.changeName=function(id,plan,name){return QuotesService.modifyRiderName(id,plan,name)},$scope.showStepDownOption=function(planId){return CommonServiceTerm.isKotakPlan(planId)},$scope.showExtendedTermOption=function(planId){return CommonServiceTerm.isExidePlan(planId)},$scope.isAegonTropPlan=function(planId){return!!$rootScope.pTabName.onetimePlans&&GenericService.isAegoniReturnPlan(planId)},$scope.isAegoniTermStickerVisible=function(planId,term){return term<75&&$scope.isAegoniTermPlan(planId)},$scope.isAegoniTermPlan=function(planId){return!!$rootScope.pTabName.onetimePlans&&GenericService.isAegoniTermPlan(planId)},$scope.hideThisRider=function(index,rider){return index>=2&&!rider.isSelected}},templateUrl:"templates/partials/quotes-new/quote-tile.html",link:function($scope,elem,attrs){function callQuotesApi(){var lastQuestionAnswered=void 0!==$cookies.get("last_question_answered")?$cookies.get("last_question_answered"):"";return!!(!$routeParams.isProgressiveJourney||"annualincome"===lastQuestionAnswered||"professiontype"===lastQuestionAnswered||$routeParams.LeadId&&$routeParams.AgentId)}$scope.showAll=!1,$scope.isRiderChecked=function(rider){return(rider.isSelected||rider.inBuildAddOn||rider.isDefaultAdded)&&!rider.hasRiderStatus||rider.checked},$scope.allRidersChecked=function(){if($scope.plan.riderPremiumObject){var checkedRidercount=0,totalRiders=$scope.plan.riderPremiumObject.length-2;return _.each($scope.plan.riderPremiumObject,function(rider,index){rider.isHidden&&(totalRiders-=1),index>1&&$scope.isRiderChecked(rider)&&(checkedRidercount+=1)}),checkedRidercount===totalRiders}return!1},$scope.customModalToggle=function(modalName,status){$scope.knowMorePlan=$scope.plan,$scope.customToggleModal({modalName:modalName,status:status})};var updateRiderShowStatus=function(){$scope.plan.riderPremiumObject&&($scope.plan.riderPremiumObject=$filter("orderBy")($scope.plan.riderPremiumObject,"riderPriority"),$scope.hiddenRiderCount=$scope.plan.riderPremiumObject.length-2,$scope.hiddenRiderCount?_.each($scope.plan.riderPremiumObject,function(rider,index){"undefined"!=typeof rider&&(rider.isSecondary=!1,index>1&&(rider.isSecondary=!0),$scope.showAll?(rider.isSecondary=!1,$scope.hiddenRiderCount=0):(rider.isSelected&&index>1||rider.isClicked)&&(rider.isSecondary=!1,rider.isClicked=!0,$scope.hiddenRiderCount=$scope.hiddenRiderCount-1),rider.isHidden&&($scope.hiddenRiderCount=$scope.hiddenRiderCount-1),index===$scope.plan.riderPremiumObject.length-1&&($scope.showAll?elem.find(".secondary-rider").slideDown(200,function(){$(this).addClass("just-shown")}):elem.find(".just-shown").not(".selected-rider").slideUp(200)))}):_.each($scope.plan.riderPremiumObject,function(rider,index){"undefined"!=typeof rider&&(rider.isSecondary=!1)}))};$scope.toggleMoreRiders=function(status){"show"===status?($scope.showAll=!0,updateRiderShowStatus(),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Show All Rider Click",pageName:"Quotes",click:"Click"})):(pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,custId:$scope.preQuotesInfo.custId,visitId:$scope.modifySelection.visitId,event:"On Show Less Rider Click",pageName:"Quotes",click:"Click"}),$scope.showAll=!1,_.each($scope.plan.riderPremiumObject,function(rider,index){rider.isSelected||(rider.isClicked=!1),index===$scope.plan.riderPremiumObject.length-1&&updateRiderShowStatus()}))},$scope.$watch("plan.riderPremiumAdded",function(newValue,oldValue){updateRiderShowStatus()}),$scope.$watch("quotesObj.isMonthly",function(newValue,oldValue){updateRiderShowStatus()}),$scope.$watch("updateRidersCount",function(newValue,oldValue){updateRiderShowStatus()});var doNotListRider=function(rider){if(rider.doNotPopFromObject)return!1;if(rider.hasRiderStatus&&rider.hasRiderStatus.length>0)return!1;if(rider.inBuildAddOn)return!1;if(rider.isDefaultAdded)return!1;if(!rider.isDefaultAdded&&!rider.inBuildAddOn){if(rider.premium>0||rider.monthlyPremium>0)return!1;if("Available"===$scope.riderAvailabilityStatus(rider,$scope.plan))return!1}return!0};$scope.$watch("plan.isRiderLoaded",function(newValue,oldValue){newValue!=oldValue&&1==$scope.plan.isRiderLoaded&&_.each($scope.plan.riderPremiumObject,function(rider,index){rider&&doNotListRider(rider)&&($scope.plan.riderPremiumObject.splice(index,1),$scope.hiddenRiderCount=$scope.hiddenRiderCount-1),index==$scope.plan.riderPremiumObject.length-1&&updateRiderShowStatus()})}),$timeout(function(){callQuotesApi()&&(elem.find("#compareToolTip_0").addClass("hide-animate"),$timeout(function(){elem.find("#compareToolTip_0").removeClass("hide-animate")},2e3))},3500)}}}function riderModal($timeout){return{scope:{types:"=",toggleRidersFn:"&",riderSelectCallback:"&",riderAddOns:"=",wholeLifeCheckboxClick:"&",togglePayTill60Clicked:"&",description:"@",isSelectedAddonAvailable:"=",isAddonRecommendationAvailable:"=",addonRecommendationNotes:"=",customizePlan:"="},templateUrl:"templates/partials/quotes-new/rider-modal.html",link:function(scope,elem,attrs){scope.desc=JSON.parse(scope.description),scope.onRiderUpdate=function(){scope.toggleRidersFn(!1),scope.customizePlan.apply=!1}}}}function riderDescriptionText(QuotesService){return{replace:!0,scope:{supplierId:"=",rider:"=",quotesObj:"=",name:"@",age:"=",coverage:"=",custInfo:"=",isRiderLoaded:"="},link:function(scope,elem,attrs){scope.renderText=function(){return QuotesService.renderRiderDescriptionText(scope.supplierId,scope.rider,scope.quotesObj,scope.name,scope.age,scope.coverage,scope.custInfo)},scope.$watch("isRiderLoaded",function(newVal,oldVal){if(newVal){var text=scope.renderText();text.length>0&&attrs.$set("title",text)}})}}}function riderWrap(QuotesService,$filter){return{replace:!0,scope:{plan:"=",quoteRiderSelect:"&",riderAvailabilityStatus:"&",quotesObj:"=",updateRidersCount:"=",preQuotesInfo:"="},templateUrl:"templates/quote-mobile/rider-wrap.html",link:function(scope,elem,attrs){scope.hiddenRidersCount=0,scope.changeName=function(id,plan,name){return QuotesService.modifyRiderName(id,plan,name)},scope.showAll=!1,scope.isRiderChecked=function(rider){return(rider.isSelected||rider.inBuildAddOn||rider.isDefaultAdded)&&!rider.hasRiderStatus||rider.checked},scope.allRidersChecked=function(){var checkedRidercount=0,totalRiders=scope.plan.riderPremiumObject.length-2;return _.each(scope.plan.riderPremiumObject,function(rider,index){rider.isHidden&&(totalRiders-=1),index>1&&scope.isRiderChecked(rider)&&(checkedRidercount+=1)}),checkedRidercount===totalRiders};var updateRiderShowStatus=function(){scope.plan.riderPremiumObject&&(scope.plan.riderPremiumObject=$filter("orderBy")(scope.plan.riderPremiumObject,"riderPriority"),scope.hiddenRiderCount=scope.plan.riderPremiumObject.length-2,scope.hiddenRiderCount?_.each(scope.plan.riderPremiumObject,function(rider,index){"undefined"!=typeof rider&&(rider.isSecondary=!1,index>1&&(rider.isSecondary=!0),scope.showAll?(rider.isSecondary=!1,scope.hiddenRiderCount=0):(rider.isSelected&&index>1||rider.isClicked)&&(rider.isSecondary=!1,rider.isClicked=!0,scope.hiddenRiderCount=scope.hiddenRiderCount-1),rider.isHidden&&(scope.hiddenRiderCount=scope.hiddenRiderCount-1),index===scope.plan.riderPremiumObject.length-1&&(scope.showAll?elem.find(".secondary-rider").slideDown(200,function(){$(this).addClass("just-shown")}):elem.find(".just-shown").not(".selected-rider").slideUp(200)))}):_.each(scope.plan.riderPremiumObject,function(rider,index){"undefined"!=typeof rider&&(rider.isSecondary=!1)}))};scope.toggleMoreRiders=function(status){"show"===status?(scope.showAll=!0,updateRiderShowStatus(),pbTrackerObj.logEvent({leadId:scope.preQuotesInfo.matrixLeadId,custId:scope.preQuotesInfo.custId,visitId:scope.preQuotesInfo.visitId,event:"On Show All Rider Click",pageName:"Quotes Mobile",click:"Click"})):(pbTrackerObj.logEvent({leadId:scope.preQuotesInfo.matrixLeadId,custId:scope.preQuotesInfo.custId,visitId:scope.preQuotesInfo.visitId,event:"On Show Less Rider Click",pageName:"Quotes Mobile",click:"Click"}),scope.showAll=!1,_.each(scope.plan.riderPremiumObject,function(rider,index){rider.isSelected||(rider.isClicked=!1),index===scope.plan.riderPremiumObject.length-1&&updateRiderShowStatus()}))},scope.$watch("plan.riderPremiumAdded",function(newValue,oldValue){updateRiderShowStatus()}),scope.$watch("quotesObj.isMonthly",function(newValue,oldValue){updateRiderShowStatus()}),scope.$watch("updateRidersCount",function(newValue,oldValue){updateRiderShowStatus()});var doNotListRider=function(rider){if(rider.doNotPopFromObject)return!1;if(rider.hasRiderStatus&&rider.hasRiderStatus.length>0)return!1;if(rider.inBuildAddOn)return!1;if(rider.isDefaultAdded)return!1;if(!rider.isDefaultAdded&&!rider.inBuildAddOn){if(rider.premium>0||rider.monthlyPremium>0)return!1;if("Available"===scope.riderAvailabilityStatus(rider,scope.plan))return!1}return!0};scope.$watch("plan.isRiderLoaded",function(newValue,oldValue){newValue!=oldValue&&1==scope.plan.isRiderLoaded&&_.each(scope.plan.riderPremiumObject,function(rider,index){rider&&doNotListRider(rider)&&(scope.plan.riderPremiumObject.splice(index,1),scope.hiddenRiderCount=scope.hiddenRiderCount-1),index==scope.plan.riderPremiumObject.length-1&&updateRiderShowStatus()})})}}}function toggleDropDown($timeout){return{restrict:"EA",link:function(scope,elem,attrs){function scrollToValue(){$timeout(function(){var ul=elem.find("ul"),value=parseInt(ul.attr("data-selected-value")),li=elem.find(".option-"+value);if(li[0]){var topPos=li[0].offsetTop;ul.animate({scrollTop:topPos},200)}},100)}var activeClass="active-dropdown",allDropdowns=angular.element(document).find(".dropdown-toggle").not(elem);elem.on("click",function(e){e.stopPropagation(),allDropdowns.removeClass(activeClass),elem.toggleClass(activeClass),scrollToValue()}),angular.element(document).on("click",function(){angular.element(document).find(".dropdown-toggle").removeClass(activeClass)})}}}function customerInfoModal($timeout){return{scope:{data:"=",changeDate:"&",changeMonth:"&",changeYear:"&",isYearSelected:"&",isDobMissing:"&",isValidDateOfBirth:"&",isAgeBelowMinimum:"&",isAgeAboveMaximum:"&",genderOptions:"=",modifySelection:"=",dob:"=",spouse:"=",preQuotesInfo:"=",countryCodes:"=",updateCustomerInfo:"=",maxMobileNoLength:"=",regexForMobileNo:"=",minMobileNoLength:"="},templateUrl:"templates/partials/quotes-new/customer-info-modal.html",link:function(scope,elem,attrs){}}}var app=angular.module("app",["ngAnimate","ngRoute","ngCookies","ngSanitize","ngAria","ngMaterial","ngMessages","ngStorage","vAccordion","TermCommon","duScroll","ui.bootstrap","app.ProductPage","slick"]);app.constant("isMobile",isMobileDevice()),app.constant("isTablet",window.innerWidth>=760&&window.innerWidth<=1024),window.console||(console={log:function(){}}),String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},String.prototype.startsWith||(String.prototype.startsWith=function(searchString,position){return position=position||0,this.indexOf(searchString,position)===position}),Array.prototype.sortByProp=function(p){return this.sort(function(a,b){return a[p]>b[p]?1:a[p]<b[p]?-1:0})},Array.prototype.unique=function(){for(var n={},r=[],i=0;i<this.length;i++)n[this[i]]||(n[this[i]]=!0,r.push(this[i]));return r},Array.prototype.insert=function(index,item){this.splice(index,0,item)},Array.prototype.move=function(from,to){return this.splice(to,0,this.splice(from,1)[0]),this},Array.prototype.getIndexBy=function(name,value){for(var i=0;i<this.length;i++)if(this[i][name]==value)return i;return-1},window.getUrlParameter=function(sParam){var sParameterName,i,sPageURL=decodeURIComponent(window.location.search.substring(1)),sURLVariables=sPageURL.split("&");for(i=0;i<sURLVariables.length;i++)if(sParameterName=sURLVariables[i].split("="),sParameterName[0]===sParam)return void 0===sParameterName[1]||sParameterName[1]},app.run(["$route","$rootScope","$location","$cookies","isMobile","isTablet",function($route,$rootScope,$location,$cookies,isMobile,isTablet){$rootScope.footerLoad=!1,$rootScope.quotesLoad=!1,$rootScope.hideObject={showTollFree:!1},$rootScope.cancerName="Cancer Insurance",$rootScope.hideObject.showTollFree="valuedirect"!==$location.$$search.utm_source,angular.isDefined($location.$$search.pb_source)?$rootScope.utmSource=$location.$$search.pb_source:angular.isDefined($location.$$search.utm_source)?$rootScope.utmSource=$location.$$search.utm_source:angular.isDefined($cookies.get("pborganic"))&&"organic"==$cookies.get("pborganic")?$rootScope.utmSource=$cookies.get("pborganic"):$rootScope.utmSource="",$rootScope.landingSEO="Likkk ",$rootScope.utmMedium=$location.$$search.pb_medium||$location.$$search.utm_medium||"",$rootScope.utmCampaign=$location.$$search.pb_campaign||$location.$$search.utm_campaign||"",$rootScope.utmTerm=$location.$$search.pb_term||$location.$$search.utm_term||"",$rootScope.isTablet=isTablet,$rootScope.isMobileDevice=!1,$rootScope.pbclaimUrl=termConfigObj.getPbClaimUrl(),$rootScope.detectedCountry="india",isMobile?($rootScope.isMobileDevice=!0,$rootScope.pblogo="logo_icon@2x"):$rootScope.pblogo="pb-logo",$rootScope.errorContact=!1,$rootScope.quotesVariant=0,$rootScope.gaResult=0,$rootScope.showChatBot=!1,$rootScope.isIFrame=!!$location.$$search.iframe&&$location.$$search.iframe,$rootScope.$on("$routeChangeStart",function(ev,next,cur){$(".modal-backdrop").length>0?$(".modal-backdrop").hide():"",$("body").removeClass("modal-open"),$rootScope.fromApp=!1,$rootScope.footerLoad=!1,void 0!=next.$$route&&("/landing"===next.$$route.originalPath||"/landingFrame"===next.$$route.originalPath?$rootScope.isLanding=!0:$rootScope.isLanding=!1,"/partner"===next.$$route.originalPath||"/partner"===next.$$route.originalPath?$rootScope.isPaytm=!0:$rootScope.isPaytm=!1)}),$rootScope.$on("$routeChangeSuccess",function(ev,path){path.$$route.originalPath.match("quote")&&path.$$route.originalPath.match("product")||($rootScope.footerLoad=!0),null!=document.getElementsByClassName("rocketchat-widget")&&document.getElementsByClassName("rocketchat-widget").length>0&&(document.getElementsByClassName("rocketchat-widget")[0].style.display="none")})}]),app.config(["$routeProvider","$locationProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$animateProvider","isMobile","isTablet","$httpProvider",function($routeProvider,$locationProvider,$controllerProvider,$compileProvider,$filterProvider,$provide,$animateProvider,isMobile,isTablet,$httpProvider){app.controller=$controllerProvider.register,app.directive=$compileProvider.directive,app.filter=$filterProvider.register,app.factory=$provide.factory,app.service=$provide.service,$locationProvider.html5Mode(!0),$httpProvider.useApplyAsync(!0),isMobile||isTablet?$routeProvider.when("/",{templateUrl:"templates/landingnew.html?v1.3",reloadOnSearch:!1}).when("/landing",{templateUrl:"templates/landingnew.html"}).when("/landingnew",{templateUrl:"templates/landingnew.html",reloadOnSearch:!1}).when("/landing/single",{templateUrl:"templates/landingnew.html"}).when("/Landing",{templateUrl:"templates/landingnew.html"}).when("/landingFrame",{templateUrl:"templates/landingnew.html"}).when("/contact",{templateUrl:"templates/landingnew.html"}).when("/quotes/:enquiryId",{templateUrl:"templates/quotes.html?v1.1",reloadOnSearch:!1}).when("/quotesFeatured/:enquiryId",{templateUrl:"templates/quotes.html?v1.1",reloadOnSearch:!1}).when("/quote/:enquiryId",{template:"templates/quotes.html?v1.1",reloadOnSearch:!1}).when("/quotesHorizontal/:enquiryId",{templateUrl:"templates/quotes.html?v1.1",reloadOnSearch:!1}).when("/ci/quotes/:enquiryId",{templateUrl:"templates/cancer-quotes1.html?v1.1",reloadOnSearch:!1}).when("/partner",{templateUrl:"templates/paytm.html"}).when("/buy/:planId",{templateUrl:"templates/buy.html"}).when("/compare",{templateUrl:"templates/compare/compare.html"}).when("/ci",{templateUrl:"templates/landingnew.html"}).when("/ci/contact",{templateUrl:"templates/landingnew.html"}).when("/compare/:enquiryId",{templateUrl:"templates/compare/compare-mobile.html",reloadOnSearch:!1}).when("/ci/product/:planName",{templateUrl:"templates/ProductPage/ProductCancerPage.html"}).when("/ci/product",{templateUrl:"templates/ProductPage/ProductCancerPage.html"
}).when("/product",{templateUrl:"templates/ProductPage/ProductPage.html",reloadOnSearch:!1}).when("/productDetails/:planName",{templateUrl:"templates/ProductPage/ProductPageMobile.html",reloadOnSearch:!1}).when("/product/:planName",{templateUrl:"templates/ProductPage/ProductPage.html",reloadOnSearch:!1}).when("/buyLanding",{templateUrl:"templates/buyLanding.html"}).when("/checkout/:planName",{templateUrl:"templates/ProductPage/CheckoutPage.html?v1.0"}).when("/chatbot",{templateUrl:"templates/chatbot.html"}).when("/unsubscribe",{templateUrl:"templates/unsubscribe.html"}):$routeProvider.when("/",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/landing",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/landingnew",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/landing/single",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/Landing",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/landingFrame",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/contact",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/partner",{templateUrl:"templates/landingnew.html?v1.1",reloadOnSearch:!1}).when("/quotes/:enquiryId",{template:"<quotes-component></quotes-component>",reloadOnSearch:!1}).when("/quote/:enquiryId",{template:"<quotes-component></quotes-component>",reloadOnSearch:!1}).when("/quotesHorizontal/:enquiryId",{templateUrl:"<quotes-component></quotes-component>",reloadOnSearch:!1}).when("/buy/:planId",{templateUrl:"templates/buy.html"}).when("/ci",{templateUrl:"templates/landingnew.html"}).when("/ci/contact",{templateUrl:"templates/landingnew.html"}).when("/ci/quotes/:enquiryId",{templateUrl:"templates/cancer-quotes1.html?v1.1",reloadOnSearch:!1}).when("/ci/product/:planName",{templateUrl:"templates/ProductPage/ProductCancerPage.html",reloadOnSearch:!1}).when("/product",{templateUrl:"templates/ProductPage/ProductPage.html",reloadOnSearch:!1}).when("/product/:planName",{templateUrl:"templates/ProductPage/ProductPage.html",reloadOnSearch:!1}).when("/compare/:enquiryId",{templateUrl:"templates/compare/compare.html",reloadOnSearch:!1}).when("/checkout/:planName",{templateUrl:"templates/ProductPage/CheckoutPage.html?v1.0"}).when("/buyLanding",{templateUrl:"templates/buyLanding.html"}).when("/chatbot/quotes/:roomId",{templateUrl:"templates/chatbotQuotes.html",reloadOnSearch:!1}).when("/unsubscribe",{templateUrl:"templates/unsubscribe.html"}).otherwise({redirectTo:"/"}),$animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/)}]),app.controller("BuyController",["$scope","$rootScope","$cookies","$location","$document","$timeout","$routeParams","$filter","$localStorage","GenericService","CustomerService","PreQuotesService",function($scope,$rootScope,$cookies,$location,$document,$timeout,$routeParams,$filter,$localStorage,GenericService,CustomerService,PreQuotesService){var currentRoute=$location.path();gtmObj.callGAOnPageLoad($location.$$url),currentRoute.indexOf("buy")>=0&&$cookies.put("shouldPageSkip","",-1);var preserveObj={mobileNo:null,leadId:null};$scope.planId=$routeParams.planId,$scope.errorObject={},$scope.errorObject.isLeadExist=!1,$scope.errorObject.isMobileExist=!1,$scope.errorObject.onChange=!1,$scope.errorObject.showLoader=!1,$rootScope.object={showArrow:!0,showLoader:!1},$scope.buyLanding={txtLeadId:null,txtMobileNo:null},$scope.preFillFromPreserved=function(text){"mobile"===text&&null!==preserveObj.mobileNo&&""!==preserveObj.mobileNo?($scope.buyLanding.txtMobileNo=preserveObj.mobileNo,$scope.deleteLead()):"lead"===text&&null!==preserveObj.leadId&&""!==preserveObj.leadId&&($scope.buyLanding.txtLeadId=preserveObj.leadId,$scope.deleteMobileNo())},$scope.deleteMobileNo=function(){null!==$scope.buyLanding.txtMobileNo&&""!==$scope.buyLanding.txtMobileNo&&(preserveObj.mobileNo=$scope.buyLanding.txtMobileNo,$scope.buyLanding.txtMobileNo=null)},$scope.deleteLead=function(){null!==$scope.buyLanding.txtLeadId&&""!==$scope.buyLanding.txtLeadId&&(preserveObj.leadId=$scope.buyLanding.txtLeadId,$scope.buyLanding.txtLeadId=null)},$scope.setIsLeadExist=function(){$scope.errorObject.isLeadExist=!1,$scope.errorObject.isMobileExist=!1,$scope.errorObject.onChange=!0},$scope.setArrowLoaderObject=function(showArrow,showLoader){$rootScope.object.showArrow=showArrow,$rootScope.object.showLoader=showLoader},$scope.redirectSummaryPage=function(){$scope.errorObject.isMobileExist=!1,$scope.errorObject.onChange=!1,$scope.errorObject.isLeadExist=!1,$scope.errorObject.showLoader=!0,$scope.setArrowLoaderObject(!1,!0),PreQuotesService.buyProceed($scope.buyLanding,$scope.planId).then(function(errorObject){$scope.errorObject.showLoader=!1,errorObject.isLeadExist&&($scope.isLeadExist=!0,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1),errorObject.isMobileExist&&($scope.isMobileExist=!0,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1)})}}]),app.controller("BuyLandingController",["$scope","$rootScope","$cookies","$location","$document","$timeout","$routeParams","$filter","$localStorage","GenericService","$q","CommonServiceTerm","PreQuotesService","CustomerService",function($scope,$rootScope,$cookies,$location,$document,$timeout,$routeParams,$filter,$localStorage,GenericService,$q,CommonServiceTerm,PreQuotesService,CustomerService){function setDobModelFromUrl(){var dobArray=inputParams.dob.split("-");$scope.data={dobDate:dobArray[0],dobMonth:dobArray[1],dobYear:dobArray[2]}}function populateInputParams(){inputParams.gender=$routeParams.gender?"male"==$routeParams.gender?1:2:1,inputParams.age=CommonServiceTerm.getAge($routeParams.dob),inputParams.name=$routeParams.name,inputParams.email=$routeParams.email,inputParams.mobileNo=$routeParams.mobile,inputParams.dob=$routeParams.dob,setDobModelFromUrl(),cityObj.cityId?(inputParams.cityId=cityObj.cityId,inputParams.stateId=cityObj.stateId):(inputParams.cityId=551,inputParams.stateId=35),inputParams.totalPayout=$filter("addCommas")(1e7),inputParams.leadSource=$rootScope.isMobileDevice?"PBMobile":"PB",inputParams.subProductTypeId=2,inputParams.countryId=$routeParams.country&&"india"==$routeParams.country?392:999,inputParams.productId=7,inputParams.landingPageName="productpage",inputParams.tobacco=$routeParams.tobacco||0,annualIncome&&(annualIncome<=3e5?inputParams.annualIncome=1:annualIncome>3e5&&annualIncome<=5e5?inputParams.annualIncome=2:annualIncome>5e5&&annualIncome<=7e5?inputParams.annualIncome=3:annualIncome>7e5&&annualIncome<=1e6?inputParams.annualIncome=4:annualIncome>1e6&&annualIncome<=15e5?inputParams.annualIncome=5:annualIncome>15e5?inputParams.annualIncome=6:inputParams.annualIncome=1),angular.isDefined($routeParams.pb_source)?inputParams.utmSource=$routeParams.pb_source:angular.isDefined($routeParams.utm_source)?inputParams.utmSource=$routeParams.utm_source:angular.isDefined($cookies.get("pborganic"))&&"organic"==$cookies.get("pborganic")?inputParams.utmSource=$cookies.get("pborganic"):inputParams.utmSource="",inputParams.utmMedium=$routeParams.pb_medium||$routeParams.utm_medium||"",inputParams.utmCampaign=$routeParams.pb_campaign||$routeParams.utm_campaign||"",inputParams.utmTerm=$routeParams.pb_term||$routeParams.utm_term||"",inputParams.creditScore=$routeParams.credit_score,inputParams.planId=1*planId}function saveQuoteSelection(enquiryId,plan,custInfo){var input={planId:plan.Plan_Id,refId:enquiryId,productId:"7",premium:plan.FinalPremium,supplierId:plan.Supplier_Id,leadId:custInfo.matrixLeadId,mobileNo:custInfo.mobileNo,encryptedMobileNo:custInfo.encryptedMobileNo,selectedBy:$routeParams.AgentId&&window.atob?window.atob($routeParams.AgentId):"0",ipAddress:"127.0.0.1",sourcePage:"PaisaBazaarLanding",enquiryId:enquiryId};CustomerService.saveQuoteSelection(input).success(function(data,status,headers,config){})}var annualIncome=($location.path(),12*$routeParams.monthlyIncome),planId=$routeParams.planId,cityObj={},inputParams={},configObj={};$scope.errorObject={},$scope.errorObject.somethingWentWrong=!1,$scope.errorObject.showArrow=!1,$scope.inputParams=inputParams,configObj.isMonthly=!$routeParams.isMonthly||$routeParams.isMonthly,$scope.getDObArrayObj=function(){return{date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()}},$scope.data={dobDate:null,dobMonth:null,dobYear:null},$scope.offerDetails={head:"",subHead:"",bulletPoints:[]},$scope.offerDetails=PreQuotesService.getInitialOfferDetails($localStorage.cancerPlanType);var getAllCityList=function(){var deferred=$q.defer(),cityData={};return CommonServiceTerm.getCityData().then(function(cityObj){cityData=cityObj,deferred.resolve(cityData)}),deferred.promise},cityCallback=function(data){var newDelhiObject={CityId:"551",CityName:"New Delhi(Delhi)",StateId:"35",state:"Delhi"},newData=_.uniq(data.response.CityList,function(item){return item.CityId});newData.unshift(newDelhiObject),$scope.city=$rootScope.isMobileDevice?GenericService.formatCityMobile(newData):GenericService.formatCity(newData)};$scope.changeDisplayNumberFormat=function(num){var x=CommonServiceTerm.removeCommas(num);return!angular.isUndefined(x)&&x>0?CommonServiceTerm.changeDisplayNumberFormat(x):0},getAllCityList().then(function(cityData){cityCallback(cityData),cityObj=PreQuotesService.findCityFormText($scope.city,$routeParams.city),populateInputParams()}),$scope.changeDOB=function(){inputParams.dob=$scope.data.dobDate+"-"+$scope.data.dobMonth+"-"+$scope.data.dobYear},$scope.isDOBMissing=function(){return!$scope.data.dobDate||!$scope.data.dobMonth||!$scope.data.dobYear},$scope.isValidDateOfBirth=function(){return inputParams.dob&&GenericService.isValidDateOfBirth(inputParams.dob)||!1},$scope.isAgeBelowMinimum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge(inputParams.dob)<18},$scope.isAgeAboveMaximum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge(inputParams.dob)>65},$scope.isValidAge=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge(inputParams.dob)>=18&&CommonServiceTerm.getAge(inputParams.dob)<=65},$scope.isValidAmount=function(){return CommonServiceTerm.isValidAmount(inputParams.totalPayout,!1,!1)},$scope.isValidFormInput=function(){return $scope.isValidAge()&&"undefined"!=typeof $scope.inputParams.name&&null!==$scope.inputParams.name&&""!=$scope.inputParams.name&&$scope.isValidAmount()},$scope.continueJourney=function(){$scope.errorObject.somethingWentWrong=!1,inputParams.totalPayout=CommonServiceTerm.removeCommas(inputParams.totalPayout),inputParams.gender=1*inputParams.gender,inputParams.tobacco=1*inputParams.tobacco,inputParams.age=CommonServiceTerm.getAge(inputParams.dob),$scope.isValidFormInput()&&($scope.errorObject.showArrow=!0,GenericService.getBuyLandingPageLink(inputParams).success(function(data,status,headers,config){if(data&&data.url){var planIds=termConfigObj.getE2EPlanIds(),preQuotesInfoObj=data.termCustInfo,enquiryId=data.enquiryId,plan=data.plan;preQuotesInfoObj.isMonthly=angular.copy(configObj.isMonthly),saveQuoteSelection(enquiryId,plan,preQuotesInfoObj),angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1?GenericService.redirectToE2EPage(preQuotesInfoObj,plan,enquiryId,configObj.isMonthly):window.location=data.url+planId}else $scope.errorObject.somethingWentWrong=!0,$scope.errorObject.showArrow=!1}))}}]),app.controller("CancerQuotesController",["$scope","$rootScope","$location","$mdToast","$routeParams","$timeout","$cookies","$localStorage","GenericService","CustomerService","QuotesService","$q","$filter","PlanService","CommonServiceTerm","$document",function($scope,$rootScope,$location,$mdToast,$routeParams,$timeout,$cookies,$localStorage,GenericService,CustomerService,QuotesService,$q,$filter,PlanService,CommonServiceTerm,$document){function showMessageForCoverageSort(){$scope.messageIndex=-1,null!==filterChanged.match("term")?$scope.quotes[0]&&1*$scope.quotes[0].term+1*$scope.modifySelection.customerAge>=$scope.modifySelection.policyCoverage&&(_.each($scope.quotes,function(quote,index){1*quote.term+1*$scope.modifySelection.customerAge>=$scope.modifySelection.policyCoverage&&($scope.messageIndex=index)}),orderMatchingQuotesByPremium()):$scope.messageIndex=-1}function orderMatchingQuotesByPremium(){if($scope.messageIndex&&$scope.messageIndex!=-1){var list1=[],list2=[];_.each($scope.quotes,function(quote,index){index<=$scope.messageIndex?list1.push(quote):list2.push(quote)}),list1=$filter("orderBy")(list1,"premium"),$scope.quotes=QuotesService.groupByInsurer(list1.concat(list2))}}function executeICICITracking(){var cancerQuotes=angular.copy($scope.quotes);0===ipAddress?QuotesService.getIp().success(function(data){ipAddress=data.ip,CommonServiceTerm.loadICICITracking(cancerQuotes,$scope.modifySelection,ipAddress)}):CommonServiceTerm.loadICICITracking(cancerQuotes,$scope.modifySelection,ipAddress)}$(".modal-backdrop").hide(),$scope.isCallBackAlreadyInitiated=!0,$scope.quotesObj={isMonthly:void 0===$cookies.get("monthPrem")||"monthly"==$cookies.get("monthPrem")},$rootScope.isMobileDevice&&($scope.quotesObj.isMonthly=!0),$localStorage.payOptionType=null,$scope.tollFreeNumber="1800-419-6053",$scope.filterMobile=!1,$scope.filterQuotesObj={},$scope.filterQuotesObjDate={dobDate:null,dobMonth:null,dobYear:null},$scope.filterReverseDataMobile={},$scope.tabMobile={filterQuotesObjTab:"1"},$scope.mobileSectionUpdateStatus={profile:!1,selection:!1,paytype:!1,riders:!1,tab:!1,coverage:!1},$scope.errorObj={statusError:!1,statusMsg:"",validPayout:!0,validPolicy:!0},$scope.maxTerm=40;var selectedRiders=[];$rootScope.cancerJourney=!0,$scope.limit={lowerLimit:1e6,higherLimit:5e6};var ipAddress=0;$scope.messageIndex=-1;var premMode=$scope.quotesObj.isMonthly?"monthly":"yearly";$cookies.put("monthPrem",premMode);var filterChanged="";$scope.isInternalIP=!0;$location.$$search.refId;$scope.showRiders={showProfileToSelect:!1},$location.$$search.refId&&CustomerService.setEnquiryCookie($routeParams.enquiryId),$location.search("refId",null),$scope.spouse={tobacco:[{value:1,label:"Yes"},{value:0,label:"No"}]},gtmObj.callGAOnPageLoad($location.$$url);var parentTabName=$cookies.get("pTabName")||"",filterParam="",policyChangedByClick=!1;$scope.arrowName="";$scope.quotes=[],$scope.setToDefaultVisible=!1,$scope.sortObj={},$scope.reverseData=GenericService.reverseData(),$scope.checked=!0,$scope.agentObj={},$scope.filterArray=[],$scope.agentObj.isAgent=!0,$scope.enquiryId=CommonServiceTerm.getEnquiryId()||$routeParams.enquiryId,$rootScope.pageClass=$rootScope.isMobileDevice?"quotes-mobile":"quote",$scope.showMobileChatButton=!1,$scope.tab={},$scope.tab.tabValue=$localStorage.cancerPlanType||"1",$localStorage.cancerPlanType||($localStorage.cancerPlanType=angular.copy($scope.tab.tabValue)),$scope.pTabName={cancer:1*$scope.tab.tabValue===1,heart:1*$scope.tab.tabValue===2,comprehensive:1*$scope.tab.tabValue===3},$rootScope.amountBoundry={},$rootScope.amountBoundry.cancerPayout={min:2e5,max:5e6,step:1e5},$rootScope.amountBoundry.heartPayout={min:2e5,max:25e5,step:1e5},$rootScope.amountBoundry.totalPayoutStep=1e5,CommonServiceTerm.changeCancerName($scope.tab.tabValue);var isCancerHeart=1*$scope.tab.tabValue===3;CommonServiceTerm.setisCancerHeart(isCancerHeart);var limits=CommonServiceTerm.getLimitsForCancer(!1,!0);$scope.limit.lowerLimit=limits.allowedAmount,$scope.limit.higherLimit=limits.maxAllowedAmt,$scope.isContinue={disabled:!1},$scope.changeSort=function(name,reverse,prem){gaTagsNew.trackSorting(name,reverse,$scope.modifySelection.custId);var arr=[],sortparam=name;reverse?(arr.push(sortparam),arr.push(prem)):(sortparam="-"+sortparam,arr.push(sortparam),arr.push(prem)),filterChanged=sortparam,reverse=!reverse,$scope.filterArray=arr,$scope.sortObj.sortByDropdownValue=1,filterParam=name.replace(/-/g,""),GenericService.saveSortApplied(filterParam),$scope.refreshQuotesListFunc(),executeCommonScript(),$scope.arrowName=name,$scope.setToDefaultVisible=!0,$scope.changeSorting()},$scope.changeSorting=function(){if(_.each($scope.quotes,function(quote){delete quote.quoteHide,delete quote.showViewMorePlansLink,delete quote.showMore}),$scope.filterArray instanceof Array)$scope.filterArray&&$scope.filterArray.length>0&&"premium"==$scope.filterArray[0]||$scope.filterArray.indexOf("premium")==-1&&$scope.filterArray.indexOf("-premium")==-1&&$scope.filterArray.push("premium");else{var arrayFilter=$scope.filterArray;$scope.filterArray=[],$scope.filterArray.push(arrayFilter),$scope.filterArray.push("premium")}$scope.quotes=$filter("orderBy")($scope.quotes,$scope.filterArray),$scope.quotes=QuotesService.groupByInsurer($scope.quotes),void 0!==$scope.quotes&&(gtmObj.quotesImpression($scope.quotes,$scope.preQuotesInfo.matrixLeadId,$scope.preQuotesInfo.custId,!0),showMessageForCoverageSort())},$scope.hideShowPlans=function(plan,flag,$event){function start(counter){counter<15&&setTimeout(function(){counter++,window.scrollBy(0,20),start(counter)},50)}$event.stopPropagation(),$(window).height()-$event.target.getBoundingClientRect().top<200&&start(0),_.each($scope.quotes,function(quote){quote.Supplier_Id==plan.Supplier_Id&&void 0!==quote.quoteHide&&null!==quote.quoteHide&&(quote.quoteHide=flag)}),plan.showMore=!flag},$scope.isCustomerDataLoaded=!1,$scope.sortObj.sortByDropdownValue=15,$scope.object={showArrow:!0,showLoader:!1},$scope.setArrowLoaderObject=function(showArrow,showLoader){$scope.object.showArrow=showArrow,$scope.object.showLoader=showLoader},$scope.setToDefault=function(clicked){clicked&&(filterChanged="",$scope.sortObj.sortByDropdownValue=15,$scope.setToDefaultVisible=!1,$localStorage.filterArray=null),clicked&&($scope.modifySelection.customerAge>=35&&1*$scope.modifySelection.policyCoverage!==75||$scope.modifySelection.customerAge<35&&1*$scope.modifySelection.policyCoverage!==70)?$scope.modifySelection.customerAge>=35&&1*$scope.modifySelection.policyCoverage!==75?($scope.modifySelection.policyCoverage=75,$scope.saveCustomerSelection()):$scope.modifySelection.customerAge<30&&1*$scope.modifySelection.policyCoverage!==70&&($scope.modifySelection.policyCoverage=70,$scope.saveCustomerSelection()):(($scope.modifySelection.customerAge>=35&&1*$scope.modifySelection.policyCoverage!==75||$scope.modifySelection.customerAge<35&&1*$scope.modifySelection.policyCoverage!==70)&&($scope.setToDefaultVisible=!0),gaTagsNew.editProfileTrack("SetToDefault",-1,$scope.modifySelection.custId),$scope.filterArray=["-Priority","premium"],filterParam="Priority",$scope.arrowName="Priority",clicked||$localStorage.filterArray&&($scope.filterArray=$localStorage.filterArray,filterChanged="-term"),$scope.changeSorting(),$scope.sortObj.sortByDropdownValue=15,$scope.arrowName="",GenericService.saveSortApplied(filterParam))},$scope.payout={isEditable:!1,isReadable:!0},$scope.policyDuration={isEditable:!1,isReadable:!0},$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.genderOptions=[{value:1,label:"Male"},{value:2,label:"Female"}],$scope.showLink={email:!0,callback:GenericService.isTimeWithRange(),emailback:!1,call:!1,showMobileChatButton:!1},$scope.toggleProfileFn=function(flag){$scope.showRiders.showProfileToSelect=flag},$scope.showChat={},$scope.showChat.showMobileChatButton=!1,$scope.citySearchText="",$scope.city="",$scope.cityerror=!1,$scope.modifySelection=QuotesService.buildDefaultModifySelectionObject(),$scope.refreshQuotesList=!0,$scope.data={dobDate:null,dobMonth:null,dobYear:null},$scope.dob={date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()},$scope.isQuotesLoaded=!1,$scope.clickedPlanId=-1;var setContinueButtonDisabled=function(flag){$scope.isContinue.disabled=flag};$scope.toggleWhatsThis=function(keyName){$scope.whatsThis[keyName]=!$scope.whatsThis[keyName]},$scope.showHideAddOn=function(flag){$scope.showAddOn=flag},$scope.changeDate=function(model){$scope.data.dobDate=model,$scope.changeDateOfBirth()},$scope.changeMonth=function(model){$scope.data.dobMonth=model,$scope.changeDateOfBirth()},$scope.changeYear=function(model){$scope.data.dobYear=model,$scope.changeDateOfBirth()},$scope.changeDateOfBirth=function(){$scope.modifySelection.dob=$scope.data.dobDate+"-"+$scope.data.dobMonth+"-"+$scope.data.dobYear},$scope.isYearSelected=function(index,dobYear){return index==$scope.dob.year.indexOf(parseInt(dobYear))},$scope.isDOBMissing=function(){return!$scope.data.dobDate||!$scope.data.dobMonth||!$scope.data.dobYear},$scope.isValidDateOfBirth=function(){return $scope.modifySelection.dob&&GenericService.isValidDateOfBirth($scope.modifySelection.dob)},$scope.isAgeBelowMinimum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySelection.dob)<18},$scope.isAgeAboveMaximum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySelection.dob)>65},$scope.isValidAge=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySelection.dob)>=18&&CommonServiceTerm.getAge($scope.modifySelection.dob)<=65},$scope.preFillModifySelectionModel=function(data){$scope.modifySelection=GenericService.buildModifySelectionModel(data,$scope.enquiryId),extractDOB()};var getValue=function(value){return angular.isDefined(value)?value:null},extractDOB=function(){$scope.data.dobDate=getValue($scope.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB($scope.modifySelection.dob,0):null,$scope.data.dobMonth=getValue($scope.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB($scope.modifySelection.dob,1):null,$scope.data.dobYear=getValue($scope.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB($scope.modifySelection.dob,2):null},setSelectedCityItem=function(data){angular.copy(data,$scope.selectedCityItem)};$scope.isValidProfileDetails=function(data){return angular.isDefined(data)&&$scope.isValidAge()&&!$scope.cityerror&&null!==data.isTobaccoUser},$scope.refreshQuotesListFunc=function(){$scope.refreshQuotesList=!1,$timeout(function(){$scope.refreshQuotesList=!0},0)},$scope.onCityInputChange=function(){$scope.cityerror=!0},$scope.selectedCityCallBack=function($item,$model,$label,$event){$scope.modifySelection.cityId=$item.cityId,$scope.modifySelection.city=$item.value,$scope.modifySelection.stateId=$item.stateId,$scope.cityerror=!1},$scope.toggleAddOnCoverSection=function(flag){flag&&gaTagsNew.editProfileTrack("RiderWhatisThis",-1,$scope.modifySelection.custId),$scope.showAddOnCoverHelpSection=flag};var initilizeZopim=function(){var lead=$scope.preQuotesInfo.matrixLeadId;CustomerService.getChatInformation(lead).success(function(data){var obj={ChatTime:data.custInfo.chatTime,startTime:"10:00:00",endTime:"19:00:00"},workingHrs=($scope.modifySelection.customerAge,GenericService.isWorkingHours(obj.ChatTime,obj.endTime,obj.startTime));!$scope.agentObj.isAgent&&workingHrs&&GenericService.isChatAvailableInCity($scope.modifySelection.cityId)&&($scope.isInternalIP||"Zopim"===termConfigObj.getChatEnv()||CommonServiceTerm.loadScript("../../scripts/common-scripts/ScriptLiveChat.js","text/javascript","utf-8",function(){$rootScope.isMobileDevice?$scope.showChat.showMobileChatButton=!0:ShowDesktopchat($scope.modifySelection.userInfoId)}))})};$scope.chat=function(){"Zopim"===termConfigObj.getChatEnv()||ShowMobilechat($scope.modifySelection.userInfoId)},$scope.getQuotes=function(preQuotesData,isFirst){$scope.errorObj.statusError=!1,$scope.errorObj.statusMsg="",$scope.quotes=[],$scope.isQuotesLoaded=!1;var obj=GenericService.getCancerQuotesRequestObject($scope.modifySelection,$scope.tab.tabValue);QuotesService.cancerQuotes(obj).success(function(data){if(data){if("failed"===data.status)$scope.errorObj.statusError=!0,$scope.errorObj.statusMsg="Some error occured.Please try again later";else if(data.premiumObj.length>0){$scope.quotes=data.premiumObj,_.each($scope.quotes,function(quote){quote.isQuotesVisible=!0,quote.hideFeatures=!0,quote.totalPremiumWithRiders=quote.premium,quote.monthlyPremiumWithRiders=quote.monthlyPremium,quote.riders&&_.each(quote.riders,function(rider){rider=QuotesService.getCancerRiderPremiums(quote,preQuotesData,rider,selectedRiders)})});$cookies.get("custId")||-1;gtmObj.quotesImpression($scope.quotes,$scope.preQuotesInfo.matrixLeadId,$scope.preQuotesInfo.custId,!0),$scope.setToDefault()}else $scope.errorObj.statusError=!0,$scope.errorObj.statusMsg="No quotes for the condition chosen.";var isIpru=_.find($scope.quotes,function(quote){return 5==quote.Supplier_Id});isIpru&&executeICICITracking()}$scope.isQuotesLoaded=!0,$scope.showLoader=!1,$rootScope.footerLoad=!0})},$scope.selectRider=function(plan){QuotesService.addRiderValuesCancerPlan(plan).then(function(updatedPlan){plan=updatedPlan;var selectedRiders=[];_.each(plan.riders,function(rider){rider.status&&selectedRiders.push(rider.categoryId),plan.riders.indexOf(rider)+1==plan.riders.length&&CommonServiceTerm.setRiderSelected($scope.modifySelection.custId,selectedRiders)})})};var policyCoverageDataSyncup=function(){$scope.preQuotesInfo.policyCoverage=angular.copy($scope.preQuotesInfo.policyTerm)},getCityObject=function(cityId){var obj=null;return angular.forEach($scope.city,function(value,key){cityId==value.cityId&&(obj=value)}),obj},isAgeChanged=function(){var info=$scope.preQuotesInfo,customerAge=info.customerAge?info.customerAge:"",getAge=$scope.getAge(info.dob);getAge=getAge?getAge:"",customerAge!==getAge&&$location.path("/").replace()},customerSuccessCallback=function(data){$scope.preQuotesInfo=data,selectedRiders=$scope.preQuotesInfo.categoryIds,$scope.maxTerm=80,isAgeChanged(),$scope.preQuotesInfo.policyTerm=$scope.preQuotesInfo.policyTerm>$scope.maxTerm?10+$scope.preQuotesInfo.customerAge:$scope.preQuotesInfo.policyTerm;var yahooUrl="https://sp.analytics.yahoo.com/spp.pl?a=10000&.yp=430240&ea="+data.matrixLeadId+"&gv=";CommonServiceTerm.addYahooTag(yahooUrl),policyCoverageDataSyncup(),$scope.preFillModifySelectionModel($scope.preQuotesInfo),$scope.isCustomerDataLoaded=!0,handleModalPopupClose(),getAllCityList().then(function(){var selectedCityItem=getCityObject($scope.modifySelection.cityId);setSelectedCityItem(selectedCityItem),$scope.modifySelection.cityId&&($scope.cityerror=!1)}),$scope.getQuotes($scope.preQuotesInfo,"first"),CommonServiceTerm.loadInvincibleScript($scope.preQuotesInfo.matrixLeadId),CustomerService.trackCustomerJourney($scope.enquiryId);var reqObj={uniqueId:$scope.modifySelection.mobile,userInfoId:$scope.modifySelection.userInfoId};QuotesService.isCustomerExist(reqObj).then(function(data){data&&"failed"!==data.status&&(data.childLeadExists||data.previousBookingExist)?initilizeZopim():($scope.modifySelection.annualIncome>2||$scope.modifySelection.totalPayout>25e5&&1e7!==$scope.modifySelection.totalPayout)&&initilizeZopim()})};$scope.getCustomerInformation=function(enquiryId){var deferred=$q.defer();return CustomerService.getCustomerInformation(enquiryId,CommonServiceTerm.getCancerCareProductId()).success(function(data,status,headers,config){if(data){var agentId=data.agentId||0;$scope.agentObj.isAgent=agentId>0||void 0!=$routeParams.LeadId||null!=$routeParams.LeadId;var cookieVal=$cookies.get("callBack"+data.enquiryId);$scope.isCallBackAlreadyInitiated=angular.isDefined(cookieVal),GenericService.verifyMobileNumber(data).success(function(verifyMobileNumberObj,status,headers,config){$scope.isInternalIP=!verifyMobileNumberObj.isValidMobile}),customerSuccessCallback(data),deferred.resolve(data)}}),deferred.promise},$scope.getCustomerInformation($scope.enquiryId).then(function(data){data.matrixLeadId&&CommonServiceTerm.createRevisit({leadId:data.matrixLeadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:"CancerQuotesPage"})}),$scope.getAge=function(dateString){return dateString?CommonServiceTerm.getAge(dateString):""},$scope.handlePayoutFocusBlur=function(keyName){angular.forEach($scope.payout,function(value,key){$scope.payout[key]=!1}),$scope.payout[keyName]=!0,$timeout(function(){QuotesService.saveAndEditButton(keyName,"#totalPayout-edit",$scope.modifySelection.totalPayout,$scope.modifySelection.custId)},100)},$scope.focusField=function(id){$timeout(function(){angular.element("#"+id).focus()},100)},$scope.handlePolicyDurationFocusBlur=function(keyName){angular.forEach($scope.policyDuration,function(value,key){$scope.policyDuration[key]=!1}),$scope.policyDuration[keyName]=!0,$timeout(function(){"isEditable"==keyName?($(".save-btn").addClass("rightm3"),$(".edit-btn2").addClass("leftm3"),$("#policyTerm-edit").focus(),gaTagsNew.trackEditOrSavePayOrCover("CoverDurationFilterClick",$scope.modifySelection.policyCoverage,$cookies.get("pTabName"),$scope.modifySelection.custId)):($(".save-btn").removeClass("rightm3"),$(".edit-btn2").removeClass("leftm3"))},100)},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},$scope.emailQuotesCallbackStatus=function(status){$mdToast.show($mdToast.simple().content(status).position($scope.getToastPosition()).hideDelay(3e3))},$scope.emailQuotes=function(){$scope.showLink.emailback=!1,gaTagsNew.editProfileTrack("EmailPlans",-1,$scope.modifySelection.custId),QuotesService.emailQuotes($scope.quotes,$scope.modifySelection).success(function(data,status,headers,config){$timeout(function(){"success"==data.status?$scope.emailQuotesCallbackStatus("Email has been sent successfully!"):$scope.emailQuotesCallbackStatus("Failed to send email!")},100)}).error(function(data,status,headers,config){$scope.emailQuotesFailureCallback()})},$scope.callBack=function($event){$scope.createTwoCallBackCookie($scope.preQuotesInfo.enquiryId),$scope.showLink.callback=!1,$mdToast.show($mdToast.simple().content("Thank You! We will call you back shortly").position($scope.getToastPosition()).hideDelay(5e3)),CustomerService.callbackUrl($scope.preQuotesInfo,!0)},$scope.createTwoCallBackCookie=function(enquiryId){var expireDate=new Date;expireDate.setTime(expireDate.getTime()+12e4),$cookies.put("callBack"+enquiryId,enquiryId,{expires:expireDate,domain:"policybazaar.com"})},$scope.removeArrow=function(plan,val){return plan.ComboTotalPremium+plan.riderPremiumAdded>=val},$scope.isMonthlyIncomePlan=function(){return $rootScope.pTabName.monthlyPlans},$scope.changeTabRadio=function(){$scope.pTabName={cancer:1*$scope.tab.tabValue===1,heart:1*$scope.tab.tabValue===2,comprehensive:1*$scope.tab.tabValue===3},$scope.changeParentTab($scope.tab.tabValue),$scope.payout.isEditable=$scope.policyDuration.isEditable=!1,$scope.payout.isReadable=$scope.policyDuration.isReadable=!0,$(".save-btn").removeClass("rightm3"),$(".edit-btn1").removeClass("leftm3"),$(".edit-btn2").removeClass("leftm3"),defaultRiderPremiums=[],planIdsArray=[],QuotesService.setPlanIdsArray()},$scope.changetabRadioMobile=function(keyName){$scope.tab.tabValue=keyName,$scope.pTabName={cancer:1*$scope.tab.tabValue===1,heart:1*$scope.tab.tabValue===2,comprehensive:1*$scope.tab.tabValue===3},$scope.changeParentTab($scope.tab.tabValue)},$scope.changeParentTab=function(keyName){$scope.quotes=[];var planType=$scope.tab.tabValue;$localStorage.cancerPlanType=planType;var isCancerHeart=!1;3==planType&&(isCancerHeart=!0),CommonServiceTerm.changeCancerName(planType),$scope.pTabName={cancer:1*$scope.tab.tabValue===1,heart:1*$scope.tab.tabValue===2,comprehensive:1*$scope.tab.tabValue===3},CommonServiceTerm.setisCancerHeart(isCancerHeart);var limits=CommonServiceTerm.getLimitsForCancer(!1,!0);$scope.limit.lowerLimit=limits.allowedAmount,$scope.limit.higherLimit=limits.maxAllowedAmt,parentTabName!==keyName&&(parentTabName=keyName,$cookies.put("pTabName",keyName),$scope.refreshQuotesListFunc(),$scope.isValidTotalPayout()&&$scope.isValidPolicyCoverage()&&$scope.getQuotes($scope.modifySelection));
};var modelDataSyncup=function(){angular.copy($scope.modifySelection,$scope.preQuotesInfo)};$scope.toggleModal=function(modalName,status){var modalHashMap={profile:"profileModal"};$("#"+modalHashMap[modalName]).modal(status)};var successCallbackProfile=function(){setContinueButtonDisabled(!1),modelDataSyncup(),$scope.setArrowLoaderObject(!0,!1),$scope.toggleModal("profile","hide");var policyTerm=QuotesService.getPolicyTerm($scope.modifySelection);policyTerm>=10?$scope.getCustomerInformation($scope.enquiryId):($scope.modifySelection.policyCoverage=parseInt($scope.modifySelection.customerAge,10)+10,$scope.saveCustomerSelection())};$scope.updateProfileDetails=function(form){($scope.isValidProfileDetails($scope.modifySelection)||"true"==$scope.isValidProfileDetails($scope.modifySelection))&&(setContinueButtonDisabled(!0),$scope.setArrowLoaderObject(!1,!0),$scope.modifySelection.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),$scope.modifySelection.gaTrackerClientId=GenericService.getTrackerId(),$scope.isCustomerDataLoaded=!1,$scope.isQuotesLoaded=!1,CustomerService.updateProfileDetails($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){if("success"==data.status){CommonServiceTerm.callLeadGenerationTracking(data.matrixleadId,data.customerId,data.isMatrixLeadCreated,!1),gaTagsNew.editProfileTrack("ProfileFilterChange",-1,$scope.modifySelection.custId);var enquiryId=data.enquiryId;if($cookies.get("enquiryId")!=enquiryId){try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"termLead"})}catch(err){}CustomerService.setEnquiryCookie(data.enquiryId),$localStorage.enquiryId=data.enquiryId,$timeout(function(){$scope.toggleModal("profile","hide"),$routeParams.enquiryId=data.enquiryId;var currentRoute=$location.path(),exitPointUrl=GenericService.buildExitPointUrlPrequotes(location.href,currentRoute,data.enquiryId);data.enquiryId&&CustomerService.setExitPointUrl(data.enquiryId,exitPointUrl,$scope.modifySelection.productId).success(function(data,status,headers,config){}),$scope.setArrowLoaderObject(!0,!1),setContinueButtonDisabled(!1),$location.path("/ci/quotes/"+data.enquiryId).replace()},3e3)}else successCallbackProfile()}else $scope.setArrowLoaderObject(!0,!1),setContinueButtonDisabled(!1)}))},$scope.editProfile=function(){gaTagsNew.editProfileTrack("ProfileFilterClick",-1,$scope.modifySelection.custId),$scope.setArrowLoaderObject(!0,!1),$scope.toggleModal("profile","show"),angular.isDefined($scope.selectedCityItem)&&$scope.selectedCityItem.value&&($scope.cityerror=!1)},$scope.isE2EPlans=function(plan){return termConfigObj.getE2EPlanIds().indexOf(plan.planId)>-1},$scope.proceed=function(plan,index){if(gaTagsNew.quotesSelectionTrack("ProductSelect",plan,index+1,$scope.modifySelection.custId),1*plan.Supplier_Id===16&&CommonServiceTerm.callAttributionApi($scope.modifySelection,!0,plan),plan&&1*plan.Supplier_Id===25){var obj={};obj.enquiryId=$scope.enquiryId,obj.planId=plan.planId,obj.term=plan.term,QuotesService.savePayTermCancer(obj)}var custId=$scope.modifySelection.custId||$cookies.get("custId")||-1;gtmObj.quotesSelection(plan,$scope.modifySelection.matrixLeadId,custId,index,!0),$scope.clickedPlanId=plan.fakePlanId,$scope.setArrowLoaderObject(!1,!0),$scope.planOrder=index+1,CustomerService.saveSelectedFilters($scope.enquiryId,$scope.types,filterParam,$scope.planOrder),saveQuoteSelection(plan);var planIds=termConfigObj.getE2EPlanIds();if(angular.isDefined(planIds)&&planIds.indexOf(plan.planId)!==-1){var preQuotesInfoObj=angular.copy($scope.preQuotesInfo);preQuotesInfoObj.monthlyIncome=plan.monthlyIncome,preQuotesInfoObj.totalPayout=plan.TotalCover,preQuotesInfoObj.oneTimePayout=plan.OneTimePayout,preQuotesInfoObj.sumAssured=plan.SumAssured,preQuotesInfoObj.productId=CommonServiceTerm.getCancerCareProductId(),preQuotesInfoObj.isMonthly=$scope.quotesObj.isMonthly,preQuotesInfoObj.paymentFrequency=$scope.quotesObj.isMonthly?12:1;var leadId=preQuotesInfoObj.matrixLeadId,isE2ePlan=plan.Plan_Id?termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)!=-1:void 0;leadId&&CommonServiceTerm.createRevisit({leadId:leadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:isE2ePlan?"E2eRedirect":"InsurerRedirect"}),GenericService.redirectToE2EPage(preQuotesInfoObj,plan,$scope.enquiryId,$scope.quotesObj.isMonthly)}else{$cookies.put("planId",plan.planId),$cookies.put("fakePlanId",plan.fakePlanId),$cookies.put("pTabName",$scope.tab.tabValue),$cookies.put("enquiryId",$scope.enquiryId);var obj={};obj.enquiryId=$scope.enquiryId,obj.planId=plan.planId,obj.term=plan.term,QuotesService.savePayTermCancer(obj).success(function(data){$location.path("ci/product/"+plan.planName).search({index:index})})}},$scope.isQuotesEditable=function(){return $scope.payout.isEditable},$scope.isPayTermEditable=function(){return $scope.policyDuration.isEditable},$scope.isValidTotalPayout=function(){$scope.errorObj.validPayout=CommonServiceTerm.isValidAmount($scope.modifySelection.totalPayout,!1,!0);var value=parseInt(CommonServiceTerm.removeCommas($scope.modifySelection.totalPayout));return $scope.errorObj.totalPayoutStepError=!(value%$rootScope.amountBoundry.totalPayoutStep===0),$scope.errorObj.validPayout||$scope.errorObj.totalPayoutStepError},$scope.isValidPolicyCoverage=function(){return $scope.errorObj.validPolicy=$scope.modifySelection.policyCoverage&&$scope.modifySelection.policyCoverage>=5+$scope.modifySelection.customerAge&&$scope.modifySelection.policyCoverage<=$scope.maxTerm,$scope.errorObj.validPolicy},$scope.riderCheckDisable=function(rider,monthly){var disable=!1;return disable=monthly?!rider.monthlyPremium:!rider.yearlyPremium};var successCallbackCustomerSelection=function(){angular.copy($scope.modifySelection,$scope.preQuotesInfo),$scope.handlePayoutFocusBlur("isReadable"),$scope.handlePolicyDurationFocusBlur("isReadable"),$scope.getCustomerInformation($scope.enquiryId)};$scope.saveCustomerSelection=function(type){void 0!==type&&gaTagsNew.populateDataToTrackOnSave($scope.modifySelection,type,$cookies.get("pTabName")),"payTerm"==type?(filterChanged="-term",$scope.filterArray=["-term"],$localStorage.filterArray=["-term"],$scope.setToDefaultVisible=!0):filterChanged="",$scope.isQuotesInputValid()&&CustomerService.updateCustomerSelection($scope.modifySelection,$scope.enquiryId).success(function(data,status,headers,config){"success"==data.status&&successCallbackCustomerSelection()})},$scope.isQuotesInputValid=function(){return $scope.isValidTotalPayout()&&$scope.isValidPolicyCoverage()&&!$scope.errorObj.totalPayoutStepError},$scope.undoChanges=function(){angular.copy($scope.preQuotesInfo,$scope.modifySelection),$scope.handlePayoutFocusBlur("isReadable"),$scope.handlePolicyDurationFocusBlur("isReadable")};var executeCommonScript=function(){$timeout(function(){CustomerService.saveSelectedFilters($scope.enquiryId,$scope.types,filterParam)},2e3)},saveQuoteSelection=function(plan){var input={planId:plan.planId,refId:$scope.enquiryId,productId:CommonServiceTerm.getCancerCareProductId(),premium:plan.premium,supplierId:plan.Supplier_Id,leadId:$scope.preQuotesInfo.matrixLeadId,mobileNo:$scope.preQuotesInfo.mobileNo,encryptedMobileNo:$scope.preQuotesInfo.encryptedMobileNo,selectedBy:"0",ipAddress:"127.0.0.1",sourcePage:"Quotes",enquiryId:$routeParams.enquiryId};CustomerService.saveQuoteSelection(input).success(function(data,status,headers,config){})};$scope.selectedCityItem={display:$scope.modifySelection.city,value:$scope.modifySelection.city,searchString:$scope.modifySelection.city,stateId:$scope.modifySelection.stateId,cityId:$scope.modifySelection.cityId};var handleModalPopupClose=function(){$timeout(function(){$("#profileModal").on("hide.bs.modal",function(e){var selectedCityItem=getCityObject($scope.preQuotesInfo.cityId);setSelectedCityItem(selectedCityItem),angular.copy($scope.preQuotesInfo,$scope.modifySelection)})},1e3)};$scope.navigateToHome=function(){$location.path("/")};var cityCallback=function(data){var newDelhiObject={CityId:"551",CityName:"New Delhi",StateId:"35",state:"Delhi"},newData=_.uniq(data.response.CityList,function(item){return item.CityId});newData.unshift(newDelhiObject),$scope.city=$rootScope.isMobileDevice?GenericService.formatCityMobile(newData):GenericService.formatCity(newData)},getAllCityList=function(){var deferred=$q.defer(),cityData={};return CommonServiceTerm.getCityData().then(function(cityObj){cityData=cityObj,cityCallback(cityData),deferred.resolve()}),deferred.promise};$scope.changePolicyTermToMin=function(){$scope.disableRadio||1*$scope.modifySelection.policyTerm!==5&&($scope.isQuotesLoaded=!1,$scope.modifySelection.policyCoverage=5+1*$scope.modifySelection.customerAge,$scope.saveCustomerSelection(),policyChangedByClick=!0,$localStorage.filterArray=null)},$scope.changePolicyTermToMax=function(){1*$scope.modifySelection.policyCoverage!==$scope.maxTerm&&($scope.modifySelection.policyCoverage=$scope.maxTerm,$scope.saveCustomerSelection("payTerm"),policyChangedByClick=!0,$scope.filterArray=["-term"],filterChanged="-term",$localStorage.filterArray=["-term"],$scope.setToDefaultVisible=!0)},$scope.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},$scope.reversePremiumType=function(flag,plan){$scope.quotesObj.isMonthly=!flag;var premMode1=$scope.quotesObj.isMonthly?"monthly":"yearly";$cookies.put("monthPrem",premMode1);var name=$scope.quotesObj.isMonthly?"monthly":"yearly",array=[];array.push(name),array.push(plan.Plan_Id);var premium=0;premium=plan.premium,array.push(premium),gaTagsNew.trackChangePremiumType(array,"QuotesPage",$scope.modifySelection.custId)},$scope.toggleFilterMobile=function(value){var show="show"==value;$scope.filterMobile=show,show?(angular.copy($scope.preQuotesInfo,$scope.modifySelection),$scope.filterQuotesObj=angular.copy($scope.modifySelection),$scope.filterQuotesObjRiders=angular.copy($scope.types),$scope.filterQuotesObjDate=CommonServiceTerm.extractDOB($scope.filterQuotesObj.dob),$scope.filterReverseDataMobile=angular.copy($scope.reverseData),$scope.pTabName.cancer?$scope.tabMobile.filterQuotesObjTab="1":$scope.pTabName.heart?$scope.tabMobile.filterQuotesObjTab="2":$scope.pTabName.comprehensive&&($scope.tabMobile.filterQuotesObjTab="3"),$rootScope.footerLoad=!1):($scope.handlePayoutFocusBlur("isReadable"),$scope.handlePolicyDurationFocusBlur("isReadable"),$timeout(function(){var someElement=angular.element("body").focus();someElement&&$document.scrollToElement(someElement,10,300)},100),$rootScope.footerLoad=!0)},$scope.updateReverseData=function(reverseData){$scope.reverseData=angular.copy(reverseData)},$scope.updateModifySelection=function(obj){$scope.modifySelection=angular.copy(obj)},angular.element(document).ready(function(){$timeout(function(){$scope.showLink.call=!0},2e3)})}]),app.controller("chatBotController",["$scope","$rootScope","PreQuotesService","$cookies","$sce",function($scope,$rootScope,PreQuotesService,$cookies,$sce){$(".modal-backdrop").hide(),angular.element("body").removeAttr("style"),$scope.errorObject={},$scope.chatBotUrl,PreQuotesService.visitCreation().then(function(data){if(data){var visitId=$cookies.get("Cookie_VisitLog"),chatBotUrl=termConfigObj.getChatbotUrl()+visitId;$scope.chatBotUrl=$sce.trustAsResourceUrl(chatBotUrl)}else $scope.errorObject.visitCreationError=!0})}]),app.controller("compareController",["$scope","$rootScope","$location","$mdToast","$routeParams","$timeout","$cookies","$localStorage","$q","CompareService","CustomerService","CommonServiceTerm","GenericService","$filter","QuotesService","PlanService","$compile","$document","RiderService",function($scope,$rootScope,$location,$mdToast,$routeParams,$timeout,$cookies,$localStorage,$q,CompareService,CustomerService,CommonServiceTerm,GenericService,$filter,QuotesService,PlanService,$compile,$document,RiderService){function getCityObject(cityId){var obj=null;return angular.forEach($scope.cityList,function(value,key){cityId==value.cityId&&(obj=value)}),obj}function setSelectedCityItem(){angular.copy(getCityObject($scope.modifySearch.cityId),$scope.selectedCityItem)}function extractDOB(){$scope.dateObj.dobDate=$scope.modifySearch.dob?GenericService.extractDateMonthYearFromDOB($scope.modifySearch.dob,0):null,$scope.dateObj.dobMonth=$scope.modifySearch.dob?GenericService.extractDateMonthYearFromDOB($scope.modifySearch.dob,1):null,$scope.dateObj.dobYear=$scope.modifySearch.dob?GenericService.extractDateMonthYearFromDOB($scope.modifySearch.dob,2):null}function isTotalPayoutAndCoverageChange(){return preservedInfo.totalPayout!=$scope.custData.totalPayout||preservedInfo.policyTerm!=$scope.custData.policyTerm||preservedInfo.monthlyIncome!=$scope.custData.monthlyIncome}function isSeekingInfoUpdated(){var status=!1;return status=preservedInfo.totalPayout!=$scope.custData.totalPayout||preservedInfo.policyTerm!=$scope.custData.policyTerm}function customErrorExists(){var errorExists=!1,obj=_.find($scope.customErrors,function(val){return val});return errorExists=null!==obj&&void 0!==obj}function updateEnquiryId(newId){CustomerService.setEnquiryCookie(newId),enquiryId=$cookies.get("enquiryId")}function findErrors(form){var deferred=$q.defer();return errorFields=CompareService.findErrorFields(form),deferred.resolve(errorFields),deferred.promise}function somethingWentWrong(){$mdToast.show($mdToast.simple().content("Something went wrong!").position($scope.getToastPosition()).hideDelay(3e3))}function getNewPlans(){var isMonthly=!(!$rootScope.pTabName||!$rootScope.pTabName.monthlyPlans),isTotalPayoutAndCoverageChanged=isTotalPayoutAndCoverageChange();CompareService.getNewPlans($scope.custData,comparePlanIds,isMonthly,$scope.type.payType,isTotalPayoutAndCoverageChanged).success(function(data,status){GenericService.isUndefinedOrNull(data)?($scope.isPlansLoaded=!1,somethingWentWrong()):"failed"!=data.status?(data.custInfo&&!isSeekingInfoUpdated()&&CommonServiceTerm.callLeadGenerationTracking(data.custInfo.matrixLeadId,data.custInfo.custId,data.isMatrixLeadCreated,!1),getAllPlansSuccessCallback(data),$scope.suggestedPlans.show=!1,$scope.firstTimeCustomer=!1):somethingWentWrong()}).error(function(){somethingWentWrong()})}function initializePlansData(){var isMonthly=!1;isMonthly=CompareService.getIsAllMonthlyPlan()||$rootScope.isMonthlyIncomeJourney,CompareService.getPlans(enquiryId,comparePlanIds,isMonthly,$scope.type.payType).success(function(data){GenericService.isUndefinedOrNull(data)?($scope.isPlansLoaded=!1,somethingWentWrong()):"failed"==data.status||0==data.allPlans.length||0==data.custInfo.length?somethingWentWrong():getAllPlansSuccessCallback(data)}).error(function(){somethingWentWrong()})}function getAllPlansSuccessCallback(data){if($scope.showAllPlans=!1,$scope.custData=data.custInfo,null==$scope.custData.spouse||"null"==$scope.custData.spouse?($cookies.remove("spouseDob"),$scope.custData.spouse={isWorking:0,tobacco:0,age:null}):$rootScope.profile.spouse=!0,$scope.custData.customerAge=CommonServiceTerm.getAge($scope.custData.dob),preservedInfo=angular.copy($scope.custData),$scope.allPlans=data.allPlans,$scope.compareData=data.comparingPlans,$scope.staticData=data.staticData,_.each($scope.staticData.riders,function(rider){selectedRiderIds.indexOf(rider.categoryId)!=-1&&(rider.isSelected=!0),$scope.allCategories[rider.categoryId]=!1}),$scope.compareData=CompareService.setRiderObject($scope.compareData,$scope.custData.customerAge,$scope.quotesObj.isMonthly,$scope.staticData.riders),riderUpdateCall($scope.compareData).then(function(updatedQuotes){$scope.compareData=CompareService.getRidersPremiumForQuotes(CompareService.modifyPlanObjectForDisplay(updatedQuotes),$scope.staticData.riders,$scope.quotesObj.isMonthly),selectedRiderIds.length>0&&addRiderValuesToThePlans($scope.compareData).then(function(data){$scope.compareData=data})}),$scope.custData){var encodedEnquiryId=$scope.custData.encodedEnquiryId;$scope.modifySearch=CompareService.populateModifySearchModel($scope.custData),extractDOB(),$scope.updatePolicyTermRange(),encodedEnquiryId.length>0&&updateEnquiryId(encodedEnquiryId)}setCompareIds(),$timeout(function(){$scope.isPlansLoaded=!0,$scope.showAllPlans=!0},100),$scope.selectedPlanCount=comparePlanIds.length,closeEditField("all"),$scope.showLink.emailback=!0,$scope.compareData=CompareService.addMisingDataFromAllPlans($scope.compareData,$scope.allPlans)}function assignRiderPremiums(quotes,riderPremiumRespone){for(var i=0;i<=quotes.length;i++)"undefined"!=typeof quotes[i]&&(quotes[i]=RiderService.assignRiderPremiums(quotes[i],riderPremiumRespone,$scope.quotesObj));return quotes}function riderUpdateCall(quotes){var deferred=$q.defer();return optimizeRiderService?RiderService.getRidersPremium(quotes,$scope.custData).then(function(response){var riderPremiumResponse=RiderService.formatRiderPremiumResponse(response.data);quotes=assignRiderPremiums(quotes,riderPremiumResponse),deferred.resolve(quotes)}):getDefaultRidersPremium(quotes).then(function(data){deferred.resolve(data)}),deferred.promise}function getDefaultRidersPremium(quotes){var deferred=$q.defer(),requestArray=[];return _.each(quotes,function(quote){818==quote.Plan_Id&&[819,820,821].forEach(function(val){var tempQuote=angular.copy(quote);tempQuote=GenericService.modifyAegonItermPlusPlanDetails(tempQuote,val),tempQuote.riderIdCategory&&tempQuote.riderIdCategory.length>0&&requestArray.push(QuotesService.createDefaultRiderCallRequest(tempQuote,$scope.custData))}),quote.riderIdCategory&&quote.riderIdCategory.length>0&&requestArray.push(QuotesService.createDefaultRiderCallRequest(quote,$scope.custData))}),QuotesService.getAllRiderValues(requestArray).success(function(response){_.each(quotes,function(quote){getValueForQuote(quote,response)}),deferred.resolve(quotes)}),deferred.promise}function getValueForQuote(quote,response){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id),adbPremium={riderPremium:0,monthlyRiderPremium:0},ciPremium={riderPremium:0,monthlyRiderPremium:0},resp=response[quote.Plan_Id];_.each(quote.riderPremiumObject,function(rider){_.each(resp,function(resRider){1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.sumAssuredValidation=resRider.sumAssuredValidation,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium),isDHFLPlan&&1*resRider.categoryId==10&&(adbPremium.riderPremium+=resRider.riderPremium,adbPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium),isDHFLPlan&&1*resRider.categoryId==15&&(ciPremium.riderPremium+=resRider.riderPremium,ciPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)}),isDHFLPlan&&110==rider.categoryId&&(rider.premium="LimitedPay"===quote.payOptionType?0:adbPremium.riderPremium+ciPremium.riderPremium,rider.monthlyPremium="LimitedPay"===quote.payOptionType?0:adbPremium.monthlyRiderPremium+ciPremium.monthlyRiderPremium)}),818==quote.Plan_Id&&(quote.adbObj={818:{premium:0,monthlyPremium:0,sumAssured:0},819:{premium:0,monthlyPremium:0,sumAssured:0}},_.each(quote.riderPremiumObject,function(rider){_.each(response[818],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId==10&&(quote.adbObj[818].premium=resRider.riderPremium,quote.adbObj[818].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[818].riderSumAssured=resRider.riderSumAssured)}),_.each(response[819],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(quote.adbObj[819].premium=resRider.riderPremium,quote.adbObj[819].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[819].riderSumAssured=resRider.riderSumAssured),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)}),_.each(response[820],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)}),_.each(response[821],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,$scope.quotesObj.isMonthly)})})),quote.isRiderLoaded=!0}function riderAvailableInPlans(){var availableRiders=[];return $scope.compareData&&$scope.compareData.length>0&&_.each($scope.compareData,function(plan){plan.riderPremiumObject&&_.each(plan.riderPremiumObject,function(rider){availableRiders.indexOf(rider.categoryId)!=-1||rider.isHidden||(rider.inBuildAddOn||rider.isDefaultAdded?availableRiders.push(rider.categoryId):0!=plan.monthlyTotalPremium&&$scope.quotesObj.isMonthly?plan.monthlyTotalPremium>0&&$scope.quotesObj.isMonthly&&rider.monthlyPremium>0&&availableRiders.push(rider.categoryId):rider.premium>0&&availableRiders.push(rider.categoryId))})}),availableRiders}function setDefaultValues(){$scope.modifySearch.gender=1,$scope.modifySearch.isTobaccoUser=0,$scope.modifySearch.countryId=392,$scope.modifySearch.policyTerm=65,$scope.modifySearch.totalPayout="1,00,00,000",$scope.modifySearch.cityId="551",$scope.modifySearch.dob=CompareService.getDefaultDate()}function toggleCancerRiders(categoryId){var cancerRiders=[14,17,18],selectedCancerRider=cancerRiders.indexOf(categoryId),ridersTobeDisabled=[];selectedCancerRider!=-1&&(ridersTobeDisabled=angular.copy(cancerRiders),ridersTobeDisabled.splice(selectedCancerRider,1)),ridersTobeDisabled.forEach(function(id){var index=selectedRiderIds.indexOf(id);index!=-1&&selectedRiderIds.splice(index,1)}),_.each($scope.staticData.riders,function(rider){cancerRiders.indexOf(rider.categoryId)!=-1&&rider.categoryId!=categoryId&&(rider.isSelected=!1)})}function setCompareIds(){comparePlanIds.length=0,$scope.monthlyPlanExists=!1,_.each($scope.compareData,function(plan){var planId=plan.Plan_Id||plan.planId;CommonServiceTerm.isAegonItermPlusPlan(planId)&&(planId=818),comparePlanIds.push(planId),plan.monthlyIncome>0&&($scope.monthlyPlanExists=!0)}),setRiderSelected(),CompareService.setComparePlanIds(comparePlanIds),CompareService.saveComparingPlanIds($scope.custData.custId,comparePlanIds,$rootScope.isMonthlyIncomeJourney),$scope.selectedPlanCount=comparePlanIds.length,markSelectedPlans()}function markSelectedPlans(){var selectedIds=CompareService.getComparePlanIds();_.each($scope.allPlans,function(plan){selectedIds.indexOf(plan.Plan_Id)!=-1?plan.isSelected=!0:plan.isSelected=!1})}function closeEditField(fieldName){"all"===fieldName?_.each($scope.isEditable,function(value,key){$scope.isEditable[key]=!1}):($scope.isEditable[fieldName]=!1,$scope.customErrors[fieldName]=!1)}function productPageRedirect(plan,planName,index){plan.payOptionType?"LimitedPay"===plan.payOptionType?$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:plan.ppt}):$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:1}):(delete $localStorage.payOptionType,$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index}))}function updatePlanSelectedRiderIds(plan){var onlyTiSelected=!(!selectedRiderIds||1!=selectedRiderIds.length||selectedRiderIds.indexOf(101)==-1),tiRiderId={886:"302",887:"305",888:"308"};return plan.selectedRiderIds=[],_.each(plan.riderPremiumObject,function(eachRider){!(selectedRiderIds.indexOf(1*eachRider.categoryId)>-1||isRiderDefaultAdded(plan,eachRider))||CommonServiceTerm.isDHFLPlan(plan.Plan_Id)&&onlyTiSelected||eachRider.premium>0&&plan.selectedRiderIds.indexOf(eachRider.riderId)==-1&&plan.selectedRiderIds.push(eachRider.riderId),selectedRiderIds.indexOf(1*eachRider.categoryId)>-1&&(1*eachRider.categoryId==10||1*eachRider.categoryId==15)&&!onlyTiSelected&&plan.selectedRiderIds.indexOf(101)==-1&&plan.selectedRiderIds.push(1*tiRiderId[plan.Plan_Id])}),plan}var enquiryId=$routeParams.enquiryId||$cookies.get("enquiryId");CustomerService.setEnquiryCookie(enquiryId),$rootScope.enquiryId=enquiryId;var comparePlanIds=CompareService.getComparePlanIds()||[],errorFields=[],preservedInfo={},selectedRiderIds=[],defaultProfile={spouse:!1,child:!1},optimizeRiderService=termConfigObj.optimizeRiderService();$scope.tollFreeNumber="1800-419-7713",$rootScope.pTabName={onetimePlans:!(!angular.isDefined($cookies.get("pTabName"))||"onetimePlans"!=$cookies.get("pTabName")),monthlyPlans:!(!angular.isDefined($cookies.get("pTabName"))||"monthlyPlans"!=$cookies.get("pTabName")),tropPlans:!(!angular.isDefined($cookies.get("pTabName"))||"tropPlans"!=$cookies.get("pTabName")),allPlans:!(!angular.isDefined($cookies.get("pTabName"))||"allPlans"!=$cookies.get("pTabName")),wholeLifePlans:!(!angular.isDefined($cookies.get("pTabName"))||"wholeLifePlans"!=$cookies.get("pTabName"))},$scope.object={showArrow:!0,showLoader:!1},$scope.type={payType:$localStorage.payOptionType||1},$scope.firstTimeCustomer=!!GenericService.isUndefinedOrNull(enquiryId),$scope.isComparePage=!0,$scope.custData=[],$scope.allPlans=[],$scope.compareData=[],$rootScope.pageClass="compare",$scope.isPlansLoaded=!1,$scope.showAllPlans=!1,$scope.selectedPlanCount=0,$scope.compareLimit=$rootScope.isMobileDevice?2:5,$scope.cityList=[],$scope.monthlyPlanExists=!1;var jointLifeRiderClicked=!1;$rootScope.profile=angular.isDefined($rootScope.profile)?$rootScope.profile:defaultProfile,$scope.toggle={planDetails:!0,riderDetails:!0},$scope.dateObj={dobDate:null,dobMonth:null,dobYear:null},$scope.allCategories={},$scope.isTobaccoUser=[{value:1,label:"Yes"},{value:0,label:"No"}],$scope.dob={date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()},$scope.spouse={tobacco:[{value:1,label:"Yes"},{value:0,label:"No"}],isWorking:[{value:1,label:"Yes"},{value:0,label:"No"}]},$scope.quotesObj={isMonthly:void 0===$cookies.get("monthPrem")||"monthly"==$cookies.get("monthPrem")},$scope.enquiryId=CommonServiceTerm.getEnquiryId()||$routeParams.enquiryId,$scope.showProfileToSelect=!1,$scope.showLink={email:!0,callback:GenericService.isTimeWithRange(),emailback:!0,call:!0,showMobileChatButton:!1};var customerInfoFromQuotes=CompareService.getCustomerInfo();if($scope.modifySearch={name:"",customerAge:customerInfoFromQuotes.customerAge||18,isTobaccoUser:0,gender:1,city:"",totalPayout:customerInfoFromQuotes.totalPayout||"1,00,00,000",policyTerm:customerInfoFromQuotes.policyTerm||65,emailId:"",mobileNo:"",dob:CompareService.getDefaultDate(),cityId:"551",cityName:"New Delhi",stateId:"35"},$scope.isEditable={name:!0,customerAge:!0,gender:!1,isTobaccoUser:!1,city:!0,totalPayout:!1,policyTerm:!0,mobileNo:!0,emailId:!0,monthlyIncome:!1},$scope.totalPayoutRange={min:1e6,max:2e8},$scope.monthlyIncomeRange={min:1e6,max:2e8},$scope.customerAgeRange={min:18,max:65},$scope.policyTermRange={min:28,max:99},$scope.suggestedPlans={show:!1},$scope.countryCode=91,$scope.minMobileNoLength=10,$scope.maxMobileNoLength=10,$scope.regexForMobileNo=new RegExp("^[789]\\d{9}$"),$scope.customErrors={},$scope.customErrors.totalPayout=!1,$scope.customErrors.policyTermRangeError=!1,$scope.customErrors.customerAgeRangeError=!1,$scope.goToQuotes=function(){$scope.isPlansLoaded=!1,CompareService.setComparePlanIds(comparePlanIds),CompareService.saveComparingPlanIds($scope.custData.custId).success(function(data,status){GenericService.isUndefinedOrNull(data)||"success"==data.status&&($rootScope.isMobileDevice&&1*$routeParams.quotesVariant===1?$location.path("/quotesFeatured/"+enquiryId).search("quotesVariant",null):1*$routeParams.quotesVariant===1?$location.path("/quote/"+enquiryId).search("quotesVariant",null):1*$routeParams.quotesVariant===2?$location.path("/quotesHorizontal/"+enquiryId).search("quotesVariant",null):$location.path("/quotes/"+enquiryId).search("quotesVariant",null))})},$scope.genderOptions=[{value:1,label:"Male"},{value:2,label:"Female"}],$scope.tobaccoOptions=[{value:0,label:"Non Smoker"},{value:1,label:"Smoker"}],$scope.isFormValid=function(form){return!(!form.$valid||customErrorExists())},$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.city="",$scope.cityerror=!1,$scope.toggleModal=function(modalName,status){var modalHashMap={profile:"profileModal",spouse:"spouseProfileModal"};$("#"+modalHashMap[modalName]).modal(status)},CommonServiceTerm.getCityData().then(function(cityObj){cityCallback(cityObj)}),$scope.selectedCityItem={display:$scope.modifySearch.cityName,value:$scope.modifySearch.cityName,searchString:$scope.modifySearch.cityName,stateId:$scope.modifySearch.stateId,cityId:$scope.modifySearch.cityId},$scope.openEditProfileModal=function(){extractDOB(),$scope.toggleModal("profile","show"),setSelectedCityItem()},$scope.showSuggestedPlans=function(){$document.scrollTopAnimated(0),$scope.suggestedPlans.show=!0},$scope.hideSuggestedPlans=function(){$scope.suggestedPlans.show=!1},$scope.firstTimeCustomer){var emptyRegisterObj=CompareService.createEmptyUpdateObj();$scope.modifySearch=CompareService.populateModifySearchModel(emptyRegisterObj.registerCustomer),setDefaultValues(),$scope.custData=angular.copy($scope.modifySearch),closeEditField("all"),getNewPlans()}else CustomerService.getCustomerInformation(enquiryId).success(function(data){GenericService.isUndefinedOrNull(data)||($scope.custData=data,selectedRiderIds=data.categoryIds?data.categoryIds.unique():[],preservedInfo=angular.copy($scope.custData),closeEditField("all"),pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"Landing",pageName:"ComparePage"}),CompareService.getComparingPlanIds($scope.custData.custId).then(function(data){data&&data.data&&data.data.data&&(comparePlanIds=data.data.data.planIds,$rootScope.isMonthlyIncomeJourney=data.data.data.isMonthlyIncomeJourney,$rootScope.isMonthlyIncomeJourney&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1),comparePlanIds&&comparePlanIds.length>2&&$rootScope.isMobileDevice&&(comparePlanIds=comparePlanIds.splice(0,2),CompareService.saveComparingPlanIds($scope.custData.custId,comparePlanIds))),0==comparePlanIds.length?getNewPlans():initializePlansData()}))});$scope.addPlanFromSuggestions=function($event){var elem=angular.element($event.target),planId=elem.data("planid");$scope.addToCompare(planId)},$scope.onInputBlur=function(form,field){var val=$scope.modifySearch[field];findErrors(form).then(function(data){val&&!$scope.customErrors[field]?$scope.isEditable[field]=!1:$scope.isEditable[field]=!0}),$scope.firstTimeCustomer||$scope.saveModification(form,field)},$scope.getLandingQuotes=function(form){$scope.isFormValid(form)&&($scope.isPlansLoaded=!1,comparePlanIds=[],$scope.custData=angular.copy($scope.modifySearch),$scope.custData.totalPayout=CommonServiceTerm.removeCommas($scope.custData.totalPayout),$scope.custData.dob=CompareService.calculateDobFromAge($scope.custData),preservedInfo=angular.copy($scope.custData),
getNewPlans(),closeEditField("all"))};var cityCallback=function(data){var newDelhiObject={CityId:"551",CityName:"New Delhi",StateId:"35",state:"Delhi"},newData=_.uniq(data.response.CityList,function(item){return item.CityId});newData.unshift(newDelhiObject),$scope.cityList=$rootScope.isMobileDevice?GenericService.formatCityMobile(newData):GenericService.formatCity(newData),setSelectedCityItem(),$scope.modifySearch.cityId&&($scope.cityerror=!1)};$scope.selectedCityCallBack=function($item,$model,$label,$event){$scope.modifySearch.cityId=$item.cityId,$scope.modifySearch.stateId=$item.stateId,$scope.modifySearch.city=$item.value,$scope.cityerror=!1},$scope.onCityInputChange=function(){$scope.cityerror=!0},$scope.cancelEditProfile=function(){angular.copy(preservedInfo,$scope.modifySearch),$scope.firstTimeCustomer||$scope.toggleModal("profile","hide")},$scope.toggleProfileFn=function(flag){$scope.showProfileToSelect=flag},$scope.changeDate=function(model){$scope.dateObj.dobDate=angular.copy(model),$scope.changeDateOfBirth()},$scope.changeMonth=function(model){$scope.dateObj.dobMonth=angular.copy(model),$scope.changeDateOfBirth()},$scope.changeYear=function(model){$scope.dateObj.dobYear=angular.copy(model),$scope.changeDateOfBirth()},$scope.changeDateOfBirth=function(){$scope.modifySearch.dob=$scope.dateObj.dobDate+"-"+$scope.dateObj.dobMonth+"-"+$scope.dateObj.dobYear,$scope.modifySearch.customerAge=CommonServiceTerm.getAge($scope.modifySearch.dob)},$scope.isYearSelected=function(index,dobYear){return index==$scope.dob.year.indexOf(parseInt(dobYear))},$scope.isDOBMissing=function(){return!$scope.dateObj.dobDate||!$scope.dateObj.dobMonth||!$scope.dateObj.dobYear},$scope.isValidDateOfBirth=function(){return $scope.modifySearch.dob&&GenericService.isValidDateOfBirth($scope.modifySearch.dob)},$scope.isAgeBelowMinimum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySearch.dob)<$scope.customerAgeRange.min},$scope.isAgeAboveMaximum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySearch.dob)>$scope.customerAgeRange.max},$scope.isValidAge=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.modifySearch.dob)>=$scope.customerAgeRange.min&&CommonServiceTerm.getAge($scope.modifySearch.dob)<=$scope.customerAgeRange.max},$scope.isAegoniTermPlanNew=function(planId){return CommonServiceTerm.isAegonPlan(planId)},$scope.removeFromCompare=function(planId){$scope.compareData=CompareService.removeFromplan($scope.compareData,planId),comparePlanIds=_.filter(comparePlanIds,function(item){return item!==planId}),setCompareIds(),pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"Remove From Compare",pageName:"ComparePage",planId:planId}),$scope.allPlans.length>0&&$scope.compareData.length<2&&($mdToast.show($mdToast.simple().content("Select atleast 2 plans to compare.").position($scope.getToastPosition()).hideDelay(3e3)),$scope.showSuggestedPlans())},$scope.saveDob=function(){$scope.isPlansLoaded=!1,$scope.custData=CompareService.syncCustInfoWithModifySearch($scope.custData,$scope.modifySearch),$scope.isEditable.customerAge=!1,angular.equals(preservedInfo,$scope.custData)?$scope.isPlansLoaded=!0:getNewPlans()},$scope.addToCompare=function(planId){if($scope.compareData.length>=$scope.compareLimit)return $mdToast.show($mdToast.simple().content("Maximum Plans Selected For Comparison").position($scope.getToastPosition()).hideDelay(3e3)),!1;var index=comparePlanIds.indexOf(planId);index==-1&&(pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"Add To Compare",pageName:"ComparePage",planId:planId}),comparePlanIds.push(planId),comparePlanIds.length>=2?($scope.isPlansLoaded=!1,initializePlansData()):($mdToast.show($mdToast.simple().content("Select atleast 2 plans to compare.").position($scope.getToastPosition()).hideDelay(3e3)),CompareService.setComparePlanIds(comparePlanIds),$scope.selectedPlanCount=comparePlanIds.length,markSelectedPlans()))},$scope.editValue=function(field){$scope.isEditable[field]=!0,$timeout(function(){angular.element('[name="'+field+'"]').focus()},100)},$scope.isValidProfileDetails=function(data){return angular.isDefined(data)&&$scope.isValidAge()&&!$scope.cityerror&&null!==data.isTobaccoUser},$scope.onEditProfileSave=function(form){$scope.firstTimeCustomer?$scope.getLandingQuotes(form):$scope.saveModification(form),$scope.toggleModal("profile","hide")},$scope.saveModification=function(compareModifySearchForm,fieldName){var errors=[];$scope.isFormValid(compareModifySearchForm)?($scope.isPlansLoaded=!1,$scope.custData=CompareService.syncCustInfoWithModifySearch($scope.custData,$scope.modifySearch),closeEditField("all"),angular.equals(preservedInfo,$scope.custData)?$scope.isPlansLoaded=!0:getNewPlans()):findErrors(compareModifySearchForm).then(function(data){errors=data,errors=$scope.customErrors.totalPayout?CompareService.pushErrorField(errors,"totalPayout"):CompareService.popErrorField(errors,"totalPayout"),GenericService.isUndefinedOrNull(errors)||errors.indexOf(fieldName)==-1&&closeEditField(fieldName)})},$scope.isValidPayoutAmount=function(){var isValid=CompareService.isValidAmount($scope.modifySearch.totalPayout,$scope.totalPayoutRange);isValid?$scope.customErrors.totalPayout=!1:$scope.customErrors.totalPayout=!0},$scope.isValidMonthlyIncome=function(){var isValid=CompareService.isValidAmount($scope.modifySearch.monthlyIncome,$scope.monthlyIncomeRange);isValid?$scope.customErrors.monthlyIncome=!1:$scope.customErrors.monthlyIncome=!0},$scope.isValidPolicyTerm=function(){var isValid=$scope.modifySearch.policyTerm<=$scope.policyTermRange.max&&$scope.modifySearch.policyTerm>=$scope.policyTermRange.min;isValid?$scope.customErrors.policyTermRangeError=!1:$scope.customErrors.policyTermRangeError=!0},$scope.isValidCustomerAge=function(){var isValid=$scope.modifySearch.customerAge<=$scope.customerAgeRange.max&&$scope.modifySearch.customerAge>=$scope.customerAgeRange.min;isValid?$scope.customErrors.customerAgeRangeError=!1:$scope.customErrors.customerAgeRangeError=!0},$scope.updatePolicyTermRange=function(){var age=$scope.modifySearch.customerAge;GenericService.isUndefinedOrNull(age)||($scope.policyTermRange.min=age+10)},$scope.emailQuotesSuccessCallback=function(){$mdToast.show($mdToast.simple().content("Email has been sent successfully!").position($scope.getToastPosition()).hideDelay(3e3))},$scope.emailQuotesFailureCallback=function(){$mdToast.show($mdToast.simple().content("Failed to send email!").position($scope.getToastPosition()).hideDelay(3e3))},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},$scope.emailQuotes=function(){$scope.showLink.emailback=!1,CompareService.emailQuotes($scope.compareData,$scope.custData,$scope.quotesObj.isMonthly,$scope.monthlyPlanExists,$scope.staticData).success(function(data,status,headers,config){$timeout(function(){"success"==data.status?$scope.emailQuotesSuccessCallback():$scope.emailQuotesFailureCallback()},100)}).error(function(data,status,headers,config){$scope.emailQuotesFailureCallback()})},$scope.addCommas=function(nStr){return GenericService.addCommas(nStr)},$scope.showLimitedPayPeriod=function(text){var index=text.indexOf("Limited pay:"),limitedPayText="";return index&&(limitedPayText=text.substr(index+12,text.length)),limitedPayText},$scope.convertToOneDecimal=function(number){return parseFloat(number).toFixed(1)},$scope.showInfoText=function(rider,plan){return 38==rider.categoryId&&(1*plan.Supplier_Id===16||1*plan.Supplier_Id===116||1*plan.Supplier_Id===10)},$scope.renderRiderInfoText=function(rider,plan){return 38!=rider.categoryId||1*plan.Supplier_Id!==16&&1*plan.Supplier_Id!==116?38==rider.categoryId&&1*plan.Supplier_Id===10?"Waiver of Premium on death & disability":"":"Waiver Of Premium on Critical Illness"},$scope.riderAvailabilityStatus=function(rider,plan){var premium=$scope.quotesObj.isMonthly?rider.monthlyPremium:rider.premium,isIncluded=rider.isIncluded;return $scope.isPNBPlan(plan.Plan_Id)&&13==rider.categoryId?$scope.modifySearch.policyTerm>75?'<i class="fa fa-times fa-size" aria-hidden="true"></i>':"Available":premium||isIncluded?"Available":rider.combinedText?"":'<i class="fa fa-times fa-size" aria-hidden="true"></i>'},$scope.hideRider=function(riderId){var availableRiders=riderAvailableInPlans();return $scope.allCategories[riderId]=availableRiders.indexOf(riderId)!=-1,!$scope.allCategories[riderId]},$scope.isPNBPlan=function(planId){return CommonServiceTerm.isPNBPlan(planId)},$scope.isHdfc3dPlan=function(planId){return CommonServiceTerm.isHdfc3dPlan(planId)},$scope.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},$scope.renderWopInfoText=function(supplierId,premium,paymentMode){var wopText=QuotesService.getWopData(supplierId).text;return wopText&&wopText.length>0?wopText.indexOf("Free")==-1&&116!=supplierId?wopText+': <i class="fa fa-inr"></i>'+premium+" "+paymentMode:wopText:""},$scope.renderFreeWopInfoText=function(supplierId,categoryId){var wopText=QuotesService.getWopData(supplierId).text;return wopText&&wopText.length>0&&38==categoryId?wopText:"Free"},$scope.changeEndToEndName=function(name,supplierId){return 19==supplierId?"Canara "+name:1==supplierId?"Future Generali":name},$scope.changeComparedPlanName=function(plan){return $scope.isHdfc3dPlan(plan.Plan_Id)?853==plan.Plan_Id?"Income Option Increasing Monthly Income":855==plan.Plan_Id?"Income Replacement Option Increasing Monthly Income":plan.Plan_Name:plan.Plan_Name},$scope.rendershowPlanInfo=function(){return"Life Cover is split 80:20 between Life Cover & Critical Illness Cover, Critical Illness cover would increase at every policy anniversary & Life cover would decrease by the same amount."},$scope.showPlanInfoIcon=function(planId){return CommonServiceTerm.isSbiPoornaSuraksha(planId)},$scope.renderCiPayout=function(totalpayout){return.2*parseInt(CommonServiceTerm.removeCommas(totalpayout))},$scope.renderDeathBenefitPayout=function(totalpayout){return.8*parseInt(CommonServiceTerm.removeCommas(totalpayout))},$scope.toggleCiPayout=function(planId){return CommonServiceTerm.isSbiPoornaSuraksha(planId)},$scope.toggleDeathBenefitPayout=function(planId){return CommonServiceTerm.isSbiPoornaSuraksha(planId)},$scope.isSbiPoornaSuraksha=function(planId){return CommonServiceTerm.isSbiPoornaSuraksha(planId)};var setRiderSelected=function(){$rootScope.isMobileDevice&&($scope.isPlansLoaded=!1),_.each($scope.compareData.riderPremiumObject,function(riderObj){riderObj.isSelected=selectedRiderIds.indexOf(riderObj.categoryId)!=-1}),_.each($scope.staticData.riders,function(riderObj){riderObj.isSelected=selectedRiderIds.indexOf(riderObj.categoryId)!=-1}),addRiderValuesToThePlans($scope.compareData).then(function(data){$scope.compareData=data}),$rootScope.isMobileDevice&&($scope.isPlansLoaded=!0)},addRiderValuesToThePlans=function(quotes){var deferred=$q.defer();$scope.object.showLoader=!0;var selectedRiders=angular.copy(selectedRiderIds);return optimizeRiderService?$timeout(function(){RiderService.addRiderValues(quotes,selectedRiders,$scope.quotesObj.isMonthly,$scope.custData,$scope.enquiryId).then(function(data){var quotesData=GenericService.getRidersPremiumForQuotes(data,$scope.staticData.riders,$scope.quotesObj.isMonthly);quotesData=GenericService.addADBOnATPBSelectForMAX(quotesData,selectedRiders),$scope.object.showLoader=!1,deferred.resolve(quotesData)})},400):QuotesService.addRiderValues(quotes,selectedRiders,$scope.quotesObj.isMonthly,$scope.custData,$scope.enquiryId).then(function(data){var quotesData=GenericService.getRidersPremiumForQuotes(data,$scope.staticData.riders,$scope.quotesObj.isMonthly);quotesData=GenericService.addADBOnATPBSelectForMAX(quotesData,selectedRiders),$scope.object.showLoader=!1,deferred.resolve(quotesData)}),deferred.promise};$scope.isValidSpouseDetails=function(){return $scope.isSpouseAdded($scope.modifySearch)};$scope.updateRiderSelection=function(categoryId,status){var index=selectedRiderIds.indexOf(categoryId);status?pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"On Rider Select",pageName:"comparePage",riderId:categoryId,click:"Click"}):pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"On Rider Deselect",pageName:"comparePage",riderId:categoryId,click:"Click"}),13!=categoryId||$scope.isSpouseAdded($scope.modifySearch)?(status&&index==-1?(selectedRiderIds.push(categoryId),toggleCancerRiders(categoryId)):selectedRiderIds.splice(index,1),CommonServiceTerm.setRiderSelected($scope.custData.custId,selectedRiderIds).then(function(data){setCompareIds()})):(!$scope.isSpouseAdded($scope.modifySearch)&&status&&$scope.toggleModal("spouse","show"),jointLifeRiderClicked=!0)},$scope.dontUpdateSpouseRider=function(){$rootScope.profile.spouse||jointLifeRiderClicked&&(_.each($scope.staticData.riders,function(riderObj){1*riderObj.categoryId===13&&(riderObj.isSelected=!1)}),jointLifeRiderClicked=!1)},$scope.isSpouseAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.spouse)&&(angular.isDefined(data.spouse)&&data.spouse&&angular.isDefined(data.spouse.age)&&data.spouse.age&&GenericService.isSpouseAgeValid(data.spouse.age)&&null!==data.spouse.tobacco&&null!==data.spouse.isWorking)};var successCallbackSpouse=function(){CompareService.syncCustInfoWithModifySearch($scope.custData,$scope.modifySearch),$scope.toggleModal("spouse","hide"),$rootScope.profile.spouse=!0,$cookies.put("isSpouseSelected",!0),initializePlansData(),jointLifeRiderClicked&&($scope.updateRiderSelection(13,!0),jointLifeRiderClicked=!1)};$scope.monthlyFreeLookUpPremiumAvaiable=function(planId){return!($scope.isSbiPoornaSuraksha(planId)||891==planId)},$scope.updateSpouseDetails=function(form){form.$valid&&GenericService.isSpouseAgeValid(form.age.$modelValue)&&CustomerService.updateSpouseDetails($scope.modifySearch,$scope.enquiryId).success(function(data,status,headers,config){successCallbackSpouse()}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)})};var showTheModal=function(plan){var deferred=$q.defer();return $scope.hideObject.loadSummaryPage=!0,deferred.resolve(!0),deferred.promise},openPlanDetail=function(plan,index){GenericService.setPlanId(plan.Plan_Id);var planName=plan.Plan_Name.split(" ").join("-");plan.selectedRiderIds&&plan.selectedRiderIds.length>0?(CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,$scope.modifySearch,$scope.type.payType).success(function(data){showTheModal(plan).then(function(){$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,planName,index)})})):(CommonServiceTerm.setUpdateCalled("updateNotCalled"),showTheModal(plan).then(function(){$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,planName,index)}))};$scope.saveQuoteSelection=function(plan){var input={planId:plan.Plan_Id,refId:$scope.enquiryId,productId:"7",premium:plan.FinalPremium,supplierId:plan.Supplier_Id,leadId:$scope.custData.matrixLeadId,mobileNo:$scope.custData.mobileNo,encryptedMobileNo:$scope.custData.encryptedMobileNo,selectedBy:"0",ipAddress:"127.0.0.1",sourcePage:"Quotes",enquiryId:$routeParams.enquiryId};CustomerService.saveQuoteSelection(input).success(function(data,status,headers,config){})},$scope.reversePremiumType=function(flag,plan){$scope.quotesObj.isMonthly=!flag,pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"On Payment freq. change click",pageName:"ComparePage",click:"Click"})},$scope.toggleSumAssuredEdit=function(rider,val){rider.showSumAssuredInput=val,val&&$timeout(function(){$("#id"+rider.riderId).focus()},0)},$scope.validateRiderValues=function(value,rider){if(rider.sumAssuredValidation.isError=!1,void 0!==value){var sumAssuredEntered=value;sumAssuredEntered%rider.sumAssuredValidation.sumAssuredInterval===0?(rider.sumAssuredValidation.isError=!(parseInt(sumAssuredEntered)>=parseInt(rider.sumAssuredValidation.minSumAssured)&&parseInt(sumAssuredEntered)<=parseInt(rider.sumAssuredValidation.maxSumAssured)),rider.sumAssuredValidation.errorMessage="Enter value between "+$filter("amountToString")(rider.sumAssuredValidation.minSumAssured)+" and "+$filter("amountToString")(rider.sumAssuredValidation.maxSumAssured)):rider.sumAssuredValidation.sumAssuredInterval>0&&(rider.sumAssuredValidation.isError=!0,rider.sumAssuredValidation.errorMessage="Enter value in multiples of "+$filter("amountToString")(rider.sumAssuredValidation.sumAssuredInterval))}else rider.sumAssuredValidation.isError=!0,rider.sumAssuredValidation.errorMessage="Enter sum assured value";rider.sumAssuredValidation.isError&&(rider.showSumAssuredInput=!0)},$scope.updateCompareData=function(rider){var sumAssured=1*rider.sumAssuredSelected;rider.sumAssuredValidation.isError||(rider.showSumAssuredInput=!1,sumAssured!=rider.sumAssured&&(rider.sumAssured=sumAssured,_.each($scope.compareData,function(quote){quote.SumAssured=sumAssured}),riderUpdateCall($scope.compareData).then(function(updatedQuotes){$scope.compareData=CompareService.getRidersPremiumForQuotes(CompareService.modifyPlanObjectForDisplay(updatedQuotes),$scope.staticData.riders,$scope.quotesObj.isMonthly)})))};var isRiderDefaultAdded=function(quote,rider){return(!CommonServiceTerm.isDHFLPlan(quote.Plan_Id)||101!=rider.categoryId)&&rider.isDefaultAdded};$scope.proceed=function(plan,index){pbTrackerObj.logEvent({leadId:$scope.custData.matrixLeadId,visitId:$scope.custData.visitId,custId:$scope.custData.custId,event:"On Selection click",pageName:"ComparePage",basicPremium:plan.BasicPremium,planId:plan.Plan_Id,supplierName:plan.Supplier_Name,supplierId:plan.Supplier_Id,planName:plan.Plan_Name,monthlyPremium:plan.monthlyTotalPremium?plan.monthlyTotalPremium:0,planShortName:plan.planShortName,click:"Click"}),gaTagsNew.quotesSelectionTrack("ProductSelect",plan,index+1,$scope.custData.custId);var custId=$scope.custData.custId||$cookies.get("custId")||-1;gtmObj.quotesSelection(plan,$scope.custData.matrixLeadId,custId,index,!1),$scope.clickedPlanId=plan.Plan_Id,$scope.planOrder=index+1,$scope.saveQuoteSelection(plan);var planIds=termConfigObj.getE2EPlanIds();if(angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1){var preQuotesInfoObj=angular.copy($scope.custData);preQuotesInfoObj.monthlyIncome=plan.monthlyIncome,preQuotesInfoObj.totalPayout=plan.TotalCover,preQuotesInfoObj.oneTimePayout=plan.OneTimePayout,preQuotesInfoObj.sumAssured=plan.SumAssured,preQuotesInfoObj.isMonthly=$scope.quotesObj.isMonthly,preQuotesInfoObj.payOptionType=1*$scope.type.payType===3?"Limited":1*$scope.type.payType===2?"Single":"Regular",preQuotesInfoObj.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),CommonServiceTerm.setFilterTypes($scope.types);var totalPremium=$scope.quotesObj.isMonthly?plan.BasicPremium:plan.BasicPremium;CommonServiceTerm.isAegonItermForeverPlan(plan.Plan_Id)&&1*$scope.type.payType===3&&$scope.custData.customerAge<=60&&($scope.custData.customerAge&&plan.ppt&&$scope.custData.customerAge+plan.ppt<65?plan.Plan_Id=8792:plan.Plan_Id=8791),PlanService.getInsurerDetails(preQuotesInfoObj,plan,$scope.enquiryId,totalPremium).success(function(data,status,headers,config){if(data.InsurerDetails&&data.InsurerDetails.action&&"POST"===data.InsurerDetails.action){var redirectUrl="";if(void 0!==data.InsurerDetails.url&&null!==data.InsurerDetails.url&&""!==data.InsurerDetails.url)if(redirectUrl=data.InsurerDetails.url,CommonServiceTerm.isHdfc3dPlan(plan.Plan_Id))if(plan.selectedRiderIds&&plan.selectedRiderIds.length>0)CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,$scope.modifySearch,$scope.type.payType).then(function(){var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));jForm.appendTo("body").submit()});else{var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));jForm.appendTo("body").submit()}else{var jForm=$('<form type="hidden"></form>');jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html");var jInput=$("<input type='hidden'>");if(jInput.attr("name","term"),jInput.attr("value",data.InsurerDetails.fields.term),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","do-you-smoke"),jInput.attr("value",data.InsurerDetails.fields.doyousmoke),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","monthly-payout"),jInput.attr("value",data.InsurerDetails.fields.monthlyincome),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","total-payout"),jInput.attr("value",data.InsurerDetails.fields.totalcover||data.InsurerDetails.fields.sumassured),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","one-time-payout"),jInput.attr("value",data.InsurerDetails.fields.onetimepayout),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","date-of-birth"),jInput.attr("value",data.InsurerDetails.fields.dateofbirth),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","gender"),jInput.attr("value",data.InsurerDetails.fields.gender),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","city"),jInput.attr("value",CommonServiceTerm.getCityName(data.InsurerDetails.fields.city,plan)),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","mobile"),jInput.attr("value",data.InsurerDetails.fields.mobile),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","cityid"),jInput.attr("value",data.InsurerDetails.fields.cityId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","stateid"),jInput.attr("value",data.InsurerDetails.fields.stateid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","custid"),jInput.attr("value",data.InsurerDetails.fields.custid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","firstname"),jInput.attr("value",data.InsurerDetails.fields.firstname),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","lumpsumbenefit"),jInput.attr("value",data.InsurerDetails.fields.lumpsumbenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","incomebenefit"),jInput.attr("value",data.InsurerDetails.fields.incomebenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","email"),jInput.attr("value",data.InsurerDetails.fields.email),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","name"),jInput.attr("value",data.InsurerDetails.fields.name),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","agetillcovered"),jInput.attr("value",data.InsurerDetails.fields.agetillcovered),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","country"),jInput.attr("value",data.InsurerDetails.fields.country),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","basepremium"),jInput.attr("value",""),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","leadid"),jInput.attr("value",data.InsurerDetails.fields.leadId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","enquiryid"),jInput.attr("value",decodeURIComponent(data.InsurerDetails.fields.enquiryid)),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.cover?(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid0&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid0),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid1&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid1),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid2&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid2),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid3&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid3),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.sumAssured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumAssured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid4&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid4),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.middlename&&(jInput=$("<input type='hidden'>"),jInput.attr("name","middlename"),jInput.attr("value",data.InsurerDetails.fields.middlename),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.lastname&&(jInput=$("<input type='hidden'>"),jInput.attr("name","lastname"),jInput.attr("value",data.InsurerDetails.fields.lastname),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.planId&&(jInput=$("<input type='hidden'>"),jInput.attr("name","planId"),jInput.attr("value",data.InsurerDetails.fields.planId),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.sumassured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercareterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-term"),jInput.attr("value",data.InsurerDetails.fields.cancercareterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.modeofpremium){jInput=$("<input type='hidden'>"),jInput.attr("name","mode-of-premium");var modeOfPremium=$scope.quotesObj.isMonthly?"12":"1";jInput.attr("value",modeOfPremium),jForm.append(jInput)}"undefined"!=typeof data.InsurerDetails.fields.planoption&&(jInput=$("<input type='hidden'>"),jInput.attr("name","plan-option"),jInput.attr("value",data.InsurerDetails.fields.planoption),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercaretype&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-type"),jInput.attr("value",data.InsurerDetails.fields.cancercaretype),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.premiumpaymentterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","premium-payment-term"),jInput.attr("value",data.InsurerDetails.fields.premiumpaymentterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.ppt&&(jInput=$("<input type='hidden'>"),jInput.attr("name","ppt"),jInput.attr("value",data.InsurerDetails.fields.ppt),jForm.append(jInput)),jForm.appendTo("body").submit()}}else GenericService.isAegoniTermPlan(plan.Plan_Id)||CommonServiceTerm.isDHFLPlan(plan.Plan_Id)?(CommonServiceTerm.isDHFLPlan(plan.Plan_Id)&&(plan=updatePlanSelectedRiderIds(plan)),plan.selectedRiderIds&&plan.selectedRiderIds.length>0?(CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,$scope.modifySearch,$scope.type.payType).then(function(){window.location=data.InsurerDetails.url})):window.location=data.InsurerDetails.url):window.location=data.InsurerDetails.url})}else openPlanDetail(plan,$scope.planOrder)}}]),app.controller("PreQuotesNewDesignController",["$rootScope","$cookies","$location","$document","$timeout","$routeParams","$filter","$localStorage","GenericService","CustomerService","PreQuotesService","CommonServiceTerm","$scope","$q","$mdSelect",function($rootScope,$cookies,$location,$document,$timeout,$routeParams,$filter,$localStorage,GenericService,CustomerService,PreQuotesService,CommonServiceTerm,$scope,$q,$mdSelect){function preFillData(custData){if(!CommonServiceTerm.isEmptyObject(custData)&&!$routeParams.plan){if(custData.fullName&&"dear customer"===custData.fullName)return!1;preservedCustomerInfo=angular.copy(custData),vm.customerinfo=angular.copy(custData),vm.mobileNo=custData.mobileNo,vm.maskedInput.mobileNo=angular.copy(custData.mobileNo),vm.ctlCompact?vm.customerinfo.professionType=custData.professionType:vm.customerinfo.professionType=vm.customerinfo.professionType||"Salaried",vm.customerinfo.isNri=vm.customerinfo.isNri?1:0,vm.customerinfo.payterm=void 0!==$localStorage.custData&&$localStorage.custData.payterm>0?$localStorage.custData.payterm:10,vm.customerinfo.mobileNo=0!==custData.mobileNo?custData.mobileNo:"",vm.customerinfo.encryptedMobileNo=0!==custData.encryptedMobileNo?custData.encryptedMobileNo:"",vm.customerinfo.isTobacco=angular.isDefined(custData.isTobacco)&&null!==custData.isTobacco?custData.isTobacco:0,PreQuotesService.isMonthlyIncomeJourney()||(vm.customerinfo.subProductTypeId=2),!PreQuotesService.isMonthlyIncomeJourney()||angular.isDefined(vm.customerinfo.subProductTypeId)&&1==vm.customerinfo.subProductTypeId||(vm.customerinfo.subProductTypeId=1,vm.customerinfo.monthlyIncome=0,vm.customerinfo.amount=5e4),vm.data=CommonServiceTerm.extractDOB(vm.customerinfo.dob),vm.isPreFillDataExists=!0}vm.customerinfo.planType=$localStorage.cancerPlanType||"1",$localStorage.cancerPlanType=angular.copy(vm.customerinfo.planType),CommonServiceTerm.changeCancerName(vm.customerinfo.planType);var isCancerHeart=1*vm.customerinfo.planType===3;CommonServiceTerm.setisCancerHeart(isCancerHeart),window.prerenderReady=!0,vm.changeAnuualIncome(custData.annualIncome),1!=$rootScope.subProductTypeId&&($rootScope.isMonthlyIncomeJourney=!1,vm.customerinfo.subProductTypeId=2,$rootScope.cancerJourney?vm.customerinfo.amount=angular.isDefined(vm.customerinfo.amount)&&vm.customerinfo.amount>=1e6&&vm.customerinfo.amount<=5e6?vm.customerinfo.amount:1e6:$rootScope.dengueJourney?vm.customerinfo.amount=!angular.isDefined(data.amount)||25e3!=data.amount&&4e4!=data.amount&&5e4!=data.amount?25e3:data.amount:vm.customerinfo.amount=angular.isDefined(vm.customerinfo.amount)&&vm.customerinfo.amount>=1e6?vm.customerinfo.amount:1e7,
$rootScope.dengueJourney||(vm.customerinfo.amount=$filter("addCommas")(vm.customerinfo.amount)),vm.customerinfo.premium=0,vm.customerinfo.countryCode=vm.customerinfo.countryCode||392),"india"===vm.customerinfo.detectedCountry&&392!=vm.customerinfo.countryCode&&(vm.customerinfo.countryCode=392,vm.customerinfo.profileChanged=!0),1!=$rootScope.subProductTypeId||angular.isDefined(vm.customerinfo.subProductTypeId)&&1==vm.customerinfo.subProductTypeId||($rootScope.isMonthlyIncomeJourney=!0,vm.customerinfo.subProductTypeId=1,vm.customerinfo.monthlyIncome=0,vm.customerinfo.amount=5e4,vm.customerinfo.premium=0),999==vm.customerinfo.countryCode&&(vm.isCountryOthers=!0,vm.isNRI=!0),$localStorage.landingCustData&&($localStorage.landingCustData.dob||$localStorage.landingCustData.mobileNo)&&populateCustInfoFromLandingCustData(),vm.getMobileNumberRegexForCountry(vm.customerinfo.countryCode,!0),vm.customerinfo.gender=parseInt(vm.customerinfo.gender)||1,setSelectedCityItem(),trackCustomerJourney(),vm.prequotesCompact&&(vm.customerinfo.emailId="null"===vm.customerinfo.emailId?"":vm.customerinfo.emailId),"1,00,00,000"!==vm.customerinfo.amount&&(vm.customerChangedCover=!0),custData.amount&&(vm.customerinfo.existingAmount=custData.amount),landOnQuotes&&PreQuotesService.directLandOnQuotesPage(vm.customerinfo)}function checkIfCountryIsListed(countryName){var countryIsListed=!1;countryName=countryName.toLowerCase(),countryName="united states"===countryName?"usa":countryName,vm.customerinfo.detectedCountry=countryName,vm.showFormSection=!0,_.each(vm.countryCodes,function(countryObj){var country=countryObj.CountryName.toLowerCase();country.indexOf(countryName)!=-1&&392!=countryObj.CountryCodeId&&(vm.customerinfo.countryCode=countryObj.CountryCodeId||392,countryIsListed=!0)}),vm.customerinfo.profileChanged=!1,countryName="india"==countryName||countryIsListed?countryName:"india",$rootScope.detectedCountry=countryName,showMobileFirstPage=!1,vm.stage=showMobileFirstPage?"stageM":vm.prequotesCompact||vm.mobileFirstProgressive?"stageCompact":"",vm.direction=showMobileFirstPage?0:1,isRetainer&&vm.customerinfo.mobileNo&&vm.customerinfo.mobileNo.length>0&&(vm.stage="",vm.direction=1),vm.customerinfo.dob||("india"!=countryName?(vm.isNRI=!0,vm.customerinfo.city.id=9999,vm.customerinfo.city.name="Others",vm.customerinfo.city.stateId=99,setSelectedCityItem(),vm.foreignIpDetected=!0,1*vm.customerinfo.countryCode!=392&&(vm.customerinfo.isNri=1),getCountryValidations(1*vm.customerinfo.countryCode)):(vm.foreignIpDetected=!1,392!=vm.customerinfo.countryCode&&(vm.customerinfo.countryCode=392,vm.customerinfo.profileChanged=!0))),vm.prequotesCompact&&($rootScope.preQuotesVariant=4,pbTrackerObj.logEvent({event:"Landing Progressive Journey",pageName:"PQ1",utmCampaign:$rootScope.utmCampaign,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",utmMedium:$rootScope.utmMedium,utmTerm:$rootScope.utmTerm,utmSource:$rootScope.utmSource,collection:"progressive_term",variant:"two"===$routeParams.isProgressive?"second":"first"})),countryIsListed?pbTrackerObj.logEvent({event:"Country Matches List",pageName:"PQ1",countryName:countryName}):pbTrackerObj.logEvent({event:"Country Not Matches List",pageName:"PQ1",countryName:countryName})}function populateCustInfoFromLandingCustData(){vm.customerinfo.amount=$localStorage.landingCustData.amount,vm.customerinfo.dob=$localStorage.landingCustData.dob,vm.customerinfo.annualIncome=$localStorage.landingCustData.annualIncome,vm.customerinfo.policyCoverage=$localStorage.landingCustData.policyCoverage,vm.customerinfo.fullName=$localStorage.landingCustData.fullName,vm.customerinfo.gender=$localStorage.landingCustData.gender,vm.customerinfo.emailId=$localStorage.landingCustData.emailId,vm.customerinfo.mobileNo=$localStorage.landingCustData.mobileNo}function resetCity(countryCodeId,isPageLoad){392!=countryCodeId?(vm.customerinfo.city.id=9999,vm.customerinfo.city.name="Others",vm.customerinfo.city.stateId=99,setSelectedCityItem()):isPageLoad||(vm.customerinfo.city.id=0,vm.customerinfo.city.name="",vm.customerinfo.city.stateId=0,setSelectedCityItem())}var vm=this;vm.getCrFromPaisaBazaar=!0,$rootScope.newJourney=!0,vm.disableGotoQuotes=!1,$rootScope.newJourney=!0,vm.mobileFirstProgressive=$rootScope.isMobileDevice;var ctfLeadId=angular.isDefined($routeParams.leadId)?$routeParams.leadId:"";vm.isSpouseJourney=!!angular.isDefined($routeParams.isSpouseJourney)&&$routeParams.isSpouseJourney;var currentRoute=$location.path(),visitId=0;$rootScope.cancerJourney="/ci"===currentRoute,vm.preQuotesReady=!1;var progressiveVariant,landOnQuotes="true"===$routeParams.landonquotes,isRetainer="true"===$routeParams.isRetainer,pqVariant=$rootScope.isMobileDevice?0:1,showProgressiveJourney=function(){return!$routeParams.plan&&!$rootScope.cancerJourney&&(!ctfLeadId||$routeParams.isCtlSms)&&!$routeParams.isProgressive&&(1==pqVariant||2==pqVariant)};$routeParams.plan||delete $localStorage.landingCustData,showProgressiveJourney()?(progressiveVariant=1==pqVariant?"true":"two",$location.search("isProgressive",progressiveVariant),$timeout(function(){location.reload()},0)):vm.preQuotesReady=!0,vm.customerChangedCover=!1,vm.animateOverflowHidden=!1,vm.foreignIpDetected=!1;var currentDate=new Date;vm.currentYear=currentDate.getFullYear();var showMobileFirstPage=!1;vm.stage="",vm.direction=1,vm.showExitIntent=!1,vm.showExitIntent&&(vm.direction=1),vm.prequotesCompact="true"===$routeParams.isProgressive||"two"===$routeParams.isProgressive||"true"===$routeParams.isCtlSms,vm.ctlCompact="true"===$routeParams.ctlCompact,vm.progressiveSecondVariant="two"===$routeParams.isProgressive,vm.stage=vm.prequotesCompact?"stageCompact":vm.stage,vm.ctlCompact&&(vm.prequotesCompact=!1,vm.stage=vm.ctlCompact?"stageCtlCompact":vm.stage),vm.showFormSection=!$rootScope.isMobileDevice,gtmObj.callGAOnPageLoad($location.$$url),CommonServiceTerm.addYahooTag("https://sp.analytics.yahoo.com/spp.pl?a=10000&.yp=430240"),vm.errorObject={visitCreationError:!1,showArrow:!1,enqCreationError:!1,customerUpdateError:!1},$rootScope.pageClass="landingnew",$rootScope.preQuotesVariant=3,$location.path().indexOf("single")>-1?($rootScope.pageClass="landingnewsingle",$rootScope.preQuotesVariant=4):$location.path().indexOf("landingnew")>-1&&($rootScope.pageClass="landingnew",$rootScope.preQuotesVariant=3),vm.annualIncomeList=[{name:"15 Lac +",id:6},{name:"10-15 Lac",id:5},{name:"7-10 Lac",id:4},{name:"5-7 Lac",id:3},{name:"3-5 Lac",id:2},{name:"2-3 Lac",id:8},{name:"< 2 Lac",id:7}],document.title=$rootScope.cancerJourney?"Cancer Insurance - Compare & Buy Plan at Lowest Premium":document.title,vm.isCrossButtonClicked=!1,vm.isInterestedForDengue=!1;var cancerTypeParams=$location.$$search.cancerTabName?"CH"==$location.$$search.cancerTabName?"3":"H"==$location.$$search.cancerTabName?"2":"1":"1";$location.$$search.cancerTabName&&($localStorage.cancerPlanType=cancerTypeParams,$location.search("cancerTabName",null).replace()),angular.isDefined($routeParams.refId)&&$routeParams.refId&&($localStorage.enquiryId=$routeParams.refId,$location.search("refId",null)),vm.showBanner=!1,vm.isMonthlyIncomeJourney=PreQuotesService.isMonthlyIncomeJourney()||!1,vm.cancerObj={isCrossButtonClicked:!1,showButton:!1},vm.showCancerQuotes=function(flag){vm.cancerObj.isCrossButtonClicked=flag},$routeParams.quotesVariant&&($rootScope.quotesVariant=parseInt($routeParams.quotesVariant));var preservedCustomerInfo={};vm.showAsterisk=!0,vm.offerId=angular.isDefined($routeParams.offerid)?$routeParams.offerid:"";var pid=angular.isDefined($routeParams.pid)?$routeParams.pid:"";if(pid){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("pid",pid,{expires:expireDate})}if(vm.offerId&&(151===vm.offerId||"151"===vm.offerId)){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("pTabName","tropPlans",{expires:expireDate})}$routeParams.payoptiontype&&$cookies.put("pidWithPayType",$routeParams.payoptiontype,{expires:expireDate}),$routeParams.isSelectionDisabled&&"y"==$routeParams.isSelectionDisabled?$cookies.put("pidWithSelection","donotcall",{expires:expireDate}):pid&&!$routeParams.isSelectionDisabled&&$cookies.put("pidWithSelection","donotcall",{expires:expireDate}),vm.baxaMarketingOffer=CommonServiceTerm.baxaMarketingOffer(),vm.showBanner="50"==vm.offerId,angular.isDefined($routeParams.offerid)&&($rootScope.offerId=$routeParams.offerid),vm.offerDetails={head:"",subHead:"",bulletPoints:[]},""===vm.offerId&&(vm.offerDetails=PreQuotesService.getInitialOfferDetails($localStorage.cancerPlanType)),vm.offerId&&PreQuotesService.getOfferDetails(vm.offerId).then(function(data){data&&("failed"!=data.status&&void 0!==data.subHeading?vm.offerDetails.subHead=data.subHeading:vm.offerDetails.subHead="Compare 34 plans from 16 insurers & save upto 50%","failed"!=data.status&&void 0!==data.bulletPoints?(vm.offerDetails.bulletPoints=data.bulletPoints,vm.showAsterisk=!1):vm.offerDetails.bulletPoints=["Awarded India's #1 financial website*","Over 12,12,535 families secured","365 days customer support","1500+ Advisors helping you Compare & Buy"],"failed"!=data.status&&void 0!==data.heading?vm.offerDetails.head=data.heading:vm.offerDetails.head="Term Life Insurance")}),vm.getDObArrayObj=function(){return{date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()}},vm.data={dobDate:null,dobMonth:null,dobYear:null},vm.maskedInput={mobileNo:"*******989"},vm.mobileRegexError=!1,vm.customerinfo={age:null,gender:1,city:{id:null,name:null,stateId:null},isTobacco:0,amount:$rootScope.cancerJourney?$filter("addCommas")(1e6):$filter("addCommas")(1e7),premiumAmount:0,fullName:null,emailId:null,countryCode:392,mobileNo:null,visitId:null,enquiryId:null,custId:null,exitPointUrl:null,dateMonth:null,subProductTypeId:2,dob:angular.isDefined($routeParams.dob)&&$routeParams.dob?$routeParams.dob:null,otherCountryCode:null,annualIncome:null,isInterestedForDengue:!1,professionType:"Salaried",isNri:1};var landingCustData={};($routeParams.cover||$routeParams.plan)&&($routeParams.plan&&window.atob?landingCustData.amount=$routeParams.decoded?$filter("addCommas")($routeParams.plan):$filter("addCommas")(atob($routeParams.plan)):landingCustData.amount=$filter("addCommas")($routeParams.cover),vm.customerinfo.amount=landingCustData.amount),$routeParams.dob&&($routeParams.plan&&window.atob?landingCustData.dob=$routeParams.decoded?angular.copy($routeParams.dob):angular.copy(atob($routeParams.dob)):landingCustData.dob=angular.copy($routeParams.dob),landingCustData.dob=landingCustData.dob.replace(/\//g,"-")),function(){var annualIncome=$routeParams.annualIncome;$routeParams.plan&&$routeParams.annualIncome&&window.atob&&(annualIncome=$routeParams.decoded?angular.copy($routeParams.annualIncome):angular.copy(atob($routeParams.annualIncome))),annualIncome&&(1*annualIncome<=199999?landingCustData.annualIncome=7:1*annualIncome>199999&&1*annualIncome<299999?landingCustData.annualIncome=8:1*annualIncome>299999&&1*annualIncome<499999?landingCustData.annualIncome=2:1*annualIncome>499999&&1*annualIncome<699999?landingCustData.annualIncome=3:1*annualIncome>699999&&1*annualIncome<999999?landingCustData.annualIncome=4:1*annualIncome>999999&&1*annualIncome<1499999?landingCustData.annualIncome=5:landingCustData.annualIncome=6)}(),$routeParams.coverage&&($routeParams.plan&&window.atob?(vm.customerinfo.policyCoverage=$routeParams.decoded?$routeParams.coverage:atob($routeParams.coverage),landingCustData.policyCoverage=$routeParams.decoded?$routeParams.coverage:atob($routeParams.coverage)):(vm.customerinfo.policyCoverage=$routeParams.coverage,landingCustData.policyCoverage=$routeParams.coverage)),($routeParams.fullName||$routeParams.name)&&($routeParams.plan&&$routeParams.name&&window.atob?landingCustData.fullName=$routeParams.decoded?$routeParams.name:atob($routeParams.name):landingCustData.fullName=$routeParams.fullName),$routeParams.gender&&($routeParams.plan&&window.atob?landingCustData.gender=$routeParams.decoded?$routeParams.gender:atob($routeParams.gender):landingCustData.gender=$routeParams.gender,landingCustData.gender="male"===landingCustData.gender.toLowerCase()?1:"female"===landingCustData.gender.toLowerCase()?2:1*landingCustData.gender),($routeParams.emailId||$routeParams.email)&&($routeParams.plan&&window.atob?landingCustData.emailId=$routeParams.decoded?$routeParams.email:atob($routeParams.email):landingCustData.emailId=$routeParams.emailId),($routeParams.mobileNo||$routeParams.mobile)&&($routeParams.plan&&window.atob?landingCustData.mobileNo=$routeParams.decoded?$routeParams.mobile:atob($routeParams.mobile):landingCustData.mobileNo=$routeParams.mobileNo),$routeParams.city&&($routeParams.plan&&window.atob?landingCustData.city={id:$routeParams.cityId,name:$routeParams.decoded?$routeParams.city:atob($routeParams.city),stateId:$routeParams.stateId}:landingCustData.city={id:$routeParams.cityId,name:$routeParams.city,stateId:$routeParams.stateId}),(landingCustData.dob||landingCustData.amount)&&(vm.customerinfo.amount=landingCustData.amount,vm.customerinfo.annualIncome=landingCustData.annualIncome,landingCustData.dob&&(vm.customerinfo.dob=landingCustData.dob,vm.data=CommonServiceTerm.extractDOB(vm.customerinfo.dob)),$localStorage.landingCustData=landingCustData,$timeout(function(){$location.search("cover",null),$location.search("dob",null),$location.search("annualIncome",null),$location.search("coverage",null),$location.search("fullName",null),$location.search("gender",null),$location.search("emailId",null),$location.search("mobileNo",null),$location.search("city",null)},0)),PreQuotesService.visitCreation().then(function(data){data?(visitId=$cookies.get("Cookie_VisitLog"),$rootScope.cancerJourney||($routeParams.isProgressive?pbTrackerObj.logEvent({visitId:1*visitId,event:"Landing",pageName:"PQ1",utmCampaign:$rootScope.utmCampaign,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",utmMedium:$rootScope.utmMedium,utmTerm:$rootScope.utmTerm,utmSource:$rootScope.utmSource,collection:"progressive_term",variant:"two"===$routeParams.isProgressive?"second":"first"}):pbTrackerObj.logEvent({visitId:1*visitId,event:"Landing",pageName:"PQ1",utmCampaign:$rootScope.utmCampaign,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",utmMedium:$rootScope.utmMedium,utmTerm:$rootScope.utmTerm,utmSource:$rootScope.utmSource})),$routeParams.AgentId||PreQuotesService.prefillData(ctfLeadId).then(function(custData){preFillData(custData)})):vm.errorObject.visitCreationError=!0}),vm.changeDOB=function(){vm.customerinfo.dob=vm.data.dobDate+"-"+vm.data.dobMonth+"-"+vm.data.dobYear},vm.baxaMarketingOffer=CommonServiceTerm.baxaMarketingOffer(),vm.isValidAmount=function(){var groupTermJourney=!1;return vm.customerinfo&&vm.customerinfo.annualIncome&&7==vm.customerinfo.annualIncome&&!$rootScope.cancerJourney&&(groupTermJourney=!0),CommonServiceTerm.isValidAmount(vm.customerinfo.amount,vm.isMonthlyIncomeJourney,$rootScope.cancerJourney,groupTermJourney)},vm.getLimits=function(){var groupTermJourney=!1;return vm.customerinfo&&vm.customerinfo.annualIncome&&7==vm.customerinfo.annualIncome&&!$rootScope.cancerJourney&&(groupTermJourney=!0),CommonServiceTerm.validAmountLimits(vm.customerinfo.amount,vm.isMonthlyIncomeJourney,$rootScope.cancerJourney,groupTermJourney)},vm.isValidStepAmount=function(){return GenericService.isValidStepAmount(vm.customerinfo.amount,$rootScope.cancerJourney)},vm.changeDisplayNumberFormat=function(num){var x=CommonServiceTerm.removeCommas(num);return!angular.isUndefined(x)&&x>0?CommonServiceTerm.changeDisplayNumberFormat(x):0},vm.isDOBMissing=function(){return!vm.data.dobDate||!vm.data.dobMonth||!vm.data.dobYear},vm.isValidDateOfBirth=function(){return vm.customerinfo.dob&&GenericService.isValidDateOfBirth(vm.customerinfo.dob)||!1},vm.isAgeBelowMinimum=function(){return!vm.isDOBMissing()&&vm.isValidDateOfBirth()&&CommonServiceTerm.getAge(vm.customerinfo.dob)<18},vm.isAgeAboveMaximum=function(){return!vm.isDOBMissing()&&vm.isValidDateOfBirth()&&CommonServiceTerm.getAge(vm.customerinfo.dob)>65},vm.isValidAge=function(){return!vm.isDOBMissing()&&vm.isValidDateOfBirth()&&CommonServiceTerm.getAge(vm.customerinfo.dob)>=18&&CommonServiceTerm.getAge(vm.customerinfo.dob)<=65},vm.isValidFormInput=function(){return $rootScope.cancerJourney?vm.isValidAge()&&null!==vm.customerinfo.isTobacco&&vm.isValidAmount()&&vm.isValidStepAmount():vm.customerinfo.annualIncome&&1!=vm.customerinfo.annualIncome&&vm.isValidAge()&&null!==vm.customerinfo.isTobacco&&vm.isValidAmount()&&vm.isValidStepAmount()},vm.isYearSelected=function(index,dobYear){return index==vm.getDObArrayObj().year.indexOf(parseInt(dobYear))};var proceedToContactPageInternal=function(){vm.customerinfo.isMobileSinglePage=!!showMobileFirstPage,PreQuotesService.proceedToCustomerPage(vm.customerinfo,preservedCustomerInfo).then(function(data,enq){void 0!==enq&&"enquiry"==enq?vm.errorObject.enqCreationError=!0:data||void 0===enq?(vm.animateOverflowHidden=!0,vm.direction=0,vm.stage="stage1",$timeout(function(){vm.animateOverflowHidden=!1},1500)):vm.errorObject.customerUpdateError=!0,vm.errorObject.showArrow=!1})};vm.showBackButton=function(){return""!=vm.stage};var checkContactFields=function(){var status=!0;return vm.checkForCity(vm.citySearchText),vm.customerinfo.city.id||(vm.errorMessageCity=!0,status=!1,vm.errorContact=!0),status&&(vm.frmPreQuotesTermInsurance.fullName.$error.required||vm.frmPreQuotesTermInsurance.mobileNo.$error.required||vm.frmPreQuotesTermInsurance.mobileNo.$error.pattern||vm.frmPreQuotesTermInsurance.emailAdd.$error.required||vm.frmPreQuotesTermInsurance.emailAdd.$error.pattern||vm.isCountryOthers&&(vm.frmPreQuotesTermInsurance.otherCountryCode.$error.required||vm.frmPreQuotesTermInsurance.otherCountryCode.$error.parse))&&(status=!1),status};vm.goToQuotesSingleStep=function(){vm.errorObject.showArrow=!0,$rootScope.isMonthlyIncomeJourney=PreQuotesService.isMonthlyIncomeJourney(),vm.isValidFormInput()&&checkContactFields()?(vm.errorContact=!0,vm.customerinfo.visitId=1*visitId,"/Landing"===currentRoute&&ctfLeadId?($localStorage.ctfLeadId=ctfLeadId,vm.isPreFillDataExists&&PreQuotesService.validatePreFillData(vm.customerinfo)?PreQuotesService.createEnquiry(!0).then(function(data){var geoCityObj={};vm.customerinfo.enquiryId=$localStorage.enquiryId,$rootScope.cancerJourney||pbTrackerObj.logEvent({visitId:1*visitId,enquiry_id:vm.customerinfo.enquiryId,event:"On Proceed Click",pageName:"PQ1",cover_amount:vm.customerinfo.amount,dob:vm.customerinfo.dob,smoke:vm.customerinfo.isTobacco,annual_income:vm.customerinfo.annualIncome}),PreQuotesService.createCustomer(vm.customerinfo,geoCityObj)}):PreQuotesService.createEnquiry().then(function(data){vm.customerinfo.enquiryId=$localStorage.enquiryId,void 0!==vm.customerinfo.gender&&null!==vm.customerinfo.gender||(vm.customerinfo.gender=1),void 0!==vm.customerinfo.countryCode&&null!==vm.customerinfo.countryCode||(vm.customerinfo.countryCode=392),vm.customerinfo.premiumAmount=0,void 0!==vm.customerinfo.city&&null!==vm.customerinfo.city||(vm.customerinfo.city={id:null,name:null,stateId:null}),preservedCustomerInfo=vm.customerinfo,proceedToContactPageInternal()}),ctfLeadId&&$location.search("leadId",null)):proceedToContactPageInternal()):vm.errorObject.showArrow=!1},vm.navigateToContact=function(){vm.errorObject.showArrow=!0,$rootScope.isMonthlyIncomeJourney=PreQuotesService.isMonthlyIncomeJourney(),vm.isValidFormInput()?(PreQuotesService.isCustomerInputMissing(vm.customerinfo)&&(vm.customerinfo.profileChanged=!0),vm.recommendCover(),vm.customerinfo.visitId=1*visitId,"/Landing"===currentRoute&&ctfLeadId?($localStorage.ctfLeadId=ctfLeadId,vm.isPreFillDataExists&&PreQuotesService.validatePreFillData(vm.customerinfo)?PreQuotesService.createEnquiry(!0).then(function(data){var geoCityObj={};vm.customerinfo.enquiryId=$localStorage.enquiryId,$rootScope.cancerJourney||pbTrackerObj.logEvent({visitId:1*visitId,enquiry_id:vm.customerinfo.enquiryId,event:"On Proceed Click",pageName:"PQ1",cover_amount:vm.customerinfo.amount,dob:vm.customerinfo.dob,smoke:vm.customerinfo.isTobacco,annual_income:vm.customerinfo.annualIncome}),PreQuotesService.createCustomer(vm.customerinfo,geoCityObj)}):PreQuotesService.createEnquiry().then(function(data){vm.customerinfo.enquiryId=$localStorage.enquiryId,void 0!==vm.customerinfo.gender&&null!==vm.customerinfo.gender||(vm.customerinfo.gender=1),void 0!==vm.customerinfo.countryCode&&null!==vm.customerinfo.countryCode||(vm.customerinfo.countryCode=392),vm.customerinfo.premiumAmount=0,void 0!==vm.customerinfo.city&&null!==vm.customerinfo.city||(vm.customerinfo.city={id:null,name:null,stateId:null}),preservedCustomerInfo=vm.customerinfo,proceedToContactPageInternal()}),ctfLeadId&&$location.search("leadId",null)):proceedToContactPageInternal()):vm.errorObject.showArrow=!1},vm.changeAnuualIncome=function(id){$routeParams.annualIncome&&(1*$routeParams.annualIncome<=199999?vm.customerinfo.annualIncome=7:1*$routeParams.annualIncome>199999&&1*$routeParams.annualIncome<299999?vm.customerinfo.annualIncome=8:1*$routeParams.annualIncome>299999&&1*$routeParams.annualIncome<499999?vm.customerinfo.annualIncome=2:1*$routeParams.annualIncome>499999&&1*$routeParams.annualIncome<699999?vm.customerinfo.annualIncome=3:1*$routeParams.annualIncome>699999&&1*$routeParams.annualIncome<999999?vm.customerinfo.annualIncome=4:1*$routeParams.annualIncome>999999&&1*$routeParams.annualIncome<1499999?vm.customerinfo.annualIncome=5:vm.customerinfo.annualIncome=6),1*vm.customerinfo.annualIncome===1&&(vm.customerinfo.annualIncome=8),1*vm.customerinfo.annualIncome===0&&(vm.customerinfo.annualIncome=null)};var isCancerHeart=function(){var planType=vm.customerinfo.planType;$localStorage.cancerPlanType=planType;var isCancerHeart=!1;3==planType&&(isCancerHeart=!0),CommonServiceTerm.changeCancerName(vm.customerinfo.planType),CommonServiceTerm.setisCancerHeart(isCancerHeart)};vm.getCancerQuotes=function(){vm.offerDetails=PreQuotesService.getInitialOfferDetails(vm.customerinfo.planType),isCancerHeart(),$cookies.put("pTabName",vm.customerinfo.planType)},vm.frmPreQuotesMobileSubmit=function(isValid,mobileNumber){if(mobileNumber=mobileNumber||vm.customerinfo.mobileNo,mobileNumber&&mobileNumber.indexOf("*")<0&&!vm.checkIfRegexIsValid(mobileNumber,vm.regexForMobileNo))return void(vm.mobileRegexError=!0);if(vm.mobileRegexError=!1,isValid){var visitId=$cookies.get("Cookie_VisitLog");pbTrackerObj.logEvent({event:"mobile_number_provided",pageName:"PQ1",visitId:1*visitId}),PreQuotesService.updateMobileNumber(mobileNumber).then(function(data){if($location.$$search.showMobileFirst&&($location.search("showMobileFirst",null).replace(),vm.stage=""),data&&!vm.isPreFillDataExists&&392==vm.customerinfo.countryCode){if(data.data&&data.data.enquiryId){var custData=CustomerService.updateCustomerInfoUsingService(data.data);preFillData(custData)}}else vm.customerinfo.age=null,vm.customerinfo.gender=1,vm.customerinfo.isTobacco=0,vm.customerinfo.amount=$rootScope.cancerJourney?$filter("addCommas")(1e6):$filter("addCommas")(1e7),vm.customerinfo.premiumAmount=0,vm.customerinfo.fullName=null,vm.customerinfo.emailId=null,vm.customerinfo.visitId=null,vm.customerinfo.enquiryId=null,vm.customerinfo.custId=null,vm.customerinfo.exitPointUrl=null,vm.customerinfo.dateMonth=null,vm.customerinfo.subProductTypeId=2,vm.customerinfo.dob=angular.isDefined($routeParams.dob)&&$routeParams.dob?$routeParams.dob:null,vm.data={dobDate:null,dobMonth:null,dobYear:null},vm.customerinfo.city.id=9999,vm.customerinfo.city.name="Others",vm.customerinfo.city.stateId=99,setSelectedCityItem(),vm.customerinfo.otherCountryCode=null,vm.customerinfo.annualIncome=null,vm.customerinfo.isInterestedForDengue=!1,vm.customerinfo.professionType="Salaried";var expireDate=new Date;expireDate.setDate(expireDate.getDate()+30),$cookies.put("hide_mobile_field",!0,{expires:expireDate}),$cookies.put("hide_mobile_first",!0,{expires:expireDate})}),vm.changeSwitchTab("stageCompact",0),$("#exitIntentModal").modal("hide")}},vm.frmPreQuotesCtlCompactSubmit=function(isValid){if(isValid&&vm.isValidAge()){if(vm.customerinfo.mobileNo&&vm.customerinfo.mobileNo.indexOf("*")<0&&!vm.checkIfRegexIsValid(vm.customerinfo.mobileNo,vm.regexForMobileNo))return void(vm.mobileRegexError=!0);vm.mobileRegexError=!1,delete $localStorage.landingCustData,vm.errorObject.showArrow=!0,vm.isContinue.disabled=!0,vm.setArrowLoaderObject(!1,!0),vm.customerinfo.professionType=vm.customerinfo.professionType||"",vm.cityerror=!1,$localStorage.custData=vm.customerinfo,$rootScope.preQuotesVariant=0,amt=CommonServiceTerm.removeCommas(vm.customerinfo.amount),$localStorage.custData.amount=amt,vm.customerinfo.isMobileSinglePage=!0,$localStorage.payOptionType=1,vm.ctlCompact?PreQuotesService.createEnquiry().then(function(data){vm.customerinfo.enquiryId=$localStorage.enquiryId,void 0!==vm.customerinfo.gender&&null!==vm.customerinfo.gender||(vm.customerinfo.gender=1),void 0!==vm.customerinfo.countryCode&&null!==vm.customerinfo.countryCode||(vm.customerinfo.countryCode=392),vm.customerinfo.premiumAmount=0,void 0!==vm.customerinfo.city&&null!==vm.customerinfo.city||(vm.customerinfo.city={id:null,name:null,stateId:null}),preservedCustomerInfo=vm.customerinfo,PreQuotesService.createUpdateCustomer(vm.customerinfo).then(function(){})}):PreQuotesService.proceedToCustomerPage(vm.customerinfo,preservedCustomerInfo).then(function(data,enq){void 0!==enq&&"enquiry"==enq?(vm.errorObject.enqCreationError=!0,vm.errorObject.showArrow=!1):data||void 0===enq||(vm.errorObject.customerUpdateError=!0,vm.errorObject.showArrow=!1)})}},vm.frmPreQuotesCompactSubmit=function(isValid){if(isValid&&vm.isValidAge()){if(vm.customerinfo.mobileNo&&vm.customerinfo.mobileNo.indexOf("*")<0&&!vm.checkIfRegexIsValid(vm.customerinfo.mobileNo,vm.regexForMobileNo))return void(vm.mobileRegexError=!0);vm.mobileRegexError=!1,$rootScope.preQuotesVariant=4,vm.errorObject.showArrow=!0,vm.isContinue.disabled=!0,vm.setArrowLoaderObject(!1,!0),vm.customerinfo.amount=vm.customerinfo.existingAmount?$filter("addCommas")(vm.customerinfo.existingAmount):$filter("addCommas")(5e6),vm.customerinfo.isStateChange=!0,392!=vm.customerinfo.countryCode?vm.customerinfo.city={id:9999,name:"Others",stateId:99}:vm.customerinfo.city&&vm.customerinfo.city.id&&551!=vm.customerinfo.city.id?vm.customerinfo.isStateChange=!1:(vm.customerinfo.city={id:551,name:"New Delhi(Delhi)",stateId:35},vm.customerinfo.isStateChange=!0),vm.customerinfo.isNri&&(vm.customerinfo.city={id:9999,name:"Others",stateId:99}),vm.customerinfo.professionType="",vm.cityerror=!1,$localStorage.custData=vm.customerinfo;var amt=0;vm.customerinfo.isMobileSinglePage=!0,amt=CommonServiceTerm.removeCommas(vm.customerinfo.amount),$localStorage.custData.amount=amt,vm.customerinfo.isProgressiveJourney=!0,$cookies.remove("progressiveSecondVariant"),vm.progressiveSecondVariant&&(vm.customerinfo.countryCode=vm.customerinfo.countryCode||392,vm.customerinfo.mobileNo=9777777777,$cookies.put("progressiveSecondVariant",!0)),vm.customerinfo.isNri&&(vm.customerinfo.city={id:9999,name:"Others",stateId:99}),$localStorage.payOptionType=1,vm.customerinfo.isSpouseJourney=vm.isSpouseJourney,PreQuotesService.proceedToCustomerPage(vm.customerinfo,preservedCustomerInfo).then(function(data,enq){void 0!==enq&&"enquiry"==enq?(vm.errorObject.enqCreationError=!0,vm.errorObject.showArrow=!1):data||void 0===enq||(vm.errorObject.customerUpdateError=!0,vm.errorObject.showArrow=!1)})}},vm.closeExitIntent=function(){$mdSelect.hide()},vm.validateCoverAmount=function(len){var str=vm.customerinfo.amount,res="";if(str){for(var i=0;i<str.length;i++){var c=str.charAt(i);c>="0"&&c<="9"&&res.length<len&&(res+=c)}vm.customerinfo.amount=$filter("addCommas")(res)}},vm.changeSwitchTab=function(stage,direction){vm.animateOverflowHidden=!0,vm.stage=stage||"",vm.direction=direction?1:0,$timeout(function(){vm.animateOverflowHidden=!1},1500)},vm.professionTypeList=[{name:"Salaried",id:"Salaried"},{name:"Self-Employed",id:"Self-Employed"}];var geoCityObj={};if(geoCityObj.city="",geoCityObj.country="",vm.citySearchText="",vm.city="",vm.countryCodes=[],vm.cityerror=!1,vm.errorContact=!1,vm.showCreateVisitError=!1,vm.showCreateEnquiryError=!1,vm.showCreateUpdateCustomerError=!1,vm.countryList=[],vm.selectedCityItem={},vm.privacy=!0,angular.isDefined($routeParams.isRedirectFromHomePage)&&$routeParams.isRedirectFromHomePage){$localStorage.enquiryId=$routeParams.enquiryId,vm.customerinfo.enquiryId=$routeParams.enquiryId,vm.customerinfo.dob=$routeParams.dob,vm.customerinfo.totalPayout=$routeParams.totalCover,vm.customerinfo.isTobacco=$routeParams.tobacco;var visitId=$routeParams.visitId;vm.customerinfo.utmSource=$routeParams.utmSource,vm.customerinfo.utmMedium=$routeParams.utmMedium,vm.customerinfo.utmCampaign=$routeParams.utmCampaign,vm.customerinfo.utmTerm=$routeParams.utmTerm,$rootScope.utmSource=$routeParams.utmSource,$rootScope.utmMedium=$routeParams.utmMedium,$rootScope.utmCampaign=$routeParams.utmCampaign,$rootScope.utmTerm=$routeParams.utmTerm,$localStorage.custData=vm.customerinfo,$localStorage.custData.amount=CommonServiceTerm.removeCommas($localStorage.custData.amount),$location.search("enquiryId",null),$location.search("dob",null),$location.search("totalCover",null),$location.search("tobacco",null),$location.search("visitId",null),$location.search("isRedirectFromHomePage",null);var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("Cookie_VisitLog",visitId,{expires:expireDate,domain:"policybazaar.com"})}var setOtherCountryInfo=function(countryCodeId,isPageLoad){resetCity(countryCodeId,isPageLoad),isPageLoad||!$localStorage.landingCustData||$localStorage.landingCustData.mobileNo||(vm.customerinfo.mobileNo=null,vm.customerinfo.otherCountryCode=null)},getCountryValidations=function(countryCodeId){GenericService.getRegexForCountry(countryCodeId).success(function(data,status,headers,config){if(data.regexInfo){vm.minMobileNoLength=data.regexInfo.minLength,vm.maxMobileNoLength=data.regexInfo.maxLength;var re=new RegExp(data.regexInfo.regex);vm.regexForMobileNo=re}else vm.minMobileNoLength=10,vm.maxMobileNoLength=10,vm.regexForMobileNo=new RegExp("^[6789]\\d{9}$")})},updateNRICountryInfo=function(countryCodeId){vm.isNRI=392!=countryCodeId,vm.isCountryOthers=999==countryCodeId};vm.getMobileNumberRegexForCountry=function(countryCodeId,isPageLoad){isPageLoad=!!angular.isDefined(isPageLoad)&&isPageLoad,setOtherCountryInfo(countryCodeId,isPageLoad),updateNRICountryInfo(countryCodeId),getCountryValidations(countryCodeId),preservedCustomerInfo.countryCode&&(vm.customerinfo.mobileNo&&vm.customerinfo.mobileNo.indexOf("*")>-1&&preservedCustomerInfo.countryCode!=vm.customerinfo.countryCode?vm.customerinfo.mobileNo="":vm.customerinfo.mobileNo&&(""==vm.customerinfo.mobileNo||null==vm.customerinfo.mobileNo)&&preservedCustomerInfo.mobileNo&&preservedCustomerInfo.countryCode==vm.customerinfo.countryCode&&(vm.customerinfo.mobileNo=vm.maskedInput.mobileNo)),1*countryCodeId===392&&9999===vm.selectedCityItem.cityId&&(vm.selectedCityItem={},vm.customerinfo.city={})},vm.updateisNri=function(countryCodeId,status){1*vm.customerinfo.countryCode!=392?vm.assignClass=!0:vm.assignClass=!1},vm.onCountrySelect=function(){1*vm.customerinfo.countryCode!=392?vm.customerinfo.isNri=1:vm.assignClass=!0},$rootScope.pageLoaded=!1,$rootScope.subProductTypeId=angular.isDefined($routeParams.sub_product)?$routeParams.sub_product:2,$rootScope.isMonthlyIncomeJourney=1==$rootScope.subProductTypeId,$rootScope.pageClass="landingnew",$rootScope.slideFlag=angular.isDefined($rootScope.slideFlag)?$rootScope.slideFlag:"right",$rootScope.isIFrameContact=!1;var enqId=angular.isDefined($routeParams.enqId)&&$routeParams.enqId?$routeParams.enqId:"";enqId&&($localStorage.enquiryId=enqId,$rootScope.isIFrameContact=!0),vm.planId=$routeParams.planId,vm.isLeadExist=!1,vm.isMobileExist=!1,vm.onChange=!1,vm.isContinue={disabled:!1},vm.object={
showArrow:!0,showLoader:!1},vm.minMobileNoLength=10,vm.maxMobileNoLength=10,vm.regexForMobileNo=new RegExp("^[6789]\\d{9}$"),vm.mobileNo=null,vm.buyLanding={txtLeadId:null,txtMobileNo:null},vm.customerinfo.subProductTypeId=$rootScope.subProductTypeId,vm.currentRoute=currentRoute,vm.isNRI=!1,vm.gender=[{value:1,displayValue:"Mr."},{value:2,displayValue:"Ms."}],$rootScope.isMobileDevice&&(vm.topCities=GenericService.getTopCitiesList()),vm.cityModal={isVisible:!1},vm.filteredCityList=[];vm.getCountryList=function(){CommonServiceTerm.getCountryCodes().then(function(data){vm.countryCodes=data,vm.customerinfo.countryCode=vm.customerinfo.countryCode||392,CommonServiceTerm.getCountryOfClient().then(function(data){data.data.countryName&&checkIfCountryIsListed(data.data.countryName)})})},vm.showMobileField=function(){return!vm.mobileFirstProgressive||!$cookies.get("hide_mobile_field")},vm.getCountryCode=function(countryCodeId){return void 0!==countryCodeId&&null!==countryCodeId||(countryCodeId=392,vm.customerinfo.countryCode=392),vm.customerinfo.countryCode=parseInt(vm.customerinfo.countryCode),PreQuotesService.getCountryCode(vm.countryCodes,countryCodeId)},vm.getCountryList();var setSelectedCityItem=function(){vm.selectedCityItem=PreQuotesService.setSelectedCityItem(vm.customerinfo.city)},getPageId=function(){return"contact"==$rootScope.pageClass?2:1};vm.checkPattern=function(isSubmitted){isSubmitted&&(vm.checkIfRegexIsValid(vm.customerinfo.mobileNo,vm.regexForMobileNo)?vm.mobileRegexError=!1:vm.mobileRegexError=!0)},vm.checkIfRegexIsValid=function(number,regex){var numberRegex=new RegExp(regex);return numberRegex.test(number)},vm.unmaskInput=function(form,event){var mobileLocal=vm.customerinfo.mobileNo;"focus"==event&&mobileLocal&&mobileLocal.indexOf("*")>-1&&(vm.customerinfo.mobileNo=""),"blur"!=event||!vm.maskedInput.mobileNo||""==vm.maskedInput.mobileNo||""!=vm.customerinfo.mobileNo&&null!=vm.customerinfo.mobileNo||preservedCustomerInfo.countryCode!=vm.customerinfo.countryCode||""==form.mobileNo.$viewValue&&(vm.customerinfo.mobileNo=vm.maskedInput.mobileNo)};var trackCustomerJourney=function(){if(PreQuotesService.isEnquiryExists()){var enquiryId=$localStorage.enquiryId,pageId=getPageId();CustomerService.trackCustomerJourneyService(enquiryId,pageId).success(function(data,status,headers,config){})}};vm.searchCityTextChangeNew=function(citySearchText,frmPreQuotesTermInsurance){return!angular.isUndefined(citySearchText)&&void(citySearchText!=vm.citySearchText&&(vm.citySearchText=citySearchText))},vm.selectedCityItemChange=function(selectedCity){return null!==vm.customerinfo.city&&void 0!==vm.customerinfo.city||(vm.customerinfo.city={}),angular.isUndefined(selectedCity)?(vm.cityerror=!0,vm.customerinfo.city.id=null,vm.customerinfo.city.name=null,vm.customerinfo.city.stateId=null,!1):void(angular.isDefined(selectedCity)?(vm.cityerror=!1,vm.customerinfo.city.id=selectedCity.cityId,vm.customerinfo.city.name=selectedCity.value,vm.customerinfo.city.stateId=selectedCity.stateId):vm.cityerror=!0)},vm.changeSlideFlag=function(flag){$rootScope.slideFlag=flag},vm.recommendCover=function(){if(vm.customerChangedCover)$cookies.remove("showPayoutCallOut"),delete vm.customerinfo.recommendedCover;else{var annualIncomeId=1*vm.customerinfo.annualIncome;annualIncomeId=7===annualIncomeId?8:annualIncomeId;var annualIncome=CustomerService.minOfAnnualIncomeRange(annualIncomeId),recommendedCover=CustomerService.recommendCover(annualIncome);vm.customerinfo.recommendedCover=recommendedCover||1e7,$cookies.put("showPayoutCallOut",!0)}},vm.changeAmount=function(){vm.customerChangedCover=!0},vm.goToQuotesPage=function(){if(vm.checkForCity(vm.citySearchText),vm.customerinfo.city.id||(vm.errorMessageCity=!0),vm.customerinfo.isMobileSinglePage=!!showMobileFirstPage,vm.errorMessageCity||vm.disableGotoQuotes)vm.errorContact=!0;else if(vm.errorContact=!0,vm.frmPreQuotesContact.$valid){vm.isContinue.disabled=!0,vm.setArrowLoaderObject(!1,!0),vm.cityerror=!1,$localStorage.custData=vm.customerinfo;var amt=0;amt=CommonServiceTerm.removeCommas(vm.customerinfo.amount),$localStorage.custData.amount=amt,$rootScope.isLanding||CommonServiceTerm.setShouldPageSkipCookie(),delete $localStorage.landingCustData,PreQuotesService.proceedToQuotesPage(vm.customerinfo,geoCityObj,vm.mobileNo).then(function(data,text){data||(vm.showCreateUpdateCustomerError=!0),vm.setArrowLoaderObject(!0,!1),vm.isContinue.disabled=!1})}},vm.setArrowLoaderObject=function(showArrow,showLoader){vm.object.showArrow=showArrow,vm.object.showLoader=showLoader};var getCountryIdByCode=function(otherCountryCode){var countryCodeId=null;return angular.forEach(vm.countryCodes,function(value,key){otherCountryCode==value.CountryCode&&(countryCodeId=value.CountryCodeId)}),countryCodeId};vm.changeCountryCode=function(){var countryCodeId=getCountryIdByCode(vm.customerinfo.otherCountryCode);countryCodeId?(vm.customerinfo.countryCode=countryCodeId,getCountryValidations(countryCodeId),resetCity(countryCodeId,!1)):(vm.customerinfo.countryCode=999,getCountryValidations(999),resetCity(999,!1)),vm.isNRI=91!=vm.customerinfo.otherCountryCode},vm.selectTopCity=function(data){vm.input=data.name,vm.callback(data)},vm.callback=function(data){void 0!==vm.customerinfo.city&&null!==vm.customerinfo.city||(vm.customerinfo.city={}),vm.customerinfo.city.id=data.id||data.cityId,vm.customerinfo.city.name=data.state?data.name+" ("+data.state+")":data.name,vm.customerinfo.city.stateId=data.stateId,vm.customerinfo.city.state=data.state,setSelectedCityItem(),$rootScope.isMobileDevice&&vm.toggleCityModal(!1)},vm.checkForCity=function(name){vm.customerinfo.city.id||vm.callback(PreQuotesService.findCityFormText(vm.city,name)),vm.errorMessageCity=!vm.customerinfo.city.id},vm.toggleCityModal=function(flag){flag||vm.customerinfo.city.id||(vm.customerinfo.city.name=null),$timeout(function(){vm.cityModal.isVisible=flag,$("html, body").stop(!0,!0).animate({scrollTop:0},200)},50)};var filterCity=function(cityList,searchText){searchText=angular.lowercase(searchText);var filteredList=_.filter(cityList,function(value,index){if(angular.lowercase(value.name).substr(0,searchText.length).indexOf(searchText)>=0)return value.name});if(angular.lowercase(searchText).substr(0,searchText.length).indexOf("del")>=0){var newDelhiObject={id:"551",name:"New Delhi(Delhi)",stateId:"35",state:"Delhi"};filteredList.unshift(newDelhiObject)}return filteredList};vm.changeCity=function(searchText){return!angular.isUndefined(searchText)&&(vm.customerinfo.city.id=null,void(vm.filteredCityList=filterCity(vm.city,searchText)))},vm.isMobileCityActive=function(){return void 0!==vm.customerinfo.city&&null!==vm.customerinfo.city&&null!==vm.customerinfo.city.id},vm.crFromPaisaBazaar=function(){vm.disableGotoQuotes=!vm.getCrFromPaisaBazaar};var cityCallback=function(data){var newDelhiObject={CityId:"551",CityName:"New Delhi(Delhi)",StateId:"35",state:"Delhi"},newData=_.uniq(data.response.CityList,function(item){return item.CityId});newData.unshift(newDelhiObject),vm.city=$rootScope.isMobileDevice?GenericService.formatCityMobile(newData):GenericService.formatCity(newData),$localStorage.landingCustData&&$localStorage.landingCustData.city&&$localStorage.landingCustData.city.name&&vm.checkForCity($localStorage.landingCustData.city.name)},getAllCityList=function(){var deferred=$q.defer(),cityData={};return CommonServiceTerm.getCityData().then(function(cityObj){cityData=cityObj,deferred.resolve(cityData)}),deferred.promise};getAllCityList().then(function(cityData){cityCallback(cityData)}),angular.element(function(){$rootScope.isMobileDevice&&angular.element("li").click(function(){$("html, body").stop(!0,!0).animate({scrollTop:$(this).offset().top-35},200)}),$timeout(function(){$('form[autocomplete="off"] input, input[autocomplete="false"]').each(function(){var input=this,name=$(input).attr("name"),id=$(input).attr("id");$(input).removeAttr("name").removeAttr("id"),setTimeout(function(){$(input).attr("name",name).attr("id",id)},100)})},100),$timeout(function(){$rootScope.pageLoaded=!0,$("pbheader").css({position:"relative",top:"-150px"}),$("pbheader").delay(100).animate({top:"0px"},1e3)},500)})}]),app.controller("quotesChatbotController",["$scope","$rootScope","$cookies","$location","$document","$timeout","$routeParams","$filter","$localStorage","GenericService","CustomerService","PreQuotesService","ServerUtilityService","PlanService","CommonServiceTerm","QuotesService",function($scope,$rootScope,$cookies,$location,$document,$timeout,$routeParams,$filter,$localStorage,GenericService,CustomerService,PreQuotesService,ServerUtilityService,PlanService,CommonServiceTerm,QuotesService){function proceed(plan,index,visitId,enquiryId,leadId,mobileNo,encryptedMobileNo){var plan=JSON.parse(plan),isMobileDefault=!!$location.$$search.isMobileDefault;saveQuoteSelection=function(plan){var input={planId:plan.Plan_Id,refId:enquiryId,productId:"7",premium:plan.FinalPremium,supplierId:plan.Supplier_Id,leadId:leadId,mobileNo:mobileNo,encryptedMobileNo:encryptedMobileNo,selectedBy:$routeParams.AgentId&&window.atob?window.atob($routeParams.AgentId):"0",ipAddress:"127.0.0.1",sourcePage:"ChatbotQuotes",enquiryId:enquiryId};CustomerService.saveQuoteSelection(input).success(function(data,status,headers,config){})},saveQuoteSelection(plan);$cookies.get("custId")||-1;planOrder=index+1;var planIds=termConfigObj.getE2EPlanIds();if(angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1){plan.BasicPremium;customerInfo={visitId:visitId,enquiryId:enquiryId,leadId:leadId},$scope.getRedirectionInformation=function(chatbotRedirectionUrl){return ServerUtilityService.getWebService(chatbotRedirectionUrl,null).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},$scope.getRedirectionInformation(chatbotRedirectionUrl).then(function(result){"Fail"!=result.data.status?(plan.Plan_Id=result.data.Plan_Id||result.data.PlanId,data=result.data):$scope.statusFail=!0;var isE2ePlan=plan.Plan_Id?termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)!=-1:void 0;if(leadId&&CommonServiceTerm.createRevisit({leadId:leadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:isE2ePlan?"E2eRedirect":"InsurerRedirect"}),data.InsurerDetails&&data.InsurerDetails.action&&"POST"===data.InsurerDetails.action&&""!==data.InsurerDetails.url){var redirectUrl="";if(void 0!==data.InsurerDetails.url&&null!==data.InsurerDetails.url&&""!==data.InsurerDetails.url)if(redirectUrl=data.InsurerDetails.url,CommonServiceTerm.isHdfc3dPlan(plan.Plan_Id))if(data.InsurerDetails.fields.isMobileDefault=""+isMobileDefault,plan.selectedRiderIds&&plan.selectedRiderIds.length>0)CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,vm.modifySelection,vm.type.payType).then(function(){var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));849!=plan.Plan_Id&&8491!=plan.Plan_Id&&8492!=plan.Plan_Id||(jInput=$("<input type='hidden'>"),jInput.attr("name","isExtrLifePlanSelected"),jInput.attr("value","yes"),jForm.append(jInput)),jForm.appendTo("body").submit()});else{var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));849!=plan.Plan_Id&&8491!=plan.Plan_Id&&8492!=plan.Plan_Id||(jInput=$("<input type='hidden'>"),jInput.attr("name","isExtrLifePlanSelected"),jInput.attr("value","yes"),jForm.append(jInput)),jForm.appendTo("body").submit()}else{var jForm=$('<form type="hidden"></form>');jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html");var jInput=$("<input type='hidden'>");if(jInput.attr("name","term"),jInput.attr("value",data.InsurerDetails.fields.term),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","do-you-smoke"),jInput.attr("value",data.InsurerDetails.fields.doyousmoke),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","monthly-payout"),jInput.attr("value",data.InsurerDetails.fields.monthlyincome),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","total-payout"),jInput.attr("value",data.InsurerDetails.fields.totalcover||data.InsurerDetails.fields.sumassured),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","one-time-payout"),jInput.attr("value",data.InsurerDetails.fields.onetimepayout),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","date-of-birth"),jInput.attr("value",data.InsurerDetails.fields.dateofbirth),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","gender"),jInput.attr("value",data.InsurerDetails.fields.gender),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","city"),jInput.attr("value",isMobileDefault?"":CommonServiceTerm.getCityName(data.InsurerDetails.fields.city,plan)),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","mobile"),jInput.attr("value",data.InsurerDetails.fields.mobile),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","cityid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.cityId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","stateid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.stateid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","custid"),jInput.attr("value",data.InsurerDetails.fields.custid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","firstname"),jInput.attr("value",data.InsurerDetails.fields.firstname),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","lumpsumbenefit"),jInput.attr("value",data.InsurerDetails.fields.lumpsumbenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","incomebenefit"),jInput.attr("value",data.InsurerDetails.fields.incomebenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","email"),jInput.attr("value",data.InsurerDetails.fields.email),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","name"),jInput.attr("value",data.InsurerDetails.fields.name),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","agetillcovered"),jInput.attr("value",plan.newCoverageUpto),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","country"),jInput.attr("value",data.InsurerDetails.fields.country),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","basepremium"),jInput.attr("value",""),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","leadid"),jInput.attr("value",data.InsurerDetails.fields.leadId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","enquiryid"),jInput.attr("value",decodeURIComponent(data.InsurerDetails.fields.enquiryid)),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.cover?(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid0&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid0),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid1&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid1),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid2&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid2),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid3&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid3),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.sumAssured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumAssured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid4&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid4),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.middlename&&(jInput=$("<input type='hidden'>"),jInput.attr("name","middlename"),jInput.attr("value",data.InsurerDetails.fields.middlename),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.lastname&&(jInput=$("<input type='hidden'>"),jInput.attr("name","lastname"),jInput.attr("value",data.InsurerDetails.fields.lastname),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.planId&&(jInput=$("<input type='hidden'>"),jInput.attr("name","planId"),jInput.attr("value",data.InsurerDetails.fields.planId),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.sumassured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercareterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-term"),jInput.attr("value",data.InsurerDetails.fields.cancercareterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.modeofpremium){jInput=$("<input type='hidden'>"),jInput.attr("name","mode-of-premium");var modeOfPremium=12;jInput.attr("value",modeOfPremium),jForm.append(jInput)}"undefined"!=typeof data.InsurerDetails.fields.planoption&&(jInput=$("<input type='hidden'>"),jInput.attr("name","plan-option"),jInput.attr("value",data.InsurerDetails.fields.planoption),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercaretype&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-type"),jInput.attr("value",data.InsurerDetails.fields.cancercaretype),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.premiumpaymentterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","premium-payment-term"),jInput.attr("value",data.InsurerDetails.fields.premiumpaymentterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.ppt&&(jInput=$("<input type='hidden'>"),jInput.attr("name","ppt"),jInput.attr("value",data.InsurerDetails.fields.ppt),jForm.append(jInput)),jForm.appendTo("body").submit()}}else GenericService.isAegoniTermPlan(plan.Plan_Id)||CommonServiceTerm.isDHFLPlan(plan.Plan_Id)||GenericService.isIPruSmartPlan(plan.Plan_Id)?((CommonServiceTerm.isDHFLMonthlyPlan(plan.Plan_Id)||GenericService.isIPruSmartPlan(plan.Plan_Id))&&$rootScope.pTabName&&$rootScope.pTabName.monthlyPlans,isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true":window.location=data.InsurerDetails.url):isMobileDefault?window.location=data.InsurerDetails.url+"?isMobileDefault=true":window.location=data.InsurerDetails.url})}else openPlanDetail(plan,planOrder);GenericService.isHDFCPlan(plan.Plan_Id)&&(planName=plan.Plan_Name)}function productPageRedirect(plan,planName,index){var isMobileDefault=!!$location.$$search.isMobileDefault;plan.payOptionType?"LimitedPay"===plan.payOptionType?$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:plan.ppt,isMobileDefault:isMobileDefault?"true":null}):$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:1,isMobileDefault:isMobileDefault?"true":null}):(delete $localStorage.payOptionType,$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,isMobileDefault:isMobileDefault?"true":null}))}$scope.roomId=$routeParams.roomId,$scope.infoData={},$scope.quotesObj={},$scope.quotesObj.isMonthly=!0,$scope.statusFail=!1,chatbotUrl=$location.protocol()+"://"+$location.host()+":"+$location.port()+"/api/chatbot/insurerredirectionquotes/"+$scope.roomId,chatbotRedirectionUrl=$location.protocol()+"://"+$location.host()+":"+$location.port()+"/api/chatbot/insurerredirection/"+$scope.roomId,$scope.getCustomerInformation=function(chatbotUrl){return ServerUtilityService.getWebService(chatbotUrl,null).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},$scope.getCustomerInformation(chatbotUrl).then(function(data){"Fail"!=data.data.status?($scope.infoData=data.data,proceed(data.data.planDetails,0,data.data.visitId,data.data.enquiryId,data.data.leadId,data.data.mobileNo,data.data.encryptedMobileNo)):$scope.statusFail=!0}),$scope.redirectSummaryPage=function(){$scope.errorObject.isMobileExist=!1,$scope.errorObject.onChange=!1,$scope.errorObject.isLeadExist=!1,$scope.errorObject.showLoader=!0,PreQuotesService.buyProceed($scope.buyLanding,$scope.planId).then(function(errorObject){$scope.errorObject.showLoader=!1,errorObject.isLeadExist&&($scope.isLeadExist=!0,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1),errorObject.isMobileExist&&($scope.isMobileExist=!0,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1)})};var openPlanDetail=function(plan,index){GenericService.setPlanId(plan.Plan_Id),$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,plan.Plan_Name,index)}}]),quotesController.$inject=["$scope","$rootScope","$location","$mdToast","$routeParams","$timeout","$cookies","$localStorage","GenericService","CustomerService","QuotesService","$q","$filter","PlanService","CommonServiceTerm","CompareService","$document","$window","$sce","RiderService","PreQuotesService"],app.controller("quotesController",quotesController),app.controller("quotesFilterController",["$scope","$rootScope","$location","$mdToast","$routeParams","$timeout","$cookies","$localStorage","GenericService","CustomerService","QuotesService","$q","$filter","PlanService","CommonServiceTerm",function($scope,$rootScope,$location,$mdToast,$routeParams,$timeout,$cookies,$localStorage,GenericService,CustomerService,QuotesService,$q,$filter,PlanService,CommonServiceTerm){$rootScope.isMobileDevice&&($scope.topCities=GenericService.getTopCitiesList()),$scope.cityModal={isVisible:!1},$scope.gender=[{value:1,displayValue:"Mr."},{value:2,displayValue:"Ms."}],$scope.filterMobileSortObj={defaultSort:!0,claimSetteled:!1,premiumSort:!1},$scope.getDObArrayObj=function(){return{date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()}},$scope.changeDOB=function(){$scope.filterQuotesObj.dob=$scope.filterQuotesObjDate.dobDate+"-"+$scope.filterQuotesObjDate.dobMonth+"-"+$scope.filterQuotesObjDate.dobYear},$scope.isDOBMissing=function(){return!$scope.filterQuotesObjDate.dobDate||!$scope.filterQuotesObjDate.dobMonth||!$scope.filterQuotesObjDate.dobYear},$scope.isValidDateOfBirth=function(){return $scope.filterQuotesObj.dob&&GenericService.isValidDateOfBirth($scope.filterQuotesObj.dob)||!1},$scope.isAgeBelowMinimum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.filterQuotesObj.dob)<18},$scope.isAgeAboveMaximum=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.filterQuotesObj.dob)>65},$scope.isValidAge=function(){return!$scope.isDOBMissing()&&$scope.isValidDateOfBirth()&&CommonServiceTerm.getAge($scope.filterQuotesObj.dob)>=18&&CommonServiceTerm.getAge($scope.filterQuotesObj.dob)<=65},$scope.isYearSelected=function(index,dobYear){return index==$scope.getDObArrayObj().year.indexOf(parseInt(dobYear))},$scope.isValidMonthlyIncome=function(){return!!$rootScope.cancerJourney||$scope.filterQuotesObj.monthlyIncome&&1*$scope.filterQuotesObj.monthlyIncome>=1e4&&1*$scope.filterQuotesObj.monthlyIncome<=2e6};var minAllowedPolicyCoverage=function(){if(angular.isDefined($scope.filterQuotesObj)){var minPolicyTerm=10;return parseInt($scope.filterQuotesObj.customerAge,10)+minPolicyTerm}};$scope.isValidPolicyCoverage=function(){return $rootScope.cancerJourney?$scope.filterQuotesObj.policyCoverage&&$scope.filterQuotesObj.policyCoverage>=5+$scope.filterQuotesObj.customerAge&&$scope.filterQuotesObj.policyCoverage<=$scope.maxTerm:$scope.filterQuotesObj.policyCoverage&&1*$scope.filterQuotesObj.policyCoverage>=minAllowedPolicyCoverage()&&1*$scope.filterQuotesObj.policyCoverage<=$scope.maxAllowedPolicyCoverage},$scope.isValidTotalPayout=function(){return $rootScope.cancerJourney?CommonServiceTerm.isValidAmount(1*$scope.filterQuotesObj.totalPayout,!1,!0):!!$scope.filterQuotesObj.totalPayout&&($rootScope.pTabName.tropPlans?1*$scope.filterQuotesObj.totalPayout>=15e5&&1*$scope.filterQuotesObj.totalPayout<=2e8:1*$scope.filterQuotesObj.totalPayout>=1e6&&1*$scope.filterQuotesObj.totalPayout<=2e8)},$scope.changeTabCallback=function(tab){$scope.filterQuotesObjMonthly=1*$scope.tabMobile.filterQuotesObjTab===2},$scope.toggleCityModal=function(flag){flag||$scope.filterQuotesObj.cityId||($scope.filterQuotesObj.city=null),$timeout(function(){$scope.cityModal.isVisible=flag},50)},$scope.topCitySelectcallback=function(data){void 0!==$scope.filterQuotesObj.city&&null!==$scope.filterQuotesObj.city||($scope.filterQuotesObj.city={}),$scope.filterQuotesObj.cityId=data.id||data.cityId,$scope.filterQuotesObj.city=data.state?data.name+" ("+data.state+")":data.name,$scope.filterQuotesObj.stateId=data.stateId,$scope.filterQuotesObj.state=data.state,$rootScope.isMobileDevice&&$scope.toggleCityModal(!1)};var filterCity=function(cityList,searchText){searchText=angular.lowercase(searchText);var filteredList=_.filter(cityList,function(value,index){if(angular.lowercase(value.name).substr(0,searchText.length).indexOf(searchText)>=0)return value.name});if(angular.lowercase(searchText).substr(0,searchText.length).indexOf("del")>=0){var newDelhiObject={id:"551",name:"New Delhi(Delhi)",stateId:"35",state:"Delhi"};filteredList.unshift(newDelhiObject)}return filteredList};$scope.changeCity=function(searchText){return!angular.isUndefined(searchText)&&($scope.filterQuotesObj.cityId=null,void($scope.filteredCityList=filterCity($scope.city,searchText)))},$scope.resetAllFilter=function(){$scope.filterQuotesObj=angular.copy($scope.$parent.modifySelection),$rootScope.cancerJourney?$scope.tabMobile.filterQuotesObjTab=angular.copy($scope.tab.tabValue):($scope.filterQuotesObjRiders=angular.copy($scope.$parent.types),$scope.filterQuotesObjType={},$scope.filterQuotesObjType.payType=angular.copy($scope.$parent.type.payType),$scope.filterQuotesObjMonthly=1*$scope.tabMobile.filterQuotesObjTab===2,$rootScope.pTabName.onetimePlans||$rootScope.pTabName.allPlans?$scope.tabMobile.filterQuotesObjTab="1":$rootScope.pTabName.monthlyPlans?$scope.tabMobile.filterQuotesObjTab="2":$rootScope.pTabName.tropPlans&&($scope.tabMobile.filterQuotesObjTab="4")),$scope.filterQuotesObjDate=CommonServiceTerm.extractDOB($scope.filterQuotesObj.dob),$scope.filterReverseDataMobile=angular.copy($scope.$parent.reverseData)};var isProfileDetailsUpdated=function(){$scope.mobileSectionUpdateStatus.profile=!1;var tobaccoChanged=$scope.filterQuotesObj.isTobaccoUser!=$scope.$parent.modifySelection.isTobaccoUser,dobChanged=$scope.filterQuotesObj.dob!=$scope.$parent.modifySelection.dob,nameChanged=$scope.filterQuotesObj.name!=$scope.$parent.modifySelection.name,genderChanged=$scope.filterQuotesObj.gender!=$scope.$parent.modifySelection.gender,cityChanged=$scope.filterQuotesObj.city!=$scope.$parent.modifySelection.city,annualIncomeChanged=1*$scope.filterQuotesObj.annualIncome!==$scope.$parent.modifySelection.annualIncome;(tobaccoChanged||dobChanged||nameChanged||genderChanged||cityChanged||annualIncomeChanged)&&($scope.mobileSectionUpdateStatus.profile=!0,pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,event:"On Edit Profile click",pageName:"Quotes",Click:"Click"}))},isCustomerSelectionUpdated=function(){$scope.mobileSectionUpdateStatus.selection=!1,$scope.mobileSectionUpdateStatus.coverage=!1;var totalPayoutChanged=$scope.filterQuotesObj.totalPayout!=$scope.$parent.modifySelection.totalPayout,monthlyPayoutChanged=$scope.filterQuotesObj.monthlyIncome!=$scope.$parent.modifySelection.monthlyIncome,coverageChanged=$scope.filterQuotesObj.policyCoverage!=$scope.$parent.modifySelection.policyCoverage;(totalPayoutChanged||monthlyPayoutChanged||coverageChanged)&&($scope.mobileSectionUpdateStatus.selection=!0,totalPayoutChanged?(pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,event:"On Payout click",pageName:"Quotes",previous_payout:$scope.modifySelection.totalPayout,new_payout:$scope.filterQuotesObj.totalPayout}),gaTagsNew.populateDataToTrackOnSave($scope.filterQuotesObj,"totalPayout",$cookies.get("pTabName"))):(pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,event:"On Payout click",pageName:"Quotes",previous_payout:$scope.modifySelection.monthlyIncome,new_payout:$scope.filterQuotesObj.monthlyIncome}),gaTagsNew.populateDataToTrackOnSave($scope.filterQuotesObj,"monthly",$cookies.get("pTabName"))),coverageChanged&&($scope.mobileSectionUpdateStatus.coverage=!0,gaTagsNew.populateDataToTrackOnSave($scope.filterQuotesObj,"payTerm",$cookies.get("pTabName")),pbTrackerObj.logEvent({leadId:$scope.preQuotesInfo.matrixLeadId,visitId:$scope.modifySelection.visitId,event:"On Coverage period click",pageName:"Quotes",previous_coverage:$scope.modifySelection.policyCoverage,new_coverage:$scope.filterQuotesObj.policyCoverage})))},isPayTypeUpdated=function(){$scope.mobileSectionUpdateStatus.paytype=!1;var payTypeChanged=$scope.filterQuotesObjType.payType!=$scope.$parent.type.payType;payTypeChanged&&($localStorage.payOptionType=$scope.filterQuotesObjType.payType,$scope.mobileSectionUpdateStatus.paytype=!0)},isRidersUpdated=function(){$scope.mobileSectionUpdateStatus.riders=!1,_.each($scope.filterQuotesObjRiders,function(val,index){val.status!=$scope.$parent.types[index].status&&($scope.mobileSectionUpdateStatus.riders=!0,gaTagsNew.trackRiderSelectQuotes(val.name,val.status,$scope.modifySelection.custId)),1*val.id!==13||$scope.isSpouseAdded($scope.filterQuotesObj)||(val.status=!1)})},isTabUpdated=function(){if($scope.mobileSectionUpdateStatus.tab=!1,$scope.tabMobile.filterQuotesObjTab!=$scope.tab.tabValue){if($scope.tab.tabValue=$scope.tabMobile.filterQuotesObjTab,
$rootScope.cancerJourney){$scope.pTabName={cancer:1*$scope.tab.tabValue===1,heart:1*$scope.tab.tabValue===2,comprehensive:1*$scope.tab.tabValue===3};var planType=$scope.tab.tabValue;$localStorage.cancerPlanType=planType}else 1*$scope.tab.tabValue===1?($rootScope.pTabName.onetimePlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1):1*$scope.tab.tabValue===2?($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.tropPlans=!1):1*$scope.tab.tabValue===3?($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!0,$rootScope.pTabName.tropPlans=!1):1*$scope.tab.tabValue===4&&($rootScope.pTabName.tropPlans=!0,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1);$scope.mobileSectionUpdateStatus.tab=!0}},closePayoutEditField=function(fieldName){"monthlyPayout"===fieldName?$scope.isValidMonthlyIncome()&&$scope.$parent.handleMonthlyIncomeFocusBlur("isReadable"):"totalPayout"===fieldName?$scope.isValidTotalPayout()&&$scope.$parent.handlePayoutFocusBlur("isReadable"):"policyCoverage"===fieldName&&$scope.isValidPolicyCoverage()&&$scope.$parent.handlePolicyDurationFocusBlur("isReadable")};$scope.disableApplyButton=function(){var disable=!1;return $scope.isValidMonthlyIncome()&&$scope.isValidTotalPayout()&&$scope.isValidPolicyCoverage()&&$scope.filterQuotesObj.name||(disable=!0),$scope.groupTermJourney&&$scope.filterQuotesObj.name&&$scope.filterQuotesObj.city&&(disable=!1),disable},$scope.payoutBlurEvent=function(fieldName){closePayoutEditField(fieldName)},$scope.changeSortingParams=function(type){"premium"===type?$scope.filterMobileSortObj={defaultSort:!1,claimSetteled:!1,premiumSort:!0}:"claims"===type?$scope.filterMobileSortObj={defaultSort:!1,claimSetteled:!0,premiumSort:!1}:$scope.filterMobileSortObj={defaultSort:!0,claimSetteled:!1,premiumSort:!1}};var changeInJointLifeRiderMobile=function(status){!$scope.isSpouseAdded($scope.filterQuotesObj)&&status&&$scope.toggleModal("spouse","show")};$scope.riderSelectCallbackMobile=function(id,status){13==id&&changeInJointLifeRiderMobile(status)},$scope.changeInPayTillSixty=function(status){status||($scope.filterQuotesObjType.payType=3)};var updateQuotes=function(){$scope.mobileSectionUpdateStatus.profile||$scope.mobileSectionUpdateStatus.selection?($scope.isQuotesLoaded=!1,$scope.updateProfileDetails(!0)):$rootScope.cancerJourney?$scope.$parent.changeTabRadio():$scope.mobileSectionUpdateStatus.riders?$scope.mobileSectionUpdateStatus.paytype?$scope.$parent.changePayType():$scope.$parent.changeInRiderSelect():$scope.mobileSectionUpdateStatus.paytype?$scope.$parent.changePayType():$scope.mobileSectionUpdateStatus.tab?$scope.changeTabRadio():$scope.$parent.changeSingleSorting()};$scope.applyFilter=function(){$scope.disableApplyButton()?CommonServiceTerm.scrollToError():($scope.isCustomerDataLoaded=!1,$scope.isQuotesLoaded=!1,!$rootScope.cancerJourney&&$scope.riderAddOns.payTillSixtyChecbox&&($scope.filterQuotesObjType.payType=3,$scope.preQuotesInfo.policyCoverage<=60&&($scope.filterQuotesObj.policyCoverage=65)),!$rootScope.cancerJourney&&$scope.riderAddOns.wholeLifeChecbox&&($scope.filterQuotesObj.policyCoverage=99),isProfileDetailsUpdated(),isCustomerSelectionUpdated(),isTabUpdated(),$rootScope.cancerJourney||(isPayTypeUpdated(),isRidersUpdated(),$scope.$parent.updatePayType($scope.filterQuotesObjType.payType),$scope.$parent.updateTypes($scope.filterQuotesObjRiders)),$scope.$parent.updateReverseData($scope.filterReverseDataMobile),$scope.$parent.updateModifySelection($scope.filterQuotesObj),updateQuotes(),$scope.toggleFilterMobile("hide"))}}]),function(){function quotesController($scope,$rootScope,$location,$mdToast,$routeParams,$timeout,$cookies,$localStorage,GenericService,CustomerService,QuotesService,$q,$filter,PlanService,ServerUtilityService,CommonServiceTerm,CompareService,$document,$window,$sce,RiderService,PreQuotesService){function resetCity(countryCodeId,isPageLoad){vm.modifySelection.city||(vm.modifySelection.city={}),392!=countryCodeId&&(vm.modifySelection.city.id=9999,vm.modifySelection.city.name="Others",vm.modifySelection.city.stateId=99)}function toggleSortingKey(filterArrayLocal){var allMonthlyPremiumIndex,allTotalPremiumIndex,excludeFromMonthlySortingIndex;return vm.quotesObj.isMonthly?(allTotalPremiumIndex=filterArrayLocal.indexOf("allTotalPremium"),allTotalPremiumIndex>-1&&filterArrayLocal.splice(allTotalPremiumIndex,0,"allMonthlyPremium"),allTotalPremiumIndex=filterArrayLocal.indexOf("-allTotalPremium"),allTotalPremiumIndex>-1&&filterArrayLocal.splice(allTotalPremiumIndex,0,"-allMonthlyPremium"),filterArrayLocal.splice(0,0,"excludeFromMonthlySorting")):(allMonthlyPremiumIndex=filterArrayLocal.indexOf("allMonthlyPremium"),allMonthlyPremiumIndex>-1&&filterArrayLocal.splice(allMonthlyPremiumIndex,1),allMonthlyPremiumIndex=filterArrayLocal.indexOf("-allMonthlyPremium"),allMonthlyPremiumIndex>-1&&filterArrayLocal.splice(allMonthlyPremiumIndex,1),excludeFromMonthlySortingIndex=filterArrayLocal.indexOf("excludeFromMonthlySorting"),excludeFromMonthlySortingIndex>-1&&filterArrayLocal.splice(excludeFromMonthlySortingIndex,1)),filterArrayLocal}function showMessageForCoverageSort(){var isNRI=1*vm.modifySelection.countryId!=392;vm.messageIndex=[],null!==filterChanged.match("Coverage")?(_.each(vm.quotes,function(quote,index){1*quote.newCoverageUpto===vm.modifySelection.policyCoverage&&(vm.messageIndex[0]=index)}),_.each(vm.newQuotes,function(quote,index){1*quote.newCoverageUpto===vm.modifySelection.policyCoverage&&(vm.messageIndex[1]=index)})):vm.messageIndex=[],isNRI&&(vm.quotes=QuotesService.showNriPlansSeperation(vm.quotes,vm.isNonTropPlanVisible),vm.newQuotes=QuotesService.showNriPlansSeperation(vm.newQuotes,vm.isNonTropPlanVisible))}function removeAllRidersSelected(){var isAnyTrue=!1;_.each(vm.types,function(val){val.status&&(isAnyTrue=!0,val.status=!1)}),optimizeRiderService?addRiderValuesToThePlans():isAnyTrue&&callRiderChangeCategoryList(),isAnyTrue&&callRiderChangeCategoryList()}function postProcessPlans(){vm.object.showLoader=!1,vm.showDummyQuotes=!1,vm.setToDefault(),vm.quotes=GenericService.setRiderObject(vm.quotes,vm.preQuotesInfo,vm.quotesObj.isMonthly),vm.newQuotes=GenericService.setRiderObject(vm.newQuotes,vm.preQuotesInfo,vm.quotesObj.isMonthly),vm.checked.disableRadio=!0,$scope.$$phase||$scope.$apply(),callAndUpdateRiders()}function callAndUpdateRiders(){riderUpdateCall().then(function(){vm.isAllRiderLoaded=!0,executeCommonScript(),callIndiInusrerFunc(quotes);var selectedRiders=getSelectedRidersList();sudoSelectedRiderList=angular.copy(selectedRiders),vm.quotes=GenericService.getRidersPremiumForQuotes(vm.quotes,vm.types,vm.quotesObj.isMonthly),vm.newQuotes.length>0?(vm.newQuotes=GenericService.getRidersPremiumForQuotes(vm.newQuotes,vm.types,vm.quotesObj.isMonthly),vm.checked.disableRadio=!1):vm.checked.disableRadio=!1,optimizeRiderService?addRiderValuesToThePlans(!0):selectedRiders.length>0&&addRiderValuesToThePlans(),1*vm.type.payType!==1||$localStorage.AgentId||$timeout(function(){if(!$cookies.get("showOverlapShown")){var expireDate=new Date;expireDate.setTime(expireDate.getTime()+36e5),$cookies.put("showOverlapShown",!0,{expires:expireDate}),vm.showOverlap=!0}$timeout(function(){vm.showOverlap=!1},5e3)},500)})}function getSelectedRidersList(){var selectedRiders=[];return _.each(vm.types,function(val){val.status&&(15==val.id&&selectedRiders.push(20),selectedRiders.push(val.id))}),selectedRiders}function assignRiderPremiums(quotes,riderPremiumRespone){for(var i=0;i<=quotes.length;i++)"undefined"!=typeof quotes[i]&&(quotes[i]=RiderService.assignRiderPremiums(quotes[i],riderPremiumRespone,vm.quotesObj));return quotes}function riderUpdateCall(){var deferred=$q.defer();if($localStorage.AgentId&&vm.isLocalIP&&!vm.isNRI)if(void 0!==$cookies.get("CustomerEligibility")){var custData=JSON.parse($cookies.get("CustomerEligibility"));custData.enquiryId!=vm.enquiryId&&vm.editCustomerEligibility()}else vm.editCustomerEligibility();return optimizeRiderService?RiderService.getRidersPremium(vm.quotes,vm.preQuotesInfo).then(function(response){$timeout(function(){$routeParams.isProgressiveJourney&&7!==vm.preQuotesInfo.annualIncome&&(vm.customizeVisible=!0),vm.customizeVisible&&$timeout(function(){vm.shrinkCustomizeStachel=!0,$timeout(function(){vm.showRidersSuggestionStachel=!0},1e3)},1e4)},1500),vm.quotes=assignRiderPremiums(vm.quotes,RiderService.formatRiderPremiumResponse(response.data)),vm.newQuotes.length>0?RiderService.getRidersPremium(vm.newQuotes,vm.preQuotesInfo).then(function(response){vm.newQuotes=assignRiderPremiums(vm.newQuotes,RiderService.formatRiderPremiumResponse(response.data)),deferred.resolve()}):deferred.resolve()}):getDefaultRidersPremium(vm.quotes).then(function(data){vm.quotes=angular.copy(data),vm.newQuotes.length>0?getDefaultRidersPremium(vm.newQuotes).then(function(newData){vm.newQuotes=angular.copy(newData),deferred.resolve()}):deferred.resolve()}),deferred.promise}function getDefaultRidersPremium(quotes){var deferred=$q.defer(),requestArray=[];return _.each(quotes,function(quote){818==quote.Plan_Id&&[819,820,821].forEach(function(val){var tempQuote=angular.copy(quote);tempQuote=GenericService.modifyAegonItermPlusPlanDetails(tempQuote,val),tempQuote.riderIdCategory&&tempQuote.riderIdCategory.length>0&&tempQuote.isQuotesVisible&&requestArray.push(QuotesService.createDefaultRiderCallRequest(tempQuote,vm.preQuotesInfo))}),quote.riderIdCategory&&quote.riderIdCategory.length>0&&quote.isQuotesVisible&&requestArray.push(QuotesService.createDefaultRiderCallRequest(quote,vm.preQuotesInfo))}),QuotesService.getAllRiderValues(requestArray).success(function(response){_.each(quotes,function(quote){getValueForQuote(quote,response)}),deferred.resolve(quotes)}),deferred.promise}function getValueForQuote(quote,response){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id),isPnbPlan=CommonServiceTerm.isPNBPlan(quote.Plan_Id),adbPremium={riderPremium:0,monthlyRiderPremium:0},ciPremium={riderPremium:0,monthlyRiderPremium:0},resp=response[quote.Plan_Id];_.each(quote.riderPremiumObject,function(rider){_.each(resp,function(resRider){resRider&&(1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium),isDHFLPlan&&1*resRider.categoryId==10&&(adbPremium.riderPremium+=resRider.riderPremium,adbPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium,adbPremium.riderSumAssured=resRider.riderSumAssured),isDHFLPlan&&1*resRider.categoryId==15&&(ciPremium.riderPremium+=resRider.riderPremium,ciPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium,ciPremium.riderSumAssured=resRider.riderSumAssured)),isPnbPlan&&1*resRider.categoryId==16&&(quote.sIRiderObj=angular.copy(resRider))),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,vm.quotesObj.isMonthly)}),isDHFLPlan&&110==rider.categoryId&&(rider.premium="LimitedPay"===quote.payOptionType?0:adbPremium.riderPremium+ciPremium.riderPremium,rider.monthlyPremium="LimitedPay"===quote.payOptionType?0:adbPremium.monthlyRiderPremium+ciPremium.monthlyRiderPremium,rider.ciSumAssured=ciPremium.riderSumAssured,rider.adbSumAssured=adbPremium.riderSumAssured)}),818==quote.Plan_Id&&(quote.adbObj={818:{premium:0,monthlyPremium:0,sumAssured:0},819:{premium:0,monthlyPremium:0,sumAssured:0}},_.each(quote.riderPremiumObject,function(rider){_.each(response[818],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId==10&&(quote.adbObj[818].premium=resRider.riderPremium,quote.adbObj[818].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[818].riderSumAssured=resRider.riderSumAssured)}),_.each(response[819],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(quote.adbObj[819].premium=resRider.riderPremium,quote.adbObj[819].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[819].riderSumAssured=resRider.riderSumAssured),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,vm.quotesObj.isMonthly)}),_.each(response[820],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,vm.quotesObj.isMonthly)}),_.each(response[821],function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,vm.quotesObj.isMonthly)})})),quote.isRiderLoaded=!0}function callIndiInusrerFunc(quotes){vm.aegonObj=_.find(quotes,function(val){return 1*val.Plan_Id===787});var hdfcObj=_.find(quotes,function(val){return 1*val.Plan_Id===849});hdfcObj&&(vm.baseHDFCPlanPremium.yearly=hdfcObj.ComboTotalPremium,vm.baseHDFCPlanPremium.monthly=hdfcObj.monthlyTotalPremium);var doNotCallSelection=function(supplierId){return!(!$cookies.get("pidWithSelection")||"donotcall"!=$cookies.get("pidWithSelection"))||(supplierId===termConfigObj.getBAXASupplier()||10===supplierId)};$cookies.get("pid")&&_.each(vm.quotes,function(quote){doNotCallSelection(quote.Supplier_Id)||GenericService.priorityObject[quote.Supplier_Id]!=$cookies.get("pid")||vm.saveQuoteSelection(quote)});var kotakPlan=(_.find(quotes,function(val){return 1*val.Supplier_Id===117}),_.find(quotes,function(val){return 1*val.Supplier_Id===3}));if(kotakPlan){var x=document.createElement("IFRAME"),styles="visibility:hidden;display:none";x.setAttribute("style",styles),x.setAttribute("src","https://insurance.kotak.com/einsurance/aggregators/kotakcookie.html"),x.setAttribute("height",0),x.setAttribute("width",0),document.body.appendChild(x),CommonServiceTerm.callKotakAttributionApi(vm.modifySelection,!1,kotakPlan)}}function callQuotesApi(){var lastQuestionAnswered=void 0!==$cookies.get("last_question_answered")?$cookies.get("last_question_answered"):"",response=vm.isCityPopupEnabled?"city":"professiontype";return!!(!$routeParams.isProgressiveJourney||"spouse"===lastQuestionAnswered||"annualincome"===lastQuestionAnswered||lastQuestionAnswered===response||$routeParams.LeadId&&$routeParams.AgentId)}function fetchMedicalGridData(preQuotesData){var input=buildQuotesInputObject(preQuotesData);$rootScope.pTabName.monthlyPlans&&(input.planSADetails=QuotesService.buildMonthlyMedicalGridData(vm.quotes)),QuotesService.getMedicalGridData(input).success(function(data,status,headers,config){return vm.medicalGridInfo=data,!angular.isDefined(data.status)||"failed"!=data.status&&"fail"!=data.status?angular.isDefined(data.msg)&&data.msg.indexOf("failed")>=0?void(vm.medicalGridData=[]):(vm.quotes=QuotesService.assignMedicalInfo(vm.quotes,data,vm.isAffiliates),void(vm.newQuotes.length>0&&(vm.newQuotes=QuotesService.assignMedicalInfo(vm.newQuotes,data,vm.isAffiliates)))):void(vm.medicalGridData=[])})}function hideQuestions(){vm.toggleModal("progressiveModal","hide"),$timeout(function(){vm.showRidersSuggestionStachel=!0},1e3)}function showQuestions(){vm.progressiveJourney.show=!0,vm.toggleModal("progressiveModal","show")}function sortDummyObject(dummyPlans){var dummyTop=dummyPlans.filter(function(dum){return 1*dum.Plan_Id==818||1*dum.Plan_Id==749||1*dum.Plan_Id==911}),dummyBottom=dummyPlans.filter(function(dum){return 1*dum.Plan_Id!=818&&1*dum.Plan_Id!=749&&1*dum.Plan_Id!=911});return dummyTop.concat(dummyBottom)}function toggleGroupTermJourney(){if(7!==vm.preQuotesInfo.annualIncome||vm.isNRI){var totalPayoutOptionTop=CommonServiceTerm.populateOptionsList(totalPayoutLimit(),9999999,5e5),totalPayoutOptionbottom=CommonServiceTerm.populateOptionsList(1e7,2e8,1e6);vm.totalPayoutOptions=totalPayoutOptionTop.concat(totalPayoutOptionbottom),vm.groupTermJourney=!1}else $timeout(function(){vm.totalPayoutOptions=[{name:5e4,id:5e4}];var list=CommonServiceTerm.populateOptionsList(1e5,3e6,1e5);vm.totalPayoutOptions=vm.totalPayoutOptions.concat(list),vm.totalPayoutOptions.push({name:35e5,id:35e4}),vm.groupTermJourney=!0,vm.reversePremiumType(!0),vm.tab.tabValue=1,vm.changeTabRadio()},0)}function showMdToast(message,timeDelay){var timeDelay=timeDelay||5e3;$mdToast.show($mdToast.simple().content(message).position(vm.getToastPosition()).hideDelay(timeDelay))}function verifyCustomerEligibility(input){var deferred=$q.defer(),saveEligibilityPostData={age:input.age,enquiryId:input.enquiryId,annualIncome:input.annualIncome,professionType:input.professionType,educationQualification:input.educationQualification};CustomerService.updateCustomerEligibilityData(saveEligibilityPostData).success(function(data,status,headers,config){}),$rootScope.pTabName.monthlyPlans&&(delete input.sumAssured,input.planIdInfoMap=CustomerService.buildEligibilityDataMonthly(vm.quotes));var expireDate=new Date;return expireDate.setDate(expireDate.getDate()+2),$cookies.put("CustomerEligibility",JSON.stringify({enquiryId:input.enquiryId,educationQualification:input.educationQualification,professionType:input.professionType,annualIncome:input.annualIncome}),{expires:expireDate}),CustomerService.checkCustomerEligibility(input,$rootScope.pTabName.monthlyPlans).success(function(data,status,headers,config){vm.customerEligibility=data,vm.quotes=QuotesService.assignCustomerEligibility(vm.quotes,data,$rootScope.pTabName.monthlyPlans),vm.newQuotes.length>0&&(vm.newQuotes=QuotesService.assignCustomerEligibility(vm.newQuotes,data,$rootScope.pTabName.monthlyPlans)),deferred.resolve(data)}),deferred.promise}function productPageRedirect(plan,planName,index){var isMobileDefault=!!$location.$$search.isMobileDefault;plan.payOptionType?"LimitedPay"===plan.payOptionType?$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:plan.ppt,isMobileDefault:isMobileDefault?"true":null}):$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,payOptionType:plan.payOptionType,ppt:1,isMobileDefault:isMobileDefault?"true":null}):(delete $localStorage.payOptionType,$location.path("/product/"+planName).search({tabName:$cookies.get("pTabName"),index:index,isMobileDefault:isMobileDefault?"true":null}))}function modifyRiderIds(plan){return plan.riderIdCategory&&plan.riderIdCategory.length>0&&_.each(plan.riderPremiumObject,function(rider){_.each(plan.riderIdCategory,function(planRiderIdCategory){if(rider.categoryId===planRiderIdCategory.catrgoryId){if(plan.selectedRiderIds){var riderIndex=plan.selectedRiderIds.indexOf(rider.riderId);riderIndex!=-1&&(plan.selectedRiderIds[riderIndex]=planRiderIdCategory.riderId)}rider.riderId=planRiderIdCategory.riderId}})}),plan}function proceed(plan,index){optimizeRiderService&&(plan=modifyRiderIds(plan));var isMobileDefault=!!$location.$$search.isMobileDefault,utmObject=($rootScope.utmSource?"&utm_source="+$rootScope.utmSource:"")+($rootScope.utmMedium?"&utm_medium="+$rootScope.utmMedium:"")+($rootScope.utmCampaign?"&utm_campaign="+$rootScope.utmCampaign:"")+($rootScope.utmTerm?"&utm_term="+$rootScope.utmTerm:"");pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Selection click",pageName:"Quotes",basicPremium:plan.BasicPremium,planId:plan.Plan_Id,supplierName:plan.Supplier_Name,supplierId:plan.Supplier_Id,planName:plan.Plan_Name,monthlyPremium:plan.monthlyTotalPremium?plan.monthlyTotalPremium:0,planShortName:plan.planShortName,click:"Click"}),vm.showRidersSuggestionStachel&&vm.previousRiderSelection.length>0&&vm.closeRestoreSessionMsg(),1*plan.Supplier_Id!==16&&1*plan.Supplier_Id!==116||CommonServiceTerm.callAttributionApi(vm.modifySelection,!1,plan),1*plan.Supplier_Id===5&&(0===ipAddress?QuotesService.getIp().success(function(data){ipAddress=data.ip,CommonServiceTerm.loadICICITracking([plan],vm.preQuotesInfo,ipAddress)}):CommonServiceTerm.loadICICITracking([plan],vm.preQuotesInfo,ipAddress)),gaTagsNew.quotesSelectionTrack("ProductSelect",plan,index+1,vm.modifySelection.custId);var custId=vm.modifySelection.custId||$cookies.get("custId")||-1;gtmObj.quotesSelection(plan,vm.modifySelection.matrixLeadId,custId,index,!1),vm.clickedPlanId=plan.Plan_Id,vm.setArrowLoaderObject(!1,!0),vm.planOrder=index+1,CustomerService.saveSelectedFilters(vm.enquiryId,vm.types,filterParam,vm.planOrder),vm.saveQuoteSelection(plan);var planIds=termConfigObj.getE2EPlanIds();if(angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1){var preQuotesInfoObj=angular.copy(vm.preQuotesInfo);preQuotesInfoObj.monthlyIncome=plan.monthlyIncome,preQuotesInfoObj.totalPayout=plan.TotalCover,preQuotesInfoObj.oneTimePayout=plan.OneTimePayout,preQuotesInfoObj.sumAssured=plan.SumAssured,preQuotesInfoObj.isMonthly=vm.quotesObj.isMonthly,preQuotesInfoObj.payOptionType=1*vm.type.payType===3?"Limited":1*vm.type.payType===2?"Single":"Regular",preQuotesInfoObj.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),CommonServiceTerm.setFilterTypes(vm.types);var totalPremium=vm.quotesObj.isMonthly?plan.BasicPremium:plan.BasicPremium;CommonServiceTerm.isAegonItermForeverPlan(plan.Plan_Id)&&1*vm.type.payType===3&&vm.modifySelection.customerAge<=60&&(vm.preQuotesInfo.customerAge&&plan.ppt&&vm.preQuotesInfo.customerAge+plan.ppt<65?plan.Plan_Id=8792:plan.Plan_Id=8791),PlanService.getInsurerDetails(preQuotesInfoObj,plan,vm.enquiryId,totalPremium).success(function(data,status,headers,config){var leadId=preQuotesInfoObj.matrixLeadId,isE2ePlan=plan.Plan_Id?termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)!=-1:void 0;if(leadId&&CommonServiceTerm.createRevisit({leadId:leadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:isE2ePlan?"E2eRedirect":"InsurerRedirect"}),data.InsurerDetails&&data.InsurerDetails.action&&"POST"===data.InsurerDetails.action){var redirectUrl="";if(void 0!==data.InsurerDetails.url&&null!==data.InsurerDetails.url&&""!==data.InsurerDetails.url)if(redirectUrl=data.InsurerDetails.url,CommonServiceTerm.isHdfc3dPlan(plan.Plan_Id))if(data.InsurerDetails.fields.isMobileDefault=""+isMobileDefault,plan.selectedRiderIds&&plan.selectedRiderIds.length>0)CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,vm.modifySelection,vm.type.payType).then(function(){var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));849!=plan.Plan_Id&&8491!=plan.Plan_Id&&8492!=plan.Plan_Id||(jInput=$("<input type='hidden'>"),jInput.attr("name","isExtrLifePlanSelected"),jInput.attr("value","yes"),jForm.append(jInput)),jForm.appendTo("body").submit()});else{var fields=data.InsurerDetails.fields,jForm=$('<form type="hidden"></form>'),jInput=$("<input type='hidden'>");if(jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html"),!CommonServiceTerm.isUndefinedOrNullOrEmpty(fields))for(key in fields)CommonServiceTerm.isUndefinedOrNullOrEmpty(data.InsurerDetails.fields[key])||"partnerTransactionId"==key||(jInput=$("<input type='hidden'>"),jInput.attr("name",key),jInput.attr("value",data.InsurerDetails.fields[key]),jForm.append(jInput));849!=plan.Plan_Id&&8491!=plan.Plan_Id&&8492!=plan.Plan_Id||(jInput=$("<input type='hidden'>"),jInput.attr("name","isExtrLifePlanSelected"),jInput.attr("value","yes"),jForm.append(jInput)),jForm.appendTo("body").submit()}else{var jForm=$('<form type="hidden"></form>');jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html");var jInput=$("<input type='hidden'>");if(jInput.attr("name","term"),jInput.attr("value",data.InsurerDetails.fields.term),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","do-you-smoke"),jInput.attr("value",data.InsurerDetails.fields.doyousmoke),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","monthly-payout"),jInput.attr("value",data.InsurerDetails.fields.monthlyincome),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","total-payout"),jInput.attr("value",data.InsurerDetails.fields.totalcover||data.InsurerDetails.fields.sumassured),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","one-time-payout"),jInput.attr("value",data.InsurerDetails.fields.onetimepayout),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","date-of-birth"),jInput.attr("value",data.InsurerDetails.fields.dateofbirth),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","gender"),jInput.attr("value",data.InsurerDetails.fields.gender),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","city"),jInput.attr("value",isMobileDefault?"":CommonServiceTerm.getCityName(data.InsurerDetails.fields.city,plan)),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","mobile"),jInput.attr("value",data.InsurerDetails.fields.mobile),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","cityid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.cityId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","stateid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.stateid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","custid"),jInput.attr("value",data.InsurerDetails.fields.custid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","firstname"),jInput.attr("value",data.InsurerDetails.fields.firstname),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","lumpsumbenefit"),jInput.attr("value",data.InsurerDetails.fields.lumpsumbenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","incomebenefit"),jInput.attr("value",data.InsurerDetails.fields.incomebenefit),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","email"),jInput.attr("value",data.InsurerDetails.fields.email),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","name"),jInput.attr("value",data.InsurerDetails.fields.name),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","agetillcovered"),jInput.attr("value",data.InsurerDetails.fields.agetillcovered),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","country"),jInput.attr("value",data.InsurerDetails.fields.country),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","basepremium"),jInput.attr("value",""),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","leadid"),jInput.attr("value",data.InsurerDetails.fields.leadId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","enquiryid"),jInput.attr("value",decodeURIComponent(data.InsurerDetails.fields.enquiryid)),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.cover?(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid0&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid0),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid1&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid1),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid2&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid2),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid3&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid3),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.sumAssured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumAssured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid4&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid4),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.middlename&&(jInput=$("<input type='hidden'>"),jInput.attr("name","middlename"),jInput.attr("value",data.InsurerDetails.fields.middlename),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.lastname&&(jInput=$("<input type='hidden'>"),jInput.attr("name","lastname"),jInput.attr("value",data.InsurerDetails.fields.lastname),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.planId&&(jInput=$("<input type='hidden'>"),jInput.attr("name","planId"),jInput.attr("value",data.InsurerDetails.fields.planId),jForm.append(jInput)),void 0!==data.InsurerDetails&&void 0!==data.InsurerDetails.fields&&"undefined"!=typeof data.InsurerDetails.fields.sumassured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercareterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-term"),jInput.attr("value",data.InsurerDetails.fields.cancercareterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.modeofpremium){jInput=$("<input type='hidden'>"),jInput.attr("name","mode-of-premium");var modeOfPremium=vm.quotesObj.isMonthly?"12":"1";jInput.attr("value",modeOfPremium),jForm.append(jInput)}"undefined"!=typeof data.InsurerDetails.fields.planoption&&(jInput=$("<input type='hidden'>"),jInput.attr("name","plan-option"),jInput.attr("value",data.InsurerDetails.fields.planoption),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercaretype&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-type"),jInput.attr("value",data.InsurerDetails.fields.cancercaretype),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.premiumpaymentterm&&(jInput=$("<input type='hidden'>"),
jInput.attr("name","premium-payment-term"),jInput.attr("value",data.InsurerDetails.fields.premiumpaymentterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.ppt&&(jInput=$("<input type='hidden'>"),jInput.attr("name","ppt"),jInput.attr("value",data.InsurerDetails.fields.ppt),jForm.append(jInput)),vm.setArrowLoaderObject(!0,!1),jForm.appendTo("body").submit()}else vm.setArrowLoaderObject(!0,!1)}else vm.setArrowLoaderObject(!0,!1),isE2ePlan?((CommonServiceTerm.isDHFLMonthlyPlan(plan.Plan_Id)||GenericService.isIPruSmartPlan(plan.Plan_Id)||GenericService.isTATASampoornaRakshaPlan(plan.Plan_Id)||GenericService.isMAXPlan(plan.Plan_Id)||CommonServiceTerm.isSbiEshieldPlan(plan.Plan_Id)||CommonServiceTerm.isKotakPlan(plan.Plan_Id)||CommonServiceTerm.isBSLIPlan(plan.Plan_Id)||CommonServiceTerm.isBaxaNewPlans(plan.Plan_Id)||[923,924].indexOf(plan.Plan_Id)!=-1)&&$rootScope.pTabName&&$rootScope.pTabName.monthlyPlans&&(vm.modifySelection.totalPayout=plan.TotalCover,([815,923,924].indexOf(plan.Plan_Id)!=-1||CommonServiceTerm.isBSLIPlan(plan.Plan_Id))&&(vm.modifySelection.totalPayout=plan.SumAssured),CustomerService.updateCustomerSelection(vm.modifySelection,vm.enquiryId).success(function(data,status,headers,config){})),plan.selectedRiderIds&&plan.selectedRiderIds.length>0?(CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,vm.modifySelection,vm.type.payType).then(function(){isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true"+utmObject:window.location=data.InsurerDetails.url})):isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true"+utmObject:window.location=data.InsurerDetails.url):isMobileDefault?window.location=data.InsurerDetails.url+"&isMobileDefault=true"+utmObject:window.location=data.InsurerDetails.url})}else openPlanDetail(plan,vm.planOrder);GenericService.isHDFCPlan(plan.Plan_Id)&&(planName=plan.Plan_Name)}function executeICICITracking(){0===ipAddress?QuotesService.getIp().success(function(data){ipAddress=data.ip,CommonServiceTerm.loadICICITracking(quotes,vm.preQuotesInfo,ipAddress)}):CommonServiceTerm.loadICICITracking(quotes,vm.preQuotesInfo,ipAddress)}function forceRiderSelect(id,status){var deferred=$q.defer();return _.each(vm.types,function(val){val.id==id&&(val.status=angular.copy(status))}),callRiderChangeCategoryList().then(function(){deferred.resolve()}),deferred.promise}function callRiderChangeCategoryList(){var deferred=$q.defer(),selectedRiders=getSelectedRidersList();return pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Select Riders click",pageName:"Quotes",selected_riders:selectedRiders,click:"Click"}),CommonServiceTerm.setRiderSelected(vm.modifySelection.custId,selectedRiders).success(function(data){deferred.resolve()}),deferred.promise}function addRiderValuesToThePlans(onPageLoad){var deferred=$q.defer();vm.checked.disableRadio=!0;var selectedRiders=getSelectedRidersList();return onPageLoad&&selectedRiders.length>0?(vm.setArrowLoaderObject(!1,!0),vm.addOn={isClicked:!0}):onPageLoad||(vm.setArrowLoaderObject(!1,!0),vm.addOn={isClicked:!0}),optimizeRiderService?RiderService.addRiderValues(vm.quotes,selectedRiders,vm.quotesObj.isMonthly,vm.modifySelection,vm.enquiryId).then(function(data){var quotesData=GenericService.getRidersPremiumForQuotes(data,vm.types,vm.quotesObj.isMonthly);vm.quotes=GenericService.addADBOnATPBSelectForMAX(quotesData,selectedRiders),vm.newQuotes.length>0?RiderService.addRiderValues(vm.newQuotes,selectedRiders,vm.quotesObj.isMonthly,vm.modifySelection,vm.enquiryId).then(function(data){var newQuotesData=GenericService.getRidersPremiumForQuotes(data,vm.types,vm.quotesObj.isMonthly);vm.newQuotes=GenericService.addADBOnATPBSelectForMAX(newQuotesData,selectedRiders),vm.setArrowLoaderObject(!0,!1),vm.addOn={isClicked:!1},vm.checked.disableRadio=!1,deferred.resolve()}):(vm.setArrowLoaderObject(!0,!1),vm.addOn={isClicked:!1},vm.checked.disableRadio=!1,deferred.resolve())}):QuotesService.addRiderValues(vm.quotes,selectedRiders,vm.quotesObj.isMonthly,vm.modifySelection,vm.enquiryId).then(function(data){var quotesData=GenericService.getRidersPremiumForQuotes(data,vm.types,vm.quotesObj.isMonthly);vm.quotes=GenericService.addADBOnATPBSelectForMAX(quotesData,selectedRiders),vm.newQuotes.length>0?QuotesService.addRiderValues(vm.newQuotes,selectedRiders,vm.quotesObj.isMonthly,vm.modifySelection,vm.enquiryId).then(function(data){var newQuotesData=GenericService.getRidersPremiumForQuotes(data,vm.types,vm.quotesObj.isMonthly);vm.newQuotes=GenericService.addADBOnATPBSelectForMAX(newQuotesData,selectedRiders),vm.setArrowLoaderObject(!0,!1),vm.addOn={isClicked:!1},vm.checked.disableRadio=!1,deferred.resolve()}):(vm.setArrowLoaderObject(!0,!1),vm.addOn={isClicked:!1},vm.checked.disableRadio=!1,deferred.resolve())}),deferred.promise}function callGTMImpression(){if(void 0!==vm.quotes){var allQuotes=vm.quotes.concat(vm.newQuotes);allQuotes.length>0&&gtmObj.quotesImpression(allQuotes,vm.preQuotesInfo.matrixLeadId,vm.preQuotesInfo.custId,!1)}}function clearComparePlans(){vm.comparePlanIds=[],CompareService.setComparePlanIds(vm.comparePlanIds),vm.comparePlans=[],pbTrackerObj.logEvent({leadId:vm.modifySelection.matrixLeadId,custId:vm.modifySelection.custId,visitId:vm.modifySelection.visitId,event:"Remove All Comparing Plans",pageName:"Quotes"}),setComparePlans(!1),CompareService.saveComparingPlanIds(vm.modifySelection.custId,vm.comparePlanIds)}function setComparePlans(comingBackFromComparePage){vm.comparePlanIds&&vm.comparePlanIds.length>2&&$rootScope.isMobileDevice&&(vm.comparePlanIds=vm.comparePlanIds.splice(0,2),CompareService.saveComparingPlanIds(vm.modifySelection.custId,vm.comparePlanIds));var ids=angular.copy(vm.comparePlanIds);vm.quotes=CompareService.markCompareSelectedPlans(vm.quotes,ids,comingBackFromComparePage),vm.newQuotes=CompareService.markCompareSelectedPlans(vm.newQuotes,ids,comingBackFromComparePage),comingBackFromComparePage&&updateCompareStachel()}function updateCompareStachel(){$rootScope.pTabName.monthlyPlans?(_.each(allPlansData,function(plan,index){checkForExistenceAndPush(plan)}),_.each(quotes,function(plan){checkForExistenceAndPush(plan)})):_.each(quotes,function(plan){checkForExistenceAndPush(plan)})}function checkForExistenceAndPush(plan){var planId=plan.Plan_Id||plan.planId,index=vm.comparePlanIds&&vm.comparePlanIds.length>0?vm.comparePlanIds.indexOf(planId):-1;index!=-1&&(CompareService.isPlanAlreadyPushedToStachel(vm.comparePlans,plan)||vm.comparePlans.length<vm.compareLimit&&(vm.comparePlans=CompareService.pushPlansToComparingList(vm.comparePlans,plan))),orderComparedPlans()}function orderComparedPlans(){vm.comparePlans&&vm.comparePlans.length>0&&vm.comparePlanIds&&vm.comparePlanIds.length>0&&_.each(vm.comparePlans,function(comparedPlan){comparedPlan.comparedOrder=vm.comparePlanIds.indexOf(comparedPlan.planId)}),vm.comparePlans=$filter("orderBy")(vm.comparePlans,["comparedOrder"])}var vm=this;$(".modal-backdrop").hide(),angular.element("body").removeAttr("style");var optimizeRiderService=termConfigObj.optimizeRiderService(),showChatBot=!1;vm.groupTermJourney=!1,vm.isReferralLead=!1,vm.visitUse=!!$location.$$search.visitUse&&$location.$$search.visitUse;var dummyCustId=termConfigObj.getFakeCustId();vm.isSpouseJourney=!!angular.isDefined($routeParams.isSpouseJourney)&&$routeParams.isSpouseJourney;var customizeAnnualIncomeArray=CommonServiceTerm.populateOptionsList(2e5,5e6,1e5);vm.isCityPopupEnabled=termConfigObj.showCityPopup()&&$cookies.get("custState"),vm.knowMorePlan,vm.progressiveJourney={show:!1,stage:"smoker",annualIncomeList:customizeAnnualIncomeArray,annualIncome:null,toLeft:!1,toRight:!1,secondVariant:!1,mobileNo:null,countryCode:392,otherCountryCode:null,smoker:null,visibleScreens:[],isNri:!1,spouse:null,city:null,cityName:vm.isCityPopupEnabled?$cookies.get("custState"):null},vm.countryCodes=[],vm.nriPlansSeperationMessage=QuotesService.nriPlansSeperationMessage,vm.minMobileNoLength=10,vm.maxMobileNoLength=10,vm.regexForMobileNo=new RegExp("^[6789]\\d{9}$"),$cookies.get("progressiveSecondVariant")&&(vm.progressiveJourney.secondVariant=!0),vm.progressiveJourney.secondVariant&&(vm.progressiveJourney.stage="mobile");var getCountryValidations=function(countryCodeId){GenericService.getRegexForCountry(countryCodeId).success(function(data,status,headers,config){if(data.regexInfo){vm.minMobileNoLength=data.regexInfo.minLength,vm.maxMobileNoLength=data.regexInfo.maxLength;var re=new RegExp(data.regexInfo.regex);vm.regexForMobileNo=re}else vm.minMobileNoLength=10,vm.maxMobileNoLength=10,vm.regexForMobileNo=new RegExp("^[6789]\\d{9}$")})},updateNRICountryInfo=function(countryCodeId){vm.isNRI=392!=countryCodeId,vm.isCountryOthers=999==countryCodeId,vm.progressiveJourney.isNri=vm.isNRI},setOtherCountryInfo=function(countryCodeId){resetCity(countryCodeId),vm.modifySelection.otherCountryCode=null};vm.getMobileNumberRegexForCountry=function(countryCodeId){setOtherCountryInfo(countryCodeId),updateNRICountryInfo(countryCodeId),getCountryValidations(countryCodeId),vm.progressiveJourney.countryCode=countryCodeId},vm.getCountryCode=function(countryCodeId){return void 0!==countryCodeId&&null!==countryCodeId||(countryCodeId=392,vm.modifySelection.countryId=392),vm.modifySelection.countryId=parseInt(vm.modifySelection.countryId),PreQuotesService.getCountryCode(vm.countryCodes,countryCodeId)},vm.changeCountryCode=function(){var countryCodeId=getCountryIdByCode(vm.modifySelection.otherCountryCode);countryCodeId?(vm.modifySelection.countryId=countryCodeId,getCountryValidations(countryCodeId),resetCity(countryCodeId,!1)):(vm.modifySelection.countryId=999,getCountryValidations(999),resetCity(999,!1)),vm.isNRI=91!=vm.modifySelection.otherCountryCode},vm.progressiveQuestionsLeft=function(){return vm.isSpouseJourney?"spouse"===vm.progressiveJourney.stage?vm.isNRI?1:vm.isCityPopupEnabled?2:1:"annualIncome"===vm.progressiveJourney.stage?vm.isNRI?2:vm.isCityPopupEnabled?4:3:"occupationType"===vm.progressiveJourney.stage?vm.isCityPopupEnabled?3:2:"city"===vm.progressiveJourney.stage?1:"smoker"===vm.progressiveJourney.stage?vm.isNRI?3:vm.isCityPopupEnabled?5:4:5:"annualIncome"===vm.progressiveJourney.stage?vm.isNRI?1:vm.isCityPopupEnabled?3:2:"city"===vm.progressiveJourney.stage?1:"occupationType"===vm.progressiveJourney.stage?vm.isCityPopupEnabled?2:1:"smoker"===vm.progressiveJourney.stage?vm.isNRI?2:vm.isCityPopupEnabled?4:3:4};var renderNonPriorityPlans;vm.showRidersSuggestionStachel=!1,vm.showDummyQuotes=!1,vm.showCallOutText=!1,$routeParams.showchatbot&&(showChatBot=!0,$rootScope.footerLoad=!1),vm.customizeVisible=!1;var pid=angular.isDefined($routeParams.pid)?$routeParams.pid:"";if(pid){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("pid",pid,{expires:expireDate})}$rootScope.isMobileDevice&&$location.path("quotes/"+$routeParams.enquiryId).replace(),$rootScope.quotesVariant=0,vm.totalPayoutOptions=[],vm.monthlyPayoutOptions=[],vm.coverageUptoOptions=[],vm.payTypeOptions=[{value:1,displayValue:"Regular"},{value:2,displayValue:"Single Pay"},{value:3,displayValue:"Limited Pay"}],vm.payTypeOptions=[{value:1,displayValue:"Regular"},{value:2,displayValue:"Single Pay"},{value:3,displayValue:"Limited Pay"}],vm.payOutOptions=[{value:1,displayValue:"Lumpsum"},{value:2,displayValue:"Monthly"},{value:4,displayValue:"Return of Premium"}],vm.payTermOptions=[{value:5,displayValue:"5"},{value:10,displayValue:"10"},{value:15,displayValue:"15"},{value:20,displayValue:"20"}],vm.addOn={isClicked:!1},vm.isCallBackAlreadyInitiated=!0,vm.isAllRiderLoaded=!1,vm.quotesObj={isMonthly:void 0===$cookies.get("monthPrem")||"monthly"==$cookies.get("monthPrem")},vm.expressServiceText="Post sale customer queries will be resolved in the first call through a fast lane customer service team.",$rootScope.isMobileDevice&&(vm.quotesObj.isMonthly=!0),vm.previousRiderSelection=[];var previousSelectedRiderIds=[];vm.quotesUpdateInitiated=!1,vm.showCompareStachel=!1,vm.payTill60Clicked=!1,vm.tollFreeNumber="1800-419-7713";var sudoSelectedRiderList=[];vm.filterMobile=!1,vm.filterQuotesObj={},vm.filterQuotesObjType={},vm.filterQuotesObjDate={dobDate:null,dobMonth:null,dobYear:null},vm.filterReverseDataMobile={},vm.tabMobile={filterQuotesObjTab:"1"},vm.filterQuotesObjMonthly=!1,vm.mobileSectionUpdateStatus={profile:!1,selection:!1,paytype:!1,riders:!1,tab:!1,coverage:!1},vm.expressServiceText="Post sale customer queries will be resolved in the first call through a fast lane customer service team.",vm.baseHDFCPlanPremium={yearly:0,monthly:0},vm.hdfc3dPlanCollapsed=!1,vm.type={payType:$localStorage.payOptionType||1,ppt:$localStorage.selectedPayTerm&&"Pay Till 60"!=$localStorage.selectedPayTerm?$localStorage.selectedPayTerm:"10"},vm.annualIncomeEligibilityList=CommonServiceTerm.populateOptionsList(1e5,3e6,1e5),vm.annualIncomeList=[{id:6,name:"15 Lac +"},{id:5,name:"10-15 Lac"},{id:4,name:"7-10 Lac"},{id:3,name:"5-7 Lac"},{id:2,name:"3-5 Lac"},{id:8,name:"2-3 Lac"},{id:7,name:"< 2 Lac"}],vm.professionList=[{label:"Salaried",value:"Salaried"},{label:"Self-Employed",value:"Self-Employed"}],vm.qualificationList=[{label:"Graduate & above",value:"Graduate"},{label:"Diploma",value:"Diploma"},{label:"12th Pass",value:"Twelth_Pass"},{label:"10th Pass",value:"Tenth_Pass"}],vm.spouseAge=[{id:18,value:18},{id:19,value:19},{id:20,value:20},{id:21,value:21},{id:22,value:22},{id:23,value:23},{id:24,value:24},{id:25,value:25},{id:26,value:26},{id:27,value:27},{id:28,value:28},{id:29,value:29},{id:30,value:30},{id:31,value:31},{id:32,value:32},{id:33,value:33},{id:34,value:34},{id:35,value:35},{id:36,value:36},{id:37,value:37},{id:38,value:38},{id:39,value:39},{id:40,value:40},{id:41,value:41},{id:42,value:42},{id:43,value:43},{id:44,value:44},{id:45,value:45},{id:46,value:46},{id:47,value:47},{id:48,value:48},{id:49,value:49},{id:50,value:50},{id:51,value:51},{id:52,value:52},{id:53,value:53},{id:54,value:54},{id:55,value:55},{id:56,value:56},{id:57,value:57},{id:58,value:58},{id:59,value:59},{id:60,value:60},{id:61,value:61},{id:62,value:62},{id:63,value:63},{id:64,value:64},{id:65,value:65}],vm.annualIncomeError={status:!1,errorMessage:""},$cookies.put("changedOnce",!1);var ipAddress=0;vm.aegonObj={},vm.messageIndex=[];var premMode=vm.quotesObj.isMonthly?"monthly":"yearly";$cookies.put("monthPrem",premMode);var filterChanged="";vm.isAffiliates=!1;var saveJRFlags={};vm.isInternalIP=!0,vm.isLocalIP=!1;var jointLifeRiderClicked=!1;$location.$$search.refId;$rootScope.updateCss=!!$location.$$search.updCss,vm.customerInfoPreserved={},vm.customerEligibility={},vm.showCustEligibility=!1;var filteredPnb99Obj=[],filteredAegon100Obj=[];$location.$$search.refId&&($localStorage.enquiryId=$routeParams.enquiryId),$location.$$search.AgentId&&($localStorage.AgentId=$location.$$search.AgentId),$location.search("refId",null).replace(),gtmObj.callGAOnPageLoad($location.$$url);var parentTabName=$cookies.get("pTabName")||"",defaultProfile=(GenericService.planCategoryTextMappingObject(),{spouse:!1,child:!1}),filterParam="",policyChangedByClick=!1,defaultRiderPremiums=[],planIdsArray=[];vm.arrowName="";var resolvedFromCustomerCallback,quotes=[],allPlansData=[],dummyPlansExist=!1,dummyPlansReplaced=!1,callMultiple=QuotesService.callMultipleTimes()&&1*vm.type.payType===1;vm.quotes=[],vm.medicalGridInfo={},vm.newQuotes=[],vm.updateRidersCount=!1,vm.setToDefaultVisible=!1,vm.sortObj={},vm.progressiveQuotes={loading:!1},vm.comparePlanIds=[],vm.comparePlans=[],vm.compareLimit=$rootScope.isMobileDevice?2:5,vm.riderAddOns={wholeLifeChecbox:!1,payTillSixtyChecbox:!1},vm.sixtyYearRiderText="Pay till 60 years",vm.tenYearRiderText="Pay for 10 years",vm.reverseData=GenericService.reverseData(),vm.checked={},vm.checked.disableRadio=!1,vm.agentObj={},vm.filterArray=[],vm.showRiders={},vm.showRiders.showRidersToSelect=!1,vm.showRiders.showProfileToSelect=!1,vm.showOverlap=!1,vm.addonrecommendation={showRiderRecommendation:!1,showSelectedRider:!1,recommendedRiderNames:[],selectedRiderNames:[],selectedRiderIds:[],recommendedRiderIds:[],recommendedRiderNotes:[]},vm.recommendation={active:!1,selectedPlanSuggestion:!1,previouslySelectedPlans:[],previouslySelectedPlanIds:[]},vm.agentObj.isAgent=!0,$rootScope.enquiryId=CommonServiceTerm.getEnquiryId()||$routeParams.enquiryId,vm.enquiryId=CommonServiceTerm.getEnquiryId()||$routeParams.enquiryId,$rootScope.pageClass=$rootScope.isMobileDevice?"quotes-mobile":"quote",vm.showMobileChatButton=!1,vm.showPnb99Plan=termConfigObj.showPnb99Plan(),vm.types=[{key:"basic_critical_illness",status:!1,id:11,name:"Critical illness"},{key:"accidental_death",status:!1,id:10,name:"Death due to accident"},{key:"waiver_of_\tpremium",status:!1,id:38,name:" on Critical Illness or Accidental Disability"},{key:"accidental_disability",status:!1,id:12,name:"Disability due to accident"},{key:"hospitalization_benefit",status:!1,id:47,name:"Cash for hospitalization"},{key:"terminal_illness",status:!1,id:101,name:"Terminal Illness"},{key:"joint_life",status:!1,id:13,name:"Cover for spouse"},{key:"enchanced_critical_illness",status:!1,id:15,name:"Enhanced Critical Illness"},{key:"cancer_care",status:!1,id:14,name:"Cancer Cover"},{key:"heart_cancer_care",status:!1,id:18,name:"Heart and Cancer Cover"},{key:"critical_illness_rop",status:!1,id:20,name:"Critical Illness cover with Return of Premium"}],vm.riderCategoryNames=[{category_id:11,name:"Cover against critical illness"},{category_id:10,name:"Extra payout on accidental death"},{category_id:38,name:"Waiver of premium on critical illness or accidental disability"},{category_id:12,name:"Cover against accidental disability"},{category_id:47,name:"Cash for hospitalization"},{category_id:101,name:"Terminal illness"},{category_id:13,name:"Cover for spouse"},{category_id:15,name:"Enhanced critical illness"},{category_id:14,name:"Cancer cover"},{category_id:18,name:"Heart and cancer cover"},{category_id:20,name:"Critical Illness cover with Return of Premium"}],vm.riderDescription={11:"Cover 9 or fewer illnesses",10:"If death happens due to an accident, this rider offers you additional sum assured over and above the base sum assured.",38:"In case of critical illness or permanent disability, all future premiums are paid by the company on your behalf.",12:"In case of permanent disability, dismemberment (loss of the use of certain body parts) due to accident, this rider pays you regularly for next 5-10 yrs in a certain percentage of Sum Assured.",47:"In case of hospitalization, fixed per day benefit will be paid to you for each day of Hospitalization. This is a fixed amount not linked to the actual expenses incurred.",101:"Death benefit of the life assured shall be paid upon diagnosis of a Terminal Illness.",13:"",15:"Covers 10 or more illnesses",14:"Get a lumpsum benefit upon diagnosis of early or major stage of cancer.",18:"Get coverage against heart & cancer cover under the same plan.",paytill60:"Option to choose limited pay option, pay till 60 yrs & get coverage till 75 yrs of age.",wholelife:"Get life long protection & guaranteed payout on death.",20:""},vm.isSpouseWorking=null,vm.tab={},vm.tab.tabValue="1",vm.chatBotUrl="",vm.chatbotframe=!!showChatBot,$rootScope.footerLoad=!showChatBot,vm.isChatbotLoaded=!1,vm.filteredCityList=[],vm.termSwitchBackValue=null,$rootScope.pTabName={onetimePlans:!(!angular.isDefined($cookies.get("pTabName"))||"onetimePlans"!=$cookies.get("pTabName")),monthlyPlans:!(!angular.isDefined($cookies.get("pTabName"))||"monthlyPlans"!=$cookies.get("pTabName")),tropPlans:!(!angular.isDefined($cookies.get("pTabName"))||"tropPlans"!=$cookies.get("pTabName")),allPlans:!(!angular.isDefined($cookies.get("pTabName"))||"allPlans"!=$cookies.get("pTabName")),wholeLifePlans:!(!angular.isDefined($cookies.get("pTabName"))||"wholeLifePlans"!=$cookies.get("pTabName"))},vm.customizePlan={stage:1,direction:1,tab:vm.tab.tabValue,ciType:"none",accidentalDeathProtection:0,payType:1,highClaimSettlements:!1,annualIncomeList:customizeAnnualIncomeArray,apply:!1,minPlanPremium:680,fetchMsg:{status:!1,msg:"Calculating best quotes for you ... "},bannerText:[{heading:"",paragraph:""},{heading:"Term Life Insurance",paragraph:"Get a 1 Crore term insurance plan that covers against death, disease & disability for as low as"},{heading:"Term Life Insurance",paragraph:"Get a 1 Crore term insurance plan that covers against death, disease & disability for as low as"},{heading:"Term Life Insurance",paragraph:"Get a 1 Crore term insurance plan that covers against death, disease & disability for as low as"}]},($cookies.get("pid")&&(111==$cookies.get("pid")||31==$cookies.get("pid"))||$cookies.get("pid")==-1)&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!0,parentTabName="wholeLifePlans"),$cookies.get("pid")&&(vm.type.payType=1),$cookies.get("pidWithPayType")&&(vm.type.payType=$cookies.get("pidWithPayType")),vm.isContinue={disabled:!1},$rootScope.pTabName.onetimePlans?vm.tab.tabValue="1":$rootScope.pTabName.monthlyPlans?vm.tab.tabValue="2":$rootScope.pTabName.allPlans?vm.tab.tabValue="3":$rootScope.pTabName.tropPlans?vm.tab.tabValue="4":$rootScope.pTabName.wholeLifePlans?vm.tab.tabValue="5":($rootScope.pTabName.onetimePlans=!0,vm.tab.tabValue="1"),$rootScope.tabName={maxPayout:!(!angular.isDefined($cookies.get("tabName"))||"maxPayout"!=$cookies.get("tabName"))},$rootScope.tabName.maxPayout||($rootScope.tabName.maxPayout=!0),$rootScope.isMonthlyIncomeJourney&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1),$rootScope.profile=angular.isDefined($rootScope.profile)?$rootScope.profile:defaultProfile;var totalPayoutLimit=function(){return $rootScope.pTabName.tropPlans?15e5:1e6},totalPayoutOptionTop=CommonServiceTerm.populateOptionsList(totalPayoutLimit(),9999999,5e5),totalPayoutOptionbottom=CommonServiceTerm.populateOptionsList(1e7,2e8,1e6);vm.totalPayoutOptions=totalPayoutOptionTop.concat(totalPayoutOptionbottom),vm.monthlyPayoutOptions=CommonServiceTerm.populateOptionsList(3e4,2e6,1e4),vm.changeSorting=function(){var filterArrayLocal=vm.filterArray,payTillSixtyQuotes=[],coverageUptoQuotes=[];if(filterChanged.length>0&&(vm.setToDefaultVisible=!0,vm.sortObj.sortByDropdownValue=1,vm.filterArray=[filterChanged,"-Priority","allTotalPremium"],null===filterChanged.match("Coverage")||vm.reverseData.coverUptoReverse||($localStorage.filterArray=vm.filterArray)),_.each(vm.quotes,function(quote){delete quote.quoteHide,delete quote.showViewMorePlansLink,delete quote.showMore}),1*vm.type.payType!==1){var dividedQuotesArray=[],allQuotesDum=vm.quotes.concat(vm.newQuotes);dividedQuotesArray=GenericService.divideQuotesInTwo(allQuotesDum),vm.quotes=dividedQuotesArray[0],vm.newQuotes=dividedQuotesArray[1]}if(filterArrayLocal=vm.filterArray,null===filterChanged.match("allTotalPremium")&&(null!=filterChanged.match("Coverage")||filterArrayLocal.indexOf("allTotalPremium")==-1&&filterArrayLocal.indexOf("-allTotalPremium")==-1)||(filterArrayLocal=toggleSortingKey(filterArrayLocal)),null==filterChanged.match("Coverage")&&$localStorage.filterArray&&$localStorage.filterArray.length>0&&$localStorage.filterArray.indexOf("-newCoverageUpto")>-1&&filterArrayLocal.splice(0,0,"-newCoverageUpto"),vm.quotes=$filter("orderBy")(vm.quotes,filterArrayLocal),vm.sortingInitiated||(vm.quotes=QuotesService.groupByInsurer(vm.quotes),coverageUptoQuotes=vm.quotes.filter(function(quote){return!quote.newCoverageUpto||quote.newCoverageUpto!=vm.modifySelection.policyCoverage}),vm.quotes=vm.quotes.filter(function(quote){return quote.newCoverageUpto&&quote.newCoverageUpto==vm.modifySelection.policyCoverage}),vm.quotes=vm.quotes.concat(coverageUptoQuotes)),vm.newQuotes.length>0&&(vm.newQuotes=$filter("orderBy")(vm.newQuotes,filterArrayLocal),vm.sortingInitiated||(vm.newQuotes=QuotesService.groupByInsurer(vm.newQuotes))),1*vm.type.payType==3&&"Pay Till 60"!=$localStorage.selectedPayTerm&&(payTillSixtyQuotes=vm.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)>-1}),payTillSixtyQuotes&&payTillSixtyQuotes.length>0?payTillSixtyQuotes[0].message=!0:"",vm.quotes=vm.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)==-1}),vm.quotes=payTillSixtyQuotes&&payTillSixtyQuotes.length>0?vm.quotes.concat(payTillSixtyQuotes):vm.quotes),void 0!==vm.quotes){var allQuotes=vm.quotes.concat(vm.newQuotes);allQuotes.length>0&&(gtmObj.quotesImpression(allQuotes,vm.preQuotesInfo.matrixLeadId,vm.preQuotesInfo.custId,!1),showMessageForCoverageSort())}vm.updateRidersCount=!vm.updateRidersCount},vm.mobileFilterOpenTrack=function(value){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Filter click",pageName:"Quotes",click:"Click"}),gaTagsNew.payTypeChange("MobileFilterClick",value,vm.modifySelection.custId)},vm.toggleFilterMobile=function(value){var show="show"==value;show?(angular.copy(vm.preQuotesInfo,vm.modifySelection),vm.filterQuotesObj=angular.copy(vm.modifySelection),vm.filterQuotesObjRiders=angular.copy(vm.types),vm.filterQuotesObjType.payType=angular.copy(vm.type.payType),vm.filterQuotesObjDate=CommonServiceTerm.extractDOB(vm.filterQuotesObj.dob),vm.filterReverseDataMobile=angular.copy(vm.reverseData),vm.filterQuotesObjMonthly=$rootScope.pTabName.monthlyPlans,vm.filterQuotesObj.city=angular.copy(vm.selectedCityItem.name),$rootScope.pTabName.onetimePlans||$rootScope.pTabName.allPlans?vm.tabMobile.filterQuotesObjTab="1":$rootScope.pTabName.monthlyPlans?vm.tabMobile.filterQuotesObjTab="2":$rootScope.pTabName.tropPlans?vm.tabMobile.filterQuotesObjTab="4":$rootScope.pTabName.wholeLifePlans&&(vm.tabMobile.filterQuotesObjTab="5"),$rootScope.footerLoad=!1,vm.filterMobile=show):(vm.filterMobile=show,vm.handlePayoutFocusBlur("isReadable"),vm.handleMonthlyIncomeFocusBlur("isReadable"),vm.handlePolicyDurationFocusBlur("isReadable"),$timeout(function(){var someElement=angular.element("body").focus();someElement&&$document.scrollToElement(someElement,10,300)},100),$rootScope.footerLoad=!0)},vm.focusEditProfile=function(){$timeout(function(){var someElement=angular.element("#filter-edit-profile").focus();someElement&&$document.scrollToElement(someElement,10,300)},100)},vm.focusRiderSelection=function(){$timeout(function(){var someElement=angular.element("#divFeatureFilter").focus();someElement&&$document.scrollToElement(someElement,50,300)},100)},vm.hideShowPlans=function(plan,flag,$event){function start(counter){counter<15&&setTimeout(function(){counter++,window.scrollBy(0,20),start(counter)},50)}$(window).height()-$event.target.getBoundingClientRect().top<200&&start(0),_.each(vm.quotes,function(quote){quote.Supplier_Id==plan.Supplier_Id&&void 0!==quote.quoteHide&&null!==quote.quoteHide&&(quote.quoteHide=flag)}),_.each(vm.newQuotes,function(quote){quote.Supplier_Id==plan.Supplier_Id&&void 0!==quote.quoteHide&&null!==quote.quoteHide&&(quote.quoteHide=flag)}),plan.showMore=!flag},$routeParams.pTabName&&(angular.forEach($rootScope.pTabName,function(value,key){$rootScope.pTabName[key]=!1}),$rootScope.pTabName[$routeParams.pTabName]=!0,$cookies.put("pTabName",$routeParams.pTabName),angular.forEach($rootScope.tabName,function(value,key){$rootScope.tabName[key]=!1}),"allPlans"==$routeParams.pTabName&&($rootScope.tabName[$routeParams.tabName]=!0,$cookies.put("tabName",$routeParams.tabName)),$routeParams.pTabName=null,$routeParams.tabName=null,$rootScope.pTabName.onetimePlans?vm.tab.tabValue="1":$rootScope.pTabName.monthlyPlans?vm.tab.tabValue="2":$rootScope.pTabName.allPlans?vm.tab.tabValue="3":$rootScope.pTabName.tropPlans?vm.tab.tabValue="4":$rootScope.pTabName.wholeLifePlans?vm.tab.tabValue="5":($rootScope.pTabName.onetimePlans=!0,vm.tab.tabValue="1"),$location.url($location.path())),vm.changeSingleSorting=function(planId,showLoader){var filterArrayLocal=vm.filterArray,payTillSixtyQuotes=[],coverageUptoQuotes=[];if(filterChanged.length>0&&(planId=void 0,vm.setToDefaultVisible=!0,vm.sortObj.sortByDropdownValue=1,null==filterChanged.match("allTotalPremium")?vm.filterArray=[filterChanged,"-Priority","allTotalPremium"]:(showLoader&&$timeout(function(){vm.isQuotesLoaded=!1,vm.hideObject.quotes=!0},0),vm.filterArray=[filterChanged],vm.filterArray.push("-Priority")),null===filterChanged.match("Coverage")||vm.reverseData.coverUptoReverse||($localStorage.filterArray=vm.filterArray)),filterArrayLocal=vm.filterArray,null===filterChanged.match("allTotalPremium")&&(null!=filterChanged.match("Coverage")||filterArrayLocal.indexOf("allTotalPremium")==-1&&filterArrayLocal.indexOf("-allTotalPremium")==-1)||(filterArrayLocal=toggleSortingKey(filterArrayLocal)),null==filterChanged.match("Coverage")&&$localStorage.filterArray&&$localStorage.filterArray.length>0&&$localStorage.filterArray.indexOf("-newCoverageUpto")>-1&&filterArrayLocal.splice(0,0,"-newCoverageUpto"),1*vm.type.payType!==1){var dividedQuotesArray=[],allQuotesDum=vm.quotes.concat(vm.newQuotes);dividedQuotesArray=GenericService.divideQuotesInTwo(allQuotesDum),vm.quotes=dividedQuotesArray[0],vm.newQuotes=dividedQuotesArray[1]}if($rootScope.pTabName.onetimePlans)vm.quotes=$filter("orderBy")(vm.quotes,filterArrayLocal),vm.sortingInitiated||(vm.quotes=QuotesService.groupTropTogether(vm.quotes,planId),coverageUptoQuotes=vm.quotes.filter(function(quote){return!quote.newCoverageUpto||quote.newCoverageUpto!=vm.modifySelection.policyCoverage}),vm.quotes=vm.quotes.filter(function(quote){return quote.newCoverageUpto&&quote.newCoverageUpto==vm.modifySelection.policyCoverage}),vm.quotes=vm.quotes.concat(coverageUptoQuotes)),(1*vm.preQuotesInfo.policyCoverage>85||1*vm.preQuotesInfo.policyCoverage-1*vm.preQuotesInfo.customerAge>50)&&!vm.sortingInitiated&&(vm.quotes=QuotesService.groupWholeLifeTogether(vm.quotes,vm.preQuotesInfo.policyCoverage)),vm.newQuotes.length>0&&(vm.newQuotes=$filter("orderBy")(vm.newQuotes,filterArrayLocal));else if($rootScope.pTabName.tropPlans){if(vm.quotes=$filter("orderBy")(vm.quotes,filterArrayLocal),!vm.setToDefaultVisible){var indexOfAegonIreturn=vm.quotes.getIndexBy("Plan_Id",736),indexOfAegonItermForever=vm.quotes.getIndexBy("Plan_Id",879);indexOfAegonIreturn==-1||indexOfAegonItermForever==-1||vm.sortingInitiated||(vm.quotes=vm.quotes.move(indexOfAegonItermForever,indexOfAegonIreturn))}if(vm.newQuotes.length>0&&(vm.newQuotes=$filter("orderBy")(vm.newQuotes,filterArrayLocal),!vm.setToDefaultVisible)){var indexOfAegonIreturnNewQuotes=vm.newQuotes.getIndexBy("Plan_Id",736),indexOfAegonItermForeverNewQuotes=vm.newQuotes.getIndexBy("Plan_Id",879);indexOfAegonIreturnNewQuotes==-1||indexOfAegonItermForeverNewQuotes==-1||vm.sortingInitiated||(vm.newQuotes=vm.newQuotes.move(indexOfAegonItermForeverNewQuotes,indexOfAegonIreturnNewQuotes))}}else vm.quotes=GenericService.showMonthlyPremiumTop(vm.quotes,filterArrayLocal),vm.newQuotes.length>0&&(vm.newQuotes=GenericService.showMonthlyPremiumTop(vm.newQuotes,filterArrayLocal));if(1*vm.type.payType==3&&"Pay Till 60"!=$localStorage.selectedPayTerm&&(payTillSixtyQuotes=vm.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)>-1}),payTillSixtyQuotes&&payTillSixtyQuotes.length>0?payTillSixtyQuotes[0].message=!0:"",vm.quotes=vm.quotes.filter(function(quote){return QuotesService.payTillSixtySupplierIds.indexOf(quote.Supplier_Id)==-1}),vm.quotes=payTillSixtyQuotes&&payTillSixtyQuotes.length>0?vm.quotes.concat(payTillSixtyQuotes):vm.quotes),void 0!==vm.quotes){var allQuotes=vm.quotes.concat(vm.newQuotes);allQuotes.length>0&&(gtmObj.quotesImpression(allQuotes,vm.preQuotesInfo.matrixLeadId,vm.preQuotesInfo.custId,!1),
showMessageForCoverageSort())}showLoader&&$timeout(function(){vm.isQuotesLoaded=!0,vm.hideObject.quotes=!1},1e3),vm.updateRidersCount=!vm.updateRidersCount},vm.collapseAegon=function(){vm.checked.disableRadio||(vm.tab.tabValue=4,vm.changeTabRadio(),gaTagsNew.trackBlueStripClick("tropPlans"),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Blue Sliver - TROP click",pageName:"Quotes",click:"Click"}))},vm.getCountryList=function(){var detectedCountry;$rootScope.detectedCountry&&(detectedCountry=$rootScope.detectedCountry.toLowerCase()),CommonServiceTerm.getCountryCodes().then(function(data){vm.countryCodes=data,$routeParams.isProgressiveJourney&&detectedCountry&&"india"!=detectedCountry&&"zz"!=detectedCountry&&_.each(vm.countryCodes,function(countryObj){var country=countryObj.CountryName.toLowerCase();country.indexOf(detectedCountry)!=-1&&392!=countryObj.CountryCodeId&&vm.getMobileNumberRegexForCountry(countryObj.CountryCodeId)})})}(),vm.collapseWholeLife=function(eventName){vm.checked.disableRadio||(vm.tab.tabValue=5,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!0,vm.changeTabRadio(),gaTagsNew.trackBlueStripClick(eventName),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:"wholeLifePlans"===eventName?"On Blue Sliver - Whole Life click":"On Blue Sliver - PNB 99 Plan click",pageName:"Quotes",click:"Click"}))},vm.returnToOneTimeTab=function(){vm.checked.disableRadio||(vm.tab.tabValue=1,vm.changeTabRadio(),gaTagsNew.trackBlueStripClick("onetimePlans"))},vm.isAegonTropPlan=function(planId){return!!$rootScope.pTabName.onetimePlans&&GenericService.isAegoniReturnPlan(planId)},vm.isAegoniTermStickerVisible=function(planId,term){return term<75&&vm.isAegoniTermPlan(planId)},vm.isAegoniTermPlan=function(planId){return!!$rootScope.pTabName.onetimePlans&&GenericService.isAegoniTermPlan(planId)},vm.isCustomerDataLoaded=!1,vm.sortObj.sortByDropdownValue=15,vm.object={showArrow:!0,showLoader:!1},vm.setArrowLoaderObject=function(showArrow,showLoader){vm.object.showArrow=showArrow,vm.object.showLoader=showLoader},vm.setToDefault=function(clicked){if(vm.setToDefaultVisible=!1,vm.arrowName="",clicked&&(vm.riderAddOns.wholeLifeChecbox=!1,vm.riderAddOns.payTillSixtyChecbox=!1,filterChanged="",vm.sortObj.sortByDropdownValue=15,vm.setToDefaultVisible=!1,$localStorage.filterArray=null,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Set to default click",pageName:"Quotes",click:"Click"}),vm.customizePlan.apply=!1),clicked&&(vm.modifySelection.customerAge>=35&&1*vm.modifySelection.policyCoverage!==75||vm.modifySelection.customerAge<35&&1*vm.modifySelection.policyCoverage!==70)){var isAnyTrue=!1;_.each(vm.types,function(val){val.status&&(isAnyTrue=!0,val.status=!1)}),callRiderChangeCategoryList().then(function(){vm.modifySelection.customerAge<=50?vm.modifySelection.policyCoverage=60:vm.modifySelection.customerAge>50&&(vm.modifySelection.policyCoverage=vm.modifySelection.customerAge+10),vm.sortObj.sortByDropdownValue=1,vm.saveCustomerSelection()})}else{if(gaTagsNew.editProfileTrack("SetToDefault",-1,vm.modifySelection.custId),$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?(policyChangedByClick?(vm.filterArray=["-Priority","allTotalPremium"],filterParam="BasicPremium",vm.arrowName="BasicPremium"):($rootScope.profile.spouse||$rootScope.profile.child?vm.filterArray=["profileSort","-Priority","allTotalPremium"]:vm.filterArray=["-Priority","allTotalPremium"],filterParam="BasicPremium"),policyChangedByClick=!1):($rootScope.profile.spouse||$rootScope.profile.child?vm.filterArray=["profileSort","-Priority","CostPerLac","allTotalPremium"]:vm.filterArray=["-Priority","CostPerLac","allTotalPremium"],filterParam="CostPerLac"),!clicked&&!$rootScope.profile.spouse&&!$rootScope.profile.child){var sortByCoverage=!1;sortByCoverage=vm.preQuotesInfo.policyTerm>75||vm.preQuotesInfo.policyTerm>1*vm.preQuotesInfo.customerAge+40,!$rootScope.pTabName.wholeLifePlans||1*vm.modifySelection.policyCoverage!==99&&1*vm.modifySelection.policyCoverage!==100||(sortByCoverage=!1),$localStorage.filterArray&&(sortByCoverage?(vm.filterArray=$localStorage.filterArray,filterChanged="-newCoverageUpto"):(filterChanged="",vm.filterArray=["-Priority","allTotalPremium"]))}if($rootScope.pTabName.allPlans||$rootScope.pTabName.monthlyPlans)vm.changeSorting();else{var plnId=831;$cookies.get("pid")&&$cookies.get("pid")==termConfigObj.getBAXASupplier()&&(plnId=749),vm.changeSingleSorting(plnId)}vm.sortObj.sortByDropdownValue=15,vm.arrowName=vm.filterArray[0],GenericService.saveSortApplied(filterParam),clicked&&removeAllRidersSelected()}},vm.payout={isEditable:!1,isReadable:!0},vm.policyDuration={isEditable:!1,isReadable:!0},vm.monthlyIncome={isEditable:!1,isReadable:!0},vm.toastPosition={bottom:!1,top:!0,left:!1,right:!0},vm.spouse={tobacco:[{value:1,label:"Yes"},{value:0,label:"No"}],isWorking:[{value:1,label:"Yes"},{value:0,label:"No"}]},vm.genderOptions=[{value:1,label:"Male"},{value:2,label:"Female"}],vm.showLink={email:!0,callback:GenericService.isTimeWithRange(),emailback:!0,call:!1,showMobileChatButton:!1,showCallbackButton:!1,emailSubmitButton:!1},vm.toggleRidersFn=function(flag){if(vm.riderAddOns.wholeLifeChecbox&&vm.changePolicyTerm(!1,99),vm.isAllRiderLoaded&&(vm.showRiders.showRidersToSelect=flag,!flag&&(vm.payTill60Clicked&&vm.payTill60Click(),getSelectedRidersList().sort().join(",")!==sudoSelectedRiderList.sort().join(",")))){var selectedRiders=getSelectedRidersList();sudoSelectedRiderList=angular.copy(getSelectedRidersList()),callRiderChangeCategoryList(),vm.handleFilterEvents(flag),selectedRiders.length>0&&CommonServiceTerm.dropRiderSelectionCookie()}},vm.togglePayType=function(flag){vm.showPayType=flag},vm.changePayType=function(){var payType;switch(1*vm.type.payType){case 2:payType="Single";break;case 3:payType="Limited";break;default:payType="Regular"}clearComparePlans(),$localStorage.payOptionType=vm.type.payType,vm.mobileSectionUpdateStatus.riders&&callRiderChangeCategoryList(),gaTagsNew.payTypeChange("PayTypeFilterClick",payType,vm.modifySelection.custId),vm.isQuotesLoaded=!1,1*vm.type.payType==3&&vm.modifySelection.policyCoverage<65?(vm.quotes=[],vm.newQuotes=[],allPlansData=[],vm.modifySelection.policyCoverage=65,CustomerService.updateCustomerSelection(vm.modifySelection,vm.enquiryId).success(function(data,status,headers,config){"success"==data.status&&successCallbackCustomerSelection()})):vm.getQuotes(vm.preQuotesInfo),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:1*vm.type.payType===1?"On Regular Paytype click":1*vm.type.payType===2?"On Single Paytype click":"On Limted Paytype click",pageName:"Quotes",click:"Click"})},vm.onCloseLimitedPayoutProceed=function(){vm.toggleModal("term_popup_modal2","hide"),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:"Limited Payout Popup Proceed Close",pageName:"Quotes",click:"Click"}),vm.isQuotesLoaded=!1,vm.getQuotes(vm.preQuotesInfo)},vm.limitedPayoutProceed=function(){vm.toggleModal("term_popup_modal2","hide"),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:"Limited Payout Popup Proceed",pageName:"Quotes",click:"Click"}),vm.type.payType=3,vm.changePayType()},vm.toggleProfileFn=function(flag){vm.showRiders.showProfileToSelect=flag},vm.showChat={},vm.showChat.showMobileChatButton=!1,vm.showAddOnCoverHelpSection=!1,vm.planOrder=0,vm.citySearchText="",vm.city="",vm.cityerror=!1,vm.maxAllowedPolicyCoverage=vm.showPnb99Plan?99:85,vm.modifySelection=QuotesService.buildDefaultModifySelectionObject(),vm.data={dobDate:null,dobMonth:null,dobYear:null,qualification:null,annualIncome:null,professionType:null},vm.dob={date:GenericService.getDateList(),month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:GenericService.getYearList()},vm.hideObject={loadSummaryPage:!1,isNoQuotesPresent:!1,isTropNotPresent:!1,singleComparePlanMessage:!0,quotes:!1},vm.showAddOn=!1,vm.whatsThis={totalPayout:!1,policyCoverage:!1},vm.isQuotesLoaded=!1,vm.clickedPlanId=-1;var setContinueButtonDisabled=function(flag){vm.isContinue.disabled=flag};vm.toggleWhatsThis=function(keyName){vm.whatsThis[keyName]=!vm.whatsThis[keyName]},vm.showHideAddOn=function(flag){vm.showAddOn=flag},vm.changeDate=function(model){vm.data.dobDate=model,vm.changeDateOfBirth()},vm.changeMonth=function(model){vm.data.dobMonth=model,vm.changeDateOfBirth()},vm.changeYear=function(model){vm.data.dobYear=model,vm.changeDateOfBirth()},vm.changeDateOfBirth=function(){vm.modifySelection.dob=vm.data.dobDate+"-"+vm.data.dobMonth+"-"+vm.data.dobYear},vm.isYearSelected=function(index,dobYear){return index==vm.dob.year.indexOf(parseInt(dobYear))},vm.isDOBMissing=function(){return!vm.data.dobDate||!vm.data.dobMonth||!vm.data.dobYear},vm.isValidDateOfBirth=function(){return vm.modifySelection.dob&&GenericService.isValidDateOfBirth(vm.modifySelection.dob)},vm.isMAXPlan=function(plan){return CommonServiceTerm.isMAXPlan(plan.Plan_Id)},vm.isSbiPoornaSuraksha=function(plan){return CommonServiceTerm.isSbiPoornaSuraksha(plan.Plan_Id)},vm.isTataPlan=function(plan){return CommonServiceTerm.isTataPlan(plan.Plan_Id)},vm.AllowExpress=function(supplierId){var supplierIds=[5,10];return supplierIds.indexOf(1*supplierId)>-1},vm.isAgeBelowMinimum=function(){return!vm.isDOBMissing()&&vm.isValidDateOfBirth()&&CommonServiceTerm.getAge(vm.modifySelection.dob)<18},vm.isAgeAboveMaximum=function(){return!vm.isDOBMissing()&&vm.isValidDateOfBirth()&&CommonServiceTerm.getAge(vm.modifySelection.dob)>65},vm.isValidAge=function(){return!vm.isDOBMissing()&&vm.isValidDateOfBirth()&&CommonServiceTerm.getAge(vm.modifySelection.dob)>=18&&CommonServiceTerm.getAge(vm.modifySelection.dob)<=65};var changeTabVisibility=function(isMonthlyIncomeJourney){isMonthlyIncomeJourney&&($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1)};vm.preFillModifySelectionModel=function(data){vm.modifySelection=GenericService.buildModifySelectionModel(data,vm.enquiryId),extractDOB()};var getValue=function(value){return angular.isDefined(value)?value:null},extractDOB=function(){vm.data.dobDate=getValue(vm.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB(vm.modifySelection.dob,0):null,vm.data.dobMonth=getValue(vm.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB(vm.modifySelection.dob,1):null,vm.data.dobYear=getValue(vm.modifySelection.dob)?GenericService.extractDateMonthYearFromDOB(vm.modifySelection.dob,2):null},setSelectedCityItem=function(data){angular.copy(data,vm.selectedCityItem)};vm.onCityInputChange=function(){vm.cityerror=!0},vm.selectedCityCallBack=function($item,$model,$label,$event){vm.modifySelection.cityId=$item.cityId,vm.modifySelection.city=$item.value,vm.modifySelection.stateId=$item.stateId,vm.cityerror=!1},vm.toggleAddOnCoverSection=function(flag){flag&&gaTagsNew.editProfileTrack("RiderWhatisThis",-1,vm.modifySelection.custId),vm.showAddOnCoverHelpSection=flag,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:"On What are these? click",pageName:"Quotes",click:"Click"})},vm.minAllowedPolicyCoverage=function(){if(angular.isDefined(vm.preQuotesInfo)){var minPolicyTerm=10;return parseInt(vm.preQuotesInfo.customerAge,10)+minPolicyTerm}};var buildQuotesInputObject=function(data,nonPriorityPlans){var quotesInputObject=null,isSpouseAdded=vm.isSpouseAdded(data),isChildAdded=vm.isChildAdded(data),callMultiple=QuotesService.callMultipleTimes()&&1*vm.type.payType===1;return vm.isSpouseWorking=null,quotesInputObject=QuotesService.buildQuotesInputObject(data),$rootScope.profile.spouse&&isSpouseAdded&&$rootScope.profile.child&&isChildAdded?(quotesInputObject.policyTerm=QuotesService.getPolicyTermForSpouse(data),quotesInputObject.spouseAge=data.spouse.age,quotesInputObject.spouseTobacco=data.spouse.tobacco,quotesInputObject.isSpouseWorking=data.spouse.isWorking,quotesInputObject.childAge=data.child.age,vm.isSpouseWorking=data.spouse.isWorking):$rootScope.profile.spouse&&isSpouseAdded?(quotesInputObject.policyTerm=QuotesService.getPolicyTermForSpouse(data),quotesInputObject.spouseAge=data.spouse.age,quotesInputObject.spouseTobacco=data.spouse.tobacco,quotesInputObject.isSpouseWorking=data.spouse.isWorking,vm.isSpouseWorking=data.spouse.isWorking):$rootScope.profile.child&&isChildAdded&&(quotesInputObject.childAge=data.child.age,vm.isSpouseWorking=null),quotesInputObject.refId=$localStorage.enquiryId,quotesInputObject.stateId=data.stateId,quotesInputObject.nri=1*data.countryId!==392?1:0,1*vm.type.payType===2?(quotesInputObject.payOptionType="SinglePay",quotesInputObject.ppt=1):1*vm.type.payType===3&&(quotesInputObject.payOptionType="LimitedPay",quotesInputObject.ppt=vm.type.ppt||10),quotesInputObject.utmSource=data.utmSource,quotesInputObject.name=data.name,quotesInputObject.mobileNo=data.mobileNo,termConfigObj.getOptimizedQuotesApi()&&(quotesInputObject.isV2=!0),callMultiple&&(nonPriorityPlans?(quotesInputObject.isLumpsumOnly=!0,quotesInputObject.isTopLumSumPlanOnly=!1):(quotesInputObject.isLumpsumOnly=!1,quotesInputObject.isTopLumSumPlanOnly=!0)),quotesInputObject},initilizeZopim=function(){$timeout(function(){var lead=vm.preQuotesInfo.matrixLeadId;CustomerService.getChatInformation(lead).success(function(data){var obj={ChatTime:data.custInfo.chatTime,startTime:"10:00:00",endTime:"19:00:00"};getFiltersForChat(),vm.modifySelection.customerAge,GenericService.isWorkingHours(obj.ChatTime,obj.endTime,obj.startTime);vm.agentObj.isAgent||1*vm.modifySelection.countryId==392&&!GenericService.isChatAvailableInCity(vm.modifySelection.cityId)||!callQuotesApi()||vm.isInternalIP||"Zopim"===termConfigObj.getChatEnv()||CommonServiceTerm.loadScript("../../scripts/common-scripts/ScriptLiveChat.js","text/javascript","utf-8",function(){$rootScope.isMobileDevice?vm.showChat.showMobileChatButton=!0:showChatBot||ShowDesktopchat(vm.modifySelection.userInfoId,1)})})},0,!1)},getFiltersForChat=function(){var checkedFilters="";return angular.forEach(vm.types,function(value){value.status&&(checkedFilters+=value.name+" ; ")}),checkedFilters.length>0&&(checkedFilters=checkedFilters.replace(/;\s*$/,""),checkedFilters="["+checkedFilters+"]"),checkedFilters},processPlans=function(plansToBeProcessed){return plansToBeProcessed=_.uniq(plansToBeProcessed,"Plan_Id"),vm.customizePlan.fetchMsg.show=!1,vm.hideObject.isNoQuotesPresent=!(plansToBeProcessed.length>0),_.each(plansToBeProcessed,function(value){value.riderPremiumAdded=0,value.numInterestRate=value.interestRate?1*value.interestRate.split("%")[0]:0,value.monthlyRiderPremiumAdded=0,value.OneTimePayout=parseInt(value.OneTimePayout),value.SumAssured=parseInt(value.SumAssured),value.TotalCover=parseInt(value.TotalCover),value.maxOneTimePayout=parseInt(value.maxOneTimePayout),value.maxSumAssured=parseInt(value.maxSumAssured),value.maxTotalCover=parseInt(value.maxTotalCover),value.orgSumassured=parseInt(value.orgSumassured),value.maxAnnualReturn=parseInt(value.maxAnnualReturn),value.annualIncomeSort=QuotesService.sortPlanByAnnualIncome(value,vm.preQuotesInfo),value.isRiderLoaded=!1,value.isRiderSelectedForMobile=!1,value.allMonthlyPremium=value.monthlyTotalPremium,value.excludeFromMonthlySorting=0,10===value.Supplier_Id&&$routeParams.isSpouseJourney&&(value.planProfile="SNW"),value.allMonthlyPremium||(delete value.allMonthlyPremium,value.excludeFromMonthlySorting=100),$rootScope.pTabName.allPlans?value.allTotalPremium=value.maxTotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?value.allTotalPremium=value.TotalPremium:value.allTotalPremium=value.maxTotalPremium,value.profileSort=3,void 0!==typeof vm.preQuotesInfo.spouse&&null!=vm.preQuotesInfo.spouse&&("SNW"!=value.planProfile||749!=value.Plan_Id&&911!=value.Plan_Id||!vm.preQuotesInfo.spouse.isWorking||(value.planProfile="SW"),($rootScope.profile.spouse&&"SNW"==value.planProfile&&!vm.preQuotesInfo.spouse.isWorking||"SW"==value.planProfile&&vm.preQuotesInfo.spouse.isWorking)&&(value.profileSort=1)),$rootScope.profile.child&&"C"==value.planProfile&&(value.profileSort=2),776==value.Plan_Id&&(vm.customizePlan.minPlanPremium=value.monthlyTotalPremium)}),plansToBeProcessed},nonPriorityPlansCallback=function(data){var data=data,planPopulated=!1,processedPlans=processPlans(data);$localStorage.enquiryId=vm.enquiryId,quotes=angular.copy(quotes.concat(processedPlans)),quotes=_.uniq(quotes,"Plan_Id"),vm.originalQuotes=angular.copy(quotes);var filteredObj=GenericService.filterAllObjs(quotes,vm.modifySelection);return processedPlans=angular.copy(filteredObj),vm.isQuotesLoaded=!0,$rootScope.pTabName.tropPlans?vm.hideObject.isTropNotPresent=!(processedPlans.length>0):vm.hideObject.isTropNotPresent=!1,function(){planPopulated||(vm.progressiveQuotes.loading=!0,$scope.$apply(),vm.showDummyQuotes=!1,_.each(processedPlans,function(plan,i){vm.quotes.push(plan)}),vm.quotes=_.uniq(vm.quotes,"Plan_Id"),$timeout(function(){planPopulated=!0,vm.progressiveQuotes.loading=!1,postProcessPlans()},0))}},quotesSuccessCallback=function(data,nonPriorityPlans){vm.showDummyQuotes=!1,callMultiple=QuotesService.callMultipleTimes()&&1*vm.type.payType===1;var processedPlans=processPlans(data);if($routeParams.AgentId||($localStorage.enquiryId=vm.enquiryId),quotes=angular.copy(processedPlans),vm.originalQuotes=angular.copy(quotes),vm.isNotPrioritySorting=!1,"undefined"!=typeof cxApi){var chosenVariation=cxApi.chooseVariation();vm.isNotPrioritySorting=void 0!=chosenVariation&&1*chosenVariation===1}var filteredObj=GenericService.filterAllObjs(quotes,vm.modifySelection,vm.isNotPrioritySorting);if($rootScope.pTabName.tropPlans&&vm.callIciciTrop(filteredObj),processedPlans=angular.copy(filteredObj),vm.isQuotesLoaded=!0,$rootScope.quotesLoad=!0,vm.quotesResolved=resolvedFromCustomerCallback,$rootScope.pTabName.tropPlans?vm.hideObject.isTropNotPresent=!(processedPlans.length>0):vm.hideObject.isTropNotPresent=!1,window.prerenderReady=!0,$location.$$search.isMatrixLeadCreated&&(CommonServiceTerm.callLeadGenerationTracking(vm.preQuotesInfo.matrixLeadId,vm.preQuotesInfo.custId,$location.$$search.isMatrixLeadCreated,!1),$location.search("isMatrixLeadCreated",null).replace()),$rootScope.pTabName.monthlyPlans||vm.recommendationService(vm.preQuotesInfo.custId,vm.preQuotesInfo.enquiryId,vm.preQuotesInfo.annualIncome),$routeParams.isCTC&&"true"==$routeParams.isCTC&&vm.callBack(null,!0),processedPlans.length>0&&vm.customerChangeInitiated&&(vm.quotes=[],vm.newQuotes=[]),_.each(processedPlans,function(plan,i){vm.quotes.push(plan)}),1*vm.modifySelection.annualIncome===7&&(vm.isReferralLead&&1==vm.isReferralLead||vm.isAffiliates)&&(vm.quotes=[],vm.newQuotes=[]),renderNonPriorityPlans=null,callMultiple&&!nonPriorityPlans&&vm.getQuotes(vm.modifySelection,!1,!0),void 0!==$cookies.get("CustomerEligibility")&&$localStorage.AgentId&&!vm.isNRI){var input=angular.copy(vm.modifySelection),custData=JSON.parse($cookies.get("CustomerEligibility")),postData=(CommonServiceTerm.getAnnualIncomeBoundry().filter(function(obj){return obj.id==input.annualIncome}),{age:CommonServiceTerm.getAge(input.dob),enquiryId:vm.enquiryId,annualIncome:vm.data.annualIncome?vm.data.annualIncome:custData.annualIncome,professionType:vm.data.professionType?vm.data.professionType:custData.professionType,educationQualification:vm.data.qualification?vm.data.qualification:custData.educationQualification,sumAssured:input.totalPayout});verifyCustomerEligibility(postData).then(function(data){})}callMultiple?(vm.setToDefault(),vm.quotes=GenericService.setRiderObject(vm.quotes,vm.preQuotesInfo,vm.quotesObj.isMonthly),vm.newQuotes=GenericService.setRiderObject(vm.newQuotes,vm.preQuotesInfo,vm.quotesObj.isMonthly)):postProcessPlans(),fetchMedicalGridData(vm.modifySelection)};vm.callIciciTrop=function(filteredObj){var tropObject=QuotesService.buildIpruTropObject(vm.modifySelection,filteredObj);QuotesService.getIpruTropPlan(tropObject).success(function(data,status,headers,config){var index;"success"==data.status?(data.planDetail.riderPremiumObject=[],data.planDetail=GenericService.filterAllObjs([data.planDetail],vm.modifySelection)[0],filteredObj.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?filteredObj.splice(index,1,data.planDetail):"",vm.quotes.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?vm.quotes.splice(index,1,data.planDetail):"",vm.customerEligibility&&(vm.quotes=QuotesService.assignCustomerEligibility(vm.quotes,vm.customerEligibility)),fetchMedicalGridData(vm.modifySelection)):(filteredObj.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?filteredObj.splice(index,1):"",vm.quotes.some(function(obj,pos){return index=pos,892==obj.Plan_Id}),index>=0?vm.quotes.splice(index,1):"")})},vm.getComboTotalPremiumDifference=function(plan){if(749===plan.Plan_Id){if(filteredPnb99Obj[0])return vm.addCommas(filteredPnb99Obj[0].ComboTotalPremium-plan.ComboTotalPremium)}else if(CommonServiceTerm.isAegonPlan(plan.Plan_Id)&&filteredAegon100Obj[0])return vm.addCommas(filteredAegon100Obj[0].ComboTotalPremium-plan.ComboTotalPremium)},vm.getMonthlyTotalPremiumDifference=function(plan){if(749===plan.Plan_Id){if(filteredPnb99Obj[0])return vm.addCommas(filteredPnb99Obj[0].monthlyTotalPremium-plan.monthlyTotalPremium)}else if(CommonServiceTerm.isAegonPlan(plan.Plan_Id)&&filteredAegon100Obj[0])return vm.addCommas(filteredAegon100Obj[0].monthlyTotalPremium-plan.monthlyTotalPremium)},vm.chat=function(){"Zopim"===termConfigObj.getChatEnv()||ShowMobilechat(vm.modifySelection.userInfoId)},vm.getQuotes=function(preQuotesData,isFirst,nonPriorityPlans){if(callMultiple=QuotesService.callMultipleTimes()&&1*vm.type.payType===1,nonPriorityPlans||vm.customerChangeInitiated||($rootScope.quotesLoad=!1,vm.quotes=[],vm.newQuotes=[],allPlansData=[]),vm.customizePlan.fetchMsg.show=!!vm.customizePlan.apply,resolvedFromCustomerCallback="customerSuccessCallback"==vm.getQuotes.caller.name,vm.isValidPolicyCoverage()&&callQuotesApi()){var input=buildQuotesInputObject(preQuotesData,nonPriorityPlans);QuotesService.getQuotes(input).success(function(data,status,headers,config){!angular.isDefined(data.status)||"failed"!=data.status&&"fail"!=data.status?angular.isDefined(data.msg)&&data.msg.indexOf("failed")>=0?quotesSuccessCallback(null):(nonPriorityPlans?(renderNonPriorityPlans=nonPriorityPlansCallback(data),$timeout(function(){renderNonPriorityPlans&&"function"==typeof renderNonPriorityPlans&&renderNonPriorityPlans()},0)):quotesSuccessCallback(data,nonPriorityPlans),vm.groupQuotes=[],vm.isNRI||1*vm.modifySelection.annualIncome!==7||(vm.groupQuotes=angular.copy(vm.quotes)),isFirst&&$timeout(function(){if(vm.customerChangeInitiated=!1,preQuotesData.categoriesLastUpdatedTime&&preQuotesData.categoriesLastUpdatedTime>0){var date=new Date;(date.getTime()-preQuotesData.categoriesLastUpdatedTime)/864e5>=1&&$mdToast.show($mdToast.simple().content("Premium includes riders chosen by you!").position(vm.getToastPosition()).hideDelay(3e3))}vm.isNRI||1*vm.modifySelection.annualIncome!==7||(vm.quotes=vm.isReferralLead&&1==vm.isReferralLead||vm.isAffiliates?[]:angular.copy(vm.groupQuotes))},3e3),vm.showLink.emailback=!0):quotesSuccessCallback(null)})}else vm.isQuotesLoaded=!0};var getCityObject=function(cityId){var obj=null;return angular.forEach(vm.city,function(value,key){!cityId||cityId!=value.cityId&&cityId!=value.id||(obj=value)}),obj},policyCoverageDataSyncup=function(){vm.preQuotesInfo.policyCoverage=angular.copy(vm.preQuotesInfo.policyTerm)},handleAddSpouse=function(){gaTagsNew.editProfileTrack("AddSpouse",-1,vm.modifySelection.custId),vm.toggleModal("spouse","show")},handleAddChild=function(){gaTagsNew.editProfileTrack("AddChild",-1,vm.modifySelection.custId),vm.toggleModal("child","show")},handleChildAgeZeroCase=function(data){data.child&&angular.isDefined(data.child.age)&&1*data.child.age===100&&(vm.preQuotesInfo.child={age:0})},isAgeChanged=function(){var info=vm.preQuotesInfo,customerAge=info.customerAge?info.customerAge:"",getAge=vm.getAge(info.dob);getAge=getAge?getAge:"",customerAge!==getAge&&$location.path("/").replace()},setIsMobileDefault=function(existUrl){existUrl&&existUrl.indexOf("isMobileDefault=false")!=-1&&$location.search("isMobileDefault",null).replace()},mobileDefaultCheck=function(){var isMobileDefault=!!$location.$$search.isMobileDefault;vm.preQuotesInfo.city=isMobileDefault?null:vm.preQuotesInfo.city,vm.preQuotesInfo.cityId=isMobileDefault?null:vm.preQuotesInfo.cityId,vm.preQuotesInfo.state=isMobileDefault?null:vm.preQuotesInfo.state,vm.preQuotesInfo.stateId=isMobileDefault?null:vm.preQuotesInfo.stateId,vm.cityerror=!!isMobileDefault||vm.cityerror,vm.modifySelection.city=isMobileDefault?null:vm.modifySelection.city,vm.modifySelection.stateId=isMobileDefault?null:vm.modifySelection.stateId,vm.modifySelection.cityId=isMobileDefault?null:vm.modifySelection.cityId,vm.selectedCityItem={display:vm.modifySelection.city,value:vm.modifySelection.city,searchString:vm.modifySelection.city,stateId:vm.modifySelection.stateId,cityId:vm.modifySelection.cityId}};vm.restoreSession=function(){_.each(vm.types,function(val){previousSelectedRiderIds.indexOf(val.id)>-1&&(val.status=!0)}),previousSelectedRiderIds=[],vm.previousRiderSelection=[],vm.toggleRidersFn(!1),vm.showRidersSuggestionStachel=!1,CommonServiceTerm.dropRiderSelectionCookie()},vm.closeRestoreSessionMsg=function(){previousSelectedRiderIds=[],vm.previousRiderSelection=[],callRiderChangeCategoryList(),$cookies.remove("Rider_Selected"),vm.showRidersSuggestionStachel=!1,CommonServiceTerm.dropRiderSelectionCookie()};var checkForPreviousSession=function(data){return(data&&data.categoryIds&&data.categoryIds.length<=0||!data.categoryIds)&&CommonServiceTerm.dropRiderSelectionCookie(),data.categoryIds&&data.categoryIds.length>0&&"undefined"==typeof $cookies.get("Rider_Selected")&&(previousSelectedRiderIds=[],vm.previousRiderSelection=[],_.each(vm.types,function(type){data.categoryIds.indexOf(type.id)>-1&&(vm.previousRiderSelection.push(type),previousSelectedRiderIds.push(type.id))}),data.categoryIds||$cookies.remove("Rider_Selected"),data.categoryIds=[]),data},checkAnnualIncomeEligibility=function(){7===vm.preQuotesInfo.annualIncome?(vm.annualIncomeError.status=!0,vm.annualIncomeError.errorMessage=""):vm.annualIncomeError.status=!1};vm.openAnnualIncomeModal=function(){vm.modifySelection.annualIncome=vm.modifySelection.annualIncome.toString(),vm.toggleModal("annualIncomeModal","show")},vm.progressiveMobileNumberFormSubmit=function(isValid){if(isValid){vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1,$timeout(function(){vm.progressiveJourney.stage="smoker"},0),vm.progressiveJourney.visibleScreens.push("mobile"),vm.progressiveJourney.visibleScreens.push("smoker"),vm.modifySelection.mobileNo=vm.progressiveJourney.mobileNo,vm.modifySelection.countryId=vm.progressiveJourney.countryCode,vm.modifySelection.otherCountryCode=vm.progressiveJourney.otherCountryCode;var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","annualincome",{expires:expireDate}),1*vm.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:vm.modifySelection.visitId,mobile:vm.modifySelection.mobileNo,event:"On Mobile Number Save",pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,mobile:vm.modifySelection.mobileNo,event:"On Mobile Number Save",pageName:"Quotes",collection:"progressive_term"}),PreQuotesService.updateMobileNumber(vm.progressiveJourney.mobileNo,vm.modifySelection).then(function(){})}},vm.progressiveCityClicked=function(){vm.cityClicked=!0},vm.progressiveCityError=function(){var value=!1;return vm.progressiveJourney.city&&vm.progressiveJourney.city.length>=3&&$('ul[role="listbox"]').length>0&&$('ul[role="listbox"]')[0].children&&$('ul[role="listbox"]')[0].children.length<=0&&!vm.progressiveCitySelected&&(value=!0),value},vm.saveCityProgressive=function($item,$model,$label,$event){vm.progressiveJourney.city=$item,"yes"==$item?vm.modifySelection.isStateChange=!0:vm.modifySelection.isStateChange=!1;var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","city",{expires:expireDate}),$cookies.put("isStateChanged",vm.modifySelection.isStateChange,{expires:expireDate}),vm.progressiveJourney.visibleScreens.indexOf("city")===-1&&vm.progressiveJourney.visibleScreens.push("city"),$timeout(function(){hideQuestions()},0),vm.updateProfileDetails(!0,!0)},vm.saveAnnualIncomeProgressive=function(){var timeout=0;vm.modifySelection.annualIncome=1*vm.progressiveJourney.annualIncome,1*vm.modifySelection.annualIncome===7&&(timeout=2e3),vm.modifySelection.recommendedCover=!0,vm.isNRI||$timeout(function(){vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1,vm.progressiveJourney.stage="occupationType"},timeout),vm.isNRI?vm.progressiveJourney.visibleScreens.push("spouse"):vm.progressiveJourney.visibleScreens.push("occupationType"),1*vm.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:vm.modifySelection.visitId,event:"On Annual Income Save",newValue:vm.modifySelection.annualIncome,pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Annual Income Save",newValue:vm.modifySelection.annualIncome,pageName:"Quotes",collection:"progressive_term"});var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","annualincome",{expires:expireDate}),vm.isNRI&&(vm.isSpouseJourney?$timeout(function(){vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1,vm.progressiveJourney.stage="spouse"},timeout):hideQuestions()),vm.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange(vm.modifySelection.annualIncome)),vm.modifySelection.isMobileSinglePage=!0,vm.progressiveJourney.isNri=vm.modifySelection.nri,vm.mobileSectionUpdateStatus.selection=!0,vm.modifySelection.isSpouseJourney=vm.isSpouseJourney,vm.isNRI||(vm.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1),vm.isNRI&&!vm.isSpouseJourney&&vm.updateProfileDetails(!0,!0)},vm.saveAnnualIncome=function(){$routeParams.isProgressiveJourney&&"true"==$routeParams.isProgressiveJourney&&(vm.modifySelection.recommendedCover=!0),vm.modifySelection.annualIncome=1*vm.modifySelection.annualIncome,vm.mobileSectionUpdateStatus.profile=!0,vm.updateProfileDetails(!0)},vm.saveProfessionType=function(value){vm.progressiveJourney.visibleScreens.push("spouse"),vm.modifySelection.isSpouseJourney=vm.isSpouseJourney,vm.isNRI||(vm.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1),$scope.$$phase||$scope.$apply(),vm.isNRI?(vm.progressiveJourney.stage="spouse",vm.modifySelection.cityId=9999,vm.modifySelection.nri=1*value,vm.progressiveJourney.isNri=vm.modifySelection.nri,1*vm.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:vm.modifySelection.visitId,event:"On is Nri Save",newValue:vm.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On is Nri Save",
newValue:vm.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"})):(vm.modifySelection.professionType=value,392!=vm.modifySelection.countryId?(vm.modifySelection.cityId=9999,vm.modifySelection.nri=1):(vm.modifySelection.nri=0,vm.modifySelection.cityId=551),1*vm.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:vm.modifySelection.visitId,event:"On Profession Type Save",newValue:vm.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Profession Type Save",newValue:vm.modifySelection.professionType,pageName:"Quotes",collection:"progressive_term"}));var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),vm.isSpouseJourney?vm.isSpouseJourney&&$timeout(function(){vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1,vm.progressiveJourney.stage="spouse"},0):($cookies.put("last_question_answered","professiontype",{expires:expireDate}),$timeout(function(){vm.isCityPopupEnabled?(vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1,vm.progressiveJourney.stage="city",vm.progressiveCitySelected=!1):(vm.progressiveJourney.stage="spouse",hideQuestions())},0),vm.isCityPopupEnabled?vm.progressiveJourney.visibleScreens.push("city"):vm.updateProfileDetails(!0,!0))},vm.showStarOnPlan=function(plan){var isNRI=1*vm.preQuotesInfo.countryId!=392;return QuotesService.showStarOnPlan(plan,isNRI)},vm.saveSmoker=function(value){var value=1*value;vm.modifySelection.isTobaccoUser=1*value,vm.progressiveJourney.smoker=1*value,vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1,$timeout(function(){vm.progressiveJourney.stage="annualIncome"},0),vm.progressiveJourney.visibleScreens.indexOf("smoker")===-1&&vm.progressiveJourney.visibleScreens.push("smoker"),vm.progressiveJourney.visibleScreens.push("annualIncome"),1*vm.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:vm.modifySelection.visitId,newValue:vm.modifySelection.isTobaccoUser,event:"On Smoker Question Save",pageName:"Quotes",collection:"progressive_term"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,newValue:vm.modifySelection.isTobaccoUser,event:"On Smoker Question Save",pageName:"Quotes",collection:"progressive_term"});var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","smoker",{expires:expireDate})},vm.switchProgressiveQuestions=function(stage){return vm.progressiveJourney.visibleScreens.indexOf(stage)!==-1&&("city"!=stage&&(vm.cityClicked=!1),"annualIncome"===stage?(vm.progressiveJourney.toLeft=!1,vm.progressiveJourney.toRight=!0):"occupationType"===stage?(vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1):"smoker"===stage?(vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1):"mobile"===stage?(vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1):vm.isSpouseJourney&&"spouse"===stage?(vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1):"city"===stage?(vm.progressiveJourney.toLeft=!1,vm.progressiveJourney.toRight=!0):(vm.progressiveJourney.toLeft=!1,vm.progressiveJourney.toRight=!1),void $timeout(function(){vm.progressiveJourney.stage=stage},100))},$routeParams.isProgressiveJourney&&"true"==$routeParams.isProgressiveJourney&&(vm.progressiveJourney.show=!0);var customerSuccessCallback=function(data,isCalledOnApply){data=checkForPreviousSession(data),setIsMobileDefault(data.existUrl),vm.preQuotesInfo=data,vm.isReferralLead=!(!vm.isAffiliates||1*vm.preQuotesInfo.annualIncome!==7),vm.modifySelection.isReferralLead=!1,isAgeChanged(),vm.isCityPopupEnabled||mobileDefaultCheck(),$localStorage.AgentId&&392==vm.preQuotesInfo.countryId&&GenericService.checkLocalIp().success(function(data,status,headers,config){vm.isLocalIP=!(!data||1!=data.isLocalIP),vm.showCustEligibility=void 0==vm.isLocalIP||vm.isLocalIP,vm.customizeVisible=!0,CustomerService.getCustomerEligibilityData(vm.enquiryId).success(function(data,status,headers,config){data&&"fail"!=data.status&&(vm.data.qualification=data.educationQualification,vm.data.annualIncome=data.annualIncome,vm.data.professionType=data.professionType)})}),vm.coverageUptoOptions=CommonServiceTerm.populateOptionsList(vm.getAge(vm.preQuotesInfo.dob)+10,99,1),null==vm.preQuotesInfo.spouse||"null"==vm.preQuotesInfo.spouse?($cookies.remove("spouseDob"),vm.preQuotesInfo.spouse={isWorking:0,tobacco:0,age:null}):$rootScope.profile.spouse="true"===$cookies.get("isSpouseSelected"),$rootScope.profile.child=!(null==vm.preQuotesInfo.child||"null"==vm.preQuotesInfo.child),handleChildAgeZeroCase(data);var yahooUrl="https://sp.analytics.yahoo.com/spp.pl?a=10000&.yp=430240&ea="+data.matrixLeadId+"&gv=";if(CommonServiceTerm.addYahooTag(yahooUrl),$rootScope.isMonthlyIncomeJourney=1==data.subProductTypeId,changeTabVisibility($rootScope.isMonthlyIncomeJourney),policyCoverageDataSyncup(),vm.preFillModifySelectionModel(vm.preQuotesInfo),vm.quotesUpdateInitiated=!1,vm.isCustomerDataLoaded=!0,handleModalPopupClose(),getAllCityList().then(function(){if(vm.modifySelection.cityId){var selectedCityItem=getCityObject(vm.modifySelection.cityId);setSelectedCityItem(selectedCityItem)}vm.modifySelection.cityId&&(vm.cityerror=!1)}),checkAnnualIncomeEligibility(),100===data.policyTerm&&vm.changePolicyTerm(!0,99),vm.payTermOptions.indexOf("pushed")===-1&&(vm.payTermOptions.push({value:60-vm.preQuotesInfo.customerAge,displayValue:"Pay Till 60"}),vm.payTermOptions.push("pushed")),"Pay Till 60"===$localStorage.selectedPayTerm&&(vm.type.ppt=60-vm.preQuotesInfo.customerAge,1*vm.preQuotesInfo.policyTerm<=60&&($localStorage.selectedPayTerm=10,vm.type.ppt=10)),setTimeout(function(){executeICICITracking();var x=document.createElement("IFRAME"),styles="visibility:hidden;display:none";x.setAttribute("style",styles),x.setAttribute("src","https://www.aegonlife.com/sfapi/api/lead-restrict-pb?source=policybazar"),x.setAttribute("height",0),x.setAttribute("width",0),document.body.appendChild(x)},0),Math.abs(data.policyTerm-data.customerAge)<10&&(data.customerAge<50?vm.changePolicyTerm(!0,60):vm.changePolicyTerm(!0,75)),vm.isNRI=392!=vm.preQuotesInfo.countryId,vm.isCountryOthers=999==vm.preQuotesInfo.countryId,vm.progressiveJourney.isNri=vm.isNRI,vm.isNRI){var incomeArray=vm.annualIncomeList.filter(function(val){return 7!=val.id&&8!=val.id});incomeArray.push({id:8,name:"< 3 Lac"}),vm.annualIncomeList=incomeArray}if(7!==vm.preQuotesInfo.annualIncome||vm.isNRI||vm.isAffiliates||CommonServiceTerm.getReferralLead(vm.preQuotesInfo.matrixLeadId).then(function(data){vm.isReferralLead=data,vm.modifySelection.isReferralLead=vm.isReferralLead}),$cookies.get("pid")&&$cookies.get("pid")==termConfigObj.getBAXASupplier()&&85==vm.preQuotesInfo.policyTerm?$cookies.put("changedOnce",!0):!$cookies.get("pid")||111!=$cookies.get("pid")&&31!=$cookies.get("pid")||vm.preQuotesInfo.policyTerm!=vm.maxAllowedPolicyCoverage||$cookies.put("changedOnce",!0),$cookies.get("pid")&&$cookies.get("pid")==termConfigObj.getBAXASupplier()&&85!=vm.preQuotesInfo.policyTerm&&"true"!=$cookies.get("changedOnce"))$cookies.put("changedOnce",!0),vm.changePolicyTerm(!0,85);else if(!$cookies.get("pid")||111!=$cookies.get("pid")&&31!=$cookies.get("pid")||vm.preQuotesInfo.policyTerm==vm.maxAllowedPolicyCoverage||"true"==$cookies.get("changedOnce")){vm.customerChangeInitiated?"":vm.getQuotes(vm.preQuotesInfo,"first"),CommonServiceTerm.loadInvincibleScript(vm.preQuotesInfo.matrixLeadId),CustomerService.trackCustomerJourneyService(vm.enquiryId),null!==data.categoryIds&&(vm.types=GenericService.setSelectedTypes(data.categoryIds,vm.types));var reqObj={uniqueId:vm.modifySelection.encryptedMobileNo,userInfoId:vm.modifySelection.userInfoId};vm.isAffiliates||QuotesService.isCustomerExist(reqObj).then(function(data){data.childLeadExists||data.previousBookingExist?(vm.modifySelection.annualIncome>2||vm.modifySelection.totalPayout>25e5)&&1*vm.modifySelection.annualIncome!==7&&initilizeZopim():(vm.modifySelection.annualIncome>2||vm.modifySelection.totalPayout>25e5)&&1*vm.modifySelection.annualIncome!==7&&initilizeZopim()})}else $cookies.put("changedOnce",!0),vm.changePolicyTerm(!0,vm.maxAllowedPolicyCoverage);$rootScope.isMobileDevice&&isCalledOnApply&&vm.handleFilterEvents(),$routeParams.isRevisit&&"true"==$routeParams.isRevisit&&CommonServiceTerm.saveRevisitLog(vm.preQuotesInfo.matrixLeadId,termConfigObj.getTermProductId());var isInternalIP=$localStorage.isInternalIP;!$rootScope.isMobileDevice&&showChatBot&&(isInternalIP||vm.isAffiliates||vm.agentObj.isAgent||!GenericService.isChatAvailableInCity(data.cityId)?(vm.chatbotframe=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,isInternalIP:isInternalIP,isAffiliates:vm.isAffiliates,isAgent:vm.agentObj.isAgent,isChatAvailableInCity:GenericService.isChatAvailableInCity(data.cityId),event:"Chatbot not called",pageName:"Quotes",click:"Click"})):vm.getChatbot(vm.preQuotesInfo.matrixLeadId)),$routeParams.isProgressiveJourney?vm.progressiveJourney.secondVariant?1*vm.preQuotesInfo.custId==dummyCustId?pbTrackerObj.logEvent({visitId:vm.preQuotesInfo.visitId,collection:"progressive_term",event:"Landing",pageName:"Quotes",variant:"second"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,collection:"progressive_term",event:"Landing",pageName:"Quotes",variant:"second"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,collection:"progressive_term",event:"Landing",pageName:"Quotes",variant:"first"}):pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,event:"Landing",pageName:"Quotes"}),$routeParams.smsEvent&&"true"==$routeParams.smsEvent&&pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On SMS event Landing",collection:"CRM_SMS_CAMPAIGN",stage:$routeParams.stage,pageName:"Quotes"}),$routeParams.clicktocall&&"true"==$routeParams.clicktocall&&vm.preQuotesInfo.userInfoId&&CommonServiceTerm.clickToCall(vm.preQuotesInfo.userInfoId),$cookies.get("showPayoutCallOut")?(vm.showCallOutText=!0,$cookies.remove("showPayoutCallOut"),$timeout(function(){vm.showCallOutText=!1},2e3)):vm.showCallOutText=!1,toggleGroupTermJourney(),$rootScope.pTabName&&$rootScope.pTabName.wholeLifePlans||vm.customerChangeInitiated||QuotesService.populateDummyPlans().then(function(dummyPlans){vm.dummyQuotes=dummyPlans,vm.isQuotesLoaded=!0,dummyPlansExist=!0,vm.object.showLoader=!0,vm.showDummyQuotes=!0,$rootScope.profile&&$rootScope.profile.spouse&&(vm.dummyQuotes=sortDummyObject(dummyPlans))})};vm.openProgressiveJourneyQuestion=function(){var lastQuestionAnswered=void 0!==$cookies.get("last_question_answered")?$cookies.get("last_question_answered"):"",response=vm.isCityPopupEnabled?"city":vm.isSpouseJourney?"spouse":"professiontype";vm.isSpouseJourney||lastQuestionAnswered===response||"annualincome"===lastQuestionAnswered||$routeParams.LeadId&&$routeParams.AgentId||showQuestions(),!vm.isSpouseJourney||lastQuestionAnswered===response||$routeParams.LeadId&&$routeParams.AgentId||showQuestions(),"smoker"===lastQuestionAnswered?vm.switchProgressiveQuestions("annualIncome"):"annualincome"===lastQuestionAnswered?vm.switchProgressiveQuestions("occupationType"):"occupationType"===lastQuestionAnswered&&vm.isCityPopupEnabled&&vm.switchProgressiveQuestions("city")},vm.loadMoreQuotes=function(){console.log("load more quotes")},vm.recommendationService=function(custId,enquiryId,annualIncomeId){var pre_custId=void 0!==$cookies.get("recommendation")?$cookies.get("recommendation"):0;pre_custId!=custId&&vm.recommendation.active&&vm.getGenericRecommendation(custId,enquiryId,annualIncomeId)},vm.getGenericRecommendation=function(custId,enquiryId,annualIncomeId){var annualIncome;if(annualIncomeId<=4)var annualIncome=899999;else if(annualIncomeId>4)var annualIncome=1499999;recommendationServiceUrl=$location.protocol()+"://"+$location.host()+":"+$location.port()+"/api/recommendation/service/?custId="+custId+"&enquiryId="+btoa(enquiryId)+"&annualIncome="+annualIncome,vm.getRecommendation=function(recommendationServiceUrl){return ServerUtilityService.getWebService(recommendationServiceUrl,null).success(function(data,status,headers,config){if("success"==data.status){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("recommendation",custId,{expires:expireDate})}return data}).error(function(data,status,headers,config){return data})},vm.getRecommendation(recommendationServiceUrl).then(function(data){"success"==data.data.status&&(vm.recommendation.plans="[]"==data.data.selectedPlanIds?[]:data.data.selectedPlanIds,vm.recommendation.plans.length>0?vm.showPreviouslySelectedPlan():(vm.addonrecommendation.selectedRiderIds="[]"==data.data.selectedCategoryIds?[]:data.data.selectedCategoryIds,vm.addonrecommendation.recommendedRiders="[]"==data.data.recommendedRiders?[]:data.data.recommendedRiders,_.each(vm.addonrecommendation.recommendedRiders,function(rider){vm.addonrecommendation.recommendedRiderIds.push(rider.riderCategoryId),vm.addonrecommendation.recommendedRiderNotes.push(rider.recommendationNote)}),vm.showSelectedRiders()))})},vm.showSelectedRiders=function(){if(vm.addonrecommendation.selectedRiderIds.length>0){for(var rider in vm.addonrecommendation.selectedRiderIds)_.each(vm.riderCategoryNames,function(type){type.category_id==vm.addonrecommendation.selectedRiderIds[rider]&&(vm.addonrecommendation.selectedRiderNames[vm.addonrecommendation.selectedRiderNames.length]=type.name)});vm.addonrecommendation.showSelectedRider=!0,vm.addonrecommendation.showRiderRecommendation=!1}else 0==vm.addonrecommendation.selectedRiderIds.length&&setTimeout(function(){vm.showRecommendedRiders()},5e3)},vm.enableSelectedRiders=function(){for(var rider in vm.addonrecommendation.selectedRiderIds)_.each(vm.types,function(type){type.id==vm.addonrecommendation.selectedRiderIds[rider]&&(type.status=!0)}),vm.toggleRidersFn(!1);vm.showRecommendedRiders(),vm.addonrecommendation.showSelectedRider=!1},vm.showRecommendedRiders=function(){if(vm.checkRecommendedRiderAlreadySelected(),vm.addonrecommendation.recommendedRiderIds.length>0){for(var rider in vm.addonrecommendation.recommendedRiderIds)_.each(vm.riderCategoryNames,function(type){type.category_id==vm.addonrecommendation.recommendedRiderIds[rider]&&(vm.addonrecommendation.recommendedRiderNames[vm.addonrecommendation.recommendedRiderNames.length]=type.name)});vm.addonrecommendation.showRiderRecommendation=!0,vm.addonrecommendation.showSelectedRider=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,enquiryId:vm.preQuotesInfo.enquiryId,recommendedRiders:vm.addonrecommendation.recommendedRiderIds,event:"show_recommended_riders",pageName:"Quotes",collection:"Recommendation"})}},vm.checkRecommendedRiderAlreadySelected=function(){for(var rider in vm.addonrecommendation.recommendedRiderIds)_.each(vm.types,function(type){if(type.id==vm.addonrecommendation.recommendedRiderIds[rider]&&1==type.status){vm.addonrecommendation.recommendedRiderIds.indexOf(rider);vm.addonrecommendation.recommendedRiderIds.splice(rider,1),vm.addonrecommendation.recommendedRiderNotes.splice(rider,1)}})},vm.hideRecommendedRiders=function(){vm.addonrecommendation.showRiderRecommendation=!1},vm.hideSelectedRiders=function(){vm.addonrecommendation.showSelectedRider=!1},vm.enableRecommendedRiders=function(){for(var rider in vm.addonrecommendation.recommendedRiderIds)_.each(vm.types,function(type){type.id==vm.addonrecommendation.recommendedRiderIds[rider]&&(type.status=!0,11==type.id&&_.each(vm.types,function(type){15==type.id&&(type.status=!0)}))}),vm.toggleRidersFn(!1);vm.addonrecommendation.showRiderRecommendation=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,enquiryId:vm.preQuotesInfo.enquiryId,recommendedRiders:vm.addonrecommendation.recommendedRiderIds,event:"enable_recommended_riders",pageName:"Quotes",collection:"Recommendation"})},vm.getSelectedPlanRecommendation=function(custId){recommendationServiceUrl=$location.protocol()+"://"+$location.host()+":"+$location.port()+"/api/recommendation/plan/?custId="+custId,vm.getPlanRecommendation=function(recommendationServiceUrl){return ServerUtilityService.getWebService(recommendationServiceUrl,null).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},vm.getPlanRecommendation(recommendationServiceUrl).then(function(data){vm.recommendation.plans=data.data.selectedPlanIds,vm.showPreviouslySelectedPlan()})},vm.showPreviouslySelectedPlan=function(){1==vm.recommendation.plans.length&&(vm.recommendation.previouslySelectedPlans=[],vm.recommendation.previouslySelectedPlanIds=[],_.each(vm.originalQuotes,function(quote,index){quote.Plan_Id==vm.recommendation.plans[0]&&(vm.recommendation.previouslySelectedPlanIds.push(quote.Plan_Id),vm.recommendation.previouslySelectedPlans.push(quote),vm.recommendation.plan_index=index)})),vm.recommendation.plans.length>1&&(vm.recommendation.previouslySelectedPlans=[],vm.recommendation.previouslySelectedPlanIds=[],_.each(vm.recommendation.plans,function(plan){_.each(vm.originalQuotes,function(quote){quote.Plan_Id==plan&&(vm.recommendation.previouslySelectedPlanIds.push(quote.Plan_Id),vm.recommendation.previouslySelectedPlans.push(quote))})})),vm.hideSelectedRiders(),vm.hideRecommendedRiders(),vm.recommendation.selectedPlanSuggestion=!0,0==vm.recommendation.previouslySelectedPlans.length&&vm.getRiderRecommendation(vm.preQuotesInfo.custId,vm.preQuotesInfo.enquiryId,vm.preQuotesInfo.annualIncome)},vm.buyPreviouslySelectedPlan=function(){vm.proceed(vm.recommendation.previouslySelectedPlans[0],vm.recommendation.plan_index)},vm.comparePreviouslySelectedPlans=function(){clearComparePlans(),vm.comparePlanIds=vm.recommendation.previouslySelectedPlanIds,setComparePlans(!1),updateCompareStachel(),vm.showCompareStachel=vm.comparePlanIds.length>0,vm.goToCompare()},vm.hideSuggestedPlanCompareSuggestion=function(){vm.recommendation.selectedPlanSuggestion=!1},vm.removePreviouslySelectedPlan=function(plan){var planId=plan.Plan_Id||plan.planId,index=vm.comparePlanIds.indexOf(planId);vm.comparePlanIds.splice(index,1);var i=vm.recommendation.previouslySelectedPlans.indexOf(planId);vm.recommendation.previouslySelectedPlans.splice(i,1);var j=vm.recommendation.previouslySelectedPlanIds.indexOf(planId);vm.recommendation.previouslySelectedPlanIds.splice(j,1)},vm.getChatbot=function(leadId){var chatUrl=termConfigObj.getchatBotUrlPath()+btoa(leadId);vm.chatBotUrl=$sce.trustAsResourceUrl(chatUrl)},chatEventListener=function(event){if("ready"==event.data.fn?(vm.isChatbotLoaded=!0,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,event:"chatbot_ready",pageName:"Quotes"}),!vm.chatbotframe&&showChatBot&&(vm.chatbotframe=!0)):"offline"==event.data.fn&&vm.chatbotframe&&(vm.chatbotframe=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,event:"chatbot_offline",pageName:"Quotes"})),"actualcover"==event.data.parameter&&pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,actualCover:event.data.value,event:"chatbot_actualcover",pageName:"Quotes"}),"covertillage"==event.data.parameter){var covertillage=event.data.value;chatUrlForActualCover=termConfigObj.getChatInfo()+event.data.rid,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,covertillage:covertillage,event:"chatbot_covertillage",pageName:"Quotes"}),vm.getCustomerInformationFromChatbot=function(chatUrlForActualCover){return ServerUtilityService.getWebService(chatUrlForActualCover,null).success(function(data,status,headers,config){return pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,data:data,event:"chatbot_cust_info_fetch_success",pageName:"Quotes"}),data}).error(function(data,status,headers,config){return pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,data:data,event:"chatbot_cust_info_fetch_error",pageName:"Quotes"}),data})},vm.getCustomerInformationFromChatbot(chatUrlForActualCover).then(function(data){vm.modifySelection.policyCoverage!=covertillage&&covertillage>vm.preQuotesInfo.customerAge+10&&covertillage<=99&&(vm.modifySelection.policyCoverage=covertillage,vm.modifySelection.payTerm=covertillage);var actualcover=data.data.params.ActualCover;vm.modifySelection.totalPayout!=actualcover&&actualcover>1e6&&actualcover<=2e8&&!$rootScope.isMonthlyIncomeJourney&&!$rootScope.pTabName.monthlyPlans&&(vm.modifySelection.totalPayout=actualcover),vm.saveCustomerSelection("payTerm")})}},window.addEventListener("message",chatEventListener,!1),angular.element(document).ready(function($event){angular.element($window).bind("message",function($event){if("ready"==event.data.fn?(pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,event:"chatbot_ready",pageName:"Quotes"}),vm.isChatbotLoaded=!0,!vm.chatbotframe&&showChatBot&&(vm.chatbotframe=!0)):"offline"==event.data.fn&&vm.chatbotframe&&(vm.chatbotframe=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,event:"chatbot_offline",pageName:"Quotes"})),"actualcover"==event.data.parameter&&pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,actualcover:event.data.value,event:"chatbot_actualcover",pageName:"Quotes"}),"covertillage"==event.data.parameter){var covertillage=event.data.value;pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,roomId:event.data.rid,actualcover:covertillage,event:"chatbot_covertillage",pageName:"Quotes"}),chatUrlForActualCover=termConfigObj.getChatInfo()+event.data.rid,vm.getCustomerInformationFromChatbot=function(chatUrlForActualCover){return ServerUtilityService.getWebService(chatUrlForActualCover,null).success(function(data,status,headers,config){return pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,data:data,event:"chatbot_cust_info_success_error",pageName:"Quotes"}),data}).error(function(data,status,headers,config){return pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,data:data,event:"chatbot_cust_info_fetch_error",pageName:"Quotes"}),data})},vm.getCustomerInformationFromChatbot(chatUrlForActualCover).then(function(data){vm.modifySelection.policyCoverage!=covertillage&&covertillage>vm.preQuotesInfo.customerAge+10&&covertillage<=99&&(vm.modifySelection.policyCoverage=covertillage,vm.modifySelection.payTerm=covertillage);var actualcover=data.data.params.ActualCover;vm.modifySelection.totalPayout!=actualcover&&actualcover>1e6&&actualcover<=2e8&&!$rootScope.isMonthlyIncomeJourney&&!$rootScope.pTabName.monthlyPlans&&(vm.modifySelection.totalPayout=actualcover),vm.saveCustomerSelection("payTerm")})}})});var chatbot_hide_threshold_time=termConfigObj.getChatbotHideThresholdTime();setTimeout(function(){!vm.isChatbotLoaded&&showChatBot&&(vm.chatbotframe=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.preQuotesInfo.visitId,event:"chatbot_not_loaded_within_time",pageName:"Quotes"}))},chatbot_hide_threshold_time),vm.showCustomizedPlansBoundaryMessage=function(){return!!(!vm.customizePlan.apply||"none"!==vm.customizePlan.ciType||1*vm.customizePlan.accidentalDeathProtection||1*vm.customizePlan.highClaimSettlements)&&(vm.customizePlan.apply&&vm.quotes.length>0&&(vm.setToDefaultVisible=!0),vm.customizePlan.apply&&vm.quotes.length>0)},vm.isCustomizedPlan=function(plan){return QuotesService.isCustomizedPlan(plan,vm.customizePlan)},vm.seeCustomPlan=function(){var changeInRiders=!1;vm.customizePlan.apply=!0;var annualIncome=CustomerService.DecodeAnnualIncome(vm.customizePlan.annualIncome);_.each(vm.types,function(type){type.status=!1,15==type.id&&("enhanced"!==vm.customizePlan.ciType||type.status?type.status&&(type.status=!1,changeInRiders=!0):(type.status=!0,changeInRiders=!0)),11==type.id&&("basic"!==vm.customizePlan.ciType||type.status?type.status&&(type.status=!1,changeInRiders=!0):(type.status=!0,changeInRiders=!0)),10==type.id&&(vm.customizePlan.accidentalDeathProtection&&!type.status?(type.status=!0,changeInRiders=!0):type.status&&(type.status=!1,changeInRiders=!0))}),vm.customizePlan.payType!=vm.type.payType&&(vm.type.payType=1*vm.customizePlan.payType,$localStorage.payOptionType=vm.type.payType),vm.modifySelection.annualIncome!=1*annualIncome&&(vm.modifySelection.annualIncome=1*annualIncome,vm.modifySelection.policyCoverage==1*vm.customizePlan.policyCoverage&&vm.modifySelection.totalPayout==1*vm.customizePlan.totalPayout||(vm.modifySelection.policyCoverage=1*vm.customizePlan.policyCoverage,vm.modifySelection.totalPayout=1*vm.customizePlan.totalPayout),vm.updateProfileDetails(!0)),vm.modifySelection.policyCoverage!=1*vm.customizePlan.policyCoverage||vm.modifySelection.totalPayout!=1*vm.customizePlan.totalPayout?(vm.modifySelection.policyCoverage=1*vm.customizePlan.policyCoverage,vm.modifySelection.totalPayout=1*vm.customizePlan.totalPayout,vm.tab.tabValue!=vm.customizePlan.tab?(vm.tab.tabValue=1*vm.customizePlan.tab,vm.changeTabRadio()):vm.getQuotes(vm.modifySelection)):vm.tab.tabValue!=vm.customizePlan.tab&&(vm.tab.tabValue=1*vm.customizePlan.tab,vm.changeTabRadio()),changeInRiders&&addRiderValuesToThePlans(),vm.closeCustomizePlanModal(),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"enable_customize_plan",data:{tab:vm.customizePlan.tab,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.customizePlan.payType,highClaimSettlements:vm.customizePlan.highClaimSettlements,annualIncome:vm.customizePlan.annualIncome,policyCoverage:vm.customizePlan.policyCoverage},pageName:"Quotes",click:"See Plans",collection:"customize_term_plan"})},vm.changeStep=function(step){"forward"===step?(vm.customizePlan.stage+=1,vm.customizePlan.direction=1):(vm.customizePlan.stage-=1,vm.customizePlan.direction=0),vm.customizePlan.annualIncome=vm.customizePlan.annualIncome.toString(),vm.customizePlan.policyCoverage=vm.customizePlan.policyCoverage.toString(),vm.customizePlan.totalPayout=vm.customizePlan.totalPayout.toString(),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"change_page_customize_plan",data:{step:step,stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"Next Step",collection:"customize_term_plan"})},vm.openCustomizePlanModal=function(){vm.customizePlan.annualIncome=CustomerService.minOfAnnualIncomeRange(vm.modifySelection.annualIncome),vm.customizePlan.policyCoverage=vm.modifySelection.policyCoverage.toString(),vm.customizePlan.totalPayout=vm.customizePlanPayoutRecommendation(vm.customizePlan.annualIncome),vm.customizePlan.tab=vm.tab.tabValue,vm.customizePlan.ciType="none",vm.customizePlan.accidentalDeathProtection=0,vm.customizePlan.stage=1;var ciTypeBasic=!1,accidentalDeathProtection=!1;_.each(vm.types,function(type){11==type.id&&type.status&&(ciTypeBasic=!0,vm.customizePlan.ciType="basic"),15==type.id&&type.status&&(ciTypeEnhance=!0,vm.customizePlan.ciType="enhanced"),10==type.id&&type.status&&(accidentalDeathProtection=!0,vm.customizePlan.accidentalDeathProtection=1)}),vm.toggleModal("customizeModal","show"),vm.customizePlan.apply=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"show_customize_plan",data:{tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"Customize your own Plan",collection:"customize_term_plan"}),!vm.customizePlan.apply},vm.customizePlanUpdatePayout=function(){vm.customizePlan.totalPayout=vm.customizePlanPayoutRecommendation(vm.customizePlan.annualIncome),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_payout_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"annual_income_drop_down_update",collection:"customize_term_plan"})},vm.customizePlanPayoutRecommendation=function(input){return CustomerService.recommendCover(input)},vm.closeCustomizePlanModal=function(){vm.toggleModal("customizeModal","hide"),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"close_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"close_customize_plan",collection:"customize_term_plan"})},vm.customizeUpdate=function(value){var prev_annualIncome=vm.customizePlan.annualIncome;vm.customizePlan.annualIncome=value,vm.customizePlanUpdatePayout(),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_annual_income_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout,previousAnnualIncome:prev_annualIncome},pageName:"Quotes",click:"annual_income_drop_down_update",collection:"customize_term_plan"})},vm.customizetotalPayoutUpdate=function(value){var prev_total_payout=vm.customizePlan.totalPayout;vm.customizePlan.totalPayout=value,vm.customizePlan.totalPayout=vm.customizePlan.totalPayout.toString(),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_payout_customize_plan",
data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout,previousPayout:prev_total_payout},pageName:"Quotes",click:"payout_drop_down_update",collection:"customize_term_plan"})},vm.customizecoverageUptoUpdate=function(value){var prev_coverage=vm.customizePlan.policyCoverage;vm.customizePlan.policyCoverage=value,vm.customizePlan.policyCoverage=vm.customizePlan.policyCoverage.toString(),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_coverage_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout,previousPolicyCoverage:prev_coverage},pageName:"Quotes",click:"coverage_drop_down_update",collection:"customize_term_plan"})},vm.customizePlanUpdateTab=function(){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_tab_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"tab_radio_button_update",collection:"customize_term_plan"})},vm.customizePlanCiType=function(){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_ci_type_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"ci_type_radio_button_update",collection:"customize_term_plan"})},vm.customizePlanaccidentalDeathProtection=function(){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_accidental_death_protection_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"accidental_death_protection_radio_button_update",collection:"customize_term_plan"})},vm.customizePlanpayType=function(){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_pay_type_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,previousPayType:vm.modifySelection.payType,payType:vm.customizePlan.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"pay_type_radio_button_update",collection:"customize_term_plan"})},vm.customizePlanhighClaimSettlements=function(){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"update_high_claim_settlement_customize_plan",data:{stage:vm.customizePlan.stage,tab:vm.tab.tabValue,ciType:vm.customizePlan.ciType,accidentalDeathProtection:vm.customizePlan.accidentalDeathProtection,payType:vm.modifySelection.payType,annualIncome:vm.modifySelection.annualIncome,policyCoverage:vm.modifySelection.policyCoverage,payout:vm.customizePlan.totalPayout},pageName:"Quotes",click:"high_claim_settlement_radio_button_update",collection:"customize_term_plan"})},vm.getCustomerInformation=function(enquiryId,isCalledOnApply){var deferred=$q.defer();return CustomerService.getCustomerInformation(enquiryId).success(function(data,status,headers,config){if(data){CommonServiceTerm.saveUTMSourcesToScope(data),vm.isAffiliates=$rootScope.utmSource&&"offlineaffiliate"==$rootScope.utmSource.toLowerCase();var agentId=data.agentId||0;vm.agentObj.isAgent=agentId>0||void 0!=$routeParams.LeadId||null!=$routeParams.LeadId;var cookieVal=$cookies.get("callBack"+data.enquiryId);if(custID=data.custId,vm.isCallBackAlreadyInitiated=angular.isDefined(cookieVal),vm.visitUse&&data.visitId){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("Cookie_VisitLog",data.visitId,{expires:expireDate,domain:"policybazaar.com"})}GenericService.verifyMobileNumber(data).success(function(verifyMobileNumberObj,status,headers,config){vm.isInternalIP=!verifyMobileNumberObj.isValidMobile}),customerSuccessCallback(data,isCalledOnApply),deferred.resolve(data)}}),deferred.promise},vm.getCustomerInformation(vm.enquiryId).then(function(data){if(data.matrixLeadId){try{dataLayer.push({LeadID:data.matrixLeadId}),dataLayer.push({event:"termLead"})}catch(err){}CommonServiceTerm.createRevisit({leadId:data.matrixLeadId,productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),pageName:"QuotesPage"})}}),vm.changeDisplayNumberFormat=function(num){return num?CommonServiceTerm.changeDisplayNumberFormat(num):0},vm.addCommas=function(nStr){return GenericService.addCommas(nStr)},vm.getAge=function(dateString){return dateString?CommonServiceTerm.getAge(dateString):""},vm.handlePayoutFocusBlur=function(keyName,id){angular.forEach(vm.payout,function(value,key){vm.payout[key]=!1}),vm.payout[keyName]=!0,$timeout(function(){QuotesService.saveAndEditButton(keyName,"#totalPayout-edit",vm.modifySelection.totalPayout,vm.modifySelection.custId)},100)},vm.handleMonthlyIncomeFocusBlur=function(keyName){angular.forEach(vm.monthlyIncome,function(value,key){vm.monthlyIncome[key]=!1}),vm.monthlyIncome[keyName]=!0,$timeout(function(){QuotesService.saveAndEditButton(keyName,"#monthlyIncome-edit",vm.modifySelection.totalPayout,vm.modifySelection.custId)},100)},vm.handlePolicyDurationFocusBlur=function(keyName){angular.forEach(vm.policyDuration,function(value,key){vm.policyDuration[key]=!1}),vm.policyDuration[keyName]=!0,$timeout(function(){"isEditable"==keyName?($(".save-btn").addClass("rightm3"),$(".edit-btn2").addClass("leftm3"),$rootScope.isMobileDevice||$("#policyTerm-edit").focus(),gaTagsNew.trackEditOrSavePayOrCover("CoverDurationFilterClick",vm.modifySelection.policyCoverage,$cookies.get("pTabName"),vm.modifySelection.custId)):($(".save-btn").removeClass("rightm3"),$(".edit-btn2").removeClass("leftm3"))},100)},vm.focusField=function(id){$timeout(function(){$("#"+id).focus()},100)},vm.getToastPosition=function(){return Object.keys(vm.toastPosition).filter(function(pos){return vm.toastPosition[pos]}).join(" ")},vm.emailQuotesSuccessCallback=function(){$mdToast.show($mdToast.simple().content("Email has been sent successfully!").position(vm.getToastPosition()).hideDelay(3e3)),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Email click",pageName:"Quotes",click:"Click"})},vm.emailQuotesFailureCallback=function(){$mdToast.show($mdToast.simple().content("Failed to send email!").position(vm.getToastPosition()).hideDelay(3e3))},vm.validateEmail=function(){var EMAIL_REGEXP=/^[_a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;EMAIL_REGEXP.test(vm.emailQuotesInput)?vm.showLink.emailSubmitButton=!0:vm.showLink.emailSubmitButton=!1},vm.submitAndUpdateEmailId=function(){vm.modifySelection.emailId=vm.emailQuotesInput,vm.modifySelection&&1*vm.modifySelection.countryId!=392?(vm.modifySelection.cityId=9999,vm.modifySelection.stateId=99):(vm.modifySelection.cityId=551,vm.modifySelection.stateId=35),CustomerService.updateCustomerProfile(vm.modifySelection,vm.enquiryId,!0,!1).success(function(data,status,headers,config){vm.toggleModal("emailQuotesModal","hide"),"success"==data.status&&vm.emailQuotes()})},vm.emailQuotes=function(){if(!vm.modifySelection.emailId||""==vm.modifySelection.emailId)return vm.emailQuotesInput="",void vm.toggleModal("emailQuotesModal","show");gaTagsNew.editProfileTrack("EmailPlans",-1,vm.modifySelection.custId);var allQuotes=vm.quotes.concat(vm.newQuotes);vm.showLink.emailback=!1,QuotesService.emailQuotes(allQuotes,vm.modifySelection).success(function(data,status,headers,config){$timeout(function(){"success"==data.status?vm.emailQuotesSuccessCallback():vm.emailQuotesFailureCallback()},100)}).error(function(data,status,headers,config){vm.emailQuotesFailureCallback()})},vm.callBack=function($event,waitForMessage){vm.createTwoCallBackCookie(vm.preQuotesInfo.enquiryId),vm.showLink.callback=!1,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:"On Call now click",pageName:"Quotes",click:"Click"}),waitForMessage||showMdToast("Thank You! We will call you back shortly",5e3),CustomerService.callbackUrl(vm.preQuotesInfo).then(function(data){data.data&&waitForMessage&&data.data.message&&data.data.message.length>0?showMdToast(data.data.message,5e3):showMdToast("Thank You! We will call you back shortly",5e3)})},vm.removeArrow=function(plan,val){return plan.ComboTotalPremium+plan.riderPremiumAdded>=val},vm.isMonthlyIncomePlan=function(){return $rootScope.pTabName.monthlyPlans},vm.validatePayTerm=function(payTerm,coverageUpto){var errorMsg,isValid=!0;if(1*vm.type.payType===3){var payTermValue=payTerm?payTerm:1*vm.type.ppt,coverageUptoValue=coverageUpto?coverageUpto:1*vm.preQuotesInfo.policyCoverage;isValid=coverageUptoValue>vm.preQuotesInfo.customerAge+payTermValue,!isValid&&coverageUpto&&(errorMsg="Cover should be greater than "+(vm.preQuotesInfo.customerAge+payTermValue)),!isValid&&payTerm&&(errorMsg="Pay term should be less than "+(coverageUptoValue-vm.preQuotesInfo.customerAge))}return isValid+":"+errorMsg},vm.changePPT=function(){vm.isQuotesLoaded=!1,vm.getQuotes(vm.modifySelection)},vm.changeTabRadio=function(){var pbTrackerEvent;1*vm.tab.tabValue===1?($rootScope.pTabName.onetimePlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$rootScope.pTabName.limitedPay=!1,vm.changeParentTab("onetimePlans"),pbTrackerEvent="On Lumpsum click"):1*vm.tab.tabValue===2?($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!0,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$rootScope.pTabName.limitedPay=!1,vm.changeParentTab("monthlyPlans"),pbTrackerEvent="On Monthly income plans click"):1*vm.tab.tabValue===3?($rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!0,$rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$rootScope.pTabName.limitedPay=!1,vm.changeParentTab("allPlans"),pbTrackerEvent="On All Plans click"):1*vm.tab.tabValue===4?($rootScope.pTabName.tropPlans=!0,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$rootScope.pTabName.limitedPay=!1,vm.changeParentTab("tropPlans"),pbTrackerEvent="On Return of premium click"):1*vm.tab.tabValue===5?($rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!0,$rootScope.pTabName.limitedPay=!1,vm.changeParentTab("wholeLifePlans"),pbTrackerEvent="On Plan for 100 years click",vm.checked.disableRadio=!1,vm.changePolicyTerm(!1,vm.maxAllowedPolicyCoverage)):1*vm.tab.tabValue===6&&($rootScope.pTabName.tropPlans=!1,$rootScope.pTabName.onetimePlans=!1,$rootScope.pTabName.monthlyPlans=!1,$rootScope.pTabName.allPlans=!1,$rootScope.pTabName.wholeLifePlans=!1,$rootScope.pTabName.limitedPay=!0,vm.checked.disableRadio=!1,vm.limitedPayoutProceed()),vm.payout.isEditable=vm.monthlyIncome.isEditable=vm.policyDuration.isEditable=!1,vm.payout.isReadable=vm.monthlyIncome.isReadable=vm.policyDuration.isReadable=!0,$(".save-btn").removeClass("rightm3"),$(".edit-btn1").removeClass("leftm3"),$(".edit-btn2").removeClass("leftm3"),defaultRiderPremiums=[],planIdsArray=[],QuotesService.setPlanIdsArray(),$("body").scrollTop(0),$("html, body").animate({scrollTop:0},"fast"),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:pbTrackerEvent,pageName:"Quotes",click:"Click"})},vm.changeParentTab=function(keyName){if(parentTabName!==keyName){if(vm.isAllRiderLoaded=!1,vm.quotes=[],vm.newQuotes=[],allPlansData=[],vm.isQuotesLoaded=!1,vm.checked.disableRadio=!0,vm.quotesResolved=!1,vm.isMonthlyIncomePlan()?angular.isUndefined(vm.modifySelection.monthlyIncome)&&(vm.modifySelection.monthlyIncome=vm.preQuotesInfo.monthlyIncome):angular.isUndefined(vm.modifySelection.totalPayout)&&(vm.modifySelection.totalPayout=vm.preQuotesInfo.totalPayout),"monthlyPlans"===parentTabName||"monthlyPlans"===keyName)vm.getQuotes(vm.modifySelection),parentTabName=keyName,vm.setToDefault();else{parentTabName=keyName;var filteredObj=GenericService.filterAllObjs(quotes,vm.modifySelection);filteredObj=QuotesService.assignMedicalInfo(filteredObj,vm.medicalGridInfo,vm.isAffiliates),filteredObj=QuotesService.assignCustomerEligibility(filteredObj,vm.customerEligibility),"tropPlans"==keyName&&vm.callIciciTrop(filteredObj),$timeout(function(){vm.quotes=vm.quotesUpdateInitiated?[]:angular.copy(filteredObj),vm.isQuotesLoaded=!vm.quotesUpdateInitiated,vm.setToDefault(),vm.quotes=GenericService.setRiderObject(vm.quotes,vm.preQuotesInfo,vm.quotesObj.isMonthly),vm.newQuotes.length>0&&(vm.newQuotes=GenericService.setRiderObject(vm.newQuotes,vm.preQuotesInfo,vm.quotesObj.isMonthly)),$rootScope.pTabName.tropPlans?vm.hideObject.isTropNotPresent=!(vm.quotes.length>0):vm.hideObject.isTropNotPresent=!1,setComparePlans(!1),$timeout(function(){riderUpdateCall().then(function(){vm.isAllRiderLoaded=!0;var selectedRiders=getSelectedRidersList();sudoSelectedRiderList=angular.copy(selectedRiders),optimizeRiderService?addRiderValuesToThePlans(!0):selectedRiders.length>0&&addRiderValuesToThePlans()})},10)},0)}angular.forEach($rootScope.pTabName,function(value,key){$rootScope.pTabName[key]=!1}),gaTagsNew.trackTabNameChange(keyName),$rootScope.pTabName[keyName]=!0,$cookies.put("pTabName",keyName),"allPlans"==keyName&&($rootScope.tabName.maxPayout=!0)}};var modelDataSyncup=function(){angular.copy(vm.modifySelection,vm.preQuotesInfo),$rootScope.isMobileDevice&&angular.copy(vm.filterQuotesObj,vm.modifySelection)};vm.toggleModal=function(modalName,status){var modalHashMap={profile:"profileModal",spouse:"spouseProfileModal",child:"childProfileModal",planSelection:"planSelectionModal",planDetail:"planDetailModal",riderModal:"riderModal",payoutModal:"payoutModal",annualIncomeModal:"annualIncomeModal",customizeModal:"customizeModal",progressiveModal:"progressiveModal",term_popup_modal2:"term_popup_modal2",emailQuotesModal:"emailModel",customModels:"customModels"};"payoutModal"===modalName||"progressiveModal"===modalName?"hide"===status?$("#"+modalHashMap[modalName]).modal(status):$("#"+modalHashMap[modalName]).modal({backdrop:"static",keyboard:!1}):$("#"+modalHashMap[modalName]).modal(status)};var successCallbackProfile=function(isCalledOnApply){setContinueButtonDisabled(!1),modelDataSyncup(),vm.setArrowLoaderObject(!0,!1),vm.toggleModal("profile","hide");var policyTerm=QuotesService.getPolicyTerm(vm.modifySelection);policyTerm>=10?vm.getCustomerInformation(vm.enquiryId,isCalledOnApply):(vm.modifySelection.policyCoverage=parseInt(vm.modifySelection.customerAge,10)+10,vm.saveCustomerSelection(isCalledOnApply))};vm.updateEligibilityDetails=function(form){var input=angular.copy(vm.modifySelection);vm.showLoaderCustom=!0;var postData={age:CommonServiceTerm.getAge(input.dob),enquiryId:vm.enquiryId,annualIncome:vm.data.annualIncome,professionType:vm.data.professionType,educationQualification:vm.data.qualification,sumAssured:input.totalPayout};angular.equals(vm.customerInfoPreserved.dob,vm.modifySelection.dob)||vm.updateProfileDetails(!0),vm.setArrowLoaderObject(!0,!1),verifyCustomerEligibility(postData).then(function(data){$timeout(function(){vm.toggleModal("customModels","hide")},0)})},vm.updateProfileDetails=function(isCalledOnApply,isCalledFromProgressive){!!$location.$$search.isMobileDefault;if(CustomerService.retainIsMobileDefault=!1,vm.cityerror&&!isCalledFromProgressive?(CustomerService.retainIsMobileDefault=!0,vm.modifySelection&&392!=vm.modifySelection.countryId?(vm.modifySelection.cityId=9999,vm.modifySelection.stateId=99):(vm.modifySelection.cityId=551,vm.modifySelection.stateId=35),vm.isNRI||(vm.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1)):(CustomerService.retainIsMobileDefault=!1,isCalledFromProgressive||(vm.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1)),isCalledFromProgressive&&(CustomerService.retainIsMobileDefault=!0),(vm.progressiveJourney.isNri||vm.modifySelection&&392!=vm.modifySelection.countryId)&&(vm.modifySelection.cityId=9999,vm.modifySelection.stateId=99),vm.modifySelection.isSpouseJourney=vm.isSpouseJourney,vm.isValidProfileDetails(vm.modifySelection)||"true"==vm.isValidProfileDetails(vm.modifySelection)){vm.quotes=[],vm.newQuotes=[],quotes=[],dummyPlansExist=!1,setContinueButtonDisabled(!0),vm.setArrowLoaderObject(!1,!0),vm.modifySelection.customerAge=CommonServiceTerm.getAge(vm.modifySelection.dob);var policyTerm=QuotesService.getPolicyTerm(vm.modifySelection);policyTerm<10&&(vm.modifySelection.policyCoverage=parseInt(vm.modifySelection.customerAge,10)+10),vm.modifySelection.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId(),vm.modifySelection.gaTrackerClientId=GenericService.getTrackerId();var profileUpdated=!$rootScope.isMobileDevice||vm.mobileSectionUpdateStatus.profile,selectionUpdated=vm.mobileSectionUpdateStatus.selection;vm.isCustomerDataLoaded=!1,vm.isQuotesLoaded=!!isCalledFromProgressive,$rootScope.quotesLoad=!1,vm.modifySelection.mobileNo=vm.preQuotesInfo.mobileNo,vm.modifySelection.encryptedMobileNo=vm.preQuotesInfo.encryptedMobileNo,isCalledFromProgressive&&(vm.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange(vm.modifySelection.annualIncome))),CustomerService.updateCustomerProfile(vm.modifySelection,vm.enquiryId,profileUpdated,selectionUpdated).success(function(data,status,headers,config){if("success"==data.status){CommonServiceTerm.callLeadGenerationTracking(data.matrixleadId,data.customerId,data.isMatrixLeadCreated,!1),gaTagsNew.editProfileTrack("ProfileFilterChange",-1,vm.modifySelection.custId);var enquiryId=data.enquiryId;if(void 0!==$cookies.get("CustomerEligibility")&&$localStorage.AgentId){var custData=JSON.parse($cookies.get("CustomerEligibility")),expireDate=new Date;expireDate.setDate(expireDate.getDate()+2),$cookies.put("CustomerEligibility",JSON.stringify({enquiryId:enquiryId,educationQualification:custData.educationQualification,professionType:custData.professionType,annualIncome:custData.annualIncome}),{expires:expireDate})}if($location.$$search.litePage||$localStorage.enquiryId==enquiryId)$location.search("litePage",null).replace(),successCallbackProfile(isCalledOnApply,isCalledFromProgressive);else{$rootScope.profile.spouse=!1,$rootScope.profile.child=!1;try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"termLead"})}catch(err){}$localStorage.enquiryId=data.enquiryId,$timeout(function(){vm.toggleModal("profile","hide"),$routeParams.enquiryId=data.enquiryId;var currentRoute=$location.path(),exitPointUrl=GenericService.buildExitPointUrlPrequotes(location.href,currentRoute,data.enquiryId);if(data.enquiryId&&CustomerService.setExitPointUrl(data.enquiryId,exitPointUrl,vm.modifySelection.productId).success(function(data,status,headers,config){}),vm.setArrowLoaderObject(!0,!1),setContinueButtonDisabled(!1),$rootScope.isMobileDevice)if(vm.enquiryId=data.enquiryId||vm.enquiryId,vm.mobileSectionUpdateStatus.profile||vm.mobileSectionUpdateStatus.selection){if(vm.mobileSectionUpdateStatus.coverage){var sortByCoverage=!1;sortByCoverage=vm.modifySelection.policyCoverage>75||vm.modifySelection.policyCoverage>1*vm.modifySelection.customerAge+40,!$rootScope.pTabName.wholeLifePlans||1*vm.modifySelection.policyCoverage!==99&&1*vm.modifySelection.policyCoverage!==100||(sortByCoverage=!1),filterChanged=sortByCoverage?"-newCoverageUpto":""}successCallbackCustomerSelection(isCalledOnApply)}else vm.mobileSectionUpdateStatus.riders?vm.mobileSectionUpdateStatus.paytype?vm.changePayType():vm.changeInRiderSelect():vm.mobileSectionUpdateStatus.paytype?vm.changePayType():vm.getQuotes(vm.modifySelection);else $location.path("/quotes/"+data.enquiryId).replace()},3e3)}}else vm.setArrowLoaderObject(!0,!1),setContinueButtonDisabled(!1),vm.isQuotesLoaded=!0,vm.hideObject.isNoQuotesPresent=!(vm.quotes.length>0)})}};var successCallbackSpouse=function(){setContinueButtonDisabled(!1),modelDataSyncup(),vm.toggleModal("spouse","hide"),$rootScope.profile.spouse=!0,$cookies.put("isSpouseSelected",!0),$rootScope.isMobileDevice||(vm.isQuotesLoaded=!1,vm.getQuotes(vm.modifySelection)),jointLifeRiderClicked&&(vm.changeInRiderSelect(saveJRFlags.flag,saveJRFlags.name,saveJRFlags.nameFlag),jointLifeRiderClicked=!1,saveJRFlags={})};vm.saveSpouseAgeFromProgressive=function(){vm.isQuotesLoaded=!1,vm.modifySelection.spouse.age=1*vm.progressiveJourney.spouse,$rootScope.profile&&($rootScope.profile={spouse:!0,child:!1},$rootScope.profile.spouse.age=1*vm.progressiveJourney.spouse,$rootScope.profile.spouse.isWorking=0,$rootScope.profile.spouse.spouseTobacco=0),vm.modifySelection.spouse.spouseTobacco=0,vm.modifySelection.spouse.isWorking=0,vm.modifySelection.isSpouseJourney=vm.isSpouseJourney,vm.isNRI||(vm.modifySelection.isStateChange=$cookies.get("isStateChanged")||!1),vm.progressiveJourney.visibleScreens.indexOf("spouse")===-1&&vm.progressiveJourney.visibleScreens.push("spouse"),vm.mobileSectionUpdateStatus.profile=!0,CustomerService.updateSpouseDetails(vm.modifySelection,vm.enquiryId).success(function(data,status,headers,config){$rootScope.profile.spouse=!0,$cookies.put("isSpouseSelected",!0),!vm.isNRI&&vm.isCityPopupEnabled||CustomerService.saveProfessionType(vm.modifySelection.userInfoId,vm.modifySelection.professionType).then(function(){vm.modifySelection.totalPayout=CustomerService.recommendCover(CustomerService.minOfAnnualIncomeRange(vm.modifySelection.annualIncome)),vm.updateProfileDetails(!0,!0)})});var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("last_question_answered","spouse",{expires:expireDate}),vm.isNRI||!vm.isCityPopupEnabled?hideQuestions():vm.isCityPopupEnabled&&($timeout(function(){vm.progressiveJourney.stage="city",vm.progressiveCitySelected=!1,vm.progressiveJourney.toLeft=!0,vm.progressiveJourney.toRight=!1},0),vm.progressiveJourney.visibleScreens.push("city"))},vm.updateSpouseDetails=function(form){form.$valid&&GenericService.isSpouseAgeValid(form.age.$modelValue)&&(setContinueButtonDisabled(!0),gaTagsNew.editProfileTrack("SpouseDetailsSave",vm.modifySelection.spouse.age,vm.modifySelection.custId),CustomerService.updateSpouseDetails(vm.modifySelection,vm.enquiryId).success(function(data,status,headers,config){successCallbackSpouse()}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)}))};var successCallbackChild=function(){setContinueButtonDisabled(!1),modelDataSyncup(),vm.toggleModal("child","hide"),$rootScope.profile.child=!0,$cookies.put("isChildSelected",!0),vm.getQuotes(vm.modifySelection)};vm.updateChildDetails=function(form){form.$valid&&GenericService.isChildAgeValid(form.age.$modelValue)&&(setContinueButtonDisabled(!0),gaTagsNew.editProfileTrack("ChildDetailsSave",vm.modifySelection.child.age,vm.modifySelection.custId),CustomerService.updateChildDetails(vm.modifySelection).success(function(data,status,headers,config){successCallbackChild()}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)}))},vm.isSpouseAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.spouse)&&(angular.isDefined(data.spouse)&&data.spouse&&angular.isDefined(data.spouse.age)&&data.spouse.age&&GenericService.isSpouseAgeValid(data.spouse.age)&&null!==data.spouse.tobacco&&null!==data.spouse.isWorking)},vm.isChildAdded=function(data){return!angular.isUndefined(data)&&!angular.isUndefined(data.child)&&(angular.isDefined(data.child)&&data.child&&angular.isDefined(data.child.age)&&data.child.age>=0&&GenericService.isChildAgeValid(data.child.age))},vm.checkCustomFormValid=function(){return""!=vm.data.annualIncome&&""!=vm.data.qualification},vm.editCustomerEligibility=function(){var input=angular.copy(vm.modifySelection);vm.showLoaderCustom=!1;var annualIncomeValue=CommonServiceTerm.getAnnualIncomeBoundry().filter(function(obj){return obj.id==input.annualIncome});if(vm.setArrowLoaderObject(!0,!1),vm.toggleModal("customModels","show"),vm.modifySelection.annualIncome=vm.preQuotesInfo.annualIncome.toString(),void 0!==$cookies.get("CustomerEligibility")&&$localStorage.AgentId)var custData=JSON.parse($cookies.get("CustomerEligibility"));vm.data.qualification=vm.data.qualification?vm.data.qualification:custData&&custData.educationQualification?custData.educationQualification:"",vm.data.annualIncome=vm.data.annualIncome?vm.data.annualIncome:custData&&custData.annualIncome?custData.annualIncome:annualIncomeValue&&annualIncomeValue.length>0?annualIncomeValue[0].max+1:"",vm.data.annualIncome=vm.data.annualIncome?vm.data.annualIncome.toString():"",vm.data.professionType=vm.data.professionType?vm.data.professionType:custData&&custData.professionType?custData.professionType:input.professionType,vm.customerInfoPreserved=angular.copy(vm.modifySelection)},vm.editProfile=function(){gaTagsNew.editProfileTrack("ProfileFilterClick",-1,vm.modifySelection.custId),vm.setArrowLoaderObject(!0,!1),vm.toggleModal("profile","show"),angular.isDefined(vm.selectedCityItem)&&vm.selectedCityItem.value&&(vm.cityerror=!1),vm.modifySelection.annualIncome=vm.preQuotesInfo.annualIncome.toString(),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Edit Profile click",pageName:"Quotes",Click:"Click"})};vm.addEditSpouse=function(model){vm.isSpouseAdded(vm.preQuotesInfo)?($cookies.put("isSpouseSelected",model),vm.isQuotesLoaded=!1,vm.getQuotes(vm.modifySelection)):handleAddSpouse();var modifySelection=angular.copy(vm.modifySelection);CustomerService.updateSpouseDetails(modifySelection,vm.enquiryId).success(function(data,status,headers,config){}).error(function(data,status,headers,config){setContinueButtonDisabled(!1)})};vm.addEditChild=function(model){vm.isChildAdded(vm.preQuotesInfo)?($cookies.put("isChildSelected",model),vm.getQuotes(vm.modifySelection)):handleAddChild()};var showTheModal=function(plan){var deferred=$q.defer();return vm.hideObject.loadSummaryPage=!0,deferred.resolve(!0),deferred.promise},openPlanDetail=function(plan,index){GenericService.setPlanId(plan.Plan_Id);var planName=plan.Plan_Name.split(" ").join("-");plan.selectedRiderIds&&plan.selectedRiderIds.length>0?(CommonServiceTerm.setUpdateCalled("updateCalled"),QuotesService.updateProductRiderInfoDataFromQuotes(plan,plan.selectedRiderIds,vm.modifySelection,vm.type.payType).success(function(data){showTheModal(plan).then(function(){$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,planName,index)})})):(CommonServiceTerm.setUpdateCalled("updateNotCalled"),showTheModal(plan).then(function(){$cookies.put("planId",plan.Plan_Id),$cookies.put("basePlanId",null),productPageRedirect(plan,planName,index)}))};vm.isE2EPlans=function(plan){return termConfigObj.getE2EPlanIds().indexOf(plan.Plan_Id)>-1},vm.isPNBPlan=function(planId){return CommonServiceTerm.isPNBPlan(planId)},vm.isAegoniTermPlanNew=function(planId){return CommonServiceTerm.isAegonPlan(planId)},vm.isAegonItermPlusPlan=function(planId){return CommonServiceTerm.isAegonItermPlusPlan(planId)},vm.isHdfc3DPlan=function(planId){CommonServiceTerm.isHdfc3dPlan(vm.planDetails.planId)},vm.proceed=function(plan,index){vm.toggleModal("term_popup_modal2","hide"),819==plan.Plan_Id||820==plan.Plan_Id||821==plan.Plan_Id?forceRiderSelect(38,!0).then(function(){819==plan.Plan_Id&&plan.selectedRiderIds&&plan.selectedRiderIds.indexOf(208)==-1&&plan.selectedRiderIds.push(208),820==plan.Plan_Id&&plan.selectedRiderIds&&plan.selectedRiderIds.indexOf(209)==-1&&plan.selectedRiderIds.push(209),821==plan.Plan_Id&&plan.selectedRiderIds&&plan.selectedRiderIds.indexOf(211)==-1&&plan.selectedRiderIds.push(211),proceed(plan,index)}):proceed(plan,index)},vm.isValidSpouseDetails=function(){return vm.isSpouseAdded(vm.modifySelection)},vm.isValidChildDetails=function(){return vm.isChildAdded(vm.modifySelection)},vm.isQuotesEditable=function(){return vm.payout.isEditable||vm.monthlyIncome.isEditable},vm.isPayTermEditable=function(){return vm.policyDuration.isEditable},vm.isValidTotalPayout=function(){return!!vm.modifySelection.totalPayout&&($rootScope.pTabName.tropPlans?vm.modifySelection.totalPayout>=15e5&&vm.modifySelection.totalPayout<=2e8:vm.groupTermJourney?vm.modifySelection.totalPayout>=5e4&&vm.modifySelection.totalPayout<=35e5:vm.modifySelection.totalPayout>=1e6&&vm.modifySelection.totalPayout<=2e8)},vm.getLowerLimit=function(){return $rootScope.pTabName.tropPlans?"15L":"10L"},vm.isValidMonthlyIncome=function(){return vm.modifySelection.monthlyIncome&&vm.modifySelection.monthlyIncome>=1e4&&vm.modifySelection.monthlyIncome<=2e6},vm.isValidPolicyCoverage=function(){return vm.modifySelection.policyCoverage&&vm.modifySelection.policyCoverage>=vm.minAllowedPolicyCoverage()&&vm.modifySelection.policyCoverage<=vm.maxAllowedPolicyCoverage},vm.isQuotesInputValid=function(){return $rootScope.pTabName.monthlyPlans?vm.isValidMonthlyIncome()&&vm.isValidPolicyCoverage():vm.isValidTotalPayout()&&vm.isValidPolicyCoverage()};var successCallbackCustomerSelection=function(isCalledOnApply){$rootScope.isMobileDevice?vm.mobileSectionUpdateStatus.profile&&angular.copy(vm.modifySelection,vm.preQuotesInfo):angular.copy(vm.modifySelection,vm.preQuotesInfo),vm.quotesUpdateInitiated=!1,vm.handlePayoutFocusBlur("isReadable"),vm.handleMonthlyIncomeFocusBlur("isReadable"),vm.handlePolicyDurationFocusBlur("isReadable"),vm.getCustomerInformation(vm.enquiryId,isCalledOnApply)};vm.isProgressiveJourney=function(){return QuotesService.callMultipleTimes()&&1*vm.type.payType===1},vm.saveCustomerSelection=function(type,isCalledOnApply){void 0!==type&&gaTagsNew.populateDataToTrackOnSave(vm.modifySelection,type,$cookies.get("pTabName")),vm.termSwitchBackValue=null;var sortByCoverage=!1;sortByCoverage=vm.modifySelection.policyCoverage>75||vm.modifySelection.policyCoverage>1*vm.modifySelection.customerAge+40,!$rootScope.pTabName.wholeLifePlans||1*vm.modifySelection.policyCoverage!==99&&1*vm.modifySelection.policyCoverage!==100||(sortByCoverage=!1),filterChanged="payTerm"==type&&sortByCoverage?"-newCoverageUpto":"",vm.isQuotesInputValid()&&(defaultRiderPremiums=[],
"totalPayout"===type?(pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Payout click",pageName:"Quotes",previous_payout:vm.preQuotesInfo.totalPayout,new_payout:vm.modifySelection.totalPayout}),dummyPlansReplaced=!1):"payTerm"===type&&(pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Coverage period click",pageName:"Quotes",previous_coverage:vm.preQuotesInfo.policyCoverage,new_coverage:vm.modifySelection.policyCoverage}),1*vm.modifySelection.policyCoverage>=99&&(vm.termSwitchBackValue=angular.copy(vm.preQuotesInfo.policyCoverage))),vm.quotesUpdateInitiated=!0,"payTerm"==type||"totalPayout"===type||"monthly"===type?(vm.customerChangeInitiated=!0,vm.isQuotesLoaded=!0,vm.quotes=vm.quotes.map(function(val){return val.isDummyPlan=!0,val.ComboTotalCover=vm.modifySelection.totalPayout,val}),vm.newQuotes=vm.newQuotes.map(function(val){return val.isDummyPlan=!0,val.ComboTotalCover=vm.modifySelection.totalPayout,val}),vm.getQuotes(vm.modifySelection,"first"),"payTerm"!=type&&(vm.quotes=vm.quotes.map(function(val){return val.payoutUpdated=!0,val}),vm.newQuotes=vm.newQuotes.map(function(val){return val.payoutUpdated=!0,val}))):(vm.isQuotesLoaded=!1,vm.quotes=[],vm.newQuotes=[],allPlansData=[]),CustomerService.updateCustomerSelection(vm.modifySelection,vm.enquiryId).success(function(data,status,headers,config){"success"==data.status&&successCallbackCustomerSelection(isCalledOnApply)}))},vm.undoChanges=function(){angular.copy(vm.preQuotesInfo,vm.modifySelection),vm.handlePayoutFocusBlur("isReadable"),vm.handleMonthlyIncomeFocusBlur("isReadable"),vm.handlePolicyDurationFocusBlur("isReadable")};var executeCommonScript=function(){CustomerService.saveSelectedFilters(vm.enquiryId,vm.types,filterParam)};vm.quoteRiderSelect=function(id,status,name){name==vm.sixtyYearRiderText?(vm.riderAddOns.payTillSixtyChecbox=status,status&&(vm.togglePayTill60Clicked(),vm.payTill60Click())):(vm.riderSelectCallback(id,status,name),_.each(vm.types,function(type){110===id?10!==type.id&&15!==type.id||(type.status=status):type.id===id&&(type.status=status)}),vm.toggleRidersFn(!1))},vm.riderSelectCallback=function(id,status,name){13==id&&(!vm.isSpouseAdded(vm.preQuotesInfo)&&status&&vm.toggleModal("spouse","show"),jointLifeRiderClicked=!0),name&&name.length>0&&gaTagsNew.trackRiderSelectQuotes(name,status,vm.modifySelection.custId)},vm.changeInRiderSelect=function(flag,name,nameFlag,id){13==id?changeInJointLifeRider(flag,name,nameFlag):(name&&name.length>0&&gaTagsNew.trackRiderSelectQuotes(name,flag,vm.modifySelection.custId),callRiderChangeCategoryList(),vm.handleFilterEvents(flag))};var changeInJointLifeRider=function(flag,name,nameFlag){var isJointLifeSelected=!1;_.each(vm.types,function(val){13==val.id&&val.status&&(isJointLifeSelected=!0)}),!vm.isSpouseAdded(vm.preQuotesInfo)&&isJointLifeSelected?(vm.toggleModal("spouse","show"),jointLifeRiderClicked=!0,saveJRFlags={flag:flag,name:name,nameFlag:nameFlag}):vm.changeInRiderSelect(flag,name,nameFlag)};vm.handleFilterEvents=function(flag){vm.checked.disableRadio=!0,addRiderValuesToThePlans(),executeCommonScript()},vm.updateTypes=function(types){vm.types=angular.copy(types)},vm.updateReverseData=function(reverseData){vm.reverseData=angular.copy(reverseData)},vm.updatePayType=function(paytype){vm.type.payType=paytype},vm.updateModifySelection=function(obj){vm.modifySelection=angular.copy(obj),vm.modifySelection.cityId&&(vm.cityerror=!1)},vm.saveQuoteSelection=function(plan){var input={planId:plan.Plan_Id,refId:vm.enquiryId,productId:"7",premium:plan.FinalPremium,supplierId:plan.Supplier_Id,leadId:vm.preQuotesInfo.matrixLeadId,mobileNo:vm.preQuotesInfo.mobileNo,encryptedMobileNo:vm.preQuotesInfo.encryptedMobileNo,selectedBy:$routeParams.AgentId&&window.atob?window.atob($routeParams.AgentId):"0",ipAddress:"127.0.0.1",sourcePage:"Quotes",enquiryId:$routeParams.enquiryId};CustomerService.saveQuoteSelection(input).success(function(data,status,headers,config){})},vm.selectedCityItem={display:vm.modifySelection.city,value:vm.modifySelection.city,searchString:vm.modifySelection.city,stateId:vm.modifySelection.stateId,cityId:vm.modifySelection.cityId},vm.isValidProfileDetails=function(data){return angular.isDefined(data)&&vm.isValidAge()&&null!==data.isTobaccoUser},vm.renderTATData=function(plan){return angular.isDefined(plan.tATData)?plan.tATData:""},vm.getPlanCategoryType=function(plan){return QuotesService.getPlanCategoryType(plan)},vm.collapseHDFC3DPlan=function(){vm.hdfc3dPlanCollapsed=!0},vm.isHdfc3dPlan=function(planId){return CommonServiceTerm.isHdfc3dPlan(planId)};var handleModalPopupClose=function(){$timeout(function(){$("#profileModal").on("hide.bs.modal",function(e){var selectedCityItem=getCityObject(vm.preQuotesInfo.cityId);setSelectedCityItem(selectedCityItem),angular.copy(vm.preQuotesInfo,vm.modifySelection),extractDOB()}),$("#customModels").on("hide.bs.modal",function(e){vm.customerInfoPreserved={},angular.copy(vm.preQuotesInfo,vm.modifySelection),extractDOB()}),$("#spouseProfileModal").on("hide.bs.modal",function(e){vm.isSpouseAdded(vm.preQuotesInfo)?(angular.copy(vm.preQuotesInfo,vm.modifySelection),vm.filterQuotesObj=angular.copy(vm.modifySelection)):($rootScope.profile.spouse=!1,angular.copy(vm.preQuotesInfo,vm.modifySelection),vm.filterQuotesObj=angular.copy(vm.modifySelection),$rootScope.isMobileDevice&&_.each(vm.filterQuotesObjRiders,function(rider){13===rider.id&&(rider.status=!1,vm.$apply())}))}),$("#childProfileModal").on("hide.bs.modal",function(e){vm.isChildAdded(vm.preQuotesInfo)?angular.copy(vm.preQuotesInfo,vm.modifySelection):($rootScope.profile.child=!1,angular.copy(vm.preQuotesInfo,vm.modifySelection))})},1e3)};vm.showSwitchToWholeLifeLink=function(selectedCoverage,planId,isWholeLife){var show=!1,tabs=!!$rootScope.pTabName.onetimePlans,plans=!(!GenericService.isAegoniTermPlan(planId)&&!CommonServiceTerm.isPNBPlan(planId));return selectedCoverage<99&&tabs&&plans&&(show=!0),show},vm.switchToWholeLifeLinkText=function(planId,isWholeLife){return GenericService.isAegoniTermPlan(planId)?"Upgrade to 100 years ":CommonServiceTerm.isPNBPlan(planId)?"Upgrade to 99 years ":""},vm.clickToSwitchWholeLife=function(planId,isWholeLife){vm.changePolicyTerm(!1,vm.maxAllowedPolicyCoverage),vm.termSwitchBackValue=angular.copy(vm.preQuotesInfo.policyCoverage)},vm.wholeLifeCheckboxClick=function(){vm.riderAddOns.wholeLifeChecbox&&vm.changePolicyTerm(!1,99)},vm.togglePayTill60Clicked=function(){vm.payTill60Clicked=!0},vm.payTill60Click=function(){vm.payTill60Clicked=!1,vm.riderAddOns.payTillSixtyChecbox?vm.preQuotesInfo.policyCoverage<=60?(1*vm.type.payType!=3&&(vm.type.payType=3,$mdToast.show($mdToast.simple().content("Paytype has been changed to limited pay").position(vm.getToastPosition()).hideDelay(2e3))),vm.changePolicyTerm(!1,65)):1*vm.type.payType!=3&&(vm.type.payType=3,vm.changePayType(),$mdToast.show($mdToast.simple().content("Paytype has been changed to limited pay").position(vm.getToastPosition()).hideDelay(2e3))):1*vm.type.payType!=1&&(vm.type.payType=1,vm.changePayType(),$mdToast.show($mdToast.simple().content("Paytype has been changed to regular pay").position(vm.getToastPosition()).hideDelay(2500)))},vm.getSurvivalBenefit=function(plan){var survivalBenefit=0;if(survivalBenefit=plan.survivalBenefit&&1*plan.survivalBenefit>0?1*plan.survivalBenefit:0,survivalBenefit>0)return vm.quotesObj.isMonthly?survivalBenefit=plan.survivalBenefitMonthly&&1*plan.survivalBenefitMonthly>0?1*plan.survivalBenefitMonthly:0:survivalBenefit;switch(plan.payOptionType){case"SinglePay":survivalBenefit=plan.ComboTotalPremium/1.045;break;case"LimitedPay":survivalBenefit=vm.quotesObj.isMonthly&&1*plan.monthlyPremiumWGST>0?12*plan.monthlyPremiumWGST*plan.ppt:plan.ComboTotalPremium/1.045*plan.ppt;break;default:survivalBenefit=vm.quotesObj.isMonthly&&1*plan.monthlyPremiumWGST>0?12*plan.monthlyPremiumWGST*plan.PolicyTerm:plan.ComboTotalPremium/1.045*plan.PolicyTerm}return survivalBenefit=CommonServiceTerm.isAvivaPlan(plan.Plan_Id)?1.2*survivalBenefit:survivalBenefit},vm.isChildPlan=function(plan){return GenericService.isChildPlan(plan)},vm.renderPlanInterestRate=function(plan){return GenericService.isSBIIncomePlans(plan.Plan_Id)?plan.interestRate:(angular.isDefined(plan.interestRate)&&plan.interestRate?parseFloat(plan.interestRate.toString().replace(/%/g,""),10):0)+"%"},vm.renderPlanInterestType=function(plan){return angular.isDefined(plan.interestType)&&plan.interestType?plan.interestType:""},vm.renderPlanIncreasingValue=function(plan){return GenericService.renderPlanIncreasingValue(plan)},vm.renderPlanAnnualIncomeTerm=function(plan){return GenericService.renderPlanAnnualIncomeTerm(plan)},vm.renderPlanEnhancedSumAssured=function(plan){var enhancedText=GenericService.renderPlanEnhancedSumAssured(plan);return enhancedText&&(enhancedText=enhancedText.replace("%SA_MSG%",vm.changeDisplayNumberFormat(plan.SumAssured)),enhancedText=enhancedText.replace("%TP_MSG",vm.changeDisplayNumberFormat(plan.TotalCover)),enhancedText=enhancedText.replace("%Term_MSG%",plan.PolicyTerm<=20?plan.PolicyTerm:21)),enhancedText},vm.renderPlanAnnualIncomeTermTillYear=function(plan){return GenericService.renderPlanAnnualIncomeTermTillYear(plan)},vm.renderPlanAnnualIncomeTermTillYearText=function(plan){return GenericService.renderPlanAnnualIncomeTermTillYearText(plan)},vm.renderPlanAnnualIncomeTermOrTillYrText=function(plan){return GenericService.renderPlanAnnualIncomeTermOrTillYrText(plan)},vm.renderPlanAnnualIncomeTermOrYrText=function(plan){return GenericService.renderPlanAnnualIncomeTermOrYrText(plan)},vm.renderPlanAnnualIncomeTermOrTillYr=function(plan){return GenericService.renderPlanAnnualIncomeTermOrTillYr(plan)},vm.rendePlanAnnualIncomeMonthTerm=function(plan){return GenericService.rendePlanAnnualIncomeMonthTerm(plan)},vm.handleElementFocusIn=function(event){!$rootScope.isMobileDevice},vm.changeSort=function(name,reverse,prem){gaTagsNew.trackSorting(name,reverse,vm.modifySelection.custId);var eventName;"TotalCover"===name?eventName="On Payout click":"Claims_Settled"===name&&(eventName="On Claims Settled click"),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:eventName,pageName:"Quotes",click:"Click"});var arr=[],sortparam=name;reverse?(arr.push(sortparam),arr.push(prem)):(sortparam="-"+sortparam,arr.push(sortparam),arr.push(prem)),filterChanged=sortparam,reverse=!reverse,vm.filterArray=arr,vm.sortObj.sortByDropdownValue=1,filterParam=name.replace(/-/g,""),GenericService.saveSortApplied(filterParam),executeCommonScript(),vm.arrowName=name,vm.setToDefaultVisible=!0,$rootScope.pTabName.monthlyPlans&&callGTMImpression()},vm.changePremiumSort=function(name,reverse,prem){gaTagsNew.trackSorting(name,reverse,vm.modifySelection.custId),pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Premium click",pageName:"Quotes",click:"Click"});var arr=[],sortparam=name;reverse?(sortparam="-"+sortparam,arr.push(sortparam)):arr.push(sortparam),void 0!=prem&&arr.push(prem),filterChanged=sortparam,reverse=!reverse,vm.filterArray=arr,vm.sortObj.sortByDropdownValue=1,filterParam=name.replace(/-/g,""),vm.arrowName=name,GenericService.saveSortApplied(filterParam),executeCommonScript(),vm.setToDefaultVisible=!0,$rootScope.pTabName.monthlyPlans&&callGTMImpression()},vm.trimSpecialCharacter=function(str,delimeter){return delimeter=angular.isDefined(delimeter)?delimeter:"_",angular.isDefined(str)&&str?str.replace(delimeter," "):""},vm.navigateToHome=function(){$location.path("/")},vm.isAnyCategoryAndInbuildRiderExists=function(plan){var freeRiderExist=!1;return _.each(plan.inbuildAddOns,function(val,key){val&&(freeRiderExist=!0)}),angular.isDefined(plan.riderIdCategory)&&plan.riderIdCategory.length||freeRiderExist},vm.addRemoveAddOn=function(rider){_.each(vm.types,function(type){1*rider.categoryId===type.id&&(type.status=!!rider.isSelected)}),13==rider.categoryId?changeInJointLifeRider(!0,rider.name,rider.name):(callRiderChangeCategoryList(),addRiderValuesToThePlans(),executeCommonScript())},vm.showHundredCoverage=function(plan){var planId=plan.Plan_Id||plan.planId,notHundredCoveragePlans=[749,752,753,756,787,789,814,815,816,817];return!!plan.isWholeLifePlan&&notHundredCoveragePlans.indexOf(planId)==-1},vm.showPolicyTermForLimitedPay=function(plan){var validPlanIds=[814,787];return plan&&plan.isWholeLifePlan&&validPlanIds.indexOf(plan.Plan_Id)!=-1},vm.isNonTropPlanVisible=function(plan){var isVisible=plan.isQuotesVisible;return $rootScope.pTabName.onetimePlans?plan.isTrop&&(isVisible=!1):$rootScope.pTabName.tropPlans?plan.isLifeLongProtection&&plan.isTrop&&(isVisible=!1):$rootScope.pTabName.wholeLifePlans&&(isVisible=!(!plan.isWholeLifePlan||1*vm.type.payType==2)),isVisible},vm.isAegoniTermForverPlan=function(planId){return CommonServiceTerm.isAegoniTermForverPlan(planId)},vm.isAvivaPlan=function(planId){return CommonServiceTerm.isAvivaPlan(planId)},vm.showTillSixtyYearsRider=function(plan){return vm.isMAXPlan(plan)&&1*vm.type.payType===1},vm.showInstaClaims=function(plan){return vm.isMAXPlan(plan)},vm.showPayForTenYearsRider=function(plan){return vm.isTataPlan(plan)&&1*vm.type.payType===1},vm.showStepDownOption=function(planId){return CommonServiceTerm.isKotakPlan(planId)};var cityCallback=function(data){var newDelhiObject={CityId:"551",CityName:"New Delhi",StateId:"35",state:"Delhi"},newData=_.uniq(data.response.CityList,function(item){return item.CityId});newData.unshift(newDelhiObject),vm.city=$rootScope.isMobileDevice?GenericService.formatCityMobile(newData):GenericService.formatCity(newData)},getAllCityList=function(){var deferred=$q.defer(),cityData={};return CommonServiceTerm.getCityData().then(function(cityObj){cityData=cityObj,CommonServiceTerm.isEmptyObject(cityData)?CommonServiceTerm.getCity().success(function(data){cityCallback(data),deferred.resolve()}).error(function(data){}):(cityCallback(cityData),deferred.resolve())}),deferred.promise};vm.createTwoCallBackCookie=function(enquiryId){var expireDate=new Date;expireDate.setTime(expireDate.getTime()+12e4),$cookies.put("callBack"+enquiryId,enquiryId,{expires:expireDate,domain:"policybazaar.com"})},vm.changePolicyTerm=function(dontSort,value){1*value<=60&&($localStorage.selectedPayTerm=10,$scope.type.ppt=10),!vm.checked.disableRadio&&value&&1*vm.modifySelection.policyCoverage!==1*value&&(vm.isQuotesLoaded=!1,vm.modifySelection.policyCoverage=1*value,dontSort?vm.saveCustomerSelection():(vm.saveCustomerSelection("payTerm"),policyChangedByClick=!0,filterChanged="-newCoverageUpto",pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Max Coverage click",pageName:"Quotes",click:"Click"}))),$("html, body").animate({scrollTop:0},"slow")},vm.changePolicyTermToMin=function(){vm.checked.disableRadio||1*vm.modifySelection.policyTerm!==10&&(vm.isQuotesLoaded=!1,vm.modifySelection.policyCoverage=10+1*vm.modifySelection.customerAge,vm.saveCustomerSelection(),policyChangedByClick=!0,$localStorage.filterArray=null,pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Min Coverage click",pageName:"Quotes",click:"Click"}))},vm.riderPremiumAdded=function(plan){var show=!1;return _.each(plan.selectedRiderIds,function(val,key){_.each(plan.riderPremiumObject,function(riderVal,riderKey){1*val===riderVal.riderId&&riderVal.premium>0&&(show=!0)})}),show},vm.reversePremiumType=function(flag,plan){vm.object.showLoader=!0,$timeout(function(){vm.quotesObj.isMonthly=!flag;var premMode1=vm.quotesObj.isMonthly?"monthly":"yearly";if($cookies.put("monthPrem",premMode1),plan){var name=vm.quotesObj.isMonthly?"monthly":"yearly",array=[];array.push(name),array.push(plan.Plan_Id);var premium=0;premium=vm.quotesObj.isMonthly?$rootScope.pTabName.monthlyPlans||$rootScope.pTabName.allPlans?plan.maxMonthlyTotalPremium:plan.monthlyTotalPremium:plan.ComboTotalPremium,array.push(premium),gaTagsNew.trackChangePremiumType(array,"QuotesPage",vm.modifySelection.custId)}pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,visitId:vm.modifySelection.visitId,custId:vm.preQuotesInfo.custId,event:"On Payment freq. change click",pageName:"Quotes",click:"Click"}),vm.quotes=GenericService.checkIFADBOrATPDSelected(vm.quotes,vm.quotesObj.isMonthly,vm.types),vm.newQuotes=GenericService.checkIFADBOrATPDSelected(vm.newQuotes,vm.quotesObj.isMonthly,vm.types),vm.changeSingleSorting(null,!0),$timeout(function(){vm.object.showLoader=!1},500)},500)},vm.changeComparedPlanName=function(plan){return vm.isHdfc3dPlan(plan.planId)?853==plan.planId?"Income Option Increasing Monthly Income":855==plan.planId?"Income Replacement Option Increasing Monthly Income":plan.planShortName:plan.planName||plan.Plan_Name},vm.changeComparedSupplierName=function(plan){return 700===plan.supplierId||77===plan.supplierId?"SBI Life":plan.E2EName},vm.compareCheckboxClick=function(plan){(vm.addonrecommendation.showSelectedRider||vm.addonrecommendation.showRiderRecommendation)&&(vm.hideSelectedRiders(),vm.hideRecommendedRiders()),vm.recommendation.selectedPlanSuggestion?(vm.hideSuggestedPlanCompareSuggestion(),clearComparePlans(),vm.recommendation.previouslySelectedPlanIds.push(plan.Plan_Id),vm.comparePlanIds=vm.recommendation.previouslySelectedPlanIds,setComparePlans(!1),updateCompareStachel(),vm.showCompareStachel=vm.comparePlanIds.length>0):plan.isCompareSelected?vm.checkToCompare(plan):vm.removePlanFromCompare(plan),vm.showCompareStachel&&(vm.shrinkCustomizeStachel=!0)},vm.checkToCompare=function(plan,comingBackFromComparePage){var planId=plan.Plan_Id||plan.planId;if(CommonServiceTerm.isAegonItermPlusPlan(planId)&&(planId=818),vm.hideObject.singleComparePlanMessage=!0,vm.showCompareStachel=!0,vm.comparePlans.length>=vm.compareLimit)return $mdToast.show($mdToast.simple().content("Maximum Plans Selected For Comparison").position(vm.getToastPosition()).hideDelay(3e3)),plan.isCompareSelected=!1,!1;var index=vm.comparePlanIds&&vm.comparePlanIds.length>0?vm.comparePlanIds.indexOf(planId):-1;index==-1&&(vm.comparePlanIds.push(planId),CompareService.setComparePlanIds(vm.comparePlanIds),vm.comparePlans=CompareService.pushPlansToComparingList(vm.comparePlans,plan),pbTrackerObj.logEvent({leadId:vm.modifySelection.matrixLeadId,custId:vm.modifySelection.custId,visitId:vm.modifySelection.visitId,event:"Add To Compare",pageName:"Quotes",planId:plan.Plan_Id}),comingBackFromComparePage||(vm.showCompareStachel=vm.comparePlanIds.length>0),CompareService.saveComparingPlanIds(vm.modifySelection.custId,vm.comparePlanIds)),setComparePlans(!1)},vm.removePlanFromCompare=function(plan){var planId=plan.Plan_Id||plan.planId,index=vm.comparePlanIds.indexOf(planId);vm.hideObject.singleComparePlanMessage=!0,vm.comparePlanIds.splice(index,1),CompareService.setComparePlanIds(vm.comparePlanIds),pbTrackerObj.logEvent({leadId:vm.modifySelection.matrixLeadId,custId:vm.modifySelection.custId,visitId:vm.modifySelection.visitId,event:"Remove From Compare",pageName:"Quotes",planId:plan.planId}),vm.comparePlans&&vm.comparePlans.length>0&&(vm.comparePlans=vm.comparePlans.filter(function(comparedPlan){return comparedPlan.planId!=planId})),CompareService.saveComparingPlanIds(vm.modifySelection.custId,vm.comparePlanIds),vm.showCompareStachel=vm.comparePlanIds.length>0,setComparePlans(!1)},vm.removeAllComparePlans=function(){clearComparePlans()},vm.goToCompare=function(){if(vm.isQuotesLoaded=!1,vm.comparePlanIds.length>=2){var tabName="ONETIMEPLANS";"1"==vm.tab.tabValue?tabName="ONETIMEPLANS":"2"==vm.tab.tabValue?tabName="MONTHLYPLANS":"3"==vm.tab.tabValue?tabName="ALLPLANS":(vm.tab.tabValue="4")&&(tabName="TROPPLANS");var allPlans=[];allPlans=allPlansData&&allPlansData.length>0?CompareService.filterAllObjs(allPlansData,vm.modifySelection):CompareService.filterAllObjs(quotes,vm.modifySelection);var isAllMonthlyPlan=!0;_.each(vm.comparePlans,function(plan){plan.isMonthlyPlan||(isAllMonthlyPlan=!1)}),isAllMonthlyPlan=!(!isAllMonthlyPlan||"2"!=vm.tab.tabValue),isAllMonthlyPlan&&(allPlans=[]),pbTrackerObj.logEvent({leadId:vm.modifySelection.matrixLeadId,custId:vm.modifySelection.custId,visitId:vm.modifySelection.visitId,event:"Go To Compare page",pageName:"Quotes",comparingPlanIds:vm.comparePlanIds}),CompareService.setComparePlanIds(vm.comparePlanIds),CompareService.setIsAllMonthlyPlan(isAllMonthlyPlan),CompareService.saveComparingPlanIds(vm.modifySelection.custId,vm.comparePlanIds,isAllMonthlyPlan),CompareService.saveCustomerInfo(vm.modifySelection.customerAge),CompareService.saveQuotesOrder(vm.enquiryId,tabName,vm.quotes,allPlans).success(function(data,status){GenericService.isUndefinedOrNull(data)?clearComparePlans():"success"==data.status?$location.path("/compare/"+vm.enquiryId):clearComparePlans()}).error(function(data,success){clearComparePlans()})}else vm.hideObject.singleComparePlanMessage=!1},vm.changeName=function(id,plan,name){var supplierId=plan.Supplier_Id,aegonNotVisiblePlans=[818,819,820,821],planId=plan.Plan_Id;if(11==supplierId){if(10==id)return"Accidental Death and Disability";if(11==id)return"Critical Illness and Disability"}if(aegonNotVisiblePlans.indexOf(planId)>-1){if(1*id===11)return"Basic CI + Waiver Of Premium";if(1*id===15)return"Enhanced CI + Waiver Of Premium"}return 1*planId===819&&1*id===10?"Accidental Death + Waiver Of Premium":1!=supplierId||12!=id||$rootScope.isMobileDevice?GenericService.isMAXPlan(planId)&&38==id?"Waiver of Premiums":CommonServiceTerm.isTataPlan(planId)&&12==id?"Death and disability due to accident":116!=supplierId&&10!=supplierId||38!=id?10==supplierId&&10==id?"Death and disability due to accident":CommonServiceTerm.isHdfc3dPlan(planId)&&101==id?"Waiver of premium and terminal illness":vm.isPNBPlan(planId)&&11==id?"Serious illness":name:"Waiver of premium on critical illness":"Death & Disability due to accident"},vm.isAegonObjAvailable=function(){return null!==vm.aegonObj&&void 0!==vm.aegonObj&&!CommonServiceTerm.isEmptyObject(vm.aegonObj)},vm.getNameAccordingToPayType=function(){return 2==vm.type.payType?"Single Pay":3==vm.type.payType?"Limited Pay":""},vm.sortByPlanType=function(){vm.sortingInitiated=!0,$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?vm.changeSingleSorting():vm.changeSorting(),delete vm.sortingInitiated},vm.riderAvailabilityStatus=function(rider,plan){if(rider){var premium=vm.quotesObj.isMonthly?rider.monthlyPremium:rider.premium,isIncluded=rider.isIncluded;return vm.isPNBPlan(plan.Plan_Id)&&13==rider.categoryId?vm.modifySelection.policyCoverage>75?"-":"Available":premium||isIncluded?"Available":"-"}return"-"},vm.dontUpdateSpouseRider=function(){$rootScope.profile.spouse||(jointLifeRiderClicked&&(_.each(vm.types,function(val){1*val.id===13&&(val.status=!1)}),jointLifeRiderClicked=!1,getSelectedRidersList().sort().join(",")!==sudoSelectedRiderList.sort().join(",")&&(callRiderChangeCategoryList(),addRiderValuesToThePlans())),$rootScope.profile.spouse=!1)},vm.onClickFaqLink=function(){pbTrackerObj.logEvent({leadId:vm.preQuotesInfo.matrixLeadId,custId:vm.preQuotesInfo.custId,visitId:vm.modifySelection.visitId,event:"On Faq link Click",pageName:"Quotes",click:"Click"})},vm.onPreviousSessionClick=function(e){e.preventDefault(),e.stopPropagation()},angular.element(document).ready(function(){$(this).click(function(e){$(".selctbox").removeClass("shown")}),$(document).click(function(){vm.showRidersSuggestionStachel&&vm.previousRiderSelection.length>0&&vm.closeRestoreSessionMsg()}),$timeout(function(){vm.showRidersSuggestionStachel&&vm.previousRiderSelection.length>0&&vm.closeRestoreSessionMsg()},4e4),$("#spouseProfileModal").on("hidden.bs.modal",function(){vm.$apply(function(){$rootScope.profile.spouse||jointLifeRiderClicked&&(_.each(vm.types,function(val){1*val.id===13&&(val.status=!1)}),jointLifeRiderClicked=!1)})}),$(function(){$("body").scrollTop(0)}),$timeout(function(){vm.showLink.call=!0},2e3),$timeout(function(){$rootScope.pageLoaded=!0,$("pbheader").css({position:"relative",top:"-150px"}),$("pbheader").delay(100).animate({top:"0px"},1e3)},500)})}quotesController.$inject=["$scope","$rootScope","$location","$mdToast","$routeParams","$timeout","$cookies","$localStorage","GenericService","CustomerService","QuotesService","$q","$filter","PlanService","ServerUtilityService","CommonServiceTerm","CompareService","$document","$window","$sce","RiderService","PreQuotesService"],app.directive("quotesComponent",function(){return{templateUrl:"templates/quotes-new.html",controller:quotesController,controllerAs:"quotesCtrl"}})}(),app.service("PreQuotesService",["$rootScope","ServerUtilityService","GenericService","$filter","$routeParams","$q","CustomerService","$cookies","$localStorage","$location","$timeout","PlanService","CommonServiceTerm",function($rootScope,ServerUtilityService,GenericService,$filter,$routeParams,$q,CustomerService,$cookies,$localStorage,$location,$timeout,PlanService,CommonServiceTerm){"use strict";function clearAll(){$cookies.remove("Cookie_VisitLog",{domain:"policybazaar.com"}),$cookies.remove("CustCookie",{domain:"policybazaar.com"})}function clearQueryStringParams(){$location.search("enqId",null),$location.search("dob",null),$location.search("utm_source",null),$location.search("utm_medium",null),$location.search("utm_campaign",null),$location.search("utm_term",null),$location.search("offerid",null),$location.search("leadId",null)}function trackEnquiryCreation(name,amount,refId){var custId=$cookies.get("custId")||-1;gaTagsNew.trackEnquiryCreation(name,$localStorage.custData.amount,custId,refId.toString())}function createCustomerLast(customerData){var deferred=$q.defer();return customerCreation(customerData).then(function(data){"success"==data.status?(gaTagsNew.trackCustomerCreation("ContinueClick",customerData.city.name,data.matrixleadId,data.customerId),customerSuccessCallBack(data,customerData).then(function(){deferred.resolve(!0,"create")})):(null!=customerData.dob&&"null"!=customerData.dob||$location.path("/"),gaTagsNew.trackCustomerCreation("ContinueFail",customerData.city.name,"NA",-1),deferred.resolve(!1,"create"))}),deferred.promise}function saveCustomerCoverage(){var deferred=$q.defer(),modifySelection={};return $routeParams.cover&&$routeParams.coverage?(modifySelection.totalPayout=$routeParams.cover,modifySelection.policyCoverage=$routeParams.coverage,CustomerService.updateCustomerSelection(modifySelection,$localStorage.enquiryId).success(function(data,status,headers,config){deferred.resolve()})):deferred.resolve(),deferred.promise}function customerSuccessCallBack(data,customerData){customerData.visitId=$cookies.get("Cookie_VisitLog"),customerData.matrixLeadId=data.matrixleadId;var deferred=$q.defer(),isMobileDefault=$rootScope.newJourney||"true"===$routeParams.isProgressive?"true":null;if(customerData.existUrl&&customerData.existUrl.indexOf("isMobileDefault=false")!=-1&&(isMobileDefault=null),angular.isDefined(data.encryptCustData)){customerData.custId=data.customerId;var payterm=10;void 0!==$localStorage.custData&&(payterm=$localStorage.custData.payterm),$localStorage.custData=customerData,$localStorage.custData.payterm=payterm;var amt=CommonServiceTerm.removeCommas(customerData.amount);$localStorage.custData.amount=amt,$localStorage.enquiryId=data.enquiryId,$cookies.put("CustCookie",data.encryptCustData,{domain:"policybazaar.com"}),$cookies.put("custId",data.customerId,{domain:"policybazaar.com"}),self.executedDataLayerScript(data),self.executedDataLayerScriptForOfferId4(data),customerData.enquiryId=data.enquiryId,customerData.exitPointUrl=termConfigObj.getQuotesPageUrl(data.enquiryId),customerData.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId(),data.enquiryId&&CustomerService.setExitPointUrl(data.enquiryId,customerData.exitPointUrl,customerData.productId).success(function(data,status,headers,config){}),clearQueryStringParams(),saveCustomerCoverage().then(function(){if(CommonServiceTerm.callLeadGenerationTracking(data.matrixleadId,customerId,data.isMatrixLeadCreated,$rootScope.cancerJourney),$rootScope.cancerJourney){loadCancerInsuranceInvincibleScript(data.matrixleadId);try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"cancerInsurnceLead"})}catch(err){}var customerId=data.customerId?data.customerId:-1;$location.path("/ci/quotes/"+data.enquiryId)}else if($rootScope.isIFrame)$timeout(function(){window.open(termConfigObj.getQuotesPageUrl(data.enquiryId)+"?utm_source="+$rootScope.utmSource+"&utm_medium="+$rootScope.utmMedium+"&utm_campaign="+$rootScope.utmCampaign+"&utm_term="+$rootScope.utmTerm,"_parent")},1e3);else{var customerId=data.customerId?data.customerId:-1;$location.path("/quotes/"+data.enquiryId).search({coverage:null,cover:null,isMobileDefault:isMobileDefault,isProgressiveJourney:isProgressivejourney,utm_source:$rootScope.utmSource?$rootScope.utmSource:null,isSpouseJourney:$routeParams.isSpouseJourney?$routeParams.isSpouseJourney:null})}})}return deferred.promise}var utmSource=null,that=this;$cookies.remove("Cookie_VisitLog",{domain:"termlife.policybazaar.com"});var isProgressivejourney=!1;utmSource=angular.isDefined($location.$$search.pb_source)?$location.$$search.pb_source:angular.isDefined($location.$$search.utm_source)?$location.$$search.utm_source:angular.isDefined($cookies.get("pborganic"))&&"organic"==$cookies.get("pborganic")?$cookies.get("pborganic"):"";var utmValues={utmSource:utmSource,utmMedium:$location.$$search.pb_medium||$location.$$search.utm_medium||"",utmCampaign:$location.$$search.pb_campaign||$location.$$search.utm_campaign||"",utmTerm:$location.$$search.pb_term||$location.$$search.utm_term||""},self=this,ctfLead=0,subProductTypeId=angular.isDefined($routeParams.sub_product)?$routeParams.sub_product:2,isCTFLeadExists=function(){return angular.isDefined($localStorage.ctfLeadId)&&$localStorage.ctfLeadId},getPageId=function(){return"contact"==$rootScope.pageClass?2:1};this.isCustCookieExists=function(){return angular.isDefined($cookies.get("CustCookie"))&&$cookies.get("CustCookie")},this.isEnquiryExists=function(){return angular.isDefined($localStorage.enquiryId)&&$localStorage.enquiryId&&"bnVsbA=="!=$localStorage.enquiryId},this.isVisitLogExists=function(){return angular.isDefined($cookies.get("Cookie_VisitLog"))&&$cookies.get("Cookie_VisitLog")},this.isCustDataExists=function(){return angular.isDefined($localStorage.custData)&&$localStorage.custData},this.executedDataLayerScript=function(data){var leadText="termLead";$rootScope.cancerJourney&&(leadText="cancerLead");try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:leadText})}catch(err){}},this.executedDataLayerScriptForOfferId4=function(data){try{var age=CommonServiceTerm.getAge($scope.customerinfo.dob);$rootScope.offerId&&4==$rootScope.offerId&&age>=25&&(dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"TermQuote"}))}catch(err){}},this.isCTFLeadIdentical=function(ctfLeadId){return isCTFLeadExists()&&$localStorage.ctfLeadId==ctfLeadId},this.getCTFLead=function(){return ctfLead},this.isMonthlyIncomeJourney=function(){return 1*subProductTypeId===1},this.visitCreation=function(ctfLeadId){var deferred=$q.defer();return self.isVisitLogExists()?deferred.resolve(!0):createVisit().then(function(data){deferred.resolve(data)}),deferred.promise},this.getLeadInformation=function(visitId){var deferred=$q.defer();return ctfLead&&CustomerService.getLeadInformation(ctfLead).success(function(data,status,headers,config){if(CommonServiceTerm.isEmptyObject(data)){$location.search("leadId",null).replace();var obj={};deferred.resolve(obj)}else{var customerData=self.updateCustomerInfoUsingLeadInfo(data,visitId);
deferred.resolve(customerData)}}),deferred.promise},this.updateCustomerInfoUsingLeadInfo=function(data,visitId){var customerInfo=CustomerService.updateCustomerInfoUsingLeadInfo(data,visitId);return trackCustomerJourney(),customerInfo};var createVisit=function(isEnqNeedToBeCreated){var deferred=$q.defer();return CustomerService.createVisit().success(function(data,status,headers,config){if("success"==data.status){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("Cookie_VisitLog",data.visitId,{expires:expireDate,domain:"policybazaar.com"}),isEnqNeedToBeCreated?self.createEnquiry().then(function(data,text){deferred.resolve(data,text)}):deferred.resolve(!0)}else deferred.resolve(!1)}),deferred.promise};this.createEnquiry=function(isLandingContinue){var deferred=$q.defer();return self.enquiryCreation().then(function(data,text){void 0==text?"success"==data.status?"null"===data.refId||null===data.refId?(clearAll(),createVisit(!0).then(function(data){deferred.resolve(!0)})):($localStorage.enquiryId=data.enquiryId,$rootScope.cancerJourney||($routeParams.isProgressive?"two"===$routeParams.isProgressive?pbTrackerObj.logEvent({visitId:1*$localStorage.custData.visitId,event:"On Proceed Click",pageName:"PQ1",collection:"progressive_term",utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}):pbTrackerObj.logEvent({visitId:1*$localStorage.custData.visitId,enquiry_id:data.enquiryId,event:"On Proceed Click",pageName:"PQ1",collection:"progressive_term",cover_amount:$localStorage.custData.amount,dob:$localStorage.custData.dob,smoke:$localStorage.custData.isTobacco,annual_income:$localStorage.custData.annualIncome,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}):pbTrackerObj.logEvent({visitId:1*$localStorage.custData.visitId,enquiry_id:data.enquiryId,event:"On Proceed Click",pageName:"PQ1",cover_amount:$localStorage.custData.amount,dob:$localStorage.custData.dob,smoke:$localStorage.custData.isTobacco,annual_income:$localStorage.custData.annualIncome,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm})),trackCustomerJourney(),isLandingContinue||self.doRedirection(data.refId),deferred.resolve(!0)):($cookies.remove("Cookie_VisitLog",{domain:"policybazaar.com"}),createVisit(!0).then(function(data){deferred.resolve(!0)})):(trackEnquiryCreation("ProceedFail",$localStorage.custData.amount,"NA"),deferred.resolve(!1,text))}),deferred.promise},this.prefillData=function(ctflead){var deferred=$q.defer(),customerData={};return ctfLead=ctflead,ctfLead?self.getLeadInformation($cookies.get("Cookie_VisitLog")).then(function(custData){customerData=angular.copy(custData),deferred.resolve(customerData)}):self.isCustCookieExists()&&self.isEnquiryExists()?self.getCustomerInformation().then(function(data){customerData=angular.copy(data),CommonServiceTerm.setPreviousLeadId(data.matrixLeadId),deferred.resolve(customerData)}):self.isCustDataExists()?(customerData=localStorageCallback($localStorage.custData),deferred.resolve(customerData)):self.isEnquiryExists()?self.getCustomerInformation().then(function(data){customerData=angular.copy(data),deferred.resolve(customerData)}):deferred.resolve(customerData),deferred.promise};var loadCancerInsuranceInvincibleScript=function(leadId){var pid=CommonServiceTerm.getCancerCareProductId(),ld=leadId,m3_u=("https:"===location.protocol?"https:":"http:")+"//www.invincibleiq.com/details/ck",m3_r=Math.floor(99999999999*Math.random()),charSet=(document.createElement("script"),document.charset?"/charset:"+document.charset:document.characterSet?"/charset:"+document.characterSet:""),customScr=m3_u+"/cid:0/pid:"+pid+"/ld:"+ld+"/aid:1/cb:"+m3_r+charSet;CommonServiceTerm.loadScript(customScr,"text/javascript","utf-8")};this.getCustomerInformation=function(){var deferred=$q.defer(),customerData={};return CustomerService.getCustomerInformation($localStorage.enquiryId).success(function(data,status,headers,config){1*data.enquiryId===0||1*data.visitId===0?(clearAll(),self.visitCreation().then(function(data){ctfLead?self.getLeadInformation($cookies.get("Cookie_VisitLog")).then(function(custData){customerData=angular.copy(custData),deferred.resolve(customerData)}):deferred.resolve($localStorage.custData)})):(customerData=webServiceCallback(data),deferred.resolve(customerData))}),deferred.promise},this.updateMobileNumber=function(mobileNumber,profileObj,sendCustomerDetails){var input={mobileNo:mobileNumber,profileObj:profileObj.encryptedMobileNo,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm};profileObj&&profileObj.name&&(input.name=profileObj.name),profileObj&&profileObj.dob&&(input.dob=profileObj.dob),sendCustomerDetails&&profileObj&&(input=profileObj,input.utmChangeOnly=1),"true"!==$routeParams.isRetainer&&"true"!==$routeParams.ctlCompact||(input.utmSource="Retainer_C2L"),"true"===$routeParams.ctlCompact&&(input.oldLeadId=profileObj.oldLeadId,input.isUtmTermChange=!0),input.leadSource=$rootScope.isMobileDevice?"PBMobile":"PB";var url="/api/save/mobile";return ServerUtilityService.postWebService(url,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.isCustomerInputMissing=function(custInfo){return!custInfo.fullName||!(!custInfo.fullName||0!=custInfo.fullName.length)};var webServiceCallback=function(data){var custData=CustomerService.updateCustomerInfoUsingService(data);return trackCustomerJourney(),custData},localStorageCallback=function(data){var custData=CustomerService.updateCustomerInfoUsingStorage(data);return trackCustomerJourney(),custData};this.doRedirection=function(refId,isMatrixLeadCreated){$localStorage.custData&&$localStorage.custData.amount&&trackEnquiryCreation("ProceedClick",$localStorage.custData.amount,refId.toString()),$rootScope.cancerJourney?($location.$$search.ci="true",4==$rootScope.preQuotesVariant?self.redirectToQuotesPage():$rootScope.newJourney||$rootScope.preQuotesVariant?$rootScope.preQuotesVariant||self.redirectToQuotesPage():$location.path("/ci/contact")):$rootScope.dengueJourney?$location.path("/dc/contact"):4==$rootScope.preQuotesVariant?self.redirectToQuotesPage():$rootScope.newJourney||$rootScope.preQuotesVariant?$rootScope.preQuotesVariant||self.redirectToQuotesPage():$location.path("/contact")},this.redirectToQuotesPage=function(){var custInfo=$localStorage.custData,amt=0;amt=CommonServiceTerm.removeCommas(custInfo.amount),$localStorage.custData.amount=amt;var geoCityObj={};geoCityObj.city="",geoCityObj.country="",$rootScope.isLanding||CommonServiceTerm.setShouldPageSkipCookie(),self.proceedToQuotesPage(custInfo,geoCityObj,custInfo.mobileNo).then(function(data,text){})},this.setSelectedCityItem=function(data){var selectedCityItem={};return data&&(selectedCityItem.display=data.name,selectedCityItem.value=data.name,selectedCityItem.searchString=data.name,selectedCityItem.stateId=data.stateId,selectedCityItem.cityId=data.id),selectedCityItem},this.getCountryCode=function(countryCodes,id){var countryCodeObj=$filter("filter")(countryCodes,{CountryCodeId:id})[0],countryCode=angular.isDefined(countryCodeObj)?countryCodeObj.CountryCode:91;return"+"+countryCode};var isDateOfBirthIdentical=function(customerInfo,preserveInfo){var serviceDOB,modelDOB,isIdentical=!1;return null!==preserveInfo.dob&&(serviceDOB=preserveInfo.dob.split("-"),modelDOB=customerInfo.dob.split("-"),parseInt(serviceDOB[0],10)==parseInt(modelDOB[0],10)&&parseInt(serviceDOB[1],10)==parseInt(modelDOB[1],10)&&parseInt(serviceDOB[2],10)==parseInt(modelDOB[2],10)&&(isIdentical=!0),isIdentical)};this.getInitialOfferDetails=function(planType){var data={head:"",subHead:"",bulletPoints:[]};return planType=planType||1,$rootScope.cancerJourney?1*planType===1?(data.head="Cancer Insurance",data.subHead="Act Before Cancer Does",data.bulletPoints=["Payout for all Cancer stages","Cover upto 50 Lacs","Upto 150% of payout on Critical Stage","Premium Waiver Benefit","Monthly Income Option","Cover starting from &#8377; 40 per month*","Inbuilt Life Cover"]):1*planType===2?(data.head="Heart Insurance",data.subHead="Care For Your Heart",data.bulletPoints=["Payout at different stages","Cover upto 50 Lacs","Covers 19 Heart related illness","Premium Waiver Benefit","Inbuilt Life Cover"]):1*planType===3&&(data.head="Cancer + Heart",data.subHead="Be Prepared For Unplanned Risks",data.bulletPoints=["Covers multiple diseases","Payout at different stages","Cover upto 80 Lacs","Premium Waiver Benefit","Inbuilt Life Cover"]):(data.head="Term Life Insurance",data.subHead="Compare 34 plans from 16 insurers & save upto 50%",data.bulletPoints=["Awarded India's #1 financial website","Over 12,12,535 families secured","365 Days Customer Support","1500+ Advisors helping you Compare & Buy","24x7 claim settlement and nominee support service","Get a free credit report powered by Policybazaar on purchase of term insurance"]),data},this.getOfferDetails=function(offerId){var deferred=$q.defer();return GenericService.getOfferDetails(offerId).success(function(data,status,headers,config){deferred.resolve(data)}),deferred.promise};var isUserProfileChanged=function(customerInfo,preserveInfo){var isChanged=!1;return(preserveInfo.isTobacco&&customerInfo.isTobacco!=preserveInfo.isTobacco||!isDateOfBirthIdentical(customerInfo,preserveInfo))&&(isChanged=!0),customerInfo.profileChanged&&(isChanged=!0),isChanged},trackCustomerJourney=function(){if(self.isEnquiryExists()){var enquiryId=$localStorage.enquiryId,pageId=getPageId();CustomerService.trackCustomerJourneyService(enquiryId,pageId).success(function(data,status,headers,config){})}},customerUpdation=function(customerInfo){var deferred=$q.defer();customerInfo.enquiryId=$localStorage.enquiryId,customerInfo.exitPointUrl=termConfigObj.getQuotesPageUrl(customerInfo.enquiryId);var customerInfoObject=angular.copy(customerInfo),amt=CommonServiceTerm.removeCommas(customerInfo.amount);customerInfoObject.amount=amt,customerInfoObject.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId(),customerInfoObject.gaTrackerClientId=GenericService.getTrackerId();var gclAw=$cookies.get("_gcl_aw");gclAw&&gclAw.length>0&&(customerInfoObject.gclId=gclAw.split(".")[2]);var obj={};return obj.previousLeadId=customerInfoObject.matrixLeadId,obj.previousMobileNo=customerInfoObject.mobileNo,obj.encryptedMobileNo=customerInfoObject.encryptedMobileNo,obj.isMobileSinglePage=customerInfoObject.isMobileSinglePage,obj.isSpouseJourney=customerInfoObject.isSpouseJourney,obj.isStateChange=customerInfoObject.isStateChange,$localStorage.previousLeadObj=obj,CustomerService.updateCustomer(customerInfoObject).success(function(data,status,headers,config){try{}catch(ex){}deferred.resolve(data)}).error(function(data){deferred.resolve(!1,"update")}),deferred.promise};this.updateCustomer=function(customerInfo,geoCityObj){var deferred=$q.defer();return customerInfo.geoCity=geoCityObj.city,customerInfo.geoCountry=geoCityObj.country,customerUpdation(customerInfo).then(function(data){data&&"success"==data.status?($localStorage.enquiryId!=data.enquiryId&&(self.executedDataLayerScript(data),self.executedDataLayerScriptForOfferId4(data),customerInfo.exitPointUrl=termConfigObj.getQuotesPageUrl(customerInfo.enquiryId),customerInfo.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId(),data.enquiryId&&CustomerService.setExitPointUrl(data.enquiryId,customerInfo.exitPointUrl,customerInfo.productId).success(function(data,status,headers,config){})),$localStorage.enquiryId=data.enquiryId,deferred.resolve(data,!0)):(clearAll(),self.createEnquiry(!0).then(function(data,value){data&&void 0==value&&self.updateCustomerLast($localStorage.custData).then(function(data,flag,text){deferred.resolve(data,flag,text)})}))}),deferred.promise},this.updateCustomerLast=function(customerInfo){var deferred=$q.defer();return null==customerInfo.dob||"null"==customerInfo.dob?($location.path("/"),deferred.resolve(data,!1,"update")):customerUpdation(customerInfo).then(function(data){"success"==data.status?($localStorage.enquiryId!=data.enquiryId&&(self.executedDataLayerScript(data),self.executedDataLayerScriptForOfferId4(data),customerInfo.exitPointUrl=termConfigObj.getQuotesPageUrl(customerInfo.enquiryId),customerInfo.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId(),data.enquiryId&&CustomerService.setExitPointUrl(data.enquiryId,customerInfo.exitPointUrl,customerInfo.productId).success(function(data,status,headers,config){})),$localStorage.enquiryId=data.enquiryId,deferred.resolve(data,!0)):deferred.resolve(data,!1,"update")}),deferred.promise};var customerCreation=function(customerData){var deferred=$q.defer();if(customerData.dob){customerData.enquiryId=$localStorage.enquiryId,location.href&&(customerData.exitPointUrl=termConfigObj.getQuotesPageUrl(customerData.enquiryId));var customerInfoObject=angular.copy(customerData),amt=CommonServiceTerm.removeCommas(customerData.amount);customerInfoObject.amount=amt,customerInfoObject.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId(),customerInfoObject.gaTrackerClientId=GenericService.getTrackerId();var gclAw=$cookies.get("_gcl_aw");gclAw&&gclAw.length>0&&(customerInfoObject.gclId=gclAw.split(".")[2]),customerInfoObject.isMobileSinglePage=customerData.isMobileSinglePage,customerInfoObject.isSpouseJourney=customerData.isSpouseJourney,customerInfoObject.isStateChange=customerData.isStateChange;var obj={};obj.previousLeadId=customerInfoObject.matrixLeadId,obj.previousMobileNo=$localStorage.previousLeadObj&&$localStorage.previousLeadObj.previousMobileNo?$localStorage.previousLeadObj.previousMobileNo:customerInfoObject.mobileNo,$localStorage.previousLeadObj=obj,CustomerService.createCustomer(customerInfoObject).success(function(data,status,headers,config){try{}catch(ex){}deferred.resolve(data)}).error(function(data,status,headers,config){deferred.resolve(data)})}else $rootScope.cancerJourney?$location.path("/ci"):$location.path("/"),deferred.resolve();return deferred.promise};this.createCustomer=function(customerData){var deferred=$q.defer();return customerCreation(customerData).then(function(data){"success"==data.status?(gaTagsNew.trackCustomerCreation("ContinueClick",customerData.city.name,data.matrixleadId,data.custId),$rootScope.cancerJourney||pbTrackerObj.logEvent({leadId:1*data.matrixleadId,visitId:1*$cookies.get("Cookie_VisitLog")||1*customerData.visitId,custId:1*data.customerId,enquiry_id:data.enquiryId,event:"On Continue Click",pageName:"PQ2",title:1==customerData.gender?"Mr.":"Ms.",name:customerData.fullName,email:customerData.emailId,city:customerData.city.name,phone_number:customerData.mobileNo,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}),customerSuccessCallBack(data,customerData).then(function(){deferred.resolve(!0,"create")})):(clearAll(),createVisit(!0).then(function(data,value){data&&void 0==value&&createCustomerLast(customerData).then(function(data,text){deferred.resolve(data,text)})}))}),deferred.promise},this.enquiryCreation=function(){var deferred=$q.defer(),obj={},gclAw=$cookies.get("_gcl_aw");return gclAw&&gclAw.length>0&&(obj.gclId=gclAw.split(".")[2]),obj.exitPointUrl=location.href,obj.visitId=$cookies.get("Cookie_VisitLog"),obj.utmSource=utmValues.utmSource,obj.utmMedium=utmValues.utmMedium,obj.utmCampaign=utmValues.utmCampaign,obj.utmTerm=utmValues.utmTerm,obj.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId(),obj.gaTrackerClientId=GenericService.getTrackerId(),CustomerService.createEnquiryNew(obj).success(function(data,status,headers,config){if($rootScope.cancerJourney){var refId=data.refId||-1;gtmObj.cancerEnqGeneration(refId,-1)}else{var refId=data.refId||-1;gtmObj.enquiryGeneration(refId,-1)}deferred.resolve(data)}).error(function(data){deferred.resolve(!1,"enquiry")}),deferred.promise},this.proceedToNextPage=function(customerInfo,preserveInfo){var deferred=$q.defer();$localStorage.custData=customerInfo;var amt=CommonServiceTerm.removeCommas(customerInfo.amount);$localStorage.custData.amount=amt;var isMobileDefault=$rootScope.newJourney||"true"===$routeParams.isProgressive||"two"===$routeParams.isProgressive?"true":null;if(customerInfo.existUrl&&customerInfo.existUrl.indexOf("isMobileDefault=false")!=-1&&(isMobileDefault=null),self.isCustCookieExists()&&self.isEnquiryExists())if($localStorage.custData.custId||$localStorage.custData.CustomerID){var geoCityObj={};self.updateCustomer(customerInfo,geoCityObj).then(function(data){customerInfo.matrixleadId=data.matrixleadId;var customerId=data.custId?data.custId:-1;if($rootScope.cancerJourney||pbTrackerObj.logEvent({visitId:1*customerInfo.visitId,leadId:data.matrixleadId,custId:data.customerId,enquiry_id:data.enquiryId,event:"On Proceed Click",pageName:"PQ1",cover_amount:customerInfo.amount,dob:customerInfo.dob,smoke:customerInfo.isTobacco,annual_income:customerInfo.annualIncome,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}),CommonServiceTerm.callLeadGenerationTracking(data.matrixleadId,customerId,data.isMatrixLeadCreated,$rootScope.cancerJourney),angular.isDefined($cookies.get("shouldPageSkip"))&&$cookies.get("shouldPageSkip"))if(isUserProfileChanged(customerInfo,preserveInfo))self.doRedirection(data.refId,data.isMatrixLeadCreated);else if($rootScope.cancerJourney){loadCancerInsuranceInvincibleScript(data.matrixleadId);try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"cancerInsurnceLead"})}catch(err){}$location.path("/ci/quotes/"+data.enquiryId).search({pid:null,offerid:null})}else saveCustomerCoverage().then(function(){$rootScope.isIFrame?window.open(termConfigObj.getQuotesPageUrl(data.enquiryId)+"?utm_source="+utmValues.utmSource+"&utm_medium="+utmValues.utmMedium+"&utm_campaign="+utmValues.utmCampaign+"&utm_term="+utmValues.utmTerm,"_parent"):$location.path("/quotes/"+data.enquiryId).search({pid:null,offerid:null,isMobileDefault:isMobileDefault})});else self.doRedirection(data.refId);deferred.resolve(data)})}else self.doRedirection(""),deferred.resolve(!0);else self.createEnquiry().then(function(data,text){$localStorage.custData=customerInfo,deferred.resolve(data,text)});return deferred.promise},this.skipPreQuotesPage=function(){return"true"===$routeParams.isRetainer||"true"===$routeParams.ctlCompact},this.proceedToCustomerPage=function(customerInfo,preserveInfo){var deferred=$q.defer();$localStorage.custData=customerInfo;var amt=CommonServiceTerm.removeCommas(customerInfo.amount);$localStorage.custData.amount=amt;var isMobileDefault=$rootScope.newJourney||"true"===$routeParams.isProgressive||"two"===$routeParams.isProgressive?"true":null;if(isProgressivejourney=customerInfo.isProgressiveJourney?"true":null,customerInfo.existUrl&&customerInfo.existUrl.indexOf("isMobileDefault=false")!=-1&&(isMobileDefault=null),self.isCustCookieExists()&&self.isEnquiryExists()||that.skipPreQuotesPage())if($localStorage.custData.custId||$localStorage.custData.CustomerID){var geoCityObj={};self.updateCustomer(customerInfo,geoCityObj).then(function(data){customerInfo.matrixleadId=data.matrixleadId;var customerId=data.custId?data.custId:-1;if($rootScope.cancerJourney||($routeParams.isProgressive?"two"===$routeParams.isProgressive?pbTrackerObj.logEvent({visitId:1*customerInfo.visitId,event:"On Proceed Click",pageName:"PQ1",collection:"progressive_term",utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}):pbTrackerObj.logEvent({visitId:1*customerInfo.visitId,leadId:data.matrixleadId,custId:data.customerId,enquiry_id:data.enquiryId,event:"On Proceed Click",pageName:"PQ1",collection:"progressive_term",cover_amount:customerInfo.amount,dob:customerInfo.dob,smoke:customerInfo.isTobacco,annual_income:customerInfo.annualIncome,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}):pbTrackerObj.logEvent({visitId:1*customerInfo.visitId,leadId:data.matrixleadId,custId:data.customerId,enquiry_id:data.enquiryId,event:"On Proceed Click",pageName:"PQ1",cover_amount:customerInfo.amount,dob:customerInfo.dob,smoke:customerInfo.isTobacco,annual_income:customerInfo.annualIncome,utmSource:$rootScope.utmSource,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,utmTerm:$rootScope.utmTerm}),pbTrackerObj.logEvent({visitId:1*customerInfo.visitId,leadId:data.matrixleadId,custId:data.customerId,enquiry_id:data.enquiryId,event:"On Proceed Click",pageName:"PQ1",detectedCountry:customerInfo.detectedCountry,selectedCountry:customerInfo.countryCode,collection:"country_detect"})),CommonServiceTerm.callLeadGenerationTracking(data.matrixleadId,customerId,data.isMatrixLeadCreated,$rootScope.cancerJourney),angular.isDefined($cookies.get("shouldPageSkip"))&&$cookies.get("shouldPageSkip")||that.skipPreQuotesPage())if(isUserProfileChanged(customerInfo,preserveInfo)&&"true"!=$routeParams.ctlCompact)self.doRedirection(data.refId,data.isMatrixLeadCreated);else if($rootScope.cancerJourney){loadCancerInsuranceInvincibleScript(data.matrixleadId);try{dataLayer.push({LeadID:data.matrixleadId}),dataLayer.push({event:"cancerInsurnceLead"})}catch(err){}$location.path("/ci/quotes/"+data.enquiryId).search({pid:null,offerid:null})}else saveCustomerCoverage().then(function(){$rootScope.isIFrame?window.open(termConfigObj.getQuotesPageUrl(data.enquiryId)+"?utm_source="+utmValues.utmSource+"&utm_medium="+utmValues.utmMedium+"&utm_campaign="+utmValues.utmCampaign+"&utm_term="+utmValues.utmTerm,"_parent"):$location.path("/quotes/"+data.enquiryId).search({pid:null,offerid:null,isMobileDefault:isMobileDefault,isProgressiveJourney:isProgressivejourney,utm_source:$rootScope.utmSource?$rootScope.utmSource:null,isSpouseJourney:$routeParams.isSpouseJourney?$routeParams.isSpouseJourney:null})});else self.doRedirection(data.refId);deferred.resolve(data)})}else self.doRedirection(""),deferred.resolve(!0);else self.createEnquiry().then(function(data,text){$localStorage.custData=customerInfo,deferred.resolve(data,text)});return deferred.promise},this.buyProceed=function(buyLanding,planId){var deferred=$q.defer(),errorObject={isMobileExist:!1,isLeadExist:!1};return buyLanding.txtMobileNo?GenericService.getDataByMobileNoApi(buyLanding.txtMobileNo,planId).success(function(data,status,headers,config){if(data.url){var planIds=termConfigObj.getE2EPlanIds(),preQuotesInfoObj=data.termCustInfo,enquiryId=data.enquiryId,plan=data.plan;angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1?GenericService.redirectToE2EPage(preQuotesInfoObj,plan,enquiryId):(window.location=data.url+planId,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1,deferred.resolve(errorObject))}else errorObject.isMobileExist=!0,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1,deferred.resolve(errorObject)}):buyLanding.txtLeadId?($localStorage.$reset(),$cookies.remove("Cookie_VisitLog",{domain:"policybazaar.com"}),$cookies.remove("CustCookie",{domain:"policybazaar.com"}),GenericService.getBuyPageLink(buyLanding.txtLeadId,planId).success(function(data,status,headers,config){if(data.url){var planIds=termConfigObj.getE2EPlanIds(),preQuotesInfoObj=data.termCustInfo,enquiryId=data.enquiryId,plan=data.plan;angular.isDefined(planIds)&&planIds.indexOf(plan.Plan_Id)!==-1?GenericService.redirectToE2EPage(preQuotesInfoObj,plan,enquiryId):(window.location=data.url+planId,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1,deferred.resolve(errorObject))}else $rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1,errorObject.isLeadExist=!0,$rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1,deferred.resolve(errorObject)})):($rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1,deferred.resolve(errorObject)),deferred.promise},this.createUpdateCustomer=function(customerData){var deferred=$q.defer();return self.createCustomer(customerData).then(function(data,text){deferred.resolve(data,text)}),deferred.promise},this.proceedToQuotesPage=function(customerData){var deferred=$q.defer();return angular.isDefined($localStorage.enquiryId)&&$localStorage.enquiryId?self.createUpdateCustomer(customerData).then(function(data,text){deferred.resolve(data,text)}):(clearAll(),createVisit(!0).then(function(data,value){data&&void 0==value&&self.createUpdateCustomer(customerData).then(function(data,text){deferred.resolve(data,text)})})),deferred.promise};var isValidEmail=function(emailId){var pattern=new RegExp(/^[_a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/);return pattern.test(emailId)},isValidMobile=function(mobileNo){var pattern=new RegExp("^[789]\\d{9}$");return pattern.test(mobileNo)};this.validatePreFillData=function(preFillData){return!GenericService.isUndefinedOrNull(preFillData.fullName)&&!GenericService.isUndefinedOrNull(preFillData.emailId)&&isValidEmail(preFillData.emailId)&&!GenericService.isUndefinedOrNull(preFillData.city)&&!GenericService.isUndefinedOrNull(preFillData.countryCode)&&!GenericService.isUndefinedOrNull(preFillData.mobileNo)&&0!=preFillData.mobileNo&&isValidMobile(preFillData.mobileNo)},this.findCityFormText=function(city,citySearchText){var obj={};return null!==citySearchText&&void 0!==citySearchText&&""!==citySearchText&&(citySearchText=citySearchText.replace(/ /g,""),citySearchText.length>0&&(obj=_.find(city,function(val,key){var txt=val.name.replace(/ /g,""),index=val.name.replace(/ /g,"").indexOf("(");if(txt=txt.substr(0,index).replace(/ /g,""),citySearchText.toLowerCase()===txt.toLowerCase())return val}))),obj||{}}}]),app.service("CompareService",["$rootScope","ServerUtilityService","$cookies","$q","GenericService","$localStorage","CommonServiceTerm","$location","QuotesService",function($rootScope,ServerUtilityService,$cookies,$q,GenericService,$localStorage,CommonServiceTerm,$location,QuotesService){function isInbuildAddOn(id,inbuildAddOns){var inBuild=!1;return inbuildAddOns&&(inBuild=inbuildAddOns[id]||!1),inBuild}function isDefaultAdded(categoryId,planId,age){return GenericService.isHDFCPlan(planId)&&1*categoryId===12?age<=55:(1*planId===818||1*planId===819)&&1*categoryId===10||1*planId===819&&1*categoryId===101||(!(!CommonServiceTerm.isSbiPoornaSuraksha(planId)||1*categoryId!==38)||1*planId===891&&1*categoryId===101)}function showCombinedRiderInfo(id,plan,name){var supplierId=plan.Supplier_Id;plan.Plan_Id;return!(10!=supplierId&&22!=supplierId||10!=id&&12!=id)&&"Rider offers cover against both death & disability"}function createAllPlansArray(plans,allPlans){var supplierPlans=[],supplierPlanIds=[];return _.each(plans,function(plan){var object={};object.planCategory=plan.planCategory,object.Plan_Id=plan.Plan_Id,object.Plan_Name=plan.Plan_Name,object.Supplier_Id=plan.Supplier_Id,object.Supplier_Name=plan.Supplier_Name,object.BasicPremium=plan.BasicPremium,object.monthlyTotalPremium=plan.monthlyTotalPremium,object.riderPremiumObject=plan.riderPremiumObject,object.E2EName=plan.E2EName,object.planShortName=plan.planShortName,object.monthlyIncome=plan.monthlyIncome,supplierPlans.push(object),supplierPlanIds.push(plan.Plan_Id),allPlans&&allPlans.length>0&&_.each(allPlans,function(aPlan){aPlan.Plan_Id==plan.Plan_Id&&(object.planCategory=aPlan.planCategory,object.Plan_Id=aPlan.Plan_Id,object.Plan_Name=aPlan.Plan_Name,object.Supplier_Id=aPlan.Supplier_Id,object.Supplier_Name=aPlan.Supplier_Name,object.BasicPremium=aPlan.BasicPremium,object.monthlyTotalPremium=aPlan.monthlyTotalPremium,object.riderPremiumObject=aPlan.riderPremiumObject,object.E2EName=aPlan.E2EName,object.planShortName=aPlan.planShortName,object.monthlyIncome=plan.monthlyIncome)})}),appendRestOfThePlans(supplierPlans,supplierPlanIds,allPlans)}function appendRestOfThePlans(supplierPlans,supplierPlanIds,allPlans){var plans=[];return allPlans&&allPlans.length>0?(_.each(allPlans,function(plan){if(supplierPlanIds.indexOf(plan.Plan_Id)==-1){var object={};object.planCategory=plan.planCategory,object.Plan_Id=plan.Plan_Id,object.Plan_Name=plan.Plan_Name,object.Supplier_Id=plan.Supplier_Id,object.Supplier_Name=plan.Supplier_Name,object.BasicPremium=plan.BasicPremium,object.monthlyTotalPremium=plan.monthlyTotalPremium,object.riderPremiumObject=plan.riderPremiumObject,object.E2EName=plan.E2EName,object.monthlyIncome=plan.monthlyIncome,plans.push(object)}}),supplierPlans.concat(plans)):supplierPlans}function getUniqueSupplierIds(quotes){return quotes.map(function(quotes){return quotes.supplierId}).unique()}function createUpdateObj(custInfo,comparePlanIds){var registerCustomerObj={custId:custInfo.custId||"",enquiryId:$cookies.get("enquiryId")||"",mobileNo:custInfo.mobileNo||"",encryptedMobileNo:custInfo.encryptedMobileNo||"",countryId:custInfo.countryId||"",tobacco:custInfo.isTobaccoUser||0,gender:custInfo.gender||1,name:custInfo.name||"",email:custInfo.emailId||"",cityId:custInfo.cityId||"",stateId:custInfo.stateId||"",exitpointUrl:location.href,utmSource:utmValues.utmSource,utmTerm:utmValues.utmTerm,utmMedium:utmValues.utmMedium,utmCampaign:utmValues.utmCampaign,visitId:$cookies.get("Cookie_VisitLog")||custInfo.visitId||"",age:custInfo.dob?CommonServiceTerm.getAge(custInfo.dob):"",totalPayout:custInfo.totalPayout||"",premium:custInfo.premium||0,dob:custInfo.dob,monthlyIncome:custInfo.monthlyIncome||"",otherCountryCode:custInfo.otherCountryCode||"",productId:$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():$rootScope.dengueJourney?termConfigObj.getDengueProductId():termConfigObj.getTermProductId()||"",gaTrackerClientId:GenericService.getTrackerId(),leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",annualIncome:2,policyTerm:custInfo.policyTerm};return{registerCustomer:registerCustomerObj,comparingPlanIds:comparePlanIds}}function getPlanPremiumDisplayValue(plan,isMonthly){return 0!=plan.monthlyTotalPremium&&isMonthly?plan.monthlyTotalPremium>0&&isMonthly?plan.monthlyTotalPremium+plan.monthlyRiderPremiumAdded+" monthly":0==plan.monthlyTotalPremium?"Monthly premium not available":void 0:plan.BasicPremium+plan.riderPremiumAdded+" annually"}function getEmailCategoryList(ridersData){var obj=[];return _.each(ridersData,function(rider){obj.push({id:rider.categoryId,displayName:rider.label,isSelected:rider.isSelected})}),obj}function getEmailKeyList(planDetails,monthlyPlanExists){var obj=[];return obj.push({key:"oneTimePayout",displayName:planDetails.oneTimePayout.label}),monthlyPlanExists&&(obj.push({key:"monthlyIncome",displayName:planDetails.monthlyIncome.label}),obj.push({key:"monthlyIncomeType",displayName:planDetails.monthlyIncomeType.label}),obj.push({key:"costPerLac",displayName:planDetails.costPerLac.label}),obj.push({key:"npvValue",displayName:planDetails.npvValue.label})),obj.push({key:"maxCoverageAge",displayName:planDetails.maxCoverageAge.label}),obj.push({key:"maxMaturityAge",displayName:planDetails.maxMaturityAge.label}),obj.push({key:"claimSettlementRatio",displayName:planDetails.claimSettlementRatio.label}),obj.push({key:"paymentFrequency",displayName:planDetails.paymentFrequency.label}),obj.push({key:"medicalNeeded",displayName:planDetails.medicalNeeded.label}),obj.push({key:"freeLookPeriod",displayName:planDetails.freeLookPeriod.label
}),obj.push({key:"tatData",displayName:planDetails.tatData.label}),obj.push({key:"solvencyRatio",displayName:planDetails.solvencyRatio.label}),obj.push({key:"premiumPayingTerm",displayName:planDetails.premiumPayingTerm.label}),obj}function getRiderDisplayValue(rider,plan,isMonthly){if(rider.isDefaultAdded||rider.inBuildAddOn){if(rider.inBuildAddOn)return"Free";if(rider.isDefaultAdded)return"check"}else if(0!=plan.monthlyTotalPremium&&isMonthly){if(plan.monthlyTotalPremium>0&&isMonthly){if(!rider.monthlyPremium&&!rider.isIncluded)return"cross";if(rider.monthlyPremium>0)return rider.sumAssured>0?"Premium:"+rider.monthlyPremium+" monthly</br>for cover of "+rider.sumAssured:"Premium:"+rider.monthlyPremium+" monthly"}}else{if(!rider.premium&&!rider.isIncluded)return"cross";if(rider.premium>0)return rider.sumAssured>0?"Premium:"+rider.premium+" annually</br>for cover of "+rider.sumAssured:"Premium:"+rider.premium+" annually"}}function buildPlanDetailsForEmail(uniqueSupplierPlans,custData,isMonthly,monthlyPlanExists,staticData){var plans=[];return _.each(uniqueSupplierPlans,function(plan){var obj={supplierName:plan.Supplier_Name,planName:plan.Plan_Name,premium:getPlanPremiumDisplayValue(plan,isMonthly),oneTimePayout:plan.OneTimePayout,maxCoverageAge:plan.PolicyTerm+"yrs Max Policy Term :"+(plan.newCoverageUpto-custData.customerAge),maxMaturityAge:plan.maxCoverageAge+"yrs of Age",claimSettlementRatio:parseFloat(plan.Claims_Settled).toFixed(1)+"%",paymentFrequency:plan.paymentFrequency?plan.paymentFrequency[0]+", "+plan.paymentFrequency[1]+", "+plan.paymentFrequency[2]:"cross",medicalNeeded:("Yes"==plan.MedicalNeeded,"Home Medical: check"),freeLookPeriod:plan.Free_Lookup_Period+"Days Medical Expenses:"+plan.medicalExpensesDeductible,tatData:plan.tATData+"Days",solvencyRatio:plan.Solvency_Ratio?plan.Solvency_Ratio.toFixed(2):"cross",premiumPayingTerm:plan.premiumPayingTerm?plan.premiumPayingTerm.indexOf("Single pay")!=-1?"Single pay":plan.premiumPayingTerm.indexOf("Regular pay")!=-1?"Regular Pay":"Limited pay":"cross"};monthlyPlanExists&&(obj.monthlyIncome=plan.monthlyIncome,obj.monthlyIncomeType=plan.monthlyIncomeType,obj.costPerLac=plan.costPerLac+"Per Lac",obj.npvValue=plan.NPVValue),obj.riderPremiumObject={},_.each(plan.visibleRiderPremiumObject,function(rider){148!=rider.categoryId&&(obj.riderPremiumObject[rider.categoryId]=getRiderDisplayValue(rider,plan,isMonthly))}),plans.push(obj)}),plans}function createCompareObject(enquiryId,planIds){var obj={};return obj.enquiryId=enquiryId,obj.planIds=planIds,obj}function extractPlanIds(compareData){planIds=[],_.each(compareData,function(plan){planIds.push(plan.planId)})}var allPlansUrl="/api/compare/page",updateUrl="/api/update/compare/page",saveQuotesOrderUrl="/api/sorting/save",emailQuotesUrl="/api/compare/email",saveComparingPlanIdsUrl="/api/compare/save",getComparingPlanIdsUrl="/api/compare/saveddata?",planIds=[],utmSource=null,_self=this;this.customerInfo={customerAge:18,totalPayout:"1,00,00,000",policyTerm:65,monthlyIncome:"30,000"},utmSource=angular.isDefined($location.$$search.pb_source)?$location.$$search.pb_source:angular.isDefined($location.$$search.utm_source)?$location.$$search.utm_source:angular.isDefined($cookies.get("pborganic"))&&"organic"==$cookies.get("pborganic")?$cookies.get("pborganic"):"";var utmValues={utmSource:utmSource,utmMedium:$location.$$search.pb_medium||$location.$$search.utm_medium||"",utmCampaign:$location.$$search.pb_campaign||$location.$$search.utm_campaign||"",utmTerm:$location.$$search.pb_term||$location.$$search.utm_term||""};this.setRiderObject=function(quotes,age,isMonthly,ridersArray){return ridersArray.map(function(rider){rider.name=angular.copy(rider.label),rider.premium=0,rider.monthlyPremium=0,rider.isSelected=!1,rider.isDisabled=!1,rider.isHidden=!1,rider.isDefaultAdded=!1,rider.inBuildAddOn=!1}),_.each(quotes,function(val){val.riderPremiumObject=angular.copy(ridersArray),val.isRiderSelectedForMobile=!1,val.ridersToShowCount=0,_.each(val.riderPremiumObject,function(riderVal){riderVal.inBuildAddOn=riderVal.inBuildAddOn||isInbuildAddOn(riderVal.categoryId,val.inbuildAddOns),riderVal.isDefaultAdded=isDefaultAdded(riderVal.categoryId,val.Plan_Id,age),that.isPNBPlan(val.Plan_Id)&&1*riderVal.categoryId===13&&val.maxCoverageAge<=75&&(riderVal.isIncluded=!0),(riderVal.inBuildAddOn||riderVal.isDefaultAdded||riderVal.isAvailable||riderVal.isIncluded||!riderVal.isHiddenOnMobile&&riderVal.isSelected)&&(val.isRiderSelectedForMobile=!0,val.ridersToShowCount=val.ridersToShowCount+1)})}),quotes},this.getPlans=function(enquiryId,planIds,isMonthly,payType){payType=1*payType===2?"SinglePay":1*payType===3?"LimitedPay":"",isMonthly=isMonthly?1:0;var url=allPlansUrl+"?enquiryId="+enquiryId;return _.each(planIds,function(id){url=url+"&requestedPlanIds="+id}),url=url+"&isMonthly="+isMonthly+"&payOptionType="+payType,ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.addPlanToCompare=function(compareData,enquiryId){extractPlanIds(compareData);var obj=createCompareObject(enquiryId,planIds);return ServerUtilityService.postWebService(addPlanUrl,obj).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})};var calculateCostPerLac=function(plan){var totalCover=0,premium=0,totalLacs=0,costPerLac=0;return totalCover=plan.maxTotalCover||plan.ComboTotalCover,premium=plan.maxTotalPremium||plan.TotalPremium,1*totalCover===0?0:(totalLacs=totalCover/1e5,costPerLac=parseInt(premium/totalLacs))},isQuotesVisible=function(plan){var aegonNotVisiblePlans=[819,820,821],planId=plan.Plan_Id,isVisible=!0;return $rootScope.pTabName.monthlyPlans&&plan.maxTotalPremium<=0?isVisible=!1:(isVisible=plan.maxTotalPremium>0,isVisible=isVisible&&aegonNotVisiblePlans.indexOf(planId)==-1),isVisible};this.filterAllObjs=function(items,modifySelection){var finalOutput=[];angular.isDefined(items)&&items.length&&_.each(items,function(quote){quote.Supplier_Id;1*quote.Plan_Id!==816&&1*quote.Plan_Id!==817&&(quote.ComboPlans=[],quote.isCombo=!1,quote.ComboTotalPremium=parseInt(quote.maxTotalPremium,10),quote.monthlyTotalPremium=parseInt(quote.maxMonthlyTotalPremium,10),quote.maxMonthlyTotalPremium=angular.copy(quote.monthlyTotalPremium),1*quote.Plan_Id!=850&&1*quote.Plan_Id!=8501&&1*quote.Plan_Id!=8502||(isChanged=!0),quote.PolicyTerm==-1&&(quote.PolicyTerm=modifySelection.policyCoverage>75?modifySelection.policyCoverage:-1,quote.newCoverageUpto=modifySelection.policyCoverage,quote.isWholeLifePlan=!0),1*quote.Plan_Id===879&&(quote.isTrop=!1),quote.ComboTotalCover=quote.TotalCover,quote.CostPerLac=calculateCostPerLac(quote),quote.isQuotesVisible=isQuotesVisible(quote),quote.Claims_Settled=Number(quote.Claims_Settled).toFixed(1),finalOutput.push(quote))});var uniqueSupplierCombinePlans=[];return uniqueSupplierCombinePlans=angular.copy(finalOutput)},this.getRidersPremiumForQuotes=function(quotes,newTypes,isMonthly){var selectedRiders=[],types=angular.copy(newTypes);return _.each(types,function(val){if(val.status||val.isSelected){var id=val.id||val.categoryId;selectedRiders.push(id)}}),quotes&&_.each(quotes,function(quote){if(quote.isRiderSelectedForMobile=!1,quote.ridersToShowCount=0,_.each(quote.riderPremiumObject,function(riderVal){CommonServiceTerm.isBaxaNewPlans(quote.Plan_Id)&&(selectedRiders.indexOf(15)>-1&&1*riderVal.categoryId===11?riderVal.doNotAdd=!0:selectedRiders.indexOf(15)==-1&&1*riderVal.categoryId===11&&(riderVal.doNotAdd=!1)),_.each(types,function(type){GenericService.checkIfSelected(riderVal,type,quote,isMonthly)}),!CommonServiceTerm.isHdfc3dPlan(quote.Plan_Id)||38!==riderVal.categoryId||riderVal.premium||riderVal.monthlyPremium||(riderVal.inBuildAddOn=!0),(riderVal.inBuildAddOn||riderVal.isDefaultAdded||riderVal.isAvailable||riderVal.isIncluded||!riderVal.isHiddenOnMobile&&riderVal.isSelected)&&(quote.isRiderSelectedForMobile=!0,quote.ridersToShowCount=quote.ridersToShowCount+1),1*riderVal.categoryId===11&&riderVal.isSelected&&riderVal.doNotAdd&&(quote.riderPremiumAdded>0&&(quote.riderPremiumAdded=quote.riderPremiumAdded-riderVal.premium),quote.monthlyRiderPremiumAdded>0&&(quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded-riderVal.monthlyPremium))}),that.isMAXPlan(quote.Plan_Id)){var isADBSelected=!1,isADPDSelected=!1;_.each(quote.riderPremiumObject,function(rider){1*rider.categoryId===10&&rider.isSelected&&(isADBSelected=!0),1*rider.categoryId===12&&rider.isSelected&&(isADPDSelected=!0)}),_.each(quote.riderPremiumObject,function(rider){isADBSelected&&1*rider.categoryId===12&&(rider.isSelected=!0),isADPDSelected&&1*rider.categoryId===10&&(rider.isSelected=!0)})}}),quotes},this.addMisingDataFromAllPlans=function(comparedData,AllData){var planDetails=[];return _.each(comparedData,function(plan){var planId=plan.planId||plan.Plan_Id;plan.Supplier_Name||(planDetails=AllData.filter(function(plan){return plan.Plan_Id==planId}),planDetails&&planDetails.length>0&&(plan.Supplier_Name=planDetails[0].Supplier_Name,plan.planShortName=planDetails[0].planShortName,plan.Plan_Name=planDetails[0].Plan_Name))}),comparedData},this.modifyPlanObjectForDisplay=function(plans){return plans&&_.each(plans,function(plan){var ciRiderData=QuotesService.getCiData(plan.Supplier_Id);if(plan.PolicyTerm==-1&&(plan.isWholeLifePlan=!0),plan.costPerLac=calculateCostPerLac(plan),ciRiderData&&ciRiderData.length>0){var coveredIllness={};_.each(ciRiderData,function(ciData,index){coveredIllness[ciRiderData[index].categoryId]=ciRiderData[index].noOfIllness}),plan.coveredIllness=angular.copy(coveredIllness)}plan.riderPremiumObject&&plan.riderPremiumObject.length>0&&_.each(plan.riderPremiumObject,function(riderObj){riderObj.sumAssuredValidation={},GenericService.isPNBPlan(plan.Plan_Id)&&1*riderObj.categoryId===13&&(riderObj.isIncluded=!0),riderObj.sumAssured&&(riderObj.sumAssuredSelected=riderObj.sumAssured,riderObj.showSumAssuredInput=!1),riderObj.combinedText=showCombinedRiderInfo(riderObj.categoryId,plan,riderObj.name)})}),plans},this.findErrorFields=function(form){var errorFields=[];return _.each(form.$error,function(rules){_.each(rules,function(field){errorFields.push(field.$name)})}),errorFields},this.pushErrorField=function(errorFieldArray,newField){return errorFieldArray.indexOf(newField)>-1?errorFieldArray:(errorFieldArray.push(newField),errorFieldArray)},this.popErrorField=function(errorFieldArray,newField){var index=errorFieldArray.indexOf(newField);return index>-1&&errorFieldArray.splice(index,1),errorFieldArray},this.isValidAmount=function(amount,limitObject){var allowedAmont=limitObject.min,maxAllowedAmt=limitObject.max;return CommonServiceTerm.removeCommas(amount)>=allowedAmont&&CommonServiceTerm.removeCommas(amount)<=maxAllowedAmt},this.populateModifySearchModel=function(custInfo){return{name:custInfo.name,customerAge:custInfo.customerAge,isTobaccoUser:1*custInfo.isTobaccoUser,gender:1*custInfo.gender,city:custInfo.city,totalPayout:custInfo.totalPayout,monthlyIncome:custInfo.monthlyIncome,policyTerm:custInfo.policyTerm,emailId:custInfo.emailId,mobileNo:custInfo.mobileNo,encryptedMobileNo:custInfo.encryptedMobileNo,cityId:custInfo.cityId,countryId:custInfo.countryId,stateId:custInfo.stateId,state:custInfo.state,dob:custInfo.dob,spouse:custInfo.spouse||{tobacco:0,isWorking:0}}},this.syncCustInfoWithModifySearch=function(custInfo,modifySearch){return custInfo.name=modifySearch.name,custInfo.customerAge=modifySearch.customerAge,custInfo.isTobaccoUser=1*modifySearch.isTobaccoUser,custInfo.gender=1*modifySearch.gender,custInfo.city=modifySearch.city,custInfo.totalPayout=1*CommonServiceTerm.removeCommas(modifySearch.totalPayout),custInfo.monthlyIncome=1*CommonServiceTerm.removeCommas(modifySearch.monthlyIncome),custInfo.policyTerm=modifySearch.policyTerm,custInfo.emailId=modifySearch.emailId,custInfo.mobileNo=modifySearch.mobileNo,custInfo.encryptedMobileNo=modifySearch.encryptedMobileNo,custInfo.cityId=modifySearch.cityId,custInfo.countryId=modifySearch.countryId,custInfo.stateId=modifySearch.stateId,custInfo.state=modifySearch.state,custInfo.dob=modifySearch.dob,custInfo},this.getNewPlans=function(custInfo,comparePlanIds,isMonthly,payType,isTotalPayoutAndCoverageChange){custInfo.custId="";var input=createUpdateObj(custInfo,comparePlanIds);return input.isMonthly=isMonthly?1:0,payType=1*payType===2?"SinglePay":1*payType===3?"LimitedPay":"",input.payOptionType=payType,input.isTotalPayoutAndCoverageChange=isTotalPayoutAndCoverageChange?1:0,ServerUtilityService.postWebService(updateUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.setComparePlanIds=function(ids){_self.planIds=ids,_self.planIds.length>0&&_self.planIds.map(function(item){819!=item&&820!=item&&821!=item||(item=818)})},this.getComparePlanIds=function(){return _self.planIds},this.setIsAllMonthlyPlan=function(isAllMonthlyPlan){_self.isAllMonthlyPlan=isAllMonthlyPlan},this.getIsAllMonthlyPlan=function(){return _self.isAllMonthlyPlan},this.saveCustomerInfo=function(age,totalPayout,policyTerm){_self.customerInfo.customerAge=age,_self.customerInfo.totalPayout=totalPayout,_self.customerInfo.policyTerm=policyTerm},this.getCustomerInfo=function(){return _self.customerInfo},this.saveQuotesOrder=function(enquiryId,tabName,supplierPlans,allPlans){var obj={};return obj.enquiryId=enquiryId,obj.tabName=tabName,obj.supplierPlans=createAllPlansArray(supplierPlans,allPlans),obj.comparingPlanIds=_self.planIds,ServerUtilityService.postWebService(saveQuotesOrderUrl,obj).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.saveComparingPlanIds=function(custId,planIds,monthlyJourney){var obj={};return obj.custId=custId,obj.data={planIds:_self.planIds},obj.data.isMonthlyIncomeJourney=monthlyJourney||!1,ServerUtilityService.postWebService(saveComparingPlanIdsUrl,obj).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getComparingPlanIds=function(custId){var url=getComparingPlanIdsUrl+"custId="+custId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.groupByInsurer=function(allPlans){var supplierIds=getUniqueSupplierIds(allPlans),tempArray=[];return _.each(supplierIds,function(supplierId){var uniquePlans=[];_.each(allPlans,function(plan){supplierId==plan.supplierId&&uniquePlans.push(plan)}),tempArray.push(uniquePlans)}),tempArray},this.createEmptyUpdateObj=function(){var data=createUpdateObj({},[]);return data},this.changeTextVisibility=function(modifySearch,searchTextObj){modifySearch.name.length>0&&modifySearch.customerAge>0&&modifySearch.city?searchTextObj.personInfo.isComplete=!0:searchTextObj.personInfo.isComplete=!0},this.calculateDobFromAge=function(modifySelection){var d=new Date,currentYear=d.getFullYear(),age=modifySelection.customerAge?parseInt(modifySelection.customerAge,10):18,possibleBirthYear=currentYear-age,arrDob=modifySelection.dob.split("-"),dobDate=arrDob[0],dobMonth=arrDob[1],dobYear=arrDob[2];return dobYear==possibleBirthYear-1||dobYear==possibleBirthYear?modifySelection.dob:dobDate+"-"+dobMonth+"-"+possibleBirthYear},this.removeFromplan=function(plans,planId){var plans=plans.filter(function(plan){if(plan.Plan_Id!=planId)return plan});return plans},this.addRiderValues=function(plans,selectedRiderIds,isMonthly){return _.each(plans,function(plan){plan.monthlyRiderPremiumAdded=0,plan.riderPremiumAdded=0,_.each(plan.riderPremiumObject,function(riderObj){selectedRiderIds.indexOf(riderObj.categoryId)!=-1&&(plan.monthlyRiderPremiumAdded=1*plan.monthlyRiderPremiumAdded+1*riderObj.monthlyPremium,plan.riderPremiumAdded=1*plan.riderPremiumAdded+1*riderObj.premium)})}),plans};var getTabInfo=function(){return{oneTimePlansTab:$rootScope.pTabName.onetimePlans,monthlyPlansTab:$rootScope.pTabName.monthlyPlans,allPlansTab:$rootScope.pTabName.allPlans,tropPlans:$rootScope.pTabName.tropPlans,wholeLifePlans:$rootScope.pTabName.wholeLifePlans}};return this.buildEmailQuotesObject=function(uniqueSupplierPlans,customer,isMonthly,monthlyPlanExists,staticData){return{comparingPlans:buildPlanDetailsForEmail(uniqueSupplierPlans,customer,isMonthly,monthlyPlanExists,staticData),keyList:getEmailKeyList(staticData,monthlyPlanExists),categorydisplayNameIdList:getEmailCategoryList(staticData.riders),emailInputs:{template:"TERM_QUOTES",insurer:"TERM",name:customer.name,email:customer.emailId,custId:customer.custId,leadId:customer.matrixLeadId,method:"POST",encodedEnquiryId:customer.encodedEnquiryId,bcc:"abc@policybazaar.com",subject:"Term Insurance Quotes",tabInfo:getTabInfo()}}},this.emailQuotes=function(uniqueSupplierPlans,customer,isMonthly,monthlyPlanExists,staticData){var input=this.buildEmailQuotesObject(uniqueSupplierPlans,customer,isMonthly,monthlyPlanExists,staticData);return ServerUtilityService.postWebService(emailQuotesUrl,input)},this.getDefaultDate=function(){var today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear()-18;return dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm),today=dd+"-"+mm+"-"+yyyy},this.markCompareSelectedPlans=function(plans,comparePlanIds,comingBackFromComparePage){return comparePlanIds=comparePlanIds||[],_.each(plans,function(quote){var planId=quote.Plan_Id||quote.planId;CommonServiceTerm.isAegonItermPlusPlan(planId)&&(planId=818);var index=comparePlanIds.indexOf(planId);index!=-1?(quote.isCompareSelected=!0,quote.alreadyAddedForCompare=!!comingBackFromComparePage):(quote.isCompareSelected=!1,quote.alreadyAddedForCompare=!!comingBackFromComparePage)}),plans},this.pushPlansToComparingList=function(comparingPlans,newPlan){var newComparingPlans=comparingPlans||[],planId=newPlan.Plan_Id||newPlan.planId;return CommonServiceTerm.isAegonItermPlusPlan(planId)&&(planId=818),newComparingPlans.push({planCategory:newPlan.planCategory,planId:planId,planName:newPlan.Plan_Name,supplierId:newPlan.Supplier_Id,supplierName:newPlan.Supplier_Name,planShortName:newPlan.planShortName,E2EName:newPlan.E2EName,isMonthlyPlan:!!newPlan.monthlyIncome}),newComparingPlans},this.isPlanAlreadyPushedToStachel=function(comparedPlans,plan){var pushed=!1,planId=plan.Plan_Id||plan.planId,planAlradyPushed=comparedPlans.filter(function(pushedPlan){return pushedPlan.planId==planId});return planAlradyPushed.length>0&&(pushed=!0),pushed},this}]),app.service("CustomerService",["$rootScope","ServerUtilityService","GenericService","$cookies","CommonServiceTerm","$localStorage","$location",function($rootScope,ServerUtilityService,GenericService,$cookies,CommonServiceTerm,$localStorage,$location){"use strict";var createVisitUrl=(termConfigObj.getAPIPath(),"/v1/api/visit"),visitInfoUrl="/api/visitInfo",createEnquiryUrl="/api/enquiry",createCustomerUrl="/api/customer",updateCustomerUrl="/api/update/customer",customerInfoUrl="/api/custInfo",spouseUrl="/api/family",childUrl="/api/child",updateCustomerSelectionUrl="/api/custInfo/totalpayout",updateCustomerWrapperApiUrl="/api/wrapper/update/customer",updateCustomerWholeApiUrl="/api/wrapper/edit/profile",callbackUrl="/api/callback",unsubscribeUrl="/api/wrapper/pbcrm/unsubscribe",saveCustomerfilterUrl="/api/customerfilter",saveQuoteSelectionUrl="/api/quoteselection",trackJourneyUrl="/api/journey",exitPointUrl="/api/exitpointurl",chatInfoUrl="/api/chatcustinfo",ipinfoUrl="/api/location",leadInfoUrl="/api/clickToFill",registerUpdateCustomerUrl="/api/v1/customer",saveProfessionTypeUrl="/api/update/professionType",saveAnnualIncomeUrl="/api/update/annualIncome",customerEligibilityUrl="/api/customer/eligibility",customerMonthlyEligibilityDataUrl="/api/customer/monthly/eligibility",customerEligibilityDataUrl="/api/eligibility",self=this;return self.retainIsMobileDefault=!1,this.createVisit=function(){var postData=JSON.stringify({landingPageName:"PreQuotes",utmCampaign:$rootScope.utmCampaign,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",utmMedium:$rootScope.utmMedium,utmTerm:$rootScope.utmTerm,utmSource:$rootScope.utmSource});return ServerUtilityService.postWebService(createVisitUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.checkCustomerEligibility=function(input,isMonthly){var postData={age:input.age,professionType:input.professionType,educationQualification:input.educationQualification,annualIncome:1*input.annualIncome,sumAssured:isMonthly?void 0:input.sumAssured,planIdInfoMap:isMonthly?input.planIdInfoMap:void 0},url=isMonthly?customerMonthlyEligibilityDataUrl:customerEligibilityUrl;return ServerUtilityService.postWebService(url,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildEligibilityDataMonthly=function(quotes){var planIdInfoMap={};return angular.forEach(quotes,function(value,key){planIdInfoMap[value.Plan_Id]={supplierId:value.Supplier_Id,originalSupplierId:value.originalSupplierId,sumAssured:value.maxSumAssured}}),planIdInfoMap},this.getCustomerEligibilityData=function(enquiryId){var url=customerEligibilityDataUrl+"/"+enquiryId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.updateCustomerEligibilityData=function(input){return ServerUtilityService.postWebService(customerEligibilityDataUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getVisitInfo=function(visitId){var url=visitInfoUrl+"/"+visitId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.createEnquiry=function(custData){var postData=JSON.stringify({visitId:$cookies.get("Cookie_VisitLog"),exitpointUrl:custData.exitPointUrl,utmCampaign:$rootScope.utmCampaign,utmMedium:$rootScope.utmMedium,utmTerm:$rootScope.utmTerm,utmSource:$rootScope.utmSource,productId:GenericService.isUndefinedOrNull(custData.productId)?7:custData.productId,gaTrackerClientId:custData.gaTrackerClientId});return ServerUtilityService.postWebService(createEnquiryUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.createEnquiryNew=function(custData){var postData=JSON.stringify({visitId:custData.visitId,exitpointUrl:custData.exitPointUrl,utmCampaign:custData.utmCampaign,utmMedium:custData.utmMedium,utmTerm:custData.utmTerm,utmSource:custData.utmSource,productId:GenericService.isUndefinedOrNull(custData.productId)?7:custData.productId,gaTrackerClientId:custData.gaTrackerClientId,gclId:custData.gclId});return ServerUtilityService.postWebService(createEnquiryUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.RegisterUpdateCustomer=function(custData){var postData=JSON.stringify({enquiryId:custData.enquiryId,mobileNo:custData.mobileNo,encryptedMobileNo:custData.encryptedMobileNo,countryId:custData.countryCode,tobacco:custData.isTobacco,gender:angular.isDefined(custData.gender)&&custData.gender?custData.gender:1,name:custData.fullName,email:custData.emailId,cityId:custData.city.id,stateId:custData.city.stateId,exitpointUrl:custData.exitPointUrl,utmSource:$rootScope.utmSource,utmTerm:$rootScope.utmTerm,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,visitId:$cookies.get("Cookie_VisitLog")||custData.visitId,age:custData.age,totalPayout:$rootScope.isMonthlyIncomeJourney?0:custData.amount,premium:custData.premiumAmount,dob:custData.dob,monthlyIncome:$rootScope.isMonthlyIncomeJourney?custData.amount:0,subProductTypeId:$rootScope.subProductTypeId,otherCountryCode:custData.otherCountryCode,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB"});return ServerUtilityService.postWebService(registerUpdateCustomerUrl,postData).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})},this.createCustomer=function(custData){pbTrackerObj.logEvent({visitId:$cookies.get("Cookie_VisitLog")||custData.visitId,enquiryId:custData.enquiryId,event:"On Customer Create",pageName:"PQ",detectedCountry:custData.detectedCountry,selectedCountry:custData.countryCode,collection:"country_detect"}),custData.amount=custData.recommendedCover?custData.recommendedCover:custData.amount,392!=custData.countryCode&&(custData.professionType="");var postData=JSON.stringify({enquiryId:custData.enquiryId?custData.enquiryId:"",mobileNo:custData.mobileNo,encryptedMobileNo:custData.encryptedMobileNo,countryId:custData.countryCode,tobacco:custData.isTobacco,gender:angular.isDefined(custData.gender)&&custData.gender?custData.gender:1,name:custData.fullName,email:custData.emailId,cityId:custData.city.id,stateId:custData.city.stateId,exitpointUrl:custData.exitPointUrl,annualIncome:$rootScope.cancerJourney||$rootScope.dengueJourney?void 0:custData.annualIncome,professionType:angular.isDefined(custData.professionType)?custData.professionType:"Salaried",utmSource:$rootScope.utmSource,utmTerm:$rootScope.utmTerm,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,visitId:$cookies.get("Cookie_VisitLog")||custData.visitId,age:CommonServiceTerm.getAge(custData.dob),totalPayout:!$rootScope.isMonthlyIncomeJourney&&custData.amount?custData.amount:null,premium:0,dob:custData.dob,monthlyIncome:$rootScope.isMonthlyIncomeJourney?custData.amount:0,subProductTypeId:$rootScope.subProductTypeId,otherCountryCode:custData.otherCountryCode,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",geoCity:custData.geoCity,geoCountry:custData.geoCountry,productId:GenericService.isUndefinedOrNull(custData.productId)?7:custData.productId,gaTrackerClientId:custData.gaTrackerClientId,isInterestedForDengue:!1,gclId:custData.gclId,landingPageName:CommonServiceTerm.getLandingPageName(),isMobileSinglePage:custData.isMobileSinglePage,change:0,nri:1===custData.isNri&&392!=custData.countryCode?1:0,isSpouseJourney:custData.isSpouseJourney,isStateChange:custData.isStateChange,quotesPage:1===$rootScope.quotesVariant?"firstNewQuotes":2===$rootScope.quotesVariant?"secondNewQuotes":"",wholePlan:$cookies.get("pid")&&(111==$cookies.get("pid")||31==$cookies.get("pid"))||$cookies.get("pid")==-1?1:0});return ServerUtilityService.postWebService(createCustomerUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.updateCustomer=function(custData){pbTrackerObj.logEvent({custId:custData.custId,enquiryId:custData.enquiryId,event:"On Customer Update",pageName:"PQ",detectedCountry:custData.detectedCountry,selectedCountry:custData.countryCode,collection:"country_detect"}),custData.amount=custData.recommendedCover?custData.recommendedCover:custData.amount,392!=custData.countryCode&&(custData.professionType="");var postData=JSON.stringify({custId:custData.custId,enquiryId:custData.enquiryId,mobileNo:custData.mobileNo,encryptedMobileNo:custData.encryptedMobileNo,countryId:custData.countryCode||392,tobacco:custData.isTobacco,gender:angular.isDefined(custData.gender)&&custData.gender?custData.gender:1,name:custData.fullName,email:custData.emailId,cityId:custData.city.id,stateId:custData.city.stateId,annualIncome:$rootScope.cancerJourney||$rootScope.dengueJourney?void 0:custData.annualIncome,professionType:angular.isDefined(custData.professionType)?custData.professionType:"Salaried",exitpointUrl:custData.exitPointUrl,utmSource:$rootScope.utmSource,utmTerm:$rootScope.utmTerm,utmMedium:$rootScope.utmMedium,utmCampaign:$rootScope.utmCampaign,visitId:$cookies.get("Cookie_VisitLog")||custData.visitId,age:custData.age,totalPayout:1!=custData.subProductTypeId?custData.amount:0,premium:custData.premiumAmount,dob:custData.dob,monthlyIncome:1==custData.subProductTypeId?custData.amount:0,subProductTypeId:custData.subProductTypeId,otherCountryCode:custData.otherCountryCode,leadSource:$rootScope.isMobileDevice?"PBMobile":"PB",geoCity:custData.geoCity,geoCountry:custData.geoCountry,productId:GenericService.isUndefinedOrNull(custData.productId)?7:custData.productId,gaTrackerClientId:custData.gaTrackerClientId,gclId:custData.gclId,isMobileSinglePage:custData.isMobileSinglePage,isInterestedForDengue:!1,change:0,landingPageName:CommonServiceTerm.getLandingPageName(),nri:1===custData.isNri&&392!=custData.countryCode?1:0,isSpouseJourney:custData.isSpouseJourney,isStateChange:custData.isStateChange,wholePlan:$cookies.get("pid")&&(111==$cookies.get("pid")||31==$cookies.get("pid"))||$cookies.get("pid")==-1?1:0});return ServerUtilityService.putWebService(updateCustomerUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getCustomerInformation=function(enquiryId,productId){var url=customerInfoUrl+"/"+enquiryId;return productId&&(url=url+"?productId="+productId),ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildSpouseInputObject=function(modifySelection,enquiryId){var input=modifySelection.spouse;return input.refId=enquiryId,input.visitId=modifySelection.visitId,input},this.updateSpouseDetails=function(modifySelection,enquiryId){var input=this.buildSpouseInputObject(modifySelection,enquiryId);return ServerUtilityService.postWebService(spouseUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildChildInputObject=function(modifySelection){var input={};return input.childAge=1*modifySelection.child.age===0?100:modifySelection.child.age,input.refId=modifySelection.encodedEnquiryId,input.visitId=$cookies.get("Cookie_VisitLog")||modifySelection.visitId,input},this.updateChildDetails=function(modifySelection){var input=this.buildChildInputObject(modifySelection);return ServerUtilityService.postWebService(childUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getDateOfBirthByAge=function(modifySelection){var d=new Date,currentYear=d.getFullYear(),age=parseInt(modifySelection.customerAge,10),possibleBirthYear=currentYear-age,arrDob=modifySelection.dob.split("-"),dobDate=arrDob[0],dobMonth=arrDob[1],dobYear=arrDob[2];return dobYear==possibleBirthYear-1||dobYear==possibleBirthYear?modifySelection.dob:dobDate+"-"+dobMonth+"-"+possibleBirthYear},this.buildProfileObject=function(modifySelection,enquiryId,exitPointUrl){var isMobileDefault=(this.getDateOfBirthByAge(modifySelection),!!$location.$$search.isMobileDefault);return isMobileDefault&&!self.retainIsMobileDefault&&$location.search("isMobileDefault",null).replace(),{custId:modifySelection.custId,change:0,enquiryId:enquiryId,mobileNo:modifySelection.mobileNo,encryptedMobileNo:modifySelection.encryptedMobileNo,countryId:modifySelection.countryId,tobacco:modifySelection.isTobaccoUser,gender:angular.isDefined(modifySelection.gender)&&modifySelection.gender?modifySelection.gender:1,name:modifySelection.name,email:modifySelection.emailId,cityId:modifySelection.cityId,stateId:modifySelection.stateId,exitpointUrl:exitPointUrl?exitPointUrl:location.href,utmSource:$rootScope.utmSource||"",utmTerm:$rootScope.utmTerm||"",utmMedium:$rootScope.utmMedium||"",utmCampaign:$rootScope.utmCampaign||"",visitId:$cookies.get("Cookie_VisitLog")||modifySelection.visitId,age:modifySelection.customerAge,totalPayout:modifySelection.totalPayout,premium:modifySelection.premium,dob:modifySelection.dob,monthlyIncome:modifySelection.monthlyIncome,annualIncome:1*modifySelection.annualIncome,professionType:modifySelection.professionType,subProductTypeId:$rootScope.isMonthlyIncomeJourney?1:modifySelection.subProductTypeId,
otherCountryCode:modifySelection.otherCountryCode,productId:GenericService.isUndefinedOrNull(modifySelection.productId)?7:modifySelection.productId,gaTrackerClientId:modifySelection.gaTrackerClientId,policyTerm:modifySelection.nri?null:modifySelection.policyCoverage,landingPageName:CommonServiceTerm.getLandingPageName(),isDefaultCityChange:!!isMobileDefault,nri:modifySelection.nri,isMobileSinglePage:modifySelection.isMobileSinglePage,isSpouseJourney:!!modifySelection.isSpouseJourney&&modifySelection.isSpouseJourney,isStateChange:!!modifySelection.isStateChange&&modifySelection.isStateChange}},this.updateProfileDetails=function(modifySelection,enquiryId,exitPointUrl){exitPointUrl=angular.isDefined(exitPointUrl)?exitPointUrl:null;var postData=this.buildProfileObject(modifySelection,enquiryId,exitPointUrl);return ServerUtilityService.putWebService(updateCustomerUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildCustomerSelectionObject=function(modifySelection,enquiryId){var object={enquiryId:enquiryId,policyTerm:modifySelection.policyCoverage,totalPayout:modifySelection.totalPayout};return $rootScope.pTabName&&$rootScope.pTabName.monthlyPlans?object.monthlyIncome=modifySelection.monthlyIncome:object.monthlyIncome=0,object},this.updateCustomerSelection=function(modifySelection,enquiryId){var input=this.buildCustomerSelectionObject(modifySelection,enquiryId);return ServerUtilityService.postWebService(updateCustomerSelectionUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildUpdateCustomerObject=function(modifySelection,enquiryId,exitPointUrl,profileUpdated,selectionUpdated){return{payoutObject:selectionUpdated?this.buildCustomerSelectionObject(modifySelection,enquiryId):null,editProfileObject:profileUpdated?this.buildProfileObject(modifySelection,enquiryId,exitPointUrl):null}},this.updateCustomerProfile=function(modifySelection,enquiryId,profileUpdated,selectionUpdated){exitPointUrl=angular.isDefined(exitPointUrl)?exitPointUrl:null;var postData=this.buildUpdateCustomerObject(modifySelection,enquiryId,exitPointUrl,profileUpdated,selectionUpdated);return ServerUtilityService.putWebService(updateCustomerWrapperApiUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.updateCustomerProfileWhole=function(modifySelection,enquiryId,profileUpdated,selectionUpdated){exitPointUrl=angular.isDefined(exitPointUrl)?exitPointUrl:null;var postData=this.buildUpdateCustomerObject(modifySelection,enquiryId,exitPointUrl,profileUpdated,selectionUpdated);return 1*modifySelection.child.age!=0&&(postData.childProfileObject=this.buildChildInputObject(modifySelection)),postData.spouseProfileObject=this.buildSpouseInputObject(modifySelection,enquiryId),ServerUtilityService.putWebService(updateCustomerWholeApiUrl,postData).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.updateCustomerInfoUsingService=function(data){return CommonServiceTerm.saveUTMSourcesToScope(data),{age:data.customerAge,gender:data.gender,city:{id:data.cityId,name:data.city+"("+data.state+")",stateId:data.stateId},isTobacco:data.isTobaccoUser,amount:1==data.subProductTypeId?data.monthlyIncome:data.totalPayout,premiumAmount:data.premium,fullName:data.name,emailId:data.emailId,countryCode:data.countryId,mobileNo:data.mobileNo,encryptedMobileNo:data.encryptedMobileNo,visitId:$cookies.get("Cookie_VisitLog")||data.visitId,enquiryId:data.enquiryId,custId:data.custId,dob:data.dob,monthlyIncome:data.monthlyIncome,subProductTypeId:data.subProductTypeId,otherCountryCode:1*data.otherCountryCode===0?"":data.otherCountryCode,matrixLeadId:data.matrixLeadId,annualIncome:data.annualIncome,professionType:angular.isDefined(data.professionType)?data.professionType:"Salaried",isInterestedForDengue:!1,existUrl:data.existUrl,isNri:data.nri}},this.updateCustomerInfoUsingStorage=function(data){return{age:angular.isDefined(data.age)?data.age:null,gender:angular.isDefined(data.gender)?data.gender:1,city:{id:angular.isDefined(data.city)&&angular.isDefined(data.city.id)?data.city.id:null,name:angular.isDefined(data.city)&&angular.isDefined(data.city.name)?data.city.name:null,stateId:angular.isDefined(data.city)&&angular.isDefined(data.city.stateId)?data.city.stateId:null},isTobacco:angular.isDefined(data.isTobacco)?data.isTobacco:null,amount:angular.isDefined(data.amount)?data.amount:1e7,premiumAmount:angular.isDefined(data.premiumAmount)?data.premiumAmount:0,fullName:angular.isDefined(data.fullName)?data.fullName:null,emailId:angular.isDefined(data.emailId)?data.emailId:null,countryCode:angular.isDefined(data.countryCode)?data.countryCode:392,mobileNo:angular.isDefined(data.mobileNo)?data.mobileNo:null,encryptedMobileNo:angular.isDefined(data.encryptedMobileNo)?data.encryptedMobileNo:null,visitId:angular.isDefined(data.visitId)?data.visitId:null,enquiryId:angular.isDefined(data.enquiryId)?data.enquiryId:null,custId:angular.isDefined(data.custId)?data.custId:null,dob:angular.isDefined(data.dob)?data.dob:null,subProductTypeId:angular.isDefined(data.subProductTypeId)?data.subProductTypeId:null,otherCountryCode:1*data.otherCountryCode===0?"":data.otherCountryCode,annualIncome:data.annualIncome||1,professionType:angular.isDefined(data.professionType)?data.professionType:"Salaried",isInterestedForDengue:!1,existUrl:data.existUrl,isNri:data.nri}},this.buildCallbackObject=function(preQuotesInfo,isCancer){return{mobile:preQuotesInfo.encryptedMobileNo,userInfoId:preQuotesInfo.userInfoId,journeyType:isCancer?"CANCER_IB":"TERM_IB"}},this.callbackUrl=function(preQuotesInfo,isCancer){var queryString=$.param(this.buildCallbackObject(preQuotesInfo,isCancer)),url=callbackUrl+"?"+queryString;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.unsubscribeUrl=function(userInfo){var url=unsubscribeUrl+"?encodedMobileOrEmail="+userInfo.mobile;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.saveCustomerfilter=function(input){return ServerUtilityService.postWebService(saveCustomerfilterUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.saveQuoteSelection=function(input){return input.supplierId=CommonServiceTerm.getRealSupplierId(input.supplierId),ServerUtilityService.postWebService(saveQuoteSelectionUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildTrackJourneyObject=function(enquiryId,pageId){return{refId:enquiryId,pageId:pageId,source:"PB",ipAdress:"127.0.0.1",createdBy:-1}},this.trackCustomerJourneyService=function(enquiryId,pageId){var input=this.buildTrackJourneyObject(enquiryId,pageId);return ServerUtilityService.postWebService(trackJourneyUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildExitPointUrl=function(enquiryId,exitPoint,productId){return{refId:enquiryId,exitPointUrl:exitPoint,productId:GenericService.isUndefinedOrNull(productId)?7:productId}},this.setExitPointUrl=function(enquiryId,exitPoint,productId){var input=this.buildExitPointUrl(enquiryId,exitPoint,productId);return ServerUtilityService.postWebService(exitPointUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.saveAnnualIncome=function(userInfoId,annualIncome){var input={encodedLeadId:userInfoId,annualIncome:annualIncome};return ServerUtilityService.postWebService(saveAnnualIncomeUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.saveProfessionType=function(userInfoId,professionType){var input={encodedLeadId:userInfoId,professionType:professionType};return ServerUtilityService.postWebService(saveProfessionTypeUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getChatInformation=function(matrixLeadId){var url=chatInfoUrl+"/"+matrixLeadId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getIpInfo=function(){var url=ipinfoUrl;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getLeadInformation=function(leadId){var url=leadInfoUrl+"/"+leadId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.DecodeAnnualIncome=function(AnnualIncome){if(AnnualIncome)return 1*AnnualIncome<=199999?7:1*AnnualIncome>199999&&1*AnnualIncome<=299999?8:1*AnnualIncome>299999&&1*AnnualIncome<=499999?2:1*AnnualIncome>499999&&1*AnnualIncome<=699999?3:1*AnnualIncome>699999&&1*AnnualIncome<=999999?4:1*AnnualIncome>999999&&1*AnnualIncome<=1499999?5:6},this.recommendCoverAnnualIncomeList={100000:2e6,200000:3e6,300000:3e6,400000:4e6,500000:5e6,600000:75e5,700000:75e5,800000:1e7,900000:1e7,1000000:1e7,1100000:1e7,1200000:1e7,1300000:1e7,1400000:1e7,1500000:2e7,1600000:2e7,1700000:2e7,1800000:2e7,1900000:2e7,2000000:2e7},this.recommendCover=function(annualIncome){return annualIncome>2e6?3e7:this.recommendCoverAnnualIncomeList[annualIncome]},this.minOfAnnualIncomeRange=function(id){switch(1*id){case 7:return 1e5;case 8:return 2e5;case 2:return 3e5;case 3:return 5e5;case 4:return 7e5;case 5:return 1e6;case 6:return 15e5;default:return 5e5}},this.updateCustomerInfoUsingLeadInfo=function(data,visitId){return{age:CommonServiceTerm.getAge(data.DOB),gender:GenericService.isUndefinedOrNull(data.Gender)?1:"Male"==data.Gender?1:2,city:{id:9999!==data.CityID?data.CityID:null,name:9999!==data.CityID?data.City:null,stateId:9999!==data.CityID?data.StateID:null},isTobacco:null,amount:GenericService.isUndefinedOrNull(data.SA)?1e7:data.SA,premiumAmount:2e3,fullName:data.Name,emailId:data.EmailID,countryCode:data.CountryId,mobileNo:data.MobileNo,encryptedMobileNo:data.encryptedMobileNo,visitId:$cookies.get("Cookie_VisitLog")||visitId,dob:data.DOB,monthlyIncome:0,subProductTypeId:2,annualIncome:data.AnnualIncome?self.DecodeAnnualIncome(data.AnnualIncome):data.annualIncome||($localStorage.custData&&$localStorage.custData.annualIncome?$localStorage.custData.annualIncome:1),isInterestedForDengue:!1,existUrl:data.existUrl,isNri:data.nri,oldLeadId:data.LeadID,custId:data.custId||data.CustomerID}},this.setEnquiryCookie=function(enquiryId){var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("enquiryId",enquiryId,{expires:expireDate,domain:"policybazaar.com"})},this.saveSelectedFilters=function(enquiryId,types,filterParam,planOrder){planOrder=angular.isDefined(planOrder)?planOrder:0;var selectedFiltersFormat={refId:enquiryId,filtersStatus:[],sortBy:{key:"",order:""},selectedPlanOrder:planOrder};selectedFiltersFormat.filtersStatus=GenericService.getCheckedFilters(types),selectedFiltersFormat.sortBy.key=filterParam,selectedFiltersFormat.sortBy.order="",this.saveCustomerfilter(selectedFiltersFormat).success(function(data,status,headers,config){})},this.trackCustomerJourney=function(enquiryId){enquiryId&&self.trackCustomerJourneyService(enquiryId,3).success(function(data,status,headers,config){})},this}]),app.service("GenericService",["$rootScope","ServerUtilityService","$q","$localStorage","$location","$routeParams","$filter","PlanService","CommonServiceTerm","$timeout","$cookies",function($rootScope,ServerUtilityService,$q,$localStorage,$location,$routeParams,$filter,PlanService,CommonServiceTerm,$timeout,$cookies){"use strict";function calculateFromMinMax(min,max,interval,sumAssured){for(var mod,arr=[],i=min;i<=max;)arr.push(i),i<1e4?i=parseInt(i)+1e3:i<1e5?(mod=i%1e4,0!==mod&&(i=1e4*Math.ceil(i/1e4),arr.push(i)),i=parseInt(i)+1e4):i=i<1e7?parseInt(i)+interval:parseInt(i)+1e5;return arr}function subtractServiceTaxFromPremium(val,premium){var allowedPremium=Number.POSITIVE_INFINITY,basePremium=premium;return val.premiumLimit>0&&(allowedPremium=parseInt(parseInt(val.premiumLimit)/100*basePremium)),allowedPremium}function hideBasicCi(planId){var planIds=[806,807,808,809,810,725,726,727,728,766,767,768,1013,1015,1016,1018,1019,1021],status=!1;return planId=parseInt(planId,10),planIds.indexOf(planId)>=0&&(status=!0),status}function isInbuildAddOn(id,inbuildAddOns){var inBuild=!1;return inbuildAddOns&&(inBuild=inbuildAddOns[id]||!1),inBuild}function isDefaultAdded(categoryId,planId,age){return that.isHDFCPlan(planId)&&1*categoryId===12?age<=55:1*planId===818&&1*categoryId===10||(1*planId===819||1*planId===820||1*planId===821)&&1*categoryId===101||(1*planId===890&&(1*categoryId===15||1*categoryId===38)||1*planId===891&&1*categoryId===101)}function mobileHideKey(rider,val,isMonthly){var hidden=!1;return hidden=isMonthly&&(val.monthlyTotalPremium>0||val.maxMonthlyTotalPremium>0)?!(rider.monthlyPremium>0):!(rider.premium>0)}function addCiPlusAdbRiderOnPlan(riderPremiumObject){var ciPlusAdbRider={name:"Death due to accident & Critical illness",categoryId:110,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1};return riderPremiumObject.push(ciPlusAdbRider),riderPremiumObject}function pushCustomRiders(riderArray,plan,custInfo){return that.isMAXPlan(plan.Plan_Id)&&(plan.payOptionType||(riderArray.push({name:"Pay till 60 years",isSelected:!1,hasRiderStatus:"Available",checked:!0}),plan.TotalCover<=1e7&&riderArray.push({name:"Insta Claims",isSelected:!1,hasRiderStatus:"Available",checked:!0,riderPriority:1})),$routeParams.isSpouseJourney&&riderArray.push({name:"Cover for Spouse",isSelected:!1,hasRiderStatus:"Available",checked:!0,riderPriority:0})),!CommonServiceTerm.isTataPlan(plan.Plan_Id)||that.isTATASampoornaRakshaPlan(plan.Plan_Id)||plan.payOptionType||riderArray.push({name:"Pay for 10 years",isSelected:!0,hasRiderStatus:"Available",checked:!0}),CommonServiceTerm.isKotakPlan(plan.Plan_Id)&&!plan.payOptionType&&riderArray.push({name:"Lower your Cover Amount Option",isSelected:!1,hasRiderStatus:"Available",checked:!0}),CommonServiceTerm.isHdfc3dPlan(plan.Plan_Id)&&riderArray.push({name:"Waiver of premium",isSelected:!1,inBuildAddOn:!0,riderPriority:5}),CommonServiceTerm.isExidePlan(plan.Plan_Id)&&!plan.payOptionType&&riderArray.push({name:"Extended Term",isSelected:!1,hasRiderStatus:"Available",checked:!0}),that.isAegoniTermPlan(plan.Plan_Id)&&$routeParams.isSpouseJourney&&riderArray.push({name:"Cover for Spouse",isSelected:!0,hasRiderStatus:"Available",checked:!0,riderPriority:10}),riderArray}function hideARiderForNRI(quote,custInfo,categoryId){var countryId=1*custInfo.countryId;return 392!=countryId&&(11===categoryId||15===categoryId)&&(16!==quote.Supplier_Id&&116!==quote.Supplier_Id&&(10!==quote.Supplier_Id||378!==countryId&&376!==countryId&&24!==countryId&&999!==countryId&&375!==countryId))}function getRiderObjectNew(riderObj,plan,custInfo){var availableRiders=[],inbuildAddOns=plan.inbuildAddOns;_.each(plan.riderIdCategory,function(rider){if(availableRiders.indexOf(rider.catrgoryId)!=-1||hideARiderForNRI(plan,custInfo,rider.catrgoryId)||availableRiders.push(rider.catrgoryId),$routeParams.isSpouseJourney&&13==rider.catrgoryId){var spouseObj={riderPriority:1,categoryId:rider.catrgoryId,riderId:rider.riderId};plan.topTwoRiderCategoryId[0]=spouseObj}}),[818,819,820,821].indexOf(plan.Plan_Id)>-1&&(_.each(plan.riderIdCategory_818,function(rider){availableRiders.indexOf(rider.catrgoryId)==-1&&availableRiders.push(rider.catrgoryId)}),_.each(plan.riderIdCategory_819,function(rider){availableRiders.indexOf(rider.catrgoryId)==-1&&availableRiders.push(rider.catrgoryId)}),_.each(plan.riderIdCategory_820,function(rider){availableRiders.indexOf(rider.catrgoryId)==-1&&availableRiders.push(rider.catrgoryId)}),_.each(plan.riderIdCategory_821,function(rider){availableRiders.indexOf(rider.catrgoryId)==-1&&availableRiders.push(rider.catrgoryId)}));var arr=[];return _.each(riderObj,function(rider){that.hideAParticularRider(rider.categoryId,plan.Plan_Id,plan)||(availableRiders.indexOf(rider.categoryId)>-1&&arr.indexOf(rider.categoryId)==-1&&arr.push(rider),inbuildAddOns&&inbuildAddOns[rider.categoryId]&&arr.indexOf(rider.categoryId)==-1&&arr.push(rider))}),arr=pushCustomRiders(arr,plan,custInfo)}function getFeatures(plan,age){var supplierId=plan.Supplier_Id||plan.supplierId,featuresObject=(plan.Plan_Id,{5:[{title:"Cover against 34 critical illness",description:""},{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],116:[{title:"Option to extend Coverage till 100 years available",description:""},{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],16:[{title:"Option to increase life cover with age",description:""},{title:"Early claim settlement on terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"},{title:"Premiums are waived incase of disability",description:"Incase of a permanent disability to the life insured all future premiums will be paid by the insurance company"}],10:[{title:"Only plan with coverage against 40 Critical Illnesses",description:""},{title:"Option to pay till 60 years and get coverage till 85",description:"Premiums will have to be paid only till the age of 60; policy will continue till "+(60-age)+"yrs"}],117:[{title:"Option to extend Coverage till 100 years available",description:""},{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],31:[{title:"Option to extend Coverage till 99 years available.",description:""},{title:"Option to get Coverage against Heart & Cancer illnesses.",description:""}],201:[{title:"Only plan with coverage against critical illness till age of 85 years",description:""}],20:[{title:"Only plan with coverage against critical illness till age of 85 years",description:""}],19:[{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"},{title:"Get Cover against death & disability",description:""}],22:[{title:"Option to pay for 5 years and get coverage upto 60 years",description:""},{title:"Double your life cover in 20 years",description:""}],124:[{title:"Coverage against 36 Critical Illnesses",description:""}],24:[{title:"Cover against 35 critical illness",description:""},{title:"Option to pay for 5/10/15/20/25 years and get coverage till 85.",description:""}],1:[{title:"Coverage against death & disabilty",description:""}],25:[{title:"Coverage against 35 Critical Illnesses",description:""},{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],3:[{title:"Exclusive plan with option to reduce cover amount with age",description:""},{title:"Coverage against 37 Critical Illnesses (know more)",description:""}],1117:[{title:"Coverage against 36 Critical Illnesses",description:""},{title:"Option to cover yourself till 80 yrs of age.",description:""}],88:[{title:" Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],14:[{title:"Only plan that offers partial payout on occurrence of critical illness.",description:""}],77:[{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],700:[{title:"Only plan that offers increasing critical Illness benefit.",description:""}],11:[{title:"Coverage against 34 Critical Illnesses",description:""}],9:[{title:"Option to extend policy term by 5 yrs or 10 yrs.",description:""}],41:[{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],141:[{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}]}),featuresText=featuresObject[supplierId]?featuresObject[supplierId]:"";if(featuresText&&featuresText.length>0)return featuresText}function getPlanType(planType){var planType=planType||1;return 2==planType?"H":3==planType?"CH":"C"}var isChanged=!1,trackerId=(termConfigObj.getAPIPath(),""),getPrivateIP="/ipRequest",isInternalIP="/api/isInternalIP",cityUrl="/api/city",offerUrl="/api/offerdetail",invalidMobile="/api/checkMobile",checkLocalIpUrl="api/local/ip",regexForCountryUrl="/api/regex/country",buyPageUrl="/api/buy/",buyPageLandingUrl="/api/buy",fetchDataByMobileNoApi="/api/buy/home/",hdfcImpressionMIDAPI="https://dpm.demdex.net/id?d_rtbd=json&d_ver=2&d_orgid=0165B0EA550AFCD50A4C98C6%40AdobeOrg&d_cb=s_c_il%5B0%5D._setMarketingCloudFields",that=this;this.priorityObject={20:20,201:201,88:588,19:179,6:26,1:81,124:162,24:248,12:12,116:146,14:194,9:95,31:31,25:265,3:37,11:121,16:16,77:757,7:7,700:700,10:150,22:282,2:254,4:487,1117:187,117:197,17:147,5:758},this.setTrackerId=function(id){trackerId=id},this.getTrackerId=function(){return trackerId},this.isUndefinedOrNull=function(val){return angular.isUndefined(val)||null===val||!val||"null"===val||"undefined"===val},this.getCity=function(){var url=cityUrl;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){}).error(function(data,status,headers,config){return data})},this.getCityList=function(keyword){var url=cityUrl+"/"+keyword;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getMID=function(keyword){var deferred=$q.defer();return ServerUtilityService.getWebServiceWithCreds(hdfcImpressionMIDAPI).success(function(data,status,headers,config){var visitorid=data.replace('s_c_il[0]._setMarketingCloudFields({"d_mid":"',"");visitorid=visitorid.substring(0,visitorid.indexOf('"')),deferred.resolve(visitorid)}).error(function(data,status,headers,config){}),deferred.promise},this.getBuyPageLink=function(keyword,param){var url=buyPageUrl+"/"+keyword+"?planId="+param;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getBuyLandingPageLink=function(param){var url=buyPageLandingUrl;return ServerUtilityService.postWebService(url,param).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getDataByMobileNoApi=function(keyword,planId){var url=fetchDataByMobileNoApi+"/"+keyword;return planId&&(url+="?planId="+planId),ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.formatCity=function(data){var gurugramObject={CityId:"555",StateId:"36",CityName:"Gurugram (NCR)",state:"NCR"},vishakhapatnamObject={CityId:"20",StateId:"1",CityName:"Vishakhapatnam (Andhra Pradesh)",state:"Andhra Pradesh"},bangaloreObject={CityId:"207",StateId:"16",CityName:"Bangalore (Karnataka)",state:"Karnataka"};data.push(gurugramObject),data.push(vishakhapatnamObject),data.push(bangaloreObject);var callback=function(data){return{display:data.CityName,value:data.CityName,searchString:data.CityName,name:data.CityName,stateId:data.StateId,cityId:data.CityId}};return data.map(callback)},this.formatCityWebService=function(data){var callback=function(data){return{display:data.name+"("+data.state+")",value:data.name+"("+data.state+")",searchString:data.name+"("+data.state+")",stateId:data.stateId,cityId:data.id}};return data.map(callback)},this.verifyMobileNumber=function(custData){var postData=JSON.stringify({mobileNo:custData.mobileNo,encryptedMobileNo:custData.encryptedMobileNo,isNRI:1*custData.countryId!=392});return ServerUtilityService.postWebService(invalidMobile,postData).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})},this.checkLocalIp=function(){return ServerUtilityService.getWebService(checkLocalIpUrl).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getFormattedDate=function(dateString){dateString=this.changeDateTommddYY(dateString);var date=new Date(dateString),milliseconds=date.getTime();return milliseconds+=198e5,"/Date("+milliseconds+")/"},this.isSpouseAgeValid=function(age){return age=parseInt(age,10),age>=18&&age<=65},this.isChildAgeValid=function(age){return age=parseInt(age,10),age>=0&&age<=14},this.isProfileAgeValid=function(age){return age=parseInt(age,10),age>=18&&age<=65},this.isHDFCPlan=function(planId){var hdfcPlans=[296,725,726,727,728],isHDFCPlan=!1;return planId=parseInt(planId,10),hdfcPlans.indexOf(planId)>=0&&(isHDFCPlan=!0),isHDFCPlan},this.isHDFCExtraLife=function(planId){return planId=parseInt(planId,10),725==planId},this.isHDFCIncomeOption=function(planId){return planId=parseInt(planId,10),726==planId||727==planId||728==planId},this.isETPlan=function(planId){return planId=parseInt(planId,10),732==planId||735==planId},this.isETZindagiPlusPlan=function(planId){return planId=parseInt(planId,10),911==planId||912==planId||9112==planId||9122==planId},this.isHDFC3DIncomeOptionPlan=function(planId){return planId=parseInt(planId,10),852==planId||853===planId},this.isHDFC3DLifeOptionPlan=function(planId){return planId=parseInt(planId,10),849===planId||8491===planId||8492===planId},this.isHDFC3DIncomeReplacementOptionPlan=function(planId){return planId=parseInt(planId,10),854==planId||855===planId},this.isHDFC3DLifeProtectionOptionPlan=function(planId){return planId=parseInt(planId,10),851==planId||879==planId},this.isEtTotalSecurePlan=function(planId){return planId=parseInt(planId,10),790==planId||791==planId||792==planId||794==planId||795==planId},this.isETCitiCarePlan=function(planId){return planId=parseInt(planId,10),771==planId},this.isETMonthlyIncomePlan=function(planId){return planId=parseInt(planId,10),758==planId},this.isReliancePlan=function(planId){return planId=parseInt(planId,10),718==planId},this.isIDBIPlan=function(planId){return planId=parseInt(planId,10),762==planId},this.isIDBIiSuranceFlexiPlan=function(planId){return planId=parseInt(planId,10),796==planId},this.isBAXAPlanIncrementalPlan=function(planId){return planId=parseInt(planId,10),739==planId||740==planId},this.isBirlaSunLifePlan=function(planId){return planId=parseInt(planId,10),800==planId||801==planId||802==planId},this.isPNBPlan=function(planId){return planId=parseInt(planId,10),749==planId||752==planId||756==planId||753==planId},this.isBSLIPlan=function(planId){return CommonServiceTerm.isBSLIPlan(planId)},this.isSBIPlan=function(planId){return planId=parseInt(planId,10),703==planId},this.isSBIIncomePlans=function(planId){return planId=parseInt(planId,10),780==planId||781==planId||782==planId||783==planId},this.isSBIIncreasingIncomePlans=function(planId){return planId=parseInt(planId,10),781==planId||782==planId||783==planId},this.isFGPlan=function(planId){return planId=parseInt(planId,10),763==planId},this.isFGFlexiOnlinePlan=function(planId){return planId=parseInt(planId,10),763==planId||764==planId||765==planId},this.getGATrackerId=function(){try{ga(function(){for(var trackers=ga.getAll(),i=0;i<trackers.length;++i){var tracker=trackers[i];if($rootScope.cancerJourney){if("ccTrackerObj"==tracker.get("name"))return void that.setTrackerId(tracker.get("clientId"))}else if("termTrackerObj"==tracker.get("name"))return void that.setTrackerId(tracker.get("clientId"))}})}catch(err){}},this.getGATrackerId(),this.isValidDateOfBirth=function(dob){if(angular.isUndefined(dob)||!dob)return!1;var dobRegX=/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/;if(dob.match(dobRegX)){var dobArray=dob.split("-"),date=parseInt(dobArray[0],10),month=parseInt(dobArray[1],10),year=parseInt(dobArray[2],10),listOfDays=[31,28,31,30,31,30,31,31,30,31,30,31];if((1==month||month>2)&&date>listOfDays[month-1])return!1;if(2==month){var leapYear=!1;if((year%4||!(year%100))&&year%400||(leapYear=!0),!leapYear&&date>=29)return!1;if(leapYear&&date>29)return!1}return!0}return!1},this.extractDateMonthYearFromDOB=function(dobString,index){var dobArray=[];return dobArray=dobString.indexOf("-")>=0?dobString.split("-"):dobString.split(","),parseInt(dobArray[index],10)},this.setCookie=function(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+"; "+expires},this.getCookie=function(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(c.indexOf(name)!=-1)return c.substring(name.length,c.length)}return""},this.isTimeWithRange=function(){var inRange=!1,date=new Date,offset=date.getTimezoneOffset(),milliSeconds=date.getTime(),sum=milliSeconds+60*offset*1e3+198e5,finalDate=new Date(sum),h=finalDate.getHours(),startHour=(finalDate.getMinutes(),finalDate.getSeconds(),10),endHour=19;return startHour<=h&&endHour>h&&(inRange=!0),inRange},this.isTimeWithRangeForCallback=function(){var inRange=!1,date=new Date,offset=date.getTimezoneOffset(),milliSeconds=date.getTime(),sum=milliSeconds+60*offset*1e3+198e5,finalDate=new Date(sum),h=finalDate.getHours(),startHour=(finalDate.getMinutes(),finalDate.getSeconds(),10),endHour=23;return startHour<=h&&endHour>h&&(inRange=!0),inRange},this.isLeapYear=function(year){var leapYear=!1;return(year%4||!(year%100))&&year%400||(leapYear=!0),leapYear},this.getMonthList=function(date,year){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},this.changeDateFromHyphenToSlash=function(dateString){var arrDateString=dateString.split("-");return arrDateString[0]+"/"+arrDateString[1]+"/"+arrDateString[2]},this.changeDateTommddYY=function(dateString){var arrDateString=dateString.split("-");return arrDateString[1]+"/"+arrDateString[0]+"/"+arrDateString[2]},this.getAge=function(dateString){dateString=this.changeDateTommddYY(dateString);var today=new Date,birthDate=new Date(dateString),age=today.getFullYear()-birthDate.getFullYear(),m=today.getMonth()-birthDate.getMonth();today.getDate()-birthDate.getDate();return(m<0||0===m&&today.getDate()<birthDate.getDate())&&age--,age},this.isValidStepAmount=function(val,cancer){var x=parseInt(CommonServiceTerm.removeCommas(val));return!cancer||(2==$localStorage.cancerPlanType?x%5e4===0:x%1e5===0)},this.isAgeCriteriaMatchedFunc=function(dateString){var isAgeCriteriaMatched=!1,minAge=18,maxMage=65;if(this.isValidDateOfBirth(dateString)){var age=CommonServiceTerm.getAge(dateString);age>=minAge&&age<=maxMage&&(isAgeCriteriaMatched=!0)}return isAgeCriteriaMatched},this.addCommas=function(nStr){if(!nStr)return 0;nStr=nStr.toString();var res,lastThree=nStr.substring(nStr.length-3),otherNumbers=nStr.substring(0,nStr.length-3);
return""!==otherNumbers&&(lastThree=","+lastThree),res=otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g,",")+lastThree},this.getNumberFromCommaSeparation=function(val){return void 0!==val&&isNaN(val)&&(val=val.replace(/,/g,"")),val},this.getGridViewIndexRowHashMap=function(){for(var object={},i=1,row=1;i<100;i++){object[i]={},object[i].row=row;row=i%4===0?++row:row}return object},this.getModalFactor=function(paymentFrequency){var modalFactor=1;switch(paymentFrequency){case 1:case"1":modalFactor=1;break;case 2:case"2":modalFactor=.51;break;case 4:case"4":modalFactor=.26;break;case"12":case 12:modalFactor=.0875}return modalFactor},this.isICICIPRUPlan=function(planId){return planId=parseInt(planId,10),729==planId},this.isMAXPlan=function(planId){return CommonServiceTerm.isMAXPlan(planId)},this.isBaxaPlan=function(planId){return planId=parseInt(planId,10),309==planId},this.getMinAllowedTermYears=function(planId){return planId=parseInt(planId,10),this.isICICIPRUPlan(planId)||this.isETPlan(planId)||this.isReliancePlan(planId)||this.isHDFCPlan(planId)?10:5},this.isPolicyTermExceeded=function(objData){return objData.age+objData.term>80},this.floorCeilPolicyTerm=function(policyTerm){return policyTerm%5<=2?policyTerm-policyTerm%5:5*parseInt(policyTerm/5,10)+5},this.getMaxMaturityAge=function(planId){var maturityAge=80;return this.isICICIPRUPlan(planId)?maturityAge=70:this.isHDFCPlan(planId)&&(maturityAge=75),maturityAge},this.isADBRider=function(rider){return 20==rider.RiderID||23==rider.RiderID},this.isATPDRider=function(rider){return 21==rider.RiderID||24==rider.RiderID},this.isAegoniIncomePlan=function(planId){return planId=parseInt(planId,10),751==planId},this.isAegoniTermPlan=function(planId){return planId=parseInt(planId,10),307==planId||787==planId||789==planId},this.isAegoniTermForeverPlan=function(planId){return planId=parseInt(planId,10),879==planId||8791==planId||8792==planId},this.isBasePremiumRequired=function(planId){return planId=parseInt(planId,10),307==planId||309==planId},this.isAegoniReturnPlan=function(planId){return planId=parseInt(planId,10),736==planId},this.isAegonWholeLifePlan=function(planId){return planId=parseInt(planId,10),879==planId||8791==planId||8792==planId},this.buildExitPointUrlPrequotes=function(currentUrl,currentRoute,enquiryId){var exitPointUrl=null,arrCurrentUrl=currentUrl.split(currentRoute);return arrCurrentUrl.length&&(exitPointUrl=arrCurrentUrl[0]+"/quotes/"+enquiryId),exitPointUrl},this.isTATASampoornaRakshaPlan=function(planId){return planId=parseInt(planId,10),814==planId||815==planId||816==planId||817==planId},this.getTotalPayoutInLakhs=function(){for(var lifeCoverInLakhs=[],i=5e6;i<=1e7;i+=1e5)lifeCoverInLakhs.push(i);return lifeCoverInLakhs},this.getTotalPayoutInCrores=function(){for(var lifeCoverInCrores=[],i=11e6;i<=5e7;i+=1e6)lifeCoverInCrores.push(i);for(var j=525e5;j<=1e8;j+=25e5)lifeCoverInCrores.push(j);return lifeCoverInCrores},this.getTotalPayoutArray=function(){return this.getTotalPayoutInLakhs().concat(this.getTotalPayoutInCrores())},this.getMonthlyIncomeValue=function(data){var monthlyIncome=0;return $rootScope.pTabName.monthlyPlans&&(monthlyIncome=data.monthlyIncome>0?data.monthlyIncome:.003*data.totalPayout),monthlyIncome},this.buildModifySelectionModel=function(data,enquiryId){return{child:{age:angular.isDefined(data.child)&&data.child&&data.child.age>=0?data.child.age:null},city:data.city,cityId:data.cityId,countryId:data.countryId,custId:data.custId,customerAge:data.customerAge,emailId:data.emailId,encodedEnquiryId:enquiryId,enquiryId:data.enquiryId,existUrl:data.existUrl,gender:data.gender,isTobaccoUser:data.isTobaccoUser,matrixLeadId:data.matrixLeadId,mobileNo:data.mobileNo,encryptedMobileNo:data.encryptedMobileNo,annualIncome:data.annualIncome,professionType:data.professionType,name:data.name,policyCoverage:data.policyTerm,policyTerm:data.policyTerm,premium:data.premium,spouse:{age:angular.isDefined(data.spouse)&&data.spouse&&data.spouse.age?data.spouse.age:null,tobacco:angular.isDefined(data.spouse)&&data.spouse&&data.spouse.tobacco?data.spouse.tobacco:0,isWorking:angular.isDefined(data.spouse)&&data.spouse&&data.spouse.isWorking?data.spouse.isWorking:0},state:data.state,stateId:data.stateId,sumassured:data.sumassured,totalPayout:data.totalPayout,userInfoId:data.userInfoId,visitId:data.visitId,dob:data.dob,monthlyIncome:data.monthlyIncome,otherCountryCode:data.otherCountryCode,utmSource:$routeParams.utmSource||data.utmSource,utmMedium:$routeParams.utmMedium||data.utmMedium,nri:data.nri}},this.getDateList=function(){for(var dateList=[],i=1;i<=31;i++)i<=9?dateList.push("0"+i):dateList.push(i);return dateList},this.getYearList=function(){for(var currentYear=(new Date).getFullYear(),min=currentYear-66,max=currentYear-18,yearList=[],i=max;i>=min;i--)yearList.push(i);return yearList},this.extractDateMonthYearFromDOB=function(dobString,index){var dobArray=dobString.split("-");return dobArray[index]},this.extractDOB=function(dob){var data={};return data.dobDate=this.isUndefinedOrNull(dob)?null:this.extractDateMonthYearFromDOB(dob,0),data.dobMonth=this.isUndefinedOrNull(dob)?null:this.extractDateMonthYearFromDOB(dob,1),data.dobYear=this.isUndefinedOrNull(dob)?null:this.extractDateMonthYearFromDOB(dob,2),data},this.isChildPlan=function(plan){return angular.isDefined(plan)&&756==parseInt(plan.Plan_Id,10)},this.findClosestValue=function(num,arr){for(var curr=arr[0],diff=Math.abs(num-curr),val=0;val<arr.length;val++){var newdiff=Math.abs(num-arr[val]);newdiff<diff&&(diff=newdiff,curr=arr[val])}return curr},this.setPlanId=function(planId){this.planId=planId},this.getPlanId=function(){return this.planId},this.saveSortApplied=function(filterParam){that.filterParam=filterParam},this.getSortApplied=function(){return that.filterParam},this.getOfferDetails=function(offerId){var url=offerUrl+"/"+offerId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.addLeadingZero=function(value){return value<10&&(value="0"+value),value},this.currentDate=function(){var currentTime=new Date,month=currentTime.getMonth()+1,day=currentTime.getDate(),year=currentTime.getFullYear();return this.addLeadingZero(year)+""+this.addLeadingZero(month)+this.addLeadingZero(day)},this.currentTime=function(){var currentTime=new Date,hour=currentTime.getHours(),minute=currentTime.getMinutes();return this.addLeadingZero(hour)+""+this.addLeadingZero(minute)},this.isWorkingHours=function(time,endTime,startTime){var startTimeDate=new Date("01/01/2011 "+startTime).getTime(),endTimeDate=new Date("01/01/2011 "+endTime).getTime(),currentTimeDate=new Date("01/01/2011 "+time).getTime();return currentTimeDate>=startTimeDate&&currentTimeDate<=endTimeDate},this.encode=function(value,hasToUrlEncode){if(void 0!==value)return value},this.decode=function(value,urlDecode){return void 0!==value?value:this},this.buildRiderRequestObject=function(plan,custDetails,riderDetails,adpPremium,atdpPremium,wopObject,isMaxOrMonthly,enqId){var obj={};return obj.enquiryId=enqId,obj.gender=custDetails.gender,obj.tobacco=custDetails.isTobaccoUser,obj.age=custDetails.customerAge,obj.supplierTag=plan.E2ESupplier,obj.sumAssured=parseInt(plan.SumAssured),obj.planId=plan.Plan_Id,obj.term=plan.PolicyTerm,obj.ppt=plan.PolicyTerm,obj.basePremium=parseInt(isMaxOrMonthly?plan.maxTotalPremium:plan.TotalPremium),obj.adbPremium=adpPremium,obj.atpdPremium=atdpPremium,obj.wciPremium=parseFloat(wopObject.premium)||0,obj.name=wopObject.name,obj.types=[],obj.riderIds=[],_.each(riderDetails,function(val){obj.riderIds.push(val.riderId),obj.types.push(val.type[0]||"")}),obj.isFirstTimeCall=!0,obj},this.populatePolicyTermList=function(min,max,interval,polList){var arr=[];if(polList.length>0)_.each(polList,function(val){var obj={};obj.name=val+" years",obj.id=val,arr.push(obj)});else for(var i=min;i<=max;){var obj={};obj.name=i+" years",obj.id=i,arr.push(obj),i=parseInt(i)+interval}return arr},this.reverseData=function(){var obj={};return obj.totalCoverReverse=!1,obj.premiumReverse=!1,obj.coverUptoReverse=!1,obj.claimSettledReverse=!1,obj.ridersReverse=!1,obj.monthlyPayoutReverse=!1,obj.incYearlyReverse=!1,obj.totalPayReverse=!1,obj.oneTimePayReverse=!1,obj.maxPayReverse=!1,obj},this.redirectToE2EPage=function(preQuotesInfo,plan,enquiryId,isMonthly,type){var deferred=$q.defer(),preQuotesInfoObj=angular.copy(preQuotesInfo);preQuotesInfoObj.productId=$rootScope.cancerJourney?CommonServiceTerm.getCancerCareProductId():termConfigObj.getTermProductId();var premium=isMonthly?plan.monthlyPremium:plan.premium,isMobileDefault=!!$location.$$search.isMobileDefault,maxRetainer=!(!$location.$$search.maxRetainer||"true"!=$location.$$search.maxRetainer);return maxRetainer&&(preQuotesInfoObj.maxRetainer=!0),PlanService.getInsurerDetails(preQuotesInfoObj,plan,enquiryId,premium).success(function(data,status,headers,config){if(0!=data.flag){if(data.InsurerDetails&&data.InsurerDetails.action&&"POST"===data.InsurerDetails.action){var redirectUrl="";if(void 0!==data.InsurerDetails.url&&null!==data.InsurerDetails.url&&""!==data.InsurerDetails.url){redirectUrl=data.InsurerDetails.url;var jForm=$('<form type="hidden"></form>');jForm.attr("action",redirectUrl),jForm.attr("method","post"),jForm.attr("enctype","text/html");var jInput=$("<input type='hidden'>");if(jInput.attr("name","term"),jInput.attr("value",data.InsurerDetails.fields.term),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","do-you-smoke"),jInput.attr("value",data.InsurerDetails.fields.doyousmoke),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","date-of-birth"),jInput.attr("value",data.InsurerDetails.fields.dateofbirth),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","gender"),jInput.attr("value",data.InsurerDetails.fields.gender),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","city"),jInput.attr("value",isMobileDefault?"":CommonServiceTerm.getCityName(data.InsurerDetails.fields.city,plan)),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","mobile"),jInput.attr("value",data.InsurerDetails.fields.mobile),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","leadid"),jInput.attr("value",data.InsurerDetails.fields.leadId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","stateid"),jInput.attr("value",isMobileDefault?"":data.InsurerDetails.fields.stateid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","custid"),jInput.attr("value",data.InsurerDetails.fields.custid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","firstname"),jInput.attr("value",data.InsurerDetails.fields.firstname),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","email"),jInput.attr("value",data.InsurerDetails.fields.email),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","name"),jInput.attr("value",data.InsurerDetails.fields.name),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","agetillcovered"),jInput.attr("value",data.InsurerDetails.fields.agetillcovered),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","country"),jInput.attr("value",data.InsurerDetails.fields.country),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.sumassured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)),jInput=$("<input type='hidden'>"),jInput.attr("name","basepremium"),jInput.attr("value",data.InsurerDetails.fields.basepremium),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","enquiryid"),jInput.attr("value",data.InsurerDetails.fields.enquiryid),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.monthlyincome&&(jInput=$("<input type='hidden'>"),jInput.attr("name","monthly-payout"),jInput.attr("value",data.InsurerDetails.fields.monthlyincome),jForm.append(jInput)),jInput=$("<input type='hidden'>"),jInput.attr("name","total-payout"),jInput.attr("value",data.InsurerDetails.fields.totalcover),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.onetimepayout&&(jInput=$("<input type='hidden'>"),jInput.attr("name","one-time-payout"),jInput.attr("value",data.InsurerDetails.fields.onetimepayout),jForm.append(jInput)),jInput=$("<input type='hidden'>"),jInput.attr("name","city"),jInput.attr("value",CommonServiceTerm.getCityName(data.InsurerDetails.fields.city,plan)),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","mobile"),jInput.attr("value",data.InsurerDetails.fields.mobile),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","leadid"),jInput.attr("value",data.InsurerDetails.fields.leadId),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","stateid"),jInput.attr("value",data.InsurerDetails.fields.stateid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","custid"),jInput.attr("value",data.InsurerDetails.fields.custid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","firstname"),jInput.attr("value",data.InsurerDetails.fields.firstname),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","visitid"),jInput.attr("value",data.InsurerDetails.fields.visitid),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","email"),jInput.attr("value",data.InsurerDetails.fields.email),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","name"),jInput.attr("value",data.InsurerDetails.fields.name),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.modeofpremium){jInput=$("<input type='hidden'>"),jInput.attr("name","mode-of-premium");var modeOfPremium=isMonthly?"12":data.InsurerDetails.fields.modeofpremium;jInput.attr("value",modeOfPremium),jForm.append(jInput)}"undefined"!=typeof data.InsurerDetails.fields.planoption&&(jInput=$("<input type='hidden'>"),jInput.attr("name","plan-option"),jInput.attr("value",data.InsurerDetails.fields.planoption),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercaretype&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-type"),jInput.attr("value",plan.type?plan.type.toLowerCase():data.InsurerDetails.fields.cancercaretype),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.premiumpaymentterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","premium-payment-term"),jInput.attr("value",data.InsurerDetails.fields.premiumpaymentterm),jForm.append(jInput)),jInput=$("<input type='hidden'>"),jInput.attr("name","agetillcovered"),jInput.attr("value",data.InsurerDetails.fields.agetillcovered),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","country"),jInput.attr("value",data.InsurerDetails.fields.country),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.sumassured&&(jInput=$("<input type='hidden'>"),jInput.attr("name","sumassuredvalue"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)),jInput=$("<input type='hidden'>"),jInput.attr("name","basepremium"),jInput.attr("value",data.InsurerDetails.fields.basepremium),jForm.append(jInput),jInput=$("<input type='hidden'>"),jInput.attr("name","enquiryid"),jInput.attr("value",data.InsurerDetails.fields.enquiryid),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.monthlyincome&&(jInput=$("<input type='hidden'>"),jInput.attr("name","monthly-payout"),jInput.attr("value",data.InsurerDetails.fields.monthlyincome),jForm.append(jInput)),jInput=$("<input type='hidden'>"),jInput.attr("name","total-payout"),jInput.attr("value",data.InsurerDetails.fields.totalcover),jForm.append(jInput),"undefined"!=typeof data.InsurerDetails.fields.onetimepayout&&(jInput=$("<input type='hidden'>"),jInput.attr("name","one-time-payout"),jInput.attr("value",data.InsurerDetails.fields.onetimepayout),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.sumassured&&data.InsurerDetails.fields.sumassured?(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.sumassured),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","cover"),jInput.attr("value",data.InsurerDetails.fields.cover),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid0&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid0),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid1&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid1),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid2&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid2),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid3&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid3),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.riderid4&&(jInput=$("<input type='hidden'>"),jInput.attr("name","riderids[]"),jInput.attr("value",data.InsurerDetails.fields.riderid4),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.middlename&&(jInput=$("<input type='hidden'>"),jInput.attr("name","middlename"),jInput.attr("value",data.InsurerDetails.fields.middlename),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.lastname&&(jInput=$("<input type='hidden'>"),jInput.attr("name","lastname"),jInput.attr("value",data.InsurerDetails.fields.lastname),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercareterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-term"),jInput.attr("value",data.InsurerDetails.fields.cancercareterm),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.lumpsumbenefit?(jInput=$("<input type='hidden'>"),jInput.attr("name","lumpsumbenefit"),jInput.attr("value",data.InsurerDetails.fields.lumpsumbenefit),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","lumpsumbenefit"),jInput.attr("value","100"),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.incomebenefit?(jInput=$("<input type='hidden'>"),jInput.attr("name","incomebenefit"),jInput.attr("value",data.InsurerDetails.fields.incomebenefit),jForm.append(jInput)):(jInput=$("<input type='hidden'>"),jInput.attr("name","incomebenefit"),jInput.attr("value","0"),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.modeofpremium&&(jInput=$("<input type='hidden'>"),jInput.attr("name","mode-of-premium"),jInput.attr("value",void 0!==isMonthly?plan.planId&&1*plan.planId===772?"1":isMonthly?"12":"1":data.InsurerDetails.fields.modeofpremium),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.planoption&&(jInput=$("<input type='hidden'>"),jInput.attr("name","plan-option"),jInput.attr("value",data.InsurerDetails.fields.planoption),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.cancercaretype&&(jInput=$("<input type='hidden'>"),jInput.attr("name","cancer-care-type"),jInput.attr("value",plan.type?plan.type.toLowerCase():data.InsurerDetails.fields.cancercaretype),jForm.append(jInput)),"undefined"!=typeof data.InsurerDetails.fields.premiumpaymentterm&&(jInput=$("<input type='hidden'>"),jInput.attr("name","premium-payment-term"),jInput.attr("value",data.InsurerDetails.fields.premiumpaymentterm),jForm.append(jInput)),jForm.appendTo("body").submit()}else $rootScope.object.showArrow=!0,$rootScope.object.showLoader=!1}else window.location=data.InsurerDetails.url;deferred.resolve()}else deferred.resolve("error");deferred.resolve()}),deferred.promise},this.setRiderSelectionData=function(sumAssured,policyTerm,riderDetails,selectedRiderIds,isRider){var obj=[];return null!==riderDetails&&_.each(riderDetails.riders,function(riderVal){var tempObj={};if(tempObj.sumAssuredList=[],tempObj.policyTermList=[],riderVal.isRider===isRider){if(tempObj.riderId=riderVal.riderId,riderVal.policyTermObject&&(riderVal.policyTermObject.minPolicyTerm>-1||riderVal.policyTermObject.policyTermValues.length>0))tempObj.policyTermList=that.populatePolicyTermList(parseInt(riderVal.policyTermObject.minPolicyTerm),parseInt(riderVal.policyTermObject.maxPolicyTerm),parseInt(riderVal.policyTermObject.policyTermInterval),riderVal.policyTermObject.policyTermValues),tempObj.selectedPolicyTerm=riderVal.policyTermSelected>-1?riderVal.policyTermSelected:tempObj.policyTermList[0];else{var polTerm=riderVal.selectedPolicyTerm>-1?riderVal.selectedPolicyTerm:policyTerm;tempObj.policyTermList.push(polTerm),tempObj.selectedPolicyTerm=riderVal.policyTermSelected>-1?riderVal.policyTermSelected:polTerm}riderVal.sumAssuredObject&&riderVal.sumAssuredObject.minSumAssured>-1?tempObj.sumAssuredList=calculateFromMinMax(parseInt(riderVal.sumAssuredObject.minSumAssured),parseInt(riderVal.sumAssuredObject.maxSumAssured),parseInt(riderVal.sumAssuredObject.sumAssuredInterval),sumAssured):tempObj.sumAssuredList.push(sumAssured),tempObj.sliderObj={},tempObj.sliderObj.max=tempObj.sumAssuredList.length-1,tempObj.sliderObj.selectedSumAssuredIndex=tempObj.sumAssuredList.indexOf(riderVal.sumAssuredSelected)>-1?tempObj.sumAssuredList.indexOf(riderVal.sumAssuredSelected):parseInt(tempObj.sliderObj.max/2),tempObj.selectedSumAssured=riderVal.sumAssuredSelected||sumAssured,tempObj.riderPremium=riderVal.riderPremium,tempObj.isSumAssuerdPresent="true"===riderVal.sumAssuredObject.isSumAssuredPresent,tempObj.isPolicyPresent="true"===riderVal.policyTermObject.isPolicyTermPresent,tempObj.isRider=riderVal.isRider,tempObj.riderName=riderVal.riderName,tempObj.typeList=[],tempObj.typeList=riderVal.riderType.length>0?riderVal.riderType:[],tempObj.selectedType=riderVal.riderType.length>0?riderVal.riderType[0]:"",tempObj.selected=riderVal.defaultSelection||selectedRiderIds.indexOf(tempObj.riderId)>-1,tempObj.defaultDisabled=riderVal.isRiderDisabled||!1,tempObj.errorMessage=riderVal.errorMessage||"",tempObj.maxPolicyTerm=riderVal.policyTermObject.maxPolicyTerm,tempObj.brochureLink=riderVal.brochureLink,tempObj.categoryId=riderVal.categoryId,obj.push(tempObj)}}),obj},this.clubDependentRiders=function(obj,premium,riderDetails){var validationObject=null!==riderDetails?riderDetails.validations:{},mainArray=[],riderIdsArray=[];return _.each(validationObject.dependencies,function(val){var riderDependentObj={};riderDependentObj.intArray=[],_.each(val.dependentRiders,function(riderVal){_.each(obj,function(indiRider){parseInt(riderVal)===parseInt(indiRider.riderId)&&(_.contains(riderIdsArray,indiRider.riderId)||riderDependentObj.intArray.push(indiRider),riderIdsArray.push(indiRider.riderId))})}),riderDependentObj.intArray.length>0&&(val.premiumLimit>0,riderDependentObj.premiumLimit=val.premiumLimit>0?val.premiumLimit:0,riderDependentObj.allowedPremium=subtractServiceTaxFromPremium(val,premium)),mainArray.push(riderDependentObj)}),mainArray},this.mergeRiderSelectionData=function(responseData,previousData){return _.each(previousData,function(riderVal){_.each(riderVal.intArray,function(val){_.each(responseData.riders,function(responseVal){parseInt(val.riderId)===parseInt(responseVal.riderId)&&(val.riderPremium=responseVal.riderPremium)})})}),previousData=this.calculatePremiumSelectedForEachDependentRiders(previousData)},this.mergePlanSelectionData=function(responseData,previousData){return _.each(previousData,function(val){_.each(responseData.riders,function(responseVal){parseInt(val.riderId)===parseInt(responseVal.riderId)&&(val.riderPremium=responseVal.riderPremium,val.errorMessage=responseVal.errorMessage)})}),previousData},this.changePremiumOnChangeOfRiderValues=function(item,plan,custDetails,riderDetails,adpPremium,atdpPremium,wciObject,isMaxOrMonthly,enqId){var obj={};return obj.enquiryId=enqId,obj.gender=custDetails.gender,obj.tobacco=custDetails.isTobaccoUser,obj.age=custDetails.customerAge,obj.supplierTag=plan.E2ESupplier,obj.sumAssured=parseInt(item.selectedSumAssured),obj.planId=plan.Plan_Id,obj.term=item.selectedPolicyTerm,obj.ppt=item.selectedPolicyTerm,obj.basePremium=parseInt(isMaxOrMonthly?plan.maxTotalPremium:plan.TotalPremium),obj.adbPremium=parseFloat(adpPremium),obj.atpdPremium=parseFloat(atdpPremium),obj.wciPremium=wciObject.premium,obj.name=wciObject.name,obj.types=[],obj.riderIds=[],obj.riderIds.push(item.riderId),obj.types.push(item.selectedType),obj.isFirstTimeCall=!1,obj},this.calculateTotalPremiumAdded=function(riderSelectionList){var premium=0;return _.each(riderSelectionList,function(riderVal){_.each(riderVal.intArray,function(val){premium+=val.selected?parseFloat(val.riderPremium):0})}),parseInt(premium)},this.calculatePremiumSelectedForEachDependentRiders=function(riderSelectionList){return _.each(riderSelectionList,function(riderVal){riderVal.selectedPremiums=0,_.each(riderVal.intArray,function(val){riderVal.selectedPremiums=riderVal.selectedPremiums+(val.selected?parseFloat(val.riderPremium):0)})}),riderSelectionList},this.calculateTotalPremiumAddedByPlan=function(riderSelectionList){var premium=0;return _.each(riderSelectionList,function(val){premium+=val.selected?parseFloat(val.riderPremium):0}),parseInt(premium)},this.getSelectedRiders=function(riderSelectionList){var riderArray=[];return _.each(riderSelectionList,function(val){_.each(val.intArray,function(eachRider){eachRider.selected&&riderArray.push(eachRider.riderId)})}),riderArray},this.isADBorATPD=function(item){return 1*item.categoryId===10||1*item.categoryId===12||null!==item.riderName.toLowerCase().match(/women/)},this.setSelectedTypes=function(items,types){return _.each(types,function(type){_.each(items,function(val){1*val===1*type.id&&(type.status=!0)})}),types},this.isAegonPlan=function(planId){return planId=parseInt(planId,10),307==planId||750==planId||751==planId},this.isIPruSmartPlan=function(planId){return planId=parseInt(planId,10),766==planId||767==planId||768==planId||769==planId||892==planId||893==planId||894==planId||895==planId||934==planId||935==planId||936==planId||937==planId},this.isChatAvailableInCity=function(cityId){if(this.isUndefinedOrNull(cityId))return!0;var availableChatCities=[302,555,553,554,556,551,541,207,420,6,103,309,316,411,499,303,666,124,256,80,126,360,76,527,494,306,20,243,558,288,837];return availableChatCities.indexOf(cityId)>=0},this.isETCriticareRider=function(riderId){return riderId=parseInt(riderId,10),35==riderId||36==riderId||93==riderId},this.getRegexForCountry=function(countryCodeId){var url=regexForCountryUrl+"/"+countryCodeId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getTopCitiesList=function(){return[{id:551,name:"Delhi",stateId:35,state:"Delhi"},{id:207,name:"Bengaluru",stateId:16,state:"Karnataka"},{id:302,name:"Mumbai",stateId:20,state:"Maharashtra"},{id:309,name:"Pune",stateId:20,state:"Maharashtra"},{id:837,name:"Hyderabad",stateId:37,state:"Telangana"},{id:555,name:"Gurgaon",stateId:36,state:"NCR"},{id:103,name:"Ahmedabad",stateId:11,state:"Gujarat"},{id:541,name:"Kolkata",stateId:34,state:"West Bengal"},{id:554,name:"Ghaziabad",stateId:36,state:"NCR"},{id:420,name:"Chennai",stateId:30,state:"Tamil Nadu"},{id:666,name:"Navi Mumbai",stateId:20,state:"Maharashtra"},{id:411,name:"Jaipur",stateId:28,state:"Rajasthan"},{id:553,name:"Noida",stateId:36,state:"NCR"},{id:316,name:"Thane",stateId:20,state:"Maharashtra"},{id:80,name:"Chandigarh",stateId:6,state:"Chandigarh"},{id:499,name:"Lucknow",stateId:32,state:"Uttar Pradesh"}]},this.findCityFromId=function(city,cityId){var obj={};return _.each(city,function(value,key){var id=value.cityId;id===cityId&&(obj=value)}),obj},this.createFilterForFirstValues=function(value,query){var lowercaseQuery=angular.lowercase(query),arr=[];return angular.isDefined(value)&&(arr=value.filter(function(ele){return ele.searchString.toLowerCase().substr(0,lowercaseQuery.length).indexOf(lowercaseQuery)!=-1})),arr},this.formatCityMobile=function(data){var gurugramObject={CityId:"555",StateId:"36",CityName:"Gurugram (NCR)",state:"NCR"},vishakhapatnamObject={CityId:"20",StateId:"1",CityName:"Vishakhapatnam (Andhra Pradesh)",state:"Andhra Pradesh"},bangaloreObject={CityId:"207",StateId:"16",CityName:"Bangalore (Karnataka)",state:"Karnataka"};data.push(gurugramObject),data.push(vishakhapatnamObject),data.push(bangaloreObject);var callback=function(data){return{id:data.CityId,name:data.CityName,stateId:data.StateId,state:data.StateName}};return data.map(callback)},this.isETLumpsumpPlan=function(planId){return planId=parseInt(planId,10),732==planId},this.sendMobileOTP=function(obj){return ServerUtilityService.getWebService(obj).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})},this.VerifyMobileOTP=function(obj){return ServerUtilityService.postWebService("api/verifyOTP",obj).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})},this.getCheckedFilters=function(types){var checkedFilters=[];return angular.forEach(types,function(value){var obj={name:value.key,displayName:value.name,isSelected:value.status};checkedFilters.push(obj)}),checkedFilters};var isQuotesVisible=function(plan,modifySelection){var aegonNotVisiblePlans=[819,820,821],planId=plan.Plan_Id,isVisible=!0;return $rootScope.pTabName.monthlyPlans&&plan.maxTotalPremium<=0?isVisible=!1:(isVisible=plan.maxTotalPremium>0,isVisible=isVisible&&aegonNotVisiblePlans.indexOf(planId)==-1),8===modifySelection.annualIncome&&851===planId&&(isVisible=!1),isVisible},checkCarAsIncome=function(quoteObj,userInfo){var isTrue=!1;return"Self-Employed"==userInfo.professionType&&(10==quoteObj.Supplier_Id&&userInfo.customerAge<=45&&(quoteObj.maxSumAssured<=11e6||quoteObj.SumAssured<=11e6)&&(isTrue=!0),5==quoteObj.Supplier_Id&&(quoteObj.maxSumAssured<=1e7||quoteObj.SumAssured<=1e7)&&(isTrue=!0),31!=quoteObj.Supplier_Id&&11!=quoteObj.Supplier_Id||(isTrue=!0),1124==quoteObj.Supplier_Id&&(quoteObj.maxSumAssured<=1e7||quoteObj.SumAssured<=1e7)&&(isTrue=!0)),isTrue},calculateCostPerLac=function(plan){var totalCover=0,premium=0,totalLacs=0,costPerLac=0;return $rootScope.pTabName.allPlans?$rootScope.tabName.maxPayout?(totalCover=plan.maxTotalCover,premium=plan.maxTotalPremium):(totalCover=plan.NPVValue,premium=plan.TotalPremium):$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?(totalCover=plan.ComboTotalCover,premium=plan.TotalPremium):(totalCover=plan.maxTotalCover,premium=plan.maxTotalPremium),1*totalCover===0?0:(totalLacs=totalCover/1e5,costPerLac=parseInt(premium/totalLacs))},calculateMonthlyPremium=function(plan){var tPremium;return tPremium=$rootScope.pTabName.allPlans?plan.maxMonthlyTotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?plan.monthlyTotalPremium:plan.maxMonthlyTotalPremium},calculatePremium=function(plan){var tPremium;return tPremium=$rootScope.pTabName.allPlans?$rootScope.tabName.maxPayout?plan.maxTotalPremium:plan.TotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?plan.TotalPremium:plan.maxTotalPremium},isOneTimePlan=function(value){return value.isOneTimePlan},getPriorityObj=function(pid){for(var obj={},i=0;i<pid.length;i++){var priority=2e3-i,key=pid[i];obj[key]=priority}return obj},modifyAegonItermPlusRiderObject=function(quote){return _.each(quote.riderPremiumObject,function(rider){_.each(quote.defaultRiderObject_818,function(resRider){
resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId==10&&(quote.adbObj[818].premium=resRider.riderPremium,quote.adbObj[818].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[818].riderSumAssured=resRider.riderSumAssured)}),_.each(quote.defaultRiderObject_819,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId!=38&&(quote.adbObj[819].premium=resRider.riderPremium,quote.adbObj[819].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[819].riderSumAssured=resRider.riderSumAssured)}),_.each(quote.defaultRiderObject_820,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId!=38&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium))}),_.each(quote.defaultRiderObject_821,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId!=38&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium))})}),quote};this.modifyAegonItermPlusPlanDetails=function(quote,planId,categoryIds){var planId=categoryIds&&categoryIds.length>0?that.setAegonItermPlusPlanId(quote,categoryIds):planId;return categoryIds&&0==categoryIds.length&&(planId=818),quote.Plan_Id=angular.copy(planId),quote.BasicPremium=quote["BasicPremium_"+planId],quote.FinalPremium=quote["FinalPremium_"+planId],quote.TotalPremium=quote["TotalPremium_"+planId],quote.maxTotalPremium=quote["maxTotalPremium_"+planId],quote.newBasicPremium=quote["newBasicPremium_"+planId],quote.StandardlPremium=quote["StandardlPremium_"+planId],quote.maxHalfYearlyTotalPremium=quote["maxHalfYearlyTotalPremium_"+planId],quote.maxMonthlyTotalPremium=quote["maxMonthlyTotalPremium_"+planId],quote.halfYearlyTotalPremium=quote["halfYearlyTotalPremium_"+planId],quote.quarterlyTotalPremium=quote["quarterlyTotalPremium_"+planId],quote.monthlyTotalPremium=quote["monthlyTotalPremium_"+planId],quote.annualPremiumGST=quote["annualPremiumGST_"+planId],quote.annualPremiumWGST=quote["annualPremiumWGST_"+planId],quote.monthlyPremiumGST=quote["monthlyPremiumGST_"+planId],quote.monthlyPremiumWGST=quote["monthlyPremiumWGST_"+planId],quote.halfYearlyPremiumGST=quote["halfYearlyPremiumGST_"+planId],quote.halfYearlyPremiumWGST=quote["halfYearlyPremiumWGST_"+planId],quote.riderIdCategory=quote["riderIdCategory_"+planId],quote.defaultRiderObject=quote["defaultRiderObject_"+planId],quote.ComboTotalPremium=parseInt(calculatePremium(quote),10),quote.monthlyTotalPremium=parseInt(calculateMonthlyPremium(quote),10),quote=modifyAegonItermPlusRiderObject(quote),_.each(quote.riderPremiumObject,function(riderVal){"undefined"!=typeof riderVal&&(1*riderVal.categoryId==10&&(818==quote.Plan_Id&&quote.adbObj&&quote.adbObj[818]?(riderVal.premium=angular.copy(quote.adbObj[818].premium),riderVal.monthlyPremium=angular.copy(quote.adbObj[818].monthlyRiderPremium),riderVal.riderSumAssured=angular.copy(quote.adbObj[818].riderSumAssured)):819==quote.Plan_Id&&quote.adbObj&&quote.adbObj[819]&&(riderVal.premium=angular.copy(quote.adbObj[819].premium),riderVal.monthlyPremium=angular.copy(quote.adbObj[819].monthlyRiderPremium),riderVal.riderSumAssured=angular.copy(quote.adbObj[819].riderSumAssured))),riderVal.isDefaultAdded=isDefaultAdded(riderVal.categoryId,quote.Plan_Id))}),quote.defaultRiderObject&&_.each(quote.defaultRiderObject,function(riderDefaultVal){"undefined"!=typeof riderDefaultVal&&_.each(quote.riderPremiumObject,function(riderVal){"undefined"!=typeof riderVal&&1*riderVal.categoryId===1*riderDefaultVal.categoryId&&(riderDefaultVal.riderPremium=angular.copy(riderVal.premium),riderDefaultVal.monthlyRiderPremium=angular.copy(riderVal.monthlyPremium),riderDefaultVal.sumAssured=angular.copy(riderVal.riderSumAssured))})}),quote},this.calculateDiscount=function(plan,premium,isDiscountValue,OfflinePremium){return OfflinePremium?isDiscountValue?Math.round(10*(100-100*premium/OfflinePremium))/10:OfflinePremium:plan.onlineDiscount?isDiscountValue?plan.onlineDiscount.toString():Math.round(100*premium/(100-1*plan.onlineDiscount)):void 0},this.filterAllObjs=function(items,modifySelection,isPriorityZero){var isNRI=1*modifySelection.countryId!=392,finalOutput=[],pid=$cookies.get("pid")?$cookies.get("pid").split(","):[],priorityObj={};angular.isDefined(pid)&&pid.length>0&&((pid.indexOf("20")>-1||pid.indexOf("201")>-1)&&pid.push("10"),priorityObj=getPriorityObj(pid)),angular.isDefined(items)&&items.length&&_.each(items,function(quote){var supplierId=quote.Supplier_Id,planPriorityId=that.priorityObject[supplierId];1*quote.Plan_Id!==816&&1*quote.Plan_Id!==817&&(quote.ComboPlans=[],quote.isCombo=!1,quote.ComboTotalPremium=parseInt(calculatePremium(quote),10),quote.monthlyTotalPremium=parseInt(calculateMonthlyPremium(quote),10),quote.maxMonthlyTotalPremium=angular.copy(quote.monthlyTotalPremium),1*quote.Plan_Id!=850&&1*quote.Plan_Id!=8501&&1*quote.Plan_Id!=8502||(isChanged=!0),quote.PolicyTerm==-1&&(quote.PolicyTerm=modifySelection.policyCoverage>75?modifySelection.policyCoverage:-1,quote.newCoverageUpto=modifySelection.policyCoverage,quote.isWholeLifePlan=!0),1*quote.Plan_Id===879&&(quote.isTrop=!1),quote.ComboTotalCover=quote.TotalCover,quote.CostPerLac=calculateCostPerLac(quote),quote.isQuotesVisible=isQuotesVisible(quote,modifySelection),quote.Claims_Settled=Number(quote.Claims_Settled).toFixed(1),quote.carAsIncome=checkCarAsIncome(quote,modifySelection),($rootScope.pTabName.onetimePlans||$rootScope.pTabName.monthlyPlans)&&CommonServiceTerm.isKotakPlan(quote.Plan_Id)?quote.planShortName="Kotak e-Term Plan "+quote.planShortName:$rootScope.pTabName.onetimePlans&&CommonServiceTerm.isDHFLPlan(quote.Plan_Id)?quote.planShortName="Flexi e-Term":$rootScope.pTabName.onetimePlans&&CommonServiceTerm.isHdfc3dPlan(quote.Plan_Id)?quote.planShortName="3D Plus "+quote.planShortName:$rootScope.isMobileDevice&&$rootScope.pTabName.onetimePlans&&that.isETZindagiPlusPlan(quote.Plan_Id)&&(quote.planShortName="Extra Rs "+CommonServiceTerm.changeDisplayNumberFormat(Math.min(quote.ComboTotalCover/2,1e7))+" cover for spouse"),$rootScope.pTabName.onetimePlans&&that.isETZindagiPlusPlan(quote.Plan_Id)&&(quote.extraMsg="Extra Rs "+CommonServiceTerm.changeDisplayNumberFormat(Math.min(quote.ComboTotalCover/2,1e7))+" cover for spouse"),quote.maximumTotalPayout&&1*quote.maximumTotalPayout>0&&(quote.maximumCover=quote.maximumTotalPayout),948===quote.Plan_Id&&"Self-Employed"==modifySelection.professionType&&1*modifySelection.gender==2&&(quote.quoteHide=!0),angular.isDefined(priorityObj)&&0!=pid.indexOf(supplierId)&&_.each(priorityObj,function(value,key){key==planPriorityId&&(quote.Priority=value,quote.highlightGr=quote.Priority>1e3)}),1124===quote.Supplier_Id&&$routeParams.isSpouseJourney&&(quote.Priority=100),isNRI&&(quote.physicalMedical=that.nriPhysicalMedical(quote.Supplier_Id,1*modifySelection.countryId)),isPriorityZero&&(quote.Priority=0),finalOutput.push(quote))}),finalOutput=that.changeQuotesVisibility(finalOutput,modifySelection);var uniqueSupplierCombinePlans=[];if($rootScope.pTabName.onetimePlans)_.each(finalOutput,function(quote){isOneTimePlan(quote)&&uniqueSupplierCombinePlans.push(quote)});else if($rootScope.pTabName.tropPlans){uniqueSupplierCombinePlans=_.filter(finalOutput,function(quote){return quote.isTrop||1*quote.Plan_Id===736||1*quote.Plan_Id===879});var iciciObject=finalOutput.filter(function(quote){return 892==quote.Plan_Id});iciciObject.length>0&&uniqueSupplierCombinePlans.push(iciciObject[0])}else uniqueSupplierCombinePlans=$rootScope.pTabName.wholeLifePlans?_.filter(finalOutput,function(quote){return quote.isWholeLifePlan&&quote.isOneTimePlan}):angular.copy(finalOutput);return uniqueSupplierCombinePlans},this.changeQuotesVisibility=function(finalOutput,modifySelection){if(1*modifySelection.countryId!=392){var countryId=1*modifySelection.countryId;finalOutput.map(function(val){return val.nriCountryIds&&(val.quoteHide=val.nriCountryIds.indexOf(countryId)==-1),val}),finalOutput=finalOutput.filter(function(quote){return quote.isNRI&&!quote.quoteHide})}var bsliPlans=finalOutput.filter(function(quote){return that.isBSLIPlan(quote.Plan_Id)||CommonServiceTerm.isBSLIUltimaPlan(quote.Plan_Id)}),ultimaTrue=bsliPlans.filter(function(quote){return CommonServiceTerm.isBSLIUltimaPlan(quote.Plan_Id)&&quote.maxSumAssured>=1e7});return bsliPlans.length>0&&ultimaTrue.length>0?("Salaried"==modifySelection.professionType&&modifySelection.annualIncome>=4&&modifySelection.annualIncome<7||"Self-Employed"==modifySelection.professionType&&modifySelection.annualIncome>=5&&modifySelection.annualIncome<7?bsliPlans.map(function(val){return CommonServiceTerm.isBSLIUltimaPlan(val.Plan_Id)||(val.quoteHide=!0),val}):bsliPlans.map(function(val){return CommonServiceTerm.isBSLIUltimaPlan(val.Plan_Id)&&(val.quoteHide=!0),val}),finalOutput=finalOutput.filter(function(value){return!value.quoteHide})):bsliPlans.length>0&&(bsliPlans.map(function(val){return CommonServiceTerm.isBSLIUltimaPlan(val.Plan_Id)&&(val.quoteHide=!0),val}),finalOutput=finalOutput.filter(function(value){return!value.quoteHide})),finalOutput},this.hideAParticularRider=function(key,planId,plan){var hide=!1;return hide=309==planId?101==key||13==key||14==key||15==key||16==key||18==key:!hide&&(that.isEtTotalSecurePlan(planId)||that.isETPlan(planId)||that.isETMonthlyIncomePlan(planId))?13==key||101==key||14==key||11==key||16==key||18==key:!hide&&that.isETZindagiPlusPlan(planId)?47==key||101==key||14==key||16==key||18==key:!hide&&that.isPNBPlan(planId)?47==key||101==key||14==key||15==key||16==key||38==key:!hide&&that.isBSLIPlan(planId)?38==key||13==key||14==key||15==key||16==key||18==key:that.isMAXPlan(planId)?47==key||13==key||101==key||11==key||12==key||18==key||16==key:CommonServiceTerm.isTataPlan(planId)?47==key||13==key||14==key||15==key||16==key||18==key||38==key:that.isHDFCPlan(planId)?47==key||13==key||101==key||16==key||11==key||18==key:1*planId===821?47==key||13==key||14==key||11==key||16==key||18==key:1*planId===818||1*planId===819?47==key||13==key||14==key||16==key||18==key:CommonServiceTerm.isBaxaNewPlans(planId)?47==key||13==key||14==key||101==key||16==key||18==key:CommonServiceTerm.isHdfc3dPlan(planId)?47==key||13==key||16==key||11==key||18==key:hideBasicCi(planId)?11==key||47==key||13==key||14==key||16==key||18==key:CommonServiceTerm.isDHFLPlan(planId)?47==key||13==key||38==key||11==key||16==key||18==key:CommonServiceTerm.isKotakPlan(planId)?47==key||13==key||14==key||11==key||16==key||18==key||101==key:890==planId?47==key||13==key||14==key||11==key||16==key||18==key:that.isIPruSmartPlan(planId)?47==key||13==key||14==key||11==key||16==key||18==key:CommonServiceTerm.isExidePlan(planId)&&!plan.payOptionType?38==key||47==key||13==key||14==key||15==key||16==key||18==key:that.isAegoniTermPlan(planId)&&plan.newCoverageUpto>75&&plan.newCoverageUpto<=80?47==key||13==key||14==key||15==key||16==key||18==key||11==key||12==key||38==key:that.isAegoniTermPlan(planId)&&(plan.newCoverageUpto>80||100===plan.newCoverageUpto)?47==key||13==key||14==key||15==key||16==key||18==key||11==key||12==key||38==key:47==key||13==key||14==key||15==key||16==key||18==key},this.checkIfSelected=function(riderVal,type,val,isMonthly){1*riderVal.categoryId===1*type.id&&(1*val.Plan_Id===819&&1*riderVal.categoryId===10?riderVal.isSelected=!0:type.status?(isMonthly&&(val.monthlyTotalPremium>0||val.maxMonthlyTotalPremium>0)?riderVal.isSelected=riderVal.monthlyPremium>0:riderVal.isSelected=riderVal.premium>0,1*riderVal.categoryId===12&&that.isMAXPlan(val.Plan_Id)&&(riderVal.isSelected=!0),1*riderVal.categoryId===11&&val.enhancedCiSelected&&(riderVal.isSelected=!1),1*riderVal.categoryId===10&&(val.enhancedCiSelected||val.basicCiSelected)&&(riderVal.isSelected=!1)):riderVal.isSelected=!1)},this.setRiderObject=function(quotes,custInfo,isMonthly){var riderObj=[{name:"Death due to accident",categoryId:10,sortValue:1,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Disability due to accident",categoryId:12,sortValue:5,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Critical illness",categoryId:11,sortValue:3,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Enhanced Critical illness",categoryId:15,sortValue:4,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Cash for hospitalization",categoryId:47,sortValue:8,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Terminal Illness",categoryId:101,sortValue:6,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Waiver Of Premium",categoryId:38,sortValue:2,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Cover for spouse",categoryId:13,sortValue:7,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Waiver of premium on disability",categoryId:16,sortValue:2,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Cancer Cover",categoryId:14,sortValue:9,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Heart and Cancer Cover",categoryId:18,sortValue:10,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1},{name:"Critical Illness cover with Return of Premium",categoryId:20,sortValue:11,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1}];return _.each(quotes,function(val){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(val.Plan_Id),age=custInfo.customerAge;val.riderPremiumObject=angular.copy(getRiderObjectNew(riderObj,val,custInfo)),isDHFLPlan&&(val.riderPremiumObject=angular.copy(addCiPlusAdbRiderOnPlan(val.riderPremiumObject))),val.featuresObject=getFeatures(val,age),val.isRiderSelectedForMobile=!1,val.ridersToShowCount=0,_.each(val.riderPremiumObject,function(riderVal){riderVal.inBuildAddOn=riderVal.inBuildAddOn||isInbuildAddOn(riderVal.categoryId,val.inbuildAddOns),riderVal.isDefaultAdded=isDefaultAdded(riderVal.categoryId,val.Plan_Id,age),(that.isPNBPlan(val.Plan_Id)||CommonServiceTerm.isEtPlan(val.Plan_Id))&&1*riderVal.categoryId===13&&(that.isPNBPlan(val.Plan_Id)&&(riderVal.name="Cover for spouse with premium waiver"),riderVal.riderPriority=1,riderVal.isIncluded=!0),isDHFLPlan&&1*riderVal.categoryId===101&&(riderVal.isHidden=!0),riderVal.isHiddenOnMobile=mobileHideKey(riderVal,val,isMonthly),(riderVal.inBuildAddOn||riderVal.isDefaultAdded||riderVal.isAvailable||riderVal.isIncluded||!riderVal.isHiddenOnMobile&&riderVal.isSelected)&&(val.isRiderSelectedForMobile=!0,val.ridersToShowCount=val.ridersToShowCount+1),val.topTwoRiderCategoryId&&val.topTwoRiderCategoryId.length>0&&_.each(val.topTwoRiderCategoryId,function(priorityObject){priorityObject.categoryId==riderVal.categoryId&&(riderVal.riderPriority=angular.copy(priorityObject.riderPriority))})})}),quotes},this.hideRiderOnMobile=function(riderVal,val,isMonthly){return mobileHideKey(riderVal,val,isMonthly)},this.getRidersPremiumForQuotes=function(quotes,newTypes,isMonthly){var selectedRiders=[],types=angular.copy(newTypes);_.each(types,function(val){val.status&&selectedRiders.push(val.id),val.isSelected&&selectedRiders.push(val.categoryId)});!(!selectedRiders||1!=selectedRiders.length||selectedRiders.indexOf(101)==-1);return _.each(quotes,function(val){var isAdbSelected=selectedRiders.indexOf(10)!=-1,isCiSelected=selectedRiders.indexOf(15)!=-1,isDHFLPlan=CommonServiceTerm.isDHFLPlan(val.Plan_Id),limitedPay="LimitedPay"===val.payOptionType,isPnbPlan=CommonServiceTerm.isPNBPlan(val.Plan_Id);if(val.isRiderSelectedForMobile=!1,val.ridersToShowCount=0,_.each(val.riderPremiumObject,function(riderVal){riderVal.notAvailable=!1,isDHFLPlan&&(1*riderVal.categoryId===101&&(riderVal.isSelected=!1,riderVal.isDefaultAdded=!1,riderVal.isHidden=!0),1*riderVal.categoryId==110&&(riderVal.isSelected=!1),1*riderVal.categoryId==14&&(riderVal.isHidden=!1)),isPnbPlan&&val.sIRiderObj&&1*riderVal.categoryId===11&&(riderVal.premium=val.sIRiderObj.riderPremium,riderVal.monthlyPremium=val.sIRiderObj.monthlyRiderPremium,riderVal.riderId=val.sIRiderObj.riderId),CommonServiceTerm.isBaxaNewPlans(val.Plan_Id)&&(selectedRiders.indexOf(15)>-1&&1*riderVal.categoryId===11?riderVal.doNotAdd=!0:selectedRiders.indexOf(15)==-1&&1*riderVal.categoryId===11&&(riderVal.doNotAdd=!1)),_.each(types,function(type){riderVal.isHiddenOnMobile=mobileHideKey(riderVal,val,isMonthly),that.checkIfSelected(riderVal,type,val,isMonthly)}),(riderVal.inBuildAddOn||riderVal.isDefaultAdded||riderVal.isAvailable||riderVal.isIncluded||!riderVal.isHiddenOnMobile&&riderVal.isSelected)&&(val.isRiderSelectedForMobile=!0,val.ridersToShowCount=val.ridersToShowCount+1),1*riderVal.categoryId===11&&riderVal.isSelected&&riderVal.doNotAdd&&(val.riderPremiumAdded>0&&(val.riderPremiumAdded=val.riderPremiumAdded-riderVal.premium),val.monthlyRiderPremiumAdded>0&&(val.monthlyRiderPremiumAdded=val.monthlyRiderPremiumAdded-riderVal.monthlyPremium))}),that.isMAXPlan(val.Plan_Id)){var isADBSelected=!1,isADPDSelected=!1;_.each(val.riderPremiumObject,function(rider){1*rider.categoryId===10&&rider.isSelected&&(isADBSelected=!0),1*rider.categoryId===12&&rider.isSelected&&(isADPDSelected=!0)}),_.each(val.riderPremiumObject,function(rider){isADBSelected&&1*rider.categoryId===12&&(rider.isSelected=!0),isADPDSelected&&1*rider.categoryId===10&&(rider.isSelected=!0)})}selectedRiders&&selectedRiders.length>0&&CommonServiceTerm.isDHFLPlan(val.Plan_Id)&&_.each(val.riderPremiumObject,function(rider){limitedPay?(1*rider.categoryId===101&&isAdbSelected&&(rider.isSelected=!0,rider.isDefaultAdded=!0,rider.isHidden=!1),1*rider.categoryId==14&&isAdbSelected&&(rider.isHidden=!0)):(1*rider.categoryId===101&&(isAdbSelected||isCiSelected)&&(rider.isSelected=!0,rider.isDefaultAdded=!0,rider.isHidden=!1),isDHFLPlan&&isAdbSelected&&isCiSelected&&(1*rider.categoryId!=10&&1*rider.categoryId!=15||(rider.isSelected=!1,rider.notAvailable=!0),1*rider.categoryId==110&&(rider.isSelected=!0)),1*rider.categoryId==14&&(isAdbSelected||isCiSelected)&&(rider.isHidden=!0))})}),quotes},this.getRiderInformation=function(selectedRidersData,planId){var obj={};if(obj.planId=planId,selectedRidersData[0]&&selectedRidersData[0].defaultRiderPremium){var defaultRider=_.find(selectedRidersData[0].defaultRiderPremium,function(val){return 1*val.categoryId===38});obj.defaultRider=defaultRider}if(obj.newRider={},selectedRidersData[1]&&selectedRidersData[1].dependentRiders&&selectedRidersData[1].dependentRiders.length>0){var newRider=_.find(selectedRidersData[1].dependentRiders,function(val){return 1*val.categoryId===38});obj.newRider=newRider}return obj},this.addRemoveMaxIncluded=function(quotes,riders){return riders.length>0&&_.each(riders,function(rider){_.each(quotes,function(quote){1*quote.Plan_Id===rider.planId&&(CommonServiceTerm.isEmptyObject(rider.defaultRider)||CommonServiceTerm.isEmptyObject(rider.newRider)||(quote.riderPremiumAdded=quote.riderPremiumAdded-rider.defaultRider.premium+rider.newRider.riderPremium,quote.allTotalPremium=quote.allTotalPremium-rider.defaultRider.premium+rider.newRider.riderPremium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded-rider.defaultRider.monthlyRiderPremium+rider.newRider.monthlyRiderPremium))})}),quotes},this.addADBOnATPBSelectForMAX=function(quotes,selected){var isATPBSelAndADBNot=!1;return isATPBSelAndADBNot=selected.indexOf(10)==-1&&selected.indexOf(12)>-1,isATPBSelAndADBNot&&_.each(quotes,function(quote){that.isMAXPlan(quote.Plan_Id)&&(_.each(quote.riderPremiumObject,function(value){10==value.categoryId&&(quote.riderPremiumAdded=1*quote.riderPremiumAdded+1*value.premium,quote.allTotalPremium=1*quote.allTotalPremium+1*value.premium,value.monthlyPremium&&(quote.monthlyRiderPremiumAdded=1*quote.monthlyRiderPremiumAdded+1*value.monthlyPremium),value.isSelected=!0)}),quote.selectedRiderIds.push(10))}),quotes},this.nriPhysicalMedical=function(supplierId,countryId){var physicalMedicalObject={5:[{countryCodeId:375,CountryName:"UAE",CountryCode:971,CountryList:"Dubai"}],10:[{countryCodeId:375,CountryName:"UAE",CountryCode:971,CountryList:"Dubai | Sharjah | Abu Dhabi"}],22:[{countryCodeId:375,CountryName:"UAE",CountryCode:971,CountryList:"Dubai"}],2:[{countryCodeId:375,CountryName:"UAE",CountryCode:971,CountryList:"Dubai"}]},returnValue="",countryList=physicalMedicalObject[supplierId];return countryList?(returnValue=countryList.filter(function(country){return country.countryCodeId==countryId}),returnValue=returnValue.length>0?returnValue[0].CountryName+":"+returnValue[0].CountryList:""):returnValue},this.planCategoryTextMappingObject=function(){return{40:{value:"lumpsum",label1:"One Time",label2:"Lumpsum Plan"},41:{value:"lumpsumRegularMonthly",label1:"Lumpsum +",label2:"Monthly Income Plan"},57:{value:"lumpsumIncreasingMonthly",label1:"Lumpsum +",label2:"Monthly Income Plan",label3:"Increasing Annually"},56:{value:"onlyMonthly",label1:"Monthly Income Plan",label2:""},55:{value:"lumpsumIncreasingAnnually",label1:"Lumpsum + Increasing",label2:"Yearly Income Plan"},69:{value:"lumpsumYearly",label1:"Lumpsum +",label2:"Yearly Income Plan"},70:{value:"lumpsumIncreasingCover",label1:"One Time Lumpsum Plan",label2:"with Increasing Cover"},58:{value:"child",label1:"Lumpsum +",label2:"Monthly Income Plan"},59:{value:"spouse",label1:"Spouse Plan",label2:""},60:{value:"onlyIncreasingIncome",label1:"Monthly Income Plan",label2:"Increasing Annually"},101:{value:"onlyCritiCare",label1:"Criti Care",label2:"Plan"},102:{value:"lumpsumIncreasingAnnually",label1:"Lumpsum + Increasing",label2:"Monthly Income Plan"}}};var categoryMapping=this.planCategoryTextMappingObject(),getPlanCategoryLabelOne=function(category){return categoryMapping[category].label1},getPlanCategoryLabelTwo=function(category){return categoryMapping[category].label2},getPlanCategoryLabelThree=function(category){return categoryMapping[category].label3};return this.getCategoryId=function(planCategory){var categoryId="";return planCategory.indexOf("40")>=0?categoryId=40:planCategory.indexOf("41")>=0?categoryId=41:planCategory.indexOf("55")>=0?categoryId=55:planCategory.indexOf("56")>=0?categoryId=56:planCategory.indexOf("57")>=0?categoryId=57:planCategory.indexOf("58")>=0?categoryId=58:planCategory.indexOf("59")>=0?categoryId=59:planCategory.indexOf("60")>=0?categoryId=60:planCategory.indexOf("69")>=0?categoryId=69:planCategory.indexOf("70")>=0?categoryId=70:planCategory.indexOf("102")>=0&&(categoryId=102),categoryId},this.renderPlanIncreasingValue=function(plan){return angular.isDefined(plan.interest)&&plan.interest?plan.interest:"0%"},this.renderPlanAnnualIncomeTerm=function(plan){return angular.isDefined(plan.PlanAnnualIncomeTerm)&&plan.PlanAnnualIncomeTerm?plan.PlanAnnualIncomeTerm:0},this.renderPlanEnhancedSumAssured=function(plan){return angular.isDefined(plan.enhancedSAMsg)&&plan.enhancedSAMsg?plan.enhancedSAMsg:""},this.rendePlanAnnualIncomeMonthTerm=function(plan){return angular.isDefined(plan.PlanAnnualIncomeMonth)&&plan.PlanAnnualIncomeMonth?"("+plan.PlanAnnualIncomeMonth+")":""},this.renderPlanAnnualIncomeTermTillYearText=function(plan){return angular.isDefined(plan.tillYearText)&&plan.tillYearText?plan.tillYearText:""},this.renderPlanAnnualIncomeTermTillYear=function(plan){return angular.isDefined(plan.tillYear)&&plan.tillYear?plan.tillYear:""},this.renderPlanAnnualIncomeTermOrTillYrText=function(plan){return angular.isDefined(plan.orTillYrText)&&plan.orTillYrText?plan.orTillYrText:""},this.renderPlanAnnualIncomeTermOrTillYr=function(plan){return angular.isDefined(plan.orYrText)&&plan.orYrText?plan.orYrText:""},this.renderPlanAnnualIncomeTermOrYrText=function(plan){return angular.isDefined(plan.orTillYr)&&plan.orTillYr?plan.orTillYr:""},this.getMonthlyPayoutData=function(plan){var monthlyPayoutObject={};return monthlyPayoutObject.monthlyAnnualReturn=CommonServiceTerm.changeDisplayNumberFormat(plan.maxAnnualReturn/12),monthlyPayoutObject.monthlyPayoutTerm=0!=this.renderPlanAnnualIncomeTerm(plan)?this.renderPlanAnnualIncomeTerm(plan):"",monthlyPayoutObject.monthlyPayoutMonthTerm=this.rendePlanAnnualIncomeMonthTerm(plan),monthlyPayoutObject.monthlyPayoutTermTillYearText=this.renderPlanAnnualIncomeTermTillYearText(plan),monthlyPayoutObject.monthlyPayoutTermTillYear=this.renderPlanAnnualIncomeTermTillYear(plan),monthlyPayoutObject.monthlyPayoutTermOrTillYrText=this.renderPlanAnnualIncomeTermOrTillYrText(plan),monthlyPayoutObject.monthlyPayoutTermOrTillYr=this.renderPlanAnnualIncomeTermOrTillYr(plan),monthlyPayoutObject.monthlyPayoutTermOrYrText=this.renderPlanAnnualIncomeTermOrYrText(plan),monthlyPayoutObject},this.getCategoryLabelForPlan=function(planCategory,plan){var categoryLabel,planId=plan.Plan_Id;if(this.isAegoniReturnPlan(planId)||1*plan.Plan_Id===697||1*plan.Plan_Id===681||1*plan.Plan_Id===846)categoryLabel="The Return of Premium Plan";else if($rootScope.pTabName.onetimePlans&&this.isETCitiCarePlan(planId))categoryLabel="Critical Illness";else if(planCategory.indexOf("57")>=0)categoryLabel=getPlanCategoryLabelOne("57")+" "+getPlanCategoryLabelTwo("57")+" "+getPlanCategoryLabelThree("57");else if(planCategory.indexOf("56")>=0)categoryLabel=getPlanCategoryLabelOne("56");else{var categoryId=this.getCategoryId(planCategory);categoryLabel=categoryId?getPlanCategoryLabelOne(categoryId)+" "+getPlanCategoryLabelTwo(categoryId):""}return categoryLabel},this.showMonthlyPremiumTop=function(quotes,filterArray){_.each(quotes,function(quote){quote.monthlyTotalPremium=quote.monthlyTotalPremium>0?quote.monthlyTotalPremium:999999999});var array=[];return _.each(filterArray,function(val){"allTotalPremium"===val?array.push("monthlyTotalPremium"):"-allTotalPremium"===val?array.push("-monthlyTotalPremium"):array.push(val)}),quotes=$filter("orderBy")(quotes,array),_.each(quotes,function(quote){quote.monthlyTotalPremium=999999999==quote.monthlyTotalPremium?0:quote.monthlyTotalPremium}),quotes},this.checkIFADBOrATPDSelected=function(quotes,isMonthly,types){var selectedRiders=[],types=angular.copy(types);return _.each(types,function(val){val.status&&selectedRiders.push(val.id),val.isSelected&&selectedRiders.push(val.categoryId)}),_.each(quotes,function(quote){var limitedPay="LimitedPay"===quote.payOptionType,isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id),isAdbSelected=selectedRiders.indexOf(10)!=-1,isCiSelected=selectedRiders.indexOf(15)!=-1;if(_.each(quote.riderPremiumObject,function(riderVal){_.each(types,function(type){that.checkIfSelected(riderVal,type,quote,isMonthly)})}),that.isMAXPlan(quote.Plan_Id)){var isADBSelected=!1,isADPDSelected=!1;_.each(quote.riderPremiumObject,function(rider){1*rider.categoryId===10&&rider.isSelected&&(isADBSelected=!0),1*rider.categoryId===12&&rider.isSelected&&(isADPDSelected=!0)}),_.each(quote.riderPremiumObject,function(rider){isADBSelected&&1*rider.categoryId===12&&(rider.isSelected=!0),isADPDSelected&&1*rider.categoryId===10&&(rider.isSelected=!0)})}isDHFLPlan&&_.each(quote.riderPremiumObject,function(rider){limitedPay?(1*rider.categoryId===101&&isAdbSelected&&(rider.isSelected=!0,rider.isDefaultAdded=!0,rider.isHidden=!1),1*rider.categoryId==14&&isAdbSelected&&(rider.isHidden=!0)):(1*rider.categoryId===101&&(isAdbSelected||isCiSelected)&&(rider.isSelected=!0,rider.isDefaultAdded=!0,rider.isHidden=!1),isDHFLPlan&&isAdbSelected&&isCiSelected&&(1*rider.categoryId!=10&&1*rider.categoryId!=15||(rider.isSelected=!1),1*rider.categoryId==110&&(rider.isSelected=!0)),1*rider.categoryId==14&&(isAdbSelected||isCiSelected)&&(rider.isHidden=!0))})}),quotes},this.divideQuotesInTwo=function(quotes){var array=[],firstArray=[],secondArray=[];return _.each(quotes,function(quote){quote.payOptionType?firstArray.push(quote):secondArray.push(quote)}),array.push(firstArray),array.push(secondArray),array},this.isAnyRiderSelected=function(types){var isAnySelected=!1;return _.each(types,function(type){type.status&&(isAnySelected=type.status)}),isAnySelected},this.isAnyRiderSelectedForPlan=function(types,riderIdCategory){var isAnySelected=!1,customerSelection=[];_.each(types,function(type){type.status&&customerSelection.push(1*type.id)});var obj=_.find(riderIdCategory,function(rider){var categoryId=rider.catrgoryId||rider.categoryId;return customerSelection.indexOf(1*categoryId)>-1});return isAnySelected=null!==obj&&void 0!==obj},this.hideAegonPlansOnRiders=function(plan,categoryIds){var visible=plan.isQuotesVisible,planId=plan.Plan_Id;return[818,819,820,821].indexOf(planId)>-1&&(visible=categoryIds.indexOf(15)>-1?821==planId:categoryIds.indexOf(11)>-1?820==planId:categoryIds.indexOf(38)>-1||categoryIds.indexOf(101)>-1?819==planId:818==planId),visible},this.setAegonItermPlusPlanId=function(plan,categoryIds){var planId=plan.Plan_Id;return planId=categoryIds.indexOf(15)>-1?821:categoryIds.indexOf(11)>-1?820:categoryIds.indexOf(38)>-1||categoryIds.indexOf(101)>-1?819:818},this.getCancerQuotesRequestObject=function(modifySelection,tabValue){var obj={};obj.gender=modifySelection.gender,obj.age=modifySelection.customerAge,obj.tobacco=modifySelection.isTobaccoUser,obj.totalPayout=CommonServiceTerm.removeCommas(modifySelection.totalPayout),obj.term=modifySelection.policyTerm-modifySelection.customerAge,obj.criticareType=getPlanType(tabValue),obj.stateId=modifySelection.stateId,obj.name=modifySelection.name,obj.mobileNo=modifySelection.mobileNo,obj.encryptedMobileNo=modifySelection.encryptedMobileNo,obj.dob=modifySelection.dob,obj.age>=18&&obj.age<=50?$rootScope.amountBoundry.heartPayout.max=25e5:obj.age>=51&&obj.age<=55?$rootScope.amountBoundry.heartPayout.max=2e6:obj.age>=56&&obj.age<=65&&($rootScope.amountBoundry.heartPayout.max=1e6);var individualPayouts=CommonServiceTerm.calculateCancerHeartPayouts(obj.totalPayout);return obj.heartPayout=individualPayouts.heartPayout,obj.cancerPayout=individualPayouts.cancerPayout,obj},this.getPrivateIP=function(){var url=getPrivateIP;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.isInternalIP=function(){var url=isInternalIP;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this}]),app.service("PlanService",["$http","ServerUtilityService","$rootScope","CommonServiceTerm","$location","$localStorage","$cookies",function($http,ServerUtilityService,$rootScope,CommonServiceTerm,$location,$localStorage,$cookies){"use strict";function getPlanPremium(summary,isMonthly,quotesObj,custInfo){return custInfo.payOptionType&&"Single"==custInfo.payOptionType&&summary&&1*summary.ppt===1?summary.BasicPremium?summary.BasicPremium:summary.totalPremiumWithRiders:quotesObj?quotesObj.isMonthly?summary.maxMonthlyTotalPremium&&summary.maxMonthlyTotalPremium>0?summary.maxMonthlyTotalPremium:summary.montlyTotalPremiumWithRiders:quotesObj.isHalfYearly?summary.maxHalfYearlyTotalPremium&&summary.maxHalfYearlyTotalPremium>0?summary.maxHalfYearlyTotalPremium:summary.halfYearlyTotalPremiumWithRiders:quotesObj.isQuarterly?summary.maxQuarterlyTotalPremium&&summary.maxQuarterlyTotalPremium>0?summary.maxQuarterlyTotalPremium:summary.quarterlyTotalPremiumWithRiders:summary.BasicPremium?summary.BasicPremium:summary.totalPremiumWithRiders:isMonthly?summary.maxMonthlyTotalPremium&&summary.maxMonthlyTotalPremium>0?summary.maxMonthlyTotalPremium:summary.monthlyTotalPremium:summary.BasicPremium?summary.BasicPremium:summary.basicPremium;
}function updateStateForKotak(state){switch(state){case"Andaman & Nicobar Islands":state="Andaman and Nicobar";break;case"Chattisgarh":state="Chhattisgarh";break;case"Dadra & Nagar Haveli":state="Dadra and Nagar Haveli";break;case"Daman & Diu":state="Daman and Diu";break;case"Jammu & Kashmir":state="Jammu Kashmir";break;case"Orissa":state="Odisha";break;case"NCR":state="Delhi";break;default:state=state}return state}var planUrl="/api/plandetail",riderUrl="/api/rider",insurerUrl="/api/insurerRedirection",extensiveQuotesUrl="/api/summary/premiumdetail",planFeatureExclusion="/api/planExclusion";return this.buildPlanInformationObject=function(planId,data){var policyTerm=data.policyCoverage>=data.customerAge?data.policyCoverage-data.customerAge:data.customerAge-data.policyCoverage;return{age:data.customerAge,gender:data.gender,tobacco:data.isTobaccoUser,policyTerm:policyTerm,sumAssured:data.sumAssured,planId:planId}},this.isUndefinedOrNull=function(val){return angular.isUndefined(val)||null===val||!val||"null"===val||"undefined"===val},this.getPlanInformation=function(input){return ServerUtilityService.postWebService(planUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getRiderInformation=function(planId){var url=riderUrl+"/"+planId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getRoundDownSumAssured=function(sumAssured,planId){return planId&&(CommonServiceTerm.isBaxaNewPlans(planId)||CommonServiceTerm.isPNBPlan(planId)||CommonServiceTerm.isIndiaFirstPlan(planId))?sumAssured:(sumAssured/=1e3,sumAssured=parseInt(sumAssured,10),sumAssured=1e3*sumAssured)},this.getSumAssured=function(customerInfo,summary){return angular.isDefined($rootScope.pTabName)&&(angular.isDefined($rootScope.pTabName.onetimePlans)||angular.isDefined($rootScope.pTabName.tropPlans))?$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?customerInfo.sumAssured:summary.orgSumassured:customerInfo.sumAssured!=summary.orgSumassured?summary.orgSumassured:summary.sumAssured},this.buildInsurerDetails=function(customerInfo,summary,enquiryId,premium,riderArray,planArray,quotesObj){var planId=summary.Plan_Id?summary.Plan_Id:summary.planId;return{age:customerInfo.customerAge,planId:summary.Plan_Id?summary.Plan_Id:summary.planId,supplierTag:summary.E2ESupplier?"IDBI"==summary.E2ESupplier?"ICICIPRU":summary.E2ESupplier:summary.supplierName,visitId:customerInfo.visitId,sumAssured:this.getRoundDownSumAssured(this.getSumAssured(customerInfo,summary),planId),term:summary.PolicyTerm?summary.PolicyTerm:summary.term,finalPremium:getPlanPremium(summary,customerInfo.isMonthly,quotesObj,customerInfo),enquiryId:enquiryId,maxAnnualReturn:summary.maxAnnualReturn,oneTimePayout:customerInfo.oneTimePayout,leadId:customerInfo.matrixLeadId||customerInfo.matrixleadId,annualIncome:customerInfo.annualIncome?1*CommonServiceTerm.removeCommas(customerInfo.annualIncome):0,annualIncomeStr:customerInfo.annualIncomeStr?customerInfo.annualIncomeStr:0,riderObject:riderArray,planRiderObject:planArray,categoryIdObject:this.getSelectedAddOns(planId,summary.riderPremiumObject),cityId:customerInfo.city&&customerInfo.city.id?customerInfo.city.id:customerInfo.cityId,policyCoverage:1*customerInfo.customerAge+1*summary.PolicyTerm,totalCover:angular.isDefined(customerInfo.totalPayout)?customerInfo.totalPayout:0,productId:this.isUndefinedOrNull(customerInfo.productId)?7:customerInfo.productId,premiumpaymentterm:this.isUndefinedOrNull(summary.payOptionType)?"RegularPay":summary.payOptionType,ppt:this.isUndefinedOrNull(summary.ppt)?summary.PolicyTerm:summary.ppt,paymentMode:this.getPaymentMode(quotesObj,customerInfo,summary),payOptionType:this.isUndefinedOrNull(summary.payOptionType)?"Regular":summary.payOptionType,planPremium:getPlanPremium(summary,customerInfo.isMonthly,quotesObj,customerInfo),countryId:customerInfo.countryId,country:CommonServiceTerm.getCountryNameById(customerInfo.countryId),city:customerInfo.city&&customerInfo.city.name?customerInfo.city.name:customerInfo.city,state:customerInfo.city&&customerInfo.city.state?customerInfo.city.state:customerInfo.state,stateId:customerInfo.city&&customerInfo.city.stateId?customerInfo.city.stateId:customerInfo.stateId,annualPremium:summary.BasicPremium?summary.BasicPremium:summary.basicPremium,totalAnnualPremium:summary.totalPremiumWithRiders,basePremiumExclusiveTax:summary.basePremiumExclusiveTax?summary.basePremiumExclusiveTax:0,monthlyPremiumExclusiveTax:summary.monthlyPremiumExclusiveTax?summary.monthlyPremiumExclusiveTax:0,returnPBURL:$location.$$absUrl+"&enquiryId="+$cookies.get("enquiryId")+"&planId="+$cookies.get("planId"),paymentFrequency:"Single"===customerInfo.payOptionType?1:this.isUndefinedOrNull(customerInfo.paymentFrequency)?customerInfo.isMonthly&&summary.monthlyTotalPremium&&summary.monthlyTotalPremium>0?12:1:customerInfo.paymentFrequency,firstName:this.isUndefinedOrNull(customerInfo.firstName)?"":customerInfo.firstName,lastName:this.isUndefinedOrNull(customerInfo.lastName)?"":customerInfo.lastName,planName:summary.planName||summary.Plan_Name,annualPremiumGST:this.isUndefinedOrNull(summary.annualPremiumGST)?0:summary.annualPremiumGST,annualPremiumWGST:this.isUndefinedOrNull(summary.annualPremiumWGST)?0:summary.annualPremiumWGST,monthlyPremiumGST:this.isUndefinedOrNull(summary.monthlyPremiumGST)?0:summary.monthlyPremiumGST,monthlyPremiumWGST:this.isUndefinedOrNull(summary.monthlyPremiumWGST)?0:summary.monthlyPremiumWGST,halfYearlyPremiumGST:this.isUndefinedOrNull(summary.halfYearlyPremiumGST)?0:summary.halfYearlyPremiumGST,halfYearlyPremiumWGST:this.isUndefinedOrNull(summary.halfYearlyPremiumWGST)?0:summary.halfYearlyPremiumWGST,quarterlyPremiumGST:this.isUndefinedOrNull(summary.quarterlyPremiumGST)?0:summary.quarterlyPremiumGST,quarterlyPremiumWGST:this.isUndefinedOrNull(summary.quarterlyPremiumWGST)?0:summary.quarterlyPremiumWGST,tabName:$cookies.get("pTabName")||"oneTimePlans",decodedEnquiryId:customerInfo.decodedEnquiryId||0,supplierId:this.isUndefinedOrNull(summary.supplierId)?this.isUndefinedOrNull(summary.Supplier_Id)?0:summary.Supplier_Id:summary.supplierId,planShortName:summary.planShortName||summary.planName||summary.Plan_Name}},this.getPaymentMode=function(quotesObj,custInfo,summary){if(custInfo.payOptionType&&"Single"==custInfo.payOptionType&&summary&&1*summary.ppt===1)return"Single";var paymentMode="Annually";return quotesObj?quotesObj.isMonthly&&summary.monthlyTotalPremium&&summary.monthlyTotalPremium>0?paymentMode="Monthly":quotesObj.isHalfYearly?paymentMode="Half-Yearly":quotesObj.isQuarterly&&(paymentMode="Quarterly"):custInfo.isMonthly&&summary.monthlyTotalPremium&&summary.monthlyTotalPremium>0&&(paymentMode="Monthly"),paymentMode},this.getInsurerDetails=function(customerInfo,summary,enquiryId,premium,riderArray,planArray,basePremium,quotesObj){var planId=summary.Plan_Id?summary.Plan_Id:summary.planId,input=this.buildInsurerDetails(customerInfo,summary,enquiryId,premium,riderArray,planArray,quotesObj),currentDate=new Date,currentYear=currentDate.getFullYear();if(customerInfo.hasOwnProperty("spouse")&&null!==customerInfo.spouse&&(input.spouseDob=customerInfo.spouse&&customerInfo.spouse.dob?customerInfo.spouse.dob:"1-1-"+(currentYear.toString()-customerInfo.spouse.age),input.spouseWorking=customerInfo.spouse.isWorking,input.spouseTobacco=customerInfo.spouse.tobacco),customerInfo.hasOwnProperty("childAge")&&customerInfo.childAge>=0){var childAge=100===customerInfo.childAge?0:customerInfo.childAge;input.childDob=customerInfo.child&&customerInfo.child.dob?customerInfo.child.dob:"1-1-"+(currentYear-childAge)}return 811==summary.planId&&$rootScope.cancerJourney&&(input.optionType=this.isUndefinedOrNull(summary.fakePlanId)?0:8111==summary.fakePlanId?1:2),customerInfo.hasOwnProperty("lifeStageProtection")&&(input.lifeStageProtection=customerInfo.lifeStageProtection),customerInfo.hasOwnProperty("lifeStyleDetails")&&(input.lifeStyleDetails=customerInfo.lifeStyleDetails),customerInfo.hasOwnProperty("payer")&&1*customerInfo.isDifferentPayer!=0?(input.lifeStyleDetails.isPayerDifferent=1,input.lifeStyleDetails.payerRelationship=customerInfo.payer):(input.lifeStyleDetails&&input.lifeStyleDetails.hasOwnProperty("isPayerDifferent")&&delete input.lifeStyleDetails.isPayerDifferent,input.lifeStyleDetails&&input.lifeStyleDetails.hasOwnProperty("payerRelationship")&&delete input.lifeStyleDetails.payerRelationship),basePremium&&(input.basePremium=basePremium,input.planName=summary.Plan_Name),customerInfo.nationality&&(input.nationality=customerInfo.nationality),customerInfo.occupation&&(input.occupation=customerInfo.occupation),customerInfo.education&&(input.educationalQualification=customerInfo.education),CommonServiceTerm.isKotakPlan(planId)&&(input.state=updateStateForKotak(input.state),input.city=angular.copy(input.state)),CommonServiceTerm.isIndiaFirstPlan(planId)&&(input.comboPlanId=summary.planToSwitch,riderArray&&riderArray.length>0?input.incomeOptionTerm=riderArray[0].incomeOptionValue&&1*riderArray[0].incomeOptionValue!=0?1*riderArray[0].incomeOptionValue:summary.totalPayOutTerm?1*summary.totalPayOutTerm:0:input.incomeOptionTerm=customerInfo&&customerInfo.totalPayOutTerm?customerInfo.totalPayOutTerm:0),customerInfo.hasOwnProperty("maxRetainer")&&(input.maxRetainer=!0),ServerUtilityService.postWebService(insurerUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildInsurerDetailsFromContactPage=function(customerInfo,planDetails){return{planId:planDetails.planId,supplierTag:planDetails.supplierName,visitId:customerInfo.visitId,sumAssured:planDetails.sumAssured,term:planDetails.term,finalPremium:planDetails.premium,enquiryId:customerInfo.enquiryId,leadId:customerInfo.matrixleadId||customerInfo.matrixLeadId,annualIncome:0,productId:this.isUndefinedOrNull(customerInfo.productId)?7:customerInfo.productId}},this.getInsurerDetailsFromContactPage=function(customerInfo,planDetails){var input=this.buildInsurerDetailsFromContactPage(customerInfo,planDetails);return ServerUtilityService.postWebService(insurerUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getPlanInformationBySlider=function(input){return ServerUtilityService.postWebService(extensiveQuotesUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getPlanFeatureExclusion=function(planId){var url=planFeatureExclusion+"/"+planId;return ServerUtilityService.getWebService(url).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getSelectedAddOns=function(planId,riderPremium){var filterTypes=CommonServiceTerm.getFilterTypes(),selectedAddOns=[];angular.forEach(filterTypes,function(value,key){value.status&&selectedAddOns.push(value.id)}),CommonServiceTerm.isMAXPlan(planId)&&selectedAddOns.indexOf(12)>-1&&selectedAddOns.indexOf(10)==-1&&selectedAddOns.push(10);var arr=[];return CommonServiceTerm.isAegonPlan(planId)&&(_.each(riderPremium,function(rider){rider.premium>0&&selectedAddOns.indexOf(rider.categoryId)>-1&&arr.push(rider.categoryId)}),selectedAddOns=arr),selectedAddOns},this}]),app.service("QuotesService",["$rootScope","ServerUtilityService","GenericService","CommonServiceTerm","$cookies","$q","$routeParams","$filter",function($rootScope,ServerUtilityService,GenericService,CommonServiceTerm,$cookies,$q,$routeParams,$filter){"use strict";function getRiderInputDataFromQuotes(planInfo,selectedRiderIds,customerInfo,payOptionType){var riderObj={};riderObj.riderParams={},riderObj.riderParams.types=[],riderObj.riderParams.riderIds=[],riderObj.riderParams.selectedRiderIds=[],riderObj.riderParams.enquiryId=CommonServiceTerm.getEnquiryId(),riderObj.riderParams.planId=planInfo.Plan_Id,riderObj.riderParams.basePremium=planInfo.BasicPremium,riderObj.riderParams.sumAssured=planInfo.SumAssured,riderObj.riderParams.ppt=planInfo.PolicyTerm,riderObj.riderParams.term=planInfo.PolicyTerm;var selectedType="";if(riderObj.riderParams.types.push(selectedType),riderObj.riderParams.adbPremium=0,riderObj.riderParams.atpdPremium=0,riderObj.riderParams.wciPremium=0,riderObj.riderParams.name="",riderObj.tabName=$cookies.get("pTabName")||"oneTimePlans",riderObj.isMulti=!1,GenericService.isIPruSmartPlan(planInfo.Plan_Id)&&(riderObj.isMulti=!0),planInfo.payOptionType&&(1*payOptionType===2?riderObj.payOptionType="SinglePay":1*payOptionType===3&&(riderObj.payOptionType="LimitedPay")),riderObj.ppt=1*payOptionType===2?1:1*payOptionType===3?planInfo.ppt:null,_.each(planInfo.riderPremiumObject,function(ridersVal){selectedRiderIds.indexOf(ridersVal.riderId)>-1&&(1*ridersVal.categoryId===10&&(riderObj.riderParams.adbPremium=ridersVal.premium),1*ridersVal.categoryId===11&&1*customerInfo.gender===2&&(riderObj.riderParams.wciPremium=ridersVal.premium),1*ridersVal.categoryId===12&&(riderObj.riderParams.atpdPremium=ridersVal.premium)),ridersVal.riderId&&riderObj.riderParams.riderIds.indexOf(ridersVal.riderId)===-1&&riderObj.riderParams.riderIds.push(ridersVal.riderId),889==planInfo.Plan_Id&&15==ridersVal.categoryId&&(ridersVal.categoryId=20)}),riderObj.riderParams.sumAssuredRiderMapping=[],_.each(planInfo.riderPremiumObject,function(val){if(val.riderId){var obj={};obj.riderId=val.riderId;var sumAssured=parseInt(CommonServiceTerm.removeCommas(val.sumAssured));obj.sumAssured=sumAssured>-1?sumAssured:planInfo.sumAssured,obj.categoryId=val.categoryId,obj.term=planInfo.PolicyTerm,riderObj.riderParams.sumAssuredRiderMapping.push(obj)}}),GenericService.isPNBPlan(planInfo.Plan_Id)){riderObj.riderParams.riderIds.push(227),riderObj.riderParams.riderIds.push(228);var firstObj={riderId:227,categoryId:17,term:10,sumAssured:planInfo.sumAssured},secondObj={riderId:228,categoryId:14,term:10,sumAssured:planInfo.sumAssured};riderObj.riderParams.sumAssuredRiderMapping.push(firstObj),riderObj.riderParams.sumAssuredRiderMapping.push(secondObj)}return riderObj.riderParams.selectedRiderIds=selectedRiderIds.unique(),riderObj.riderParams.gender=customerInfo.gender,riderObj.riderParams.tobacco=customerInfo.isTobaccoUser,riderObj.riderParams.age=CommonServiceTerm.getAge(customerInfo.dob),riderObj.riderParams.supplierTag=planInfo.E2ESupplier,riderObj.riderParams.isFirstTimeCall=!0,riderObj.ppt=planInfo.ppt,819==planInfo.Plan_Id&&riderObj.riderParams.selectedRiderIds.length>0&&(riderObj.riderParams.selectedRiderIds[riderObj.riderParams.selectedRiderIds.indexOf(206)]=207),riderObj}function selectTerminalIllness(quote,selectedRiders){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id);return!(!(selectedRiders&&selectedRiders.length>0&&isDHFLPlan&&selectedRiders.indexOf(101)==-1)||selectedRiders.indexOf(10)==-1&&selectedRiders.indexOf(15)==-1)}function doNotAddPremium(planId,selectedRiders,categoryId){return!!(CommonServiceTerm.isAegonItermPlusPlan(planId)&&11==categoryId&&selectedRiders.indexOf(15)>-1)||(!(!CommonServiceTerm.isAegonItermPlusPlan(planId)||10!=categoryId||!(selectedRiders.indexOf(15)>-1||selectedRiders.indexOf(11)>-1))||890===planId&&15===categoryId)}function getResponseInAFormat(ret,riderMap){var newObj={};return _.each(ret,function(response){if(response.length>0){var obj={};obj.responseRiders={};var responseObj={};responseObj.dependentRiders=response[1].dependentRiders,responseObj.riders=response[1].riders,responseObj.defaultRiderPremium=response[0].defaultRiderPremium,obj.responseRiders.riderPremiumObject=populateRiderPreiumObjectFromValues(responseObj,riderMap[response[1].planId]),newObj[response[1].planId]=obj.responseRiders}}),newObj}function populateRiderPreiumObjectFromValues(riderRes,riderObj){return _.each(riderObj,function(rider){riderRes.dependentRiders.length>0?(_.each(riderRes.dependentRiders,function(depRider){1*depRider.categoryId===1*rider.categoryId&&(rider.premium=depRider.riderPremium?depRider.riderPremium:0,rider.monthlyPremium=depRider.monthlyRiderPremium?depRider.monthlyRiderPremium:0,rider.riderId=depRider.riderId)}),_.each(riderRes.riders,function(nonDepRider){1*nonDepRider.categoryId===1*rider.categoryId&&(rider.premium=nonDepRider.riderPremium?nonDepRider.riderPremium:0,rider.monthlyPremium=nonDepRider.monthlyRiderPremium?nonDepRider.monthlyRiderPremium:0,rider.riderId=nonDepRider.riderId)})):_.each(riderRes.defaultRiderPremium,function(defaultRider){1*defaultRider.categoryId===1*rider.categoryId&&(rider.premium=defaultRider.premium?defaultRider.premium:0,rider.monthlyPremium=defaultRider.monthlyRiderPremium?defaultRider.monthlyRiderPremium:0,rider.riderId=defaultRider.riderId)})}),riderObj}function getUniqueSupplierNames(quotes){return quotes.map(function(quotes){return quotes.Supplier_Id}).unique()}var planIdsArray=[],quotesUrl="/api/v1/quotes",medicalGridUrl="/api/medical/grid",nriMedicalgridUrl="/api/medical/nri/grid",quoteSelectionUrl="/api/quoteselection",getNewRiderDetailsUrl="/api/v2/quotes/riders",getRiderPremiumsUrl="/api/quote/riderpremium",getDengueQuotesUrl=(termConfigObj.getInsurerTagURL("hdfc"),"api/dengue/insurance/family/premium"),cancerQuotesUrl="/api/cancer/insurance/quotes",dengueQuotesUrl="/api/dengue/insurance/premium",emailQuotesUrl="/api/email/quotes",productApiUpdateUrl="/api/productInfo/update",isInternalIPUrl="/api/isInternalIP",ipUrl="/ipRequest",isCustomerExistUrl="/api/isParentExist",savePayTermCancerUrl="/api/cancer/insurance/save",getRidersForCancerPlansUrl="api/cancer/rider/price",getIpruSSTropUrl="/api/plandetail/ipruSSTrop",that=this;this.setPlanIdsArray=function(){planIdsArray=[]},this.getPolicyTerm=function(data){return data.policyCoverage>=data.customerAge?data.policyCoverage-data.customerAge:data.customerAge-data.policyCoverage},this.getIp=function(){return ServerUtilityService.getWebService(ipUrl).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildQuotesInputObject=function(data){return{age:data.customerAge,gender:data.gender,tobacco:data.isTobaccoUser,policyTerm:this.getPolicyTerm(data),totalCover:data.totalPayout,cityId:data.cityId,spouseTobacco:0,spouseAge:data.spouse?data.spouse.age:0,childAge:-1,isSpouseWorking:0,monthlyIncome:$rootScope.isMonthlyIncomeJourney||$rootScope.pTabName.monthlyPlans?data.monthlyIncome:0,dob:data.dob,monthlyIncomeYears:20,interestRate:10,encryptedMobileNo:data.encryptedMobileNo,annualIncome:data.annualIncome,professionType:data.professionType}},this.buildMonthlyMedicalGridData=function(quotesObj){var planSADetails=[];return angular.forEach(quotesObj,function(value,key){planSADetails.push({planId:value.Plan_Id,sumAssured:value.maxSumAssured})}),planSADetails},this.getPolicyTermForSpouse=function(data){var age=data.customerAge,policyTerm=data.policyCoverage>=age?data.policyCoverage-age:age-data.policyCoverage;return policyTerm},this.getIpruTropPlan=function(input){return ServerUtilityService.postWebService(getIpruSSTropUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildIpruTropObject=function(input,filteredObj){return{age:input.customerAge,gender:input.gender,tobacco:input.isTobaccoUser,planDetail:filteredObj.filter(function(quote){return 892==quote.Plan_Id})[0]}},this.savePayTermCancer=function(input){return ServerUtilityService.postWebService(savePayTermCancerUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.buildDefaultModifySelectionObject=function(){return{child:null,city:null,cityId:null,countryId:null,custId:null,customerAge:null,emailId:null,encodedEnquiryId:null,enquiryId:null,existUrl:null,gender:null,isTobaccoUser:null,matrixLeadId:null,mobileNo:null,name:null,policyCoverage:null,policyTerm:null,premium:null,spouse:{age:null,isWorking:!1,tobacco:!1},state:null,stateId:null,sumassured:null,totalPayout:null,userInfoId:null,visitId:null,dob:null,monthlyIncome:null,annualIncome:null,isSpouseJourney:!1,isStateChange:!1}},this.getQuotes=function(input){return ServerUtilityService.postWebService(quotesUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getMedicalGridData=function(input){var endPointurl=input.nri?nriMedicalgridUrl:medicalGridUrl;return ServerUtilityService.postWebService(endPointurl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.cancerQuotes=function(input){return ServerUtilityService.postWebService(cancerQuotesUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.isCustomerExist=function(input){var deferred=$q.defer();return termConfigObj.getPreChat()?ServerUtilityService.postWebService(isCustomerExistUrl,JSON.stringify(input)).success(function(data,status,headers,config){deferred.resolve(data)}).error(function(data,status,headers,config){deferred.resolve(data)}):deferred.resolve({childLeadExists:!0,previousBookingExist:!0}),deferred.promise},this.dengueQuotes=function(input){return ServerUtilityService.postWebService(dengueQuotesUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getdengueQuotesForAll=function(input){return ServerUtilityService.postWebService(getDengueQuotesUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getRiderPremiums=function(input){return ServerUtilityService.postWebService(getRiderPremiumsUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})};var getTabInfo=function(){return{oneTimePlansTab:$rootScope.pTabName.onetimePlans,monthlyPlansTab:$rootScope.pTabName.monthlyPlans,allPlansTab:$rootScope.pTabName.allPlans,tropPlans:$rootScope.pTabName.tropPlans,maxPayoutTab:$rootScope.tabName.maxPayout}};return this.buildEmailQuotesObject=function(uniqueSupplierPlans,customer){return{template:"TERM_QUOTES",insurer:"TERM",name:customer.name,email:customer.emailId,custId:customer.custId,leadId:customer.matrixLeadId,method:"POST",encodedEnquiryId:customer.encodedEnquiryId,bcc:"abc@policybazaar.com",subject:"Term Insurance Quotes",quotes:uniqueSupplierPlans,tabInfo:getTabInfo()}},this.emailQuotes=function(uniqueSupplierPlans,customer){uniqueSupplierPlans=this.getUniquePlansForEmailRequest(uniqueSupplierPlans);var input=this.buildEmailQuotesObject(uniqueSupplierPlans,customer);return ServerUtilityService.postWebService(emailQuotesUrl,input)},this.saveQuoteSelection=function(input){return input.supplierId=CommonServiceTerm.getRealSupplierId(input.supplierId),ServerUtilityService.postWebService(quoteSelectionUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.isInternalIP=function(){return ServerUtilityService.getWebService(isInternalIPUrl).success(function(data,status,headers,config){}).error(function(data,status,headers,config){})},this.createDefaultRiderCallRequest=function(quote,data){var quotesInputObject=that.buildQuotesInputObject(data),quotesInputObject={};quotesInputObject.age=data.customerAge,quotesInputObject.tobacco=data.isTobaccoUser,quotesInputObject.gender=data.gender,quotesInputObject.halfYearlyPremium=0,quotesInputObject.planId=quote.Plan_Id,quotesInputObject.type=null,quotesInputObject.countryId=data.countryId,quotesInputObject.basePremium=quote.maxTotalPremium,quotesInputObject.ppt="LimitedPay"===quote.payOptionType?quote.ppt:"SinglePay"===quote.payOptionType?1:quote.PolicyTerm,quotesInputObject.payOptionType=quote.payOptionType||"",quotesInputObject.isQuotesServiceCall=!0,quotesInputObject.wciPremium=0,quotesInputObject.monthlyIncome=quote.monthlyIncome?quote.monthlyIncome:0,quotesInputObject.monthlyPremium=quote.monthlyTotalPremium?quote.monthlyTotalPremium:0,quotesInputObject.supplierTag=quote.E2ESupplier,quotesInputObject.term=CommonServiceTerm.isAegonItermForeverPlan(quote.Plan_Id)?quotesInputObject.ppt:quote.PolicyTerm,quotesInputObject.sumAssured=quote.SumAssured,quotesInputObject.finalAnnualPremium=quote.maxTotalPremium,quotesInputObject.quarterlyPremium=0,$rootScope.profile.spouse&&data.spouse&&(quotesInputObject.policyTerm=that.getPolicyTermForSpouse(data),quotesInputObject.spouseAge=data.spouse.age,quotesInputObject.spouseTobacco=data.spouse.tobacco,quotesInputObject.isSpouseWorking=data.spouse.isWorking),$rootScope.profile.child&&data.child&&(quotesInputObject.childAge=data.child.age);var array=[];return _.each(quote.riderIdCategory,function(val){var obj={};obj.riderId=val.riderId,obj.categoryId=val.catrgoryId,array.push(obj)}),quote.isComparePageCall&&(quotesInputObject.isComparePageCall=quote.isComparePageCall,quotesInputObject.isQuotesServiceCall=!1),quotesInputObject.riders=array,quotesInputObject},this.getAllRiderValues=function(requestArray){return ServerUtilityService.postWebService(getNewRiderDetailsUrl,requestArray).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){})},this.updateProductRiderInfoDataFromQuotes=function(planDetails,selectedRiderIds,customerInfo,payOptionType){var url=productApiUpdateUrl,input=getRiderInputDataFromQuotes(planDetails,selectedRiderIds,customerInfo,payOptionType);return ServerUtilityService.postWebService(url,input).success(function(data,status,headers,config){}).error(function(data,status,headers,config){return data})},this.getSelectedRiderPremiums=function(selectedRiders,quote,modifySelection,enquiryId){var quoteObj={},deferred=$q.defer(),arr=[];return _.each(quote.riderPremiumObject,function(val){selectedRiders.indexOf(val.categoryId)>-1&&arr.push(val.categoryId)}),GenericService.isMAXPlan(quote.Plan_Id)&&selectedRiders.indexOf(12)>-1&&selectedRiders.indexOf(10)==-1&&arr.push(10),(1*quote.Plan_Id===823||GenericService.isFGFlexiOnlinePlan(quote.Plan_Id))&&(selectedRiders.indexOf(12)>-1&&arr.indexOf(12)==-1&&arr.push(12),selectedRiders.indexOf(10)>-1&&arr.indexOf(10)==-1&&arr.push(10)),GenericService.isHDFC3DLifeOptionPlan(quote.Plan_Id)&&(selectedRiders.indexOf(10)>-1&&arr.indexOf(10)==-1&&arr.push(10),selectedRiders.indexOf(11)>-1&&arr.indexOf(11)==-1&&arr.push(11)),quoteObj.gender=modifySelection.gender,quoteObj.tobacco=modifySelection.isTobaccoUser,quoteObj.age=modifySelection.customerAge,quoteObj.term=CommonServiceTerm.isAegonItermForeverPlan(quote.Plan_Id)?quote.ppt:quote.PolicyTerm,quoteObj.basePremium=quote.monthlyIncome>0?quote.maxTotalPremium:quote.BasicPremium,quoteObj.monthlyPremium=quote.monthlyTotalPremium?quote.monthlyTotalPremium:0,GenericService.isMAXPlan(quote.Plan_Id)&&(quoteObj.basePremium=quote.BasicPremium),806!==quote.Plan_Id&&807!==quote.Plan_Id&&808!==quote.Plan_Id&&809!==quote.Plan_Id&&810!==quote.Plan_Id||(quoteObj.term=quote.PolicyTerm),quoteObj.enquiryId=enquiryId,quoteObj.supplierTag=quote.E2ESupplier,quoteObj.countryId=modifySelection.countryId,quoteObj.planId=quote.Plan_Id,quoteObj.sumAssured=quote.monthlyIncome>0?quote.SumAssured:modifySelection.totalPayout,quoteObj.categoryIds=1*quote.Supplier_Id===11||1*quote.Supplier_Id===4||1*quote.Supplier_Id===117?selectedRiders:arr,quoteObj.custId=modifySelection.custId,quoteObj.premium=quote.monthlyIncome>0?quote.maxTotalPremium:quote.BasicPremium,quoteObj.payOptionType=GenericService.isUndefinedOrNull(quote.payOptionType)?"":quote.payOptionType,quoteObj.ppt=GenericService.isUndefinedOrNull(quote.ppt)?quote.PolicyTerm:quote.ppt,!GenericService.isUndefinedOrNull(modifySelection.spouse)&&GenericService.isPNBPlan(quote.Plan_Id)&&(quoteObj.spouseAge=modifySelection.spouse.age,quoteObj.isSpouseWorking=modifySelection.spouse.isWorking),that.getRiderPremiums(quoteObj).success(function(data){deferred.resolve(data)}),deferred.promise},this.getAllTotalPremium=function(quote){return $rootScope.pTabName.allPlans?quote.allTotalPremium=quote.maxTotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?quote.allTotalPremium=quote.TotalPremium:quote.allTotalPremium=quote.maxTotalPremium,quote},this.isRiderDefaultAdded=function(quote,rider){return(!CommonServiceTerm.isDHFLPlan(quote.Plan_Id)||101!=rider.categoryId)&&(819==quote.Plan_Id&&10==rider.categoryId||rider.isDefaultAdded)},this.addRiderValues=function(quotes,selectedRiders,isMonthly,modifySelection,enquiryId){var deferred=$q.defer(),riderObjectMap={},onlyTiSelected=!(!selectedRiders||1!=selectedRiders.length||selectedRiders.indexOf(101)==-1),qArr=[];return _.each(quotes,function(quote){CommonServiceTerm.isAegonItermPlusPlan(quote.Plan_Id)&&(quote=GenericService.modifyAegonItermPlusPlanDetails(quote,quote.Plan_Id,selectedRiders)),quote=that.getAllTotalPremium(quote),quote.riderPremiumAdded=0,quote.monthlyRiderPremiumAdded=0,quote.selectedRiderIds=[],selectTerminalIllness(quote,selectedRiders)&&selectedRiders.push(101),quote.isServiceCallRequired&&qArr.push(that.getSelectedRiderPremiums(selectedRiders,quote,modifySelection,enquiryId)),riderObjectMap[quote.Plan_Id]=quote.riderPremiumObject}),$q.all(qArr).then(function(ret){var responseObject={};responseObject=getResponseInAFormat(ret,riderObjectMap),_.each(responseObject,function(rider,key){riderObjectMap[responseObject.planId]=rider}),_.each(quotes,function(quote){quote.riderPremiumObject=angular.copy(riderObjectMap[quote.Plan_Id]),quote.riderPremiumAdded=0,quote.monthlyRiderPremiumAdded=0,_.each(quote.riderPremiumObject,function(eachRider){!(selectedRiders.indexOf(1*eachRider.categoryId)>-1||that.isRiderDefaultAdded(quote,eachRider))||CommonServiceTerm.isDHFLPlan(quote.Plan_Id)&&onlyTiSelected||(eachRider.premium>0&&!doNotAddPremium(quote.Plan_Id,selectedRiders,1*eachRider.categoryId)&&(quote.riderPremiumAdded=quote.riderPremiumAdded+eachRider.premium),eachRider.monthlyPremium>0&&!doNotAddPremium(quote.Plan_Id,selectedRiders,1*eachRider.categoryId)&&(quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+eachRider.monthlyPremium),eachRider.premium>0&&!doNotAddPremium(quote.Plan_Id,selectedRiders,1*eachRider.categoryId)&&quote.selectedRiderIds.push(eachRider.riderId),CommonServiceTerm.isAegonItermPlusPlan(quote.Plan_Id)&&(selectedRiders.indexOf(15)>-1?quote.enhancedCiSelected=!0:quote.enhancedCiSelected=!1,selectedRiders.indexOf(11)>-1?quote.basicCiSelected=!0:quote.basicCiSelected=!1))})}),deferred.resolve(quotes)}),deferred.promise},this.riderResponseFormat=function(response,riderMap){var newObj={};if(response.length>0){var obj={};obj.responseRiders={};var responseObj={};responseObj.dependentRiders=response[1].dependentRiders,responseObj.riders=response[1].riders,responseObj.defaultRiderPremium=response[0].defaultRiderPremium,obj.responseRiders=populateRiderPreiumObjectFromValues(responseObj,riderMap),newObj=obj.responseRiders}return newObj},this.getUniquePlansForEmailRequest=function(supplierPlans){var uniquePlans=[];return angular.forEach(supplierPlans,function(value,key){var uniquePlanObject={supplierName:value.Supplier_Name,policyTerm:value.PolicyTerm,categoryLabel:GenericService.getCategoryLabelForPlan(value.Plan_Category,value),childPlan:GenericService.isChildPlan(value),monthlyPayoutData:{},maxPayoutData:{}};$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?(uniquePlanObject.totalCoverText=CommonServiceTerm.changeDisplayNumberFormat(value.TotalCover),uniquePlanObject.premium=GenericService.addCommas(value.FinalPremium)):($rootScope.pTabName.monthlyPlans||$rootScope.pTabName.allPlans)&&(uniquePlanObject.monthlyPayoutData=GenericService.getMonthlyPayoutData(value),uniquePlanObject.premium=GenericService.addCommas(value.maxTotalPremium),uniquePlanObject.totalCoverText=CommonServiceTerm.changeDisplayNumberFormat(value.maxTotalCover)),
0!=uniquePlanObject.premium&&uniquePlans.push(uniquePlanObject)}),uniquePlans},this.saveAndEditButton=function(keyName,id,totalPayout,custId){"isEditable"==keyName?($(".save-btn").addClass("rightm3"),$(".edit-btn1").addClass("leftm3"),$rootScope.isMobileDevice||$(id).focus(),gaTagsNew.trackEditOrSavePayOrCover("TotalPayoutFilterClick",totalPayout,$cookies.get("pTabName"),custId)):($(".save-btn").removeClass("rightm3"),$(".edit-btn1").removeClass("leftm3"))},this.groupWholeLifeTogether=function(quotes,policyCoverage){var dumQuotes=[];if(quotes.length>0){var wholeLifePlans=[],lumpsumPlans=[];wholeLifePlans=_.filter(quotes,function(quote){if(quote.isWholeLifePlan||1*policyCoverage<=85&&1*quote.Supplier_Id===5)return quote}),lumpsumPlans=_.filter(quotes,function(quote){if(!quote.isWholeLifePlan)return quote}),wholeLifePlans=$filter("orderBy")(wholeLifePlans,"-Priority"),dumQuotes=wholeLifePlans.concat(lumpsumPlans)}return _.uniq(dumQuotes)},this.groupTropTogether=function(quotes,planId){var dumQuotes=[];if(quotes.length>0){var tropArray=[],tropSupplierIds=[],array=[];if(tropArray=_.filter(quotes,function(quote){if(quote.isTrop)return tropSupplierIds.push(quote.Supplier_Id),quote}),array=_.filter(quotes,function(quote){if(!quote.isTrop)return quote}),_.each(array,function(quote){tropSupplierIds.indexOf(quote.subTropId)>-1?_.each(tropArray,function(tropQuote){1*tropQuote.Supplier_Id===quote.subTropId&&(dumQuotes.push(quote),dumQuotes.push(tropQuote))}):dumQuotes.push(quote)}),dumQuotes&&void 0!==planId){for(var position=-1,pos=-1,aegonTropObj=_.find(dumQuotes,function(val){return val.isTrop&&1*val.subTropId===17}),i=dumQuotes.length-1;i>=0;i--)1*dumQuotes[i].subTropId===17&&dumQuotes[i].isTrop&&(pos=i),aegonTropObj&&1*dumQuotes[i].Plan_Id===planId&&(position=i);position>-1&&void 0!==aegonTropObj&&null!==aegonTropObj&&(dumQuotes.splice(pos,1),dumQuotes.splice(position,0,aegonTropObj))}}return _.uniq(dumQuotes)},this.groupByInsurer=function(quotes){var plans=[],getUniqueSupplierName=getUniqueSupplierNames(quotes);return _.each(getUniqueSupplierName,function(planName){var uniquePlans=[];_.each(quotes,function(quote){planName==quote.Supplier_Id&&quote.isQuotesVisible&&(uniquePlans.length>0&&(quote.quoteHide=!0),uniquePlans.push(quote))}),uniquePlans.length>1&&(uniquePlans[0].showViewMorePlansLink=!0,uniquePlans[0].showMore=!1),plans=plans.concat(uniquePlans)}),plans},this.getPlanCategoryType=function(plan){var categoryMapping=GenericService.planCategoryTextMappingObject();if(void 0!==plan&&null!==plan){if(CommonServiceTerm.isTROP(plan.Plan_Id))return"The Return of Premium Plan";if(GenericService.isAegoniTermForeverPlan(plan.Plan_Id)||CommonServiceTerm.isAegonItermPlusPlan(plan.Plan_Id)||CommonServiceTerm.isSbiPoornaSuraksha(plan.Plan_Id)||891==plan.Plan_Id||2300==plan.Plan_Id)return plan.planShortName;if(void 0!==plan.Plan_Category&&null!==plan.Plan_Category){var category=GenericService.getCategoryId(plan.Plan_Category),categoryMappingStr="",label3="";void 0!==categoryMapping[category]&&(label3=angular.isDefined(categoryMapping[category].label3)?" "+categoryMapping[category].label3:"",categoryMappingStr=categoryMapping[category].label1+" "+categoryMapping[category].label2+label3);var interestRateStr=GenericService.isSBIIncreasingIncomePlans(plan.Plan_Id)&&angular.isDefined(plan.interestRate)?" @ "+plan.interestRate:"";return categoryMappingStr+=interestRateStr,GenericService.isHDFC3DIncomeOptionPlan(plan.Plan_Id)?categoryMappingStr="Income Option + "+categoryMappingStr:GenericService.isHDFC3DIncomeReplacementOptionPlan(plan.Plan_Id)?categoryMappingStr="Income Replacement Option + "+categoryMappingStr:GenericService.isHDFC3DLifeProtectionOptionPlan(plan.Plan_Id)&&(categoryMappingStr="Life Protection Option + "+categoryMappingStr),categoryMappingStr}return"Plan"}},this.getCancerRidersInput=function(quote,custInfo,rider){var obj={planId:quote.planId,riderId:rider.riderId,age:angular.isDefined(custInfo.customerAge)?custInfo.customerAge:custInfo.age,term:quote.term,gender:1*custInfo.gender,tobacco:angular.isDefined(custInfo.isTobaccoUser)?custInfo.isTobaccoUser:custInfo.isTobacco,suplierTag:quote.supplierName,planSumAssured:quote.sumAssured,stateId:custInfo.stateId,categoryId:rider.categoryId,name:rider.riderName};if("CancerHeart"==quote.criticareType){obj.age>=18&&obj.age<=50?$rootScope.amountBoundry.heartPayout.max=25e5:obj.age>=51&&obj.age<=55?$rootScope.amountBoundry.heartPayout.max=2e6:obj.age>=56&&obj.age<=65&&($rootScope.amountBoundry.heartPayout.max=1e6);var individualPayouts=CommonServiceTerm.calculateCancerHeartPayouts(custInfo.totalPayout);obj.heartPayout=individualPayouts.heartPayout,obj.cancerPayout=individualPayouts.cancerPayout}return obj},this.getCancerRiderData=function(input){return ServerUtilityService.postWebService(getRidersForCancerPlansUrl,input).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){return data})},this.getCancerRiderPremiums=function(quote,custInfo,rider,categoryIds){var input=that.getCancerRidersInput(quote,custInfo,rider);return that.getCancerRiderData(input).success(function(data){rider.yearlyPremium=data[0].yearlyPremium,rider.monthlyPremium=data[0].monthlyPremium,rider.riderName=data[0].name,rider.term=data[0].term,rider.status=!(!categoryIds||categoryIds.indexOf(rider.categoryId)==-1),rider.status&&that.addRiderValuesCancerPlan(quote)}),rider},this.addRiderValuesCancerPlan=function(quote){var deferred=$q.defer();return quote.totalPremiumWithRiders=quote.premium,quote.monthlyPremiumWithRiders=quote.monthlyPremium,_.each(quote.riders,function(rider){rider.status&&(rider.yearlyPremium&&(quote.totalPremiumWithRiders+=rider.yearlyPremium),rider.monthlyPremium&&(quote.monthlyPremiumWithRiders+=rider.monthlyPremium)),quote.riders.indexOf(rider)+1==quote.riders.length&&deferred.resolve(quote)}),deferred.promise},this.getCiData=function(supplierId){var ciMap=[{supplierId:5,noOfIllness:34,name:"Enhanced Critical Illness",categoryId:15},{supplierId:16,noOfIllness:19,name:"Enhanced Critical Illness",categoryId:15},{supplierId:116,noOfIllness:19,name:"Enhanced Critical Illness",categoryId:15},{supplierId:10,noOfIllness:40,name:"Enhanced Critical Illness",categoryId:15},{supplierId:117,noOfIllness:4,name:"Critical Illness",categoryId:11},{supplierId:31,noOfIllness:10,name:"Critical Illness",categoryId:11},{supplierId:201,noOfIllness:34,name:"Enhanced Critical Illness",categoryId:15},{supplierId:201,noOfIllness:9,name:"Critical Illness",categoryId:11},{supplierId:20,noOfIllness:34,name:"Enhanced Critical Illness",categoryId:15},{supplierId:20,noOfIllness:9,name:"Critical Illness",categoryId:11},{supplierId:4,noOfIllness:4,name:"Critical Illness",categoryId:11},{supplierId:11,noOfIllness:34,name:"Enhanced Critical Illness",categoryId:15},{supplierId:14,noOfIllness:3,name:"Critical Illness",categoryId:11},{supplierId:3,noOfIllness:37,name:"Enhanced Critical Illness",categoryId:15},{supplierId:24,noOfIllness:35,name:"Enhanced Critical Illness",categoryId:15},{supplierId:124,noOfIllness:35,name:"Enhanced Critical Illness",categoryId:15},{supplierId:25,noOfIllness:35,name:"Enhanced Critical Illness",categoryId:15},{supplierId:700,noOfIllness:36,name:"Enhanced Critical Illness",categoryId:15}],ciData=[];return _.each(ciMap,function(data){data.supplierId==supplierId&&ciData.push(data)}),ciData},this.getWopData=function(supplierId){var wopMap=[{supplierId:117,text:"WOP on Critical Illness",categoryId:38},{supplierId:111,text:"WOP on Critical Illness",categoryId:38},{supplierId:11,text:"WOP on Accidental disability : Free",categoryId:38},{supplierId:24,text:"WOP on Critical Illness & Disabilty",categoryId:38},{supplierId:124,text:"WOP on Critical Illness & Disabilty",categoryId:38},{supplierId:116,text:"WOP on Accidental disability : Free",categoryId:38},{supplierId:5,text:"WOP on Accidental disability : Free",categoryId:38},{supplierId:3,text:"WOP on Accidental disability",categoryId:38},{supplierId:10,text:"WOP on Critical Illness & Disabilty",categoryId:38},{supplierId:700,text:"WOP on Critical Illness : Free",categoryId:38}],wopData=[];return _.each(wopMap,function(data){data.supplierId==supplierId&&(wopData=data)}),wopData},this.renderRiderDescriptionText=function(supplierId,rider,quotesObj,name,age,coverage,custInfo){var supplierId=supplierId,categoryId=parseInt(rider.categoryId),sumAssured=rider.sumAssured?CommonServiceTerm.changeDisplayNumberFormat(rider.sumAssured):"NA";if(5===supplierId){if(38===categoryId)return"Incase of a permanent disability to the life insured all future premiums will be paid by the insurance company";if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (34 illnesses covered) an amount of Rs."+sumAssured+" will be paid out"}if(116===supplierId||16===supplierId){if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(12===categoryId)return"Incase policyholder is permanently disabled due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (19 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if("Waiver of premium"==name)return"Incase of a permanent disability to the life insured all future premiums will be paid by the insurance company";if(38===categoryId&&"Waiver of Premium on critical illnesselse"==name)return"Incase of a critical illness to the life insured all future premiums will be paid by the insurance company";if(14===categoryId)return"Incase the policyholder is diagnosed with cancer an amount of Rs."+sumAssured+" will be paid out"}if(10===supplierId){if(38===categoryId)return"Incase of occurrence of critical illness or permanent disability to the life insured all future premiums will be paid by the insurance company";if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (40 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(10===categoryId)return"Incase policyholder is permanently disabled or passes away due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(14===categoryId)return"Incase the policyholder is diagnosed with cancer an amount of Rs."+sumAssured+" will be paid out";if("Pay till 60 years"==name)return"Premiums will have to be paid only till the age of 60; policy will continue till "+(60-age)+"yrs";if("Insta Claims"==name)return" Claim payment in 1 day, else interest payment on delay"}if(117===supplierId){if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(38===categoryId)return"Incase of occurrence of a critical illness to the life insured all future premiums will be paid by the insurance company";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(12===categoryId)return"Incase policyholder is permanently disabled due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(11===categoryId)return"Incase the policyholder is diagnosed with a critical illness (4 illnesses covered) an additional amount of Rs."+sumAssured+" will be paid out"}if(31===supplierId){if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(11===categoryId)return"Incase the policyholder is diagnosed with a critical illness (10 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(12===categoryId)return"Incase policyholder is permanently disabled due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(18===categoryId)return"Incase the policyholder is diagnosed with cancer or a heart condition an amount of Rs."+sumAssured+" will be paid out";if(13===categoryId)return"Get life cover for your spouse under the same policy, In your absence the life cover will continue for your spouse with all future premiums waived off.";if(14===categoryId)return"Upon diagnosis of Cancer get Lumpsum or Income Benefit."}if(201===supplierId||20===supplierId){if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (34 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(11===categoryId)return"Incase the policyholder is diagnosed with a critical illness (9 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out"}if(19===supplierId){if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out"}if(22===supplierId){if(12===categoryId)return"Incase policyholder is permanently disabled or passes away due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(11===categoryId)return"Covers 59 Critical Illnesses including Minor, Moderate and Major Stage Heart Related, Cancer Related and other Critical Illness Conditions.";if("Pay for 10 years"===name)return"Option to pay premium for 10 yrs & choose Cover Upto "+coverage+" Yrs"}if(124===supplierId||24===supplierId){if(38===categoryId)return"Incase of occurrence of critical illness or permanent disabilty to the life insured all future premiums will be paid by the insurance company";if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (35 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(12===categoryId)return"Incase policyholder is permanently disabled due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(47===categoryId)return"Incase policyholder is hospitalised, cash to meet hospitalisation expenses is paid out"}if(1===supplierId){if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(12===categoryId)return"Incase policyholder is permanently disabled or passes away due to an accident an additional amount of Rs."+sumAssured+" will be paid out"}if(25===supplierId){if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (35 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(14===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(110===categoryId)return"Incase of accidental death an additional amount of Rs."+CommonServiceTerm.changeDisplayNumberFormat(rider.adbSumAssured)+" will be paid out & on occurrence of any of the 35 critical illnesses an amount of Rs."+CommonServiceTerm.changeDisplayNumberFormat(rider.ciSumAssured)+" shall be paid";if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}if(3===supplierId){if(38===categoryId)return"Incase of a permanent disabilty to the life insured all future premiums will be paid by the insurance company";if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (37 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if("Step Down Option"==name)return"Option to lower your cover amount & pay rfeduced premiums as per revised cover amount"}if(1117===supplierId){if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out";if(11===categoryId)return"Incase the policyholder is diagnosed with a critical illness (10 illnesses covered) an amount of Rs."+sumAssured+" will be paid out & all future premiums will be waived off";if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (36 illnesses covered) an amount of Rs."+sumAssured+" will be paid out & all future premiums will be waived off"}if(88===supplierId){if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out"}if(14===supplierId){if(11===categoryId)return"Incase the policyholder is diagnosed with a critical illness the cover amount will be paid out";if(10===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out"}if(77===supplierId){if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death";if(10===categoryId)return"Incase policyholder is permanently disabled due to an accident an additional amount of Rs."+sumAssured+" will be paid out";if(12===categoryId)return"Incase of accidental death an additional amount of Rs."+sumAssured+" will be paid out"}if(700===supplierId){if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (36 illnesses covered) the cover amount will be paid out";if(38===categoryId)return"Incase of occurrence of a critical illness to the life insured all future premiums will be paid by the insurance company"}if(116===supplierId){if(15===categoryId)return"Incase the policyholder is diagnosed with a critical illness (36 illnesses covered) an amount of Rs."+sumAssured+" will be paid out";if(38===categoryId)return"Incase of occurrence of a critical illness to the life insured all future premiums will be paid by the insurance company"}if(11===supplierId){if(38===categoryId)return"Incase of a permanent disabilty to the life insured all future premiums will be paid by the insurance company";if(15===categoryId)return"The option provides coverage against 34 critical illnesses & permanent disability.  If life insured has been diagnosed with a critical illness or has met with an accident which causes permanent disability the rider sum assured shall be paid out .";if(10===categoryId)return"If life insured meets with an accident which causes death or permanent disability the rider sum assured shall be paid out to the nominee.";if(12===categoryId)return"If the life insured has met with an accident which causes a permanent disability then rider Sum assured shall be paid out."}if(41===supplierId){if(11===categoryId)return"The plan covers 4 critical illnesses, 100% of rider cover is paid out if life insured survives for 30 days upon diagnosis of any of the specified critical illnesses.";if(12===categoryId)return"Rider offers coverage against both death & disability. 100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy. If disability has occurred due to an accident then a percentage of Sum Assured is paid out. This percentage depends on degree of severity of the disability.";if(10===categoryId)return"100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy";if(101===categoryId)return"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}return 888===supplierId&&11===categoryId?"Incase policyholder is permanently disabled or diagnosed with a critical illness (16 illnesses covered) an additional amount of Rs.10 Lac will be paid out":""},this.modifyRiderName=function(id,plan,name){var supplierId=plan.Supplier_Id,aegonNotVisiblePlans=[818,819,820,821],planId=plan.Plan_Id,riderNamesObject={5:{38:"Waiver of Premium",101:"Early claim on terminal illness",10:"Extra Payout on Accidental death",15:"Cover against 34 critical illnesses"},116:{101:"Early claim on terminal Illness",10:"Extra Payout on Accidental death",12:"Cover against Accidental disability",15:"Cover against 19 critical illnesses",38:"Waiver of Premium on critical illness",14:"Cancer cover"},16:{101:"Early claim on terminal Illness",10:"Extra Payout on Accidental death",12:"Cover against Accidental disability",15:"Cover against 19 critical illnesses",38:"Waiver of Premium on critical illness",14:"Cancer cover"},10:{38:"Waiver of Premium",15:"Cover against 40 critical illnesses",10:"Extra Payout on Accidental death or disability",14:"Cancer cover"},117:{101:"Early claim on terminal illness",38:"Waiver of Premium",10:"Extra Payout on Accidental death",12:"Cover against Accidental disability",11:"Cover against 4 critical illnesses"},31:{10:"Extra Payout on Accidental death",11:"Cover against 10 serious illnesses",12:"Cover against accidental disability",18:"Heart & Cancer cover"},201:{15:"Cover against 34 critical illness",11:"Cover against 9 critical illness",10:"Extra Payout on Accidental death"},20:{15:"Cover against 34 critical illness",11:"Cover against 9 critical illness",10:"Extra Payout on Accidental death"},19:{101:"Early claim on terminal illness",10:"Extra Payout on Accidental death"},22:{12:"Cover against accidental disability/death",15:"Cover Against 59 Critical Illness",11:"Cover Against 59 Critical Illness"},124:{38:"Waiver of Premium",15:"Cover against 35 critical illness",10:"Extra Payout on Accidental death",12:"Cover against accidental disability",47:"Cash for hospitalization"},24:{38:"Waiver of Premium",15:"Cover against 35 critical illness",10:"Extra Payout on Accidental death",12:"Cover against accidental disability",47:"Cash for hospitalization"},1:{10:"Extra Payout on Accidental death",12:"Extra Payout on Accidental death & disability"},25:{15:"Cover against 35 critical illness",10:"Extra Payout on Accidental death",14:"Early claim on terminal illness",110:"Extra Payout on Accidental death & critical illness"},3:{38:"Waiver of Premium",15:"Cover against 37 critical illness",10:"Extra Payout on Accidental death"},1117:{10:"Extra Payout on Accidental death",11:"Cover against 10 Critical illness & get waiver of premium",15:"Cover against 36 Critical illness & get waiver of premium"},88:{101:"Early claim on terminal illness",10:"Extra Payout on Accidental death"},14:{11:"",10:"Extra Payout on Accidental death"},77:{101:"Early claim on terminal illness",12:"Additional benefit on accidental disability",10:"Extra Payout on Accidental death"},700:{15:"Cover against 36 critical illness",38:"Waiver of Premium"},11:{38:"Waiver of Premium",15:"Cover against 34 critical illness",10:"Cover against accidental disability",12:"Cover against accidental disability & death"},888:{11:"Extra Payout on Critical Illness & disability"},41:{11:"Cover against 4 critical illness",12:"Cover against accidental disability & death",10:"Extra Payout on Accidental death",101:"Early claim on terminal illness"},141:{11:"Cover against 4 critical illness",12:"Cover against accidental disability & death",10:"Extra Payout on Accidental death",101:"Early claim on terminal illness"},12:{10:"Extra Payout On Accidental Death",12:"Extra Payout On Accidental Death & Disability",101:"Early claim on terminal illness"},2:{20:"Cover Against 59 Critical Illness with Return of Premium"}},riderText=id&&riderNamesObject[supplierId]?riderNamesObject[supplierId][id]:"";if(riderText&&riderText.length>0)return riderText;if(11==supplierId){if(10==id)return"Accidental Death and Disability";if(11==id)return"Critical Illness and Disability"}if(aegonNotVisiblePlans.indexOf(planId)>-1){if(1*id===11)return"Basic CI + Waiver Of Premium";if(1*id===15)return"Enhanced CI + Waiver Of Premium"}return 1*planId===819&&1*id===10?"Accidental Death + Waiver Of Premium":1!=supplierId||12!=id||$rootScope.isMobileDevice?GenericService.isMAXPlan(planId)&&38==id?"Waiver of Premiums":CommonServiceTerm.isTataPlan(planId)&&12==id?"Death and disability due to accident":116!=supplierId&&10!=supplierId||38!=id?10==supplierId&&10==id?"Death and disability due to accident":CommonServiceTerm.isHdfc3dPlan(planId)&&101==id?"Waiver of premium and terminal illness":CommonServiceTerm.isPNBPlan(planId)&&11==id?"Serious illness":name:"Waiver of premium on critical illness":"Death & Disability due to accident"},this.isCustomizedPlan=function(plan,customizePlanObj){var isDesiredPlan=!1,ridersDesired=null,planOffersDesiredRider=!1,ridersAvailableWithPlan=[];if(_.each(plan.riderIdCategory,function(rider){ridersAvailableWithPlan.push(rider.catrgoryId)}),1*customizePlanObj.accidentalDeathProtection&&(ridersDesired="accidentalDeath"),"enhanced"===customizePlanObj.ciType?(ridersDesired="cienhanced",1*customizePlanObj.accidentalDeathProtection&&(ridersDesired="cienhanced with accidentalDeath")):"basic"===customizePlanObj.ciType&&(ridersDesired="cibasic",1*customizePlanObj.accidentalDeathProtection&&(ridersDesired="cibasic with accidentalDeath")),"none"!=customizePlanObj.ciType||1*customizePlanObj.accidentalDeathProtection){if(ridersAvailableWithPlan.length>0)switch(ridersDesired){case"accidentalDeath":planOffersDesiredRider=ridersAvailableWithPlan.indexOf(10)>-1;break;case"cienhanced":planOffersDesiredRider=ridersAvailableWithPlan.indexOf(15)>-1;break;case"cienhanced with accidentalDeath":planOffersDesiredRider=ridersAvailableWithPlan.indexOf(10)>-1&&ridersAvailableWithPlan.indexOf(15)>-1;break;case"cibasic":planOffersDesiredRider=ridersAvailableWithPlan.indexOf(11)>-1;break;case"cibasic with accidentalDeath":planOffersDesiredRider=ridersAvailableWithPlan.indexOf(10)>-1&&ridersAvailableWithPlan.indexOf(11)>-1}isDesiredPlan=1*customizePlanObj.highClaimSettlements?1*plan.Claims_Settled>=95&&planOffersDesiredRider===!0:planOffersDesiredRider}else 1*customizePlanObj.highClaimSettlements&&1*plan.Claims_Settled>=95&&(isDesiredPlan=!0);return!("none"!==customizePlanObj.ciType||1*customizePlanObj.accidentalDeathProtection||1*customizePlanObj.highClaimSettlements)||isDesiredPlan},this.payTillSixtySupplierIds=[117,10,1124],this.sortPlanByAnnualIncome=function(plan,customerInfo){var age=customerInfo.customerAge,professionType=customerInfo.professionType,isNRI=1*customerInfo.countryId!=392;if(isNRI)return!1;if(8===customerInfo.annualIncome){if(1*plan.Supplier_Id===10||1*plan.Supplier_Id===41||1*plan.Plan_Id===939)return!0;if(1*plan.Supplier_Id===1124&&(""==professionType||"Salaried"==professionType))return!0;if((""==professionType||"Salaried"==professionType)&&age<=35){if(1*plan.Supplier_Id===16||1*plan.Supplier_Id===116||1*plan.Supplier_Id===31||1*plan.Supplier_Id===19)return!0}else if(1*plan.Supplier_Id===31||1*plan.Supplier_Id===19)return!0}return!1},this.dummyPlansData=[{isDummyPlan:!0,BasicPremium:7287,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/ICICI_Pru_iProtect_Smart_plan.pdf",Claims_Settled:"97.9",E2ESupplier:"ICICIPRU",FinalPremium:7287,MedicalNeeded:"Yes",OneTimePayout:1e7,PlanAnnualIncomeTerm:"",PlanAnnualIncomeMonth:"",Plan_Category:["8","22","23","10","31","34","40","11","38","101"],Plan_Id:892,Plan_Name:"iProtect Smart Lumpsum",PolicyTerm:42,Priority:100,SumAssured:1e7,Supplier_Id:5,Supplier_Name:"ICICI",TotalCover:1e7,TotalPremium:7287,isE2E:!1,IsE2E:!0,orgSumassured:1e7,planShortName:"iProtect Smart",tATData:"15",NPVValue:1e7,planProfile:"N",maxCoverageAge:85,monthlyIncome:0,maxTotalPremium:7287,riderIdCategory:[{riderId:318,catrgoryId:10},{riderId:319,catrgoryId:15}],ridersPremium:[],isServiceCallRequired:!1,inbuildAddOns:{10:!1,15:!1,38:!0,101:!0},Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:2.94,isOneTimePlan:!0,minimumPremium:3600,paymentFrequency:["Single","Yearly","Half-yearly","Monthly"],premiumPayingTerm:"Single pay: Single; Regular pay: Same as Policy term; Limited pay: Policy term - 5 yrs",E2EName:"ICICI",BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/ICICI_Pru_iProtect_Smart_plan.pdf",originalSupplierId:5,topTwoRiderCategoryId:[{categoryId:38,riderId:-1,riderPriority:10},{categoryId:101,riderId:-1,riderPriority:20}],onlineDiscount:5,newCoverageUpto:60,newBasicPremium:7287,PlanAnnualIncome:0,StandardlPremium:7287,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:622,halfYearlyTotalPremium:3689,quarterlyTotalPremium:0,monthlyTotalPremium:622,CityID:1,annualPremiumGST:1111.5,annualPremiumWGST:6175,monthlyPremiumGST:1111.5,monthlyPremiumWGST:527.2057,halfYearlyPremiumGST:562.68,halfYearlyPremiumWGST:3126.09375,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!0,allMonthlyPremium:622,excludeFromMonthlySorting:0,allTotalPremium:7287,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:7287,ComboTotalCover:1e7,CostPerLac:72,isQuotesVisible:!0,riderPremiumObject:[{name:"Waiver Of Premium",categoryId:38,sortValue:2,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!0,isHiddenOnMobile:!0,riderPriority:10,$$hashKey:"object:2724",isSecondary:!1,notAvailable:!1,doNotPopFromObject:!1},{name:"Terminal Illness",categoryId:101,sortValue:6,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!0,isHiddenOnMobile:!0,riderPriority:20,$$hashKey:"object:2723",isSecondary:!1,notAvailable:!1,doNotPopFromObject:!1},{name:"Death due to accident",categoryId:10,sortValue:1,premium:561,monthlyPremium:48,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:2721",isSecondary:!0,sumAssured:1e6,riderId:318,notAvailable:!1,doNotPopFromObject:!1},{name:"Enhanced Critical illness",categoryId:15,sortValue:4,premium:1602,monthlyPremium:137,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:2722",isSecondary:!0,sumAssured:1e6,riderId:319,notAvailable:!1,doNotPopFromObject:!1}],featuresObject:[{title:"Cover against 34 critical illness",description:""},{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],ridersToShowCount:2,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},visibleDependencyAddOnPremiums:{},visibleDependencyCategoryIds:[]},defaultRiderObject:[{categoryId:10,riderPremium:561,monthlyRiderPremium:48,halfYearlyRiderPremium:281,annualPremiumGST:85.5,annualPremiumWGST:475,monthlyPremiumGST:7.12215,monthlyPremiumWGST:39.5675,halfYearlyPremiumGST:42.75,halfYearlyPremiumWGST:237.5,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:318,planId:892,minSumAssured:1e5,maxSumAssured:2e7,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Accidental Death Benefit",isRider:!0,isDefaultSelected:!1,description:"During the policy term, 100% of the rider sum assured will be paid in case of accidental death of life insured.",defaultSumAssured:1e6,supplierId:5,
sumAssured:1e6},{categoryId:15,riderPremium:1602,monthlyRiderPremium:137,halfYearlyRiderPremium:801,annualPremiumGST:244.35899934768676,annualPremiumWGST:1357.5499963760376,monthlyPremiumGST:20.35510464566231,monthlyPremiumWGST:113.08391469812393,halfYearlyPremiumGST:122.17949967384338,halfYearlyPremiumWGST:678.7749981880188,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:319,planId:892,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:30,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Critical Illness Benefit",isRider:!0,isDefaultSelected:!1,description:"CI rider provides coverage against 34 illnesses. Cover Amount (Sum Assured) under the rider is paid on occurrence of CI, The Death cover under the policy shall reduce by the amount paid and premium payment shall cease for the CI rider as CI benefit is paid.",minSumAssured:1e5,maxSumAssured:1e7,defaultSumAssured:1e6,numOfDiseasesCovered:34,supplierId:5,sumAssured:1e6}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:6849,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/HDFC%20Life%20Click%202%20Protect%203D%20Plus_Brochure.pdf",CalculateServiceTax:null,CityID:1,Claims_Settled:"97.8",Dependency:"849",Discount:0,DisplayMore:null,E2EName:"HDFC Life",E2ESupplier:"HDFC",EnquiryID:0,FinalPremium:6849,IsLastSelected:!1,IsSelected:!1,IsSubscribe:!0,MedicalNeeded:"Yes",MinPremium:0,Mortality:0,OneTimePayout:1e7,PlanAnnualIncome:0,PlanAnnualIncomeTerm:"",PlanAnnualIncomeTermYr:0,PlanAnnualIncomeMonth:"",PlanFeature:"TP",PlanType:"TERM",Plan_Category:["8","10","12","40","32","33","34","35","36","37","20","22","23","31","16"],Plan_Id:849,Plan_Name:"Hdfc Click2 Protect 3D Plus",PolicyFee:0,PolicyTerm:40,PrefText:"<Li>Long Policy Term of 75 years (by age)</li><li>Life Stage Protection feature</li><Li>Covers all types of death</li>",PremiumSorting:null,Priority:95,QuotePref:"PB Recommended",RedirectUrlForMail:null,RedirectionURL:"/life-insurance/T_RequestHDFClife.aspx",RenderOrder:0,ServiceTax:0,StandardlPremium:6849,SumAssured:1e7,SumassuredID:7,Supplier_FullName:"HDFC Life",Supplier_Id:116,Supplier_Name:"HDFC_Life",TROPPriority:0,Tcps_PlanId:"849",TermPageCounter:"",TotalCover:1e7,TotalPremium:6849,URLToBrochure:"http://documents.policybazaar.com/documents//life-insurance/Information/",claimsettlementRatio:95.02,comboID:0,IsE2E:!0,isE2E:!0,lstRiders:null,maxMaturityAge:75,orgSumassured:1e7,planShortName:"3D Plus Life Option",tATData:"15",NPVValue:1e7,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,planProfile:"N",maxCoverageAge:58,monthlyIncome:0,maxTotalPremium:6849,riderIdCategory:[{riderId:268,catrgoryId:10},{riderId:269,catrgoryId:38},{riderId:38,catrgoryId:14},{riderId:45,catrgoryId:12},{riderId:86,catrgoryId:15}],"riderIds[]":38,cancerCareRiderType:["Silver","Gold","Platinum"],ridersPremium:[],isServiceCallRequired:!0,isOneTimePlan:!0,isIncomeBenefitRiderExist:!1,riderPremiumObject:[{name:"Terminal Illness",categoryId:101,sortValue:6,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!0,isHiddenOnMobile:!0,riderPriority:10,$$hashKey:"object:3070",isSecondary:!1,notAvailable:!1,doNotPopFromObject:!1},{name:"Waiver of premium",isSelected:!1,inBuildAddOn:!0,riderPriority:20,isDefaultAdded:!1,isHiddenOnMobile:!0,$$hashKey:"object:3073",isSecondary:!1,notAvailable:!1,doNotPopFromObject:!1},{name:"Death due to accident",categoryId:10,sortValue:1,premium:638,monthlyPremium:55,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3067",isSecondary:!0,sumAssured:1e6,riderId:268,notAvailable:!1,doNotPopFromObject:!1},{name:"Disability due to accident",categoryId:12,sortValue:5,premium:307,monthlyPremium:27,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3068",isSecondary:!0,sumAssured:1e6,riderId:45,notAvailable:!1,doNotPopFromObject:!1},{name:"Enhanced Critical illness",categoryId:15,sortValue:4,premium:1460,monthlyPremium:127,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3069",isSecondary:!0,sumAssured:1e6,riderId:86,notAvailable:!1,doNotPopFromObject:!1},{name:"Waiver Of Premium",categoryId:38,sortValue:2,premium:199,monthlyPremium:17,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3071",isSecondary:!0,sumAssured:0,riderId:269,notAvailable:!1,doNotPopFromObject:!1},{name:"Cancer Cover",categoryId:14,sortValue:9,premium:510,monthlyPremium:47,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3072",isSecondary:!0,sumAssured:1e6,riderId:38,notAvailable:!1,doNotPopFromObject:!1}],inbuildAddOns:{10:!1,11:!1,16:!0,38:!1,101:!0},planLogoName:"HDFC_life_option",subTropId:116,planOrder:1,modeOfPremium:["Yearly","Half-Yearly","Quarterly","Monthly"],paymentFrequency:["Single","Yearly","Half-Yearly","Quarterly","Monthly"],Home_Medicals:1,Free_Lookup_Period:30,premiumPayingTerm:"Single pay: Single; Regular pay: Same as Policy Term; Limited pay: 5-39yrs",Solvency_Ratio:1.95,BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/HDFC%20Life%20Click%202%20Protect%203D%20Plus_Brochure.pdf",originalSupplierId:16,topTwoRiderCategoryId:[{categoryId:101,riderId:-1,riderPriority:10},{categoryId:16,riderId:-1,riderPriority:20}],onlineDiscount:5.5,isLowIncomePlan:!0,newCoverageUpto:58,newBasicPremium:6849,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:589,halfYearlyTotalPremium:3473,quarterlyTotalPremium:1746,monthlyTotalPremium:589,annualPremiumGST:1045,annualPremiumWGST:5804,monthlyPremiumGST:90,monthlyPremiumWGST:499,halfYearlyPremiumGST:530,halfYearlyPremiumWGST:2943,quarterlyPremiumGST:266,quarterlyPremiumWGST:1480,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!0,allMonthlyPremium:589,excludeFromMonthlySorting:0,allTotalPremium:6849,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:6849,ComboTotalCover:1e7,CostPerLac:68,isQuotesVisible:!0,featuresObject:[{title:"Option to extend Coverage till 100 years available",description:""},{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],ridersToShowCount:2,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},visibleDependencyAddOnPremiums:{"[38, 10]":[{supplierId:116,categoryId:10,riderName:"Accidental Death Benefit",description:"If life insured dies due to an accident, The Sum Assured amount available shall be paid to the nominee of the life insured.",extraLifeOptionPlanId:8883,defaultSumAssured:1e6,isComboPlan:!0,extraIncomeOptionPlanId:8887,extraIncomeOptionSinglePayPlanId:88871,extraIncomeOptionLimitedPayPlanId:88872,extraOptionSinglePayPlanId:88831,extraOptionLimitedPayPlanId:88832,lifeOptionSinglePayPlanId:8491,lifeOptionLimitedPayPlanId:8492,minimumSumAssuredPercentage:10,toHideCategoryIds:[38],visibilityPriority:0,isHidden:!0}],"[38]":[{supplierId:116,categoryId:10,riderName:"Accidental Death Benefit",description:"If life insured dies due to an accident, The Sum Assured amount available shall be paid to the nominee of the life insured.",extraLifeOptionPlanId:8883,defaultSumAssured:1e6,isComboPlan:!0,extraIncomeOptionPlanId:8887,extraIncomeOptionSinglePayPlanId:88871,extraIncomeOptionLimitedPayPlanId:88872,extraOptionSinglePayPlanId:88831,extraOptionLimitedPayPlanId:88832,lifeOptionSinglePayPlanId:8491,lifeOptionLimitedPayPlanId:8492,minimumSumAssuredPercentage:10,toHideCategoryIds:[38],visibilityPriority:0,isHidden:!0}],"[10]":[{supplierId:116,categoryId:38,riderName:"WOP on Critical Illness",description:"In case of diagnosis of any of the critical illnesses covered by the plan, future premiums that are payable for the continuity of the plan shall be waived off & Life cover shall continue.",extraLifeOptionPlanId:8882,isComboPlan:!0,extraIncomeOptionPlanId:8887,extraIncomeOptionSinglePayPlanId:88871,extraIncomeOptionLimitedPayPlanId:88872,extraOptionSinglePayPlanId:88831,extraOptionLimitedPayPlanId:88832,lifeOptionSinglePayPlanId:8491,lifeOptionLimitedPayPlanId:8492,maxCoverage:65,toHideCategoryIds:[10],visibilityPriority:0,isHidden:!0}]},visibleDependencyCategoryIds:[38,10]},defaultRiderObject:[{categoryId:10,riderPremium:638,monthlyRiderPremium:55,halfYearlyRiderPremium:323,quarterlyRiderPremium:163,formulaWGST:540.54,halfYearlyWGST:274.05377999999996,quarterlyWGST:137.83769999999998,monthlyWGST:46.486439999999995,formulaGST:97.29719999999999,monthlyGST:8.367559199999999,halfYearlyGST:49.329680399999994,quarterlyGST:24.810785999999997,supplierId:116,riderName:"Accidental Death Benefit",description:"If life insured dies due to an accident, The Sum Assured amount available shall be paid to the nominee of the life insured.",extraLifeOptionPlanId:8883,defaultSumAssured:1e6,isComboPlan:!0,extraIncomeOptionPlanId:8887,extraIncomeOptionSinglePayPlanId:88871,extraIncomeOptionLimitedPayPlanId:88872,extraOptionSinglePayPlanId:88831,extraOptionLimitedPayPlanId:88832,lifeOptionSinglePayPlanId:8491,lifeOptionLimitedPayPlanId:8492,minimumSumAssuredPercentage:10,toHideCategoryIds:[38],visibilityPriority:0,sumAssured:1e6},{categoryId:38,riderPremium:199,monthlyRiderPremium:17,halfYearlyRiderPremium:101,quarterlyRiderPremium:51,formulaWGST:169,halfYearlyWGST:85,quarterlyWGST:43,monthlyWGST:15,formulaGST:30,monthlyGST:2,halfYearlyGST:15,quarterlyGST:8,supplierId:116,riderName:"WOP on Critical Illness",description:"In case of diagnosis of any of the critical illnesses covered by the plan, future premiums that are payable for the continuity of the plan shall be waived off & Life cover shall continue.",extraLifeOptionPlanId:8882,isComboPlan:!0,extraIncomeOptionPlanId:8887,extraIncomeOptionSinglePayPlanId:88871,extraIncomeOptionLimitedPayPlanId:88872,extraOptionSinglePayPlanId:88831,extraOptionLimitedPayPlanId:88832,lifeOptionSinglePayPlanId:8491,lifeOptionLimitedPayPlanId:8492,maxCoverage:65,toHideCategoryIds:[10],visibilityPriority:0,sumAssured:0},{categoryId:14,riderPremium:510,monthlyRiderPremium:47,halfYearlyRiderPremium:510,quarterlyRiderPremium:510,formulaWGST:432.1073041856289,halfYearlyWGST:220.37472513467074,quarterlyWGST:112.34789908826352,monthlyWGST:37.80938911624253,formulaGST:77.7793147534132,monthlyGST:6.805690040923655,halfYearlyGST:39.667450524240735,quarterlyGST:20.222621835887434,supplierId:116,minSumAssured:1e6,maxSumAssured:4e6,sumAssuredInterval:1e5,minPolicyTerm:10,maxPolicyTerm:20,defaultPolicyTerm:20,policyTermInterval:1,riderName:"Cancer Care",brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/HDFC/HDFC-Life-Cancer-Care-Plan.pdf",defaultSumAssured:1e6,defaultType:"Silver",types:["Gold","Silver","Platinum"],sumAssured:1e6},{categoryId:12,riderPremium:307,monthlyRiderPremium:27,halfYearlyRiderPremium:157,quarterlyRiderPremium:80,formulaWGST:260.54999232292175,halfYearlyWGST:23.918489295244218,quarterlyWGST:67.74299800395966,monthlyWGST:22.798124328255653,formulaGST:46.898998618125916,monthlyGST:4.103662379086018,quarterlyGST:12.193739640712737,supplierId:116,minSumAssured:1e5,defaultSumAssured:1e6,maxSumAssured:2e7,sumAssuredInterval:1e5,riderName:"Accidental Disability /Dismemberment (Income Benefit)",brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/HDFC/HDFC-Accidental Disabilty-Rider-Brochure.pdf",maxCoverage:65,sumAssured:1e6},{categoryId:15,riderPremium:1460,monthlyRiderPremium:127,halfYearlyRiderPremium:745,quarterlyRiderPremium:380,formulaWGST:1237.0050144195557,halfYearlyWGST:630.8725573539734,quarterlyWGST:321.62130374908446,monthlyWGST:108.23793876171112,formulaGST:222.66090259552,monthlyGST:19.482828977108,halfYearlyGST:113.55706032371522,quarterlyGST:57.8918346748352,supplierId:116,minSumAssured:25e3,maxSumAssured:5e6,sumAssuredInterval:1e5,defaultSumAssured:1e6,riderName:"Critical Illness",brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/HDFC/HDFC_CriticalIllness.pdf",numOfDiseasesCovered:19,maxCoverage:65,sumAssured:1e6}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:6018,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Max_OTP_Plus_Leaflet4.pdf",CalculateServiceTax:null,CityID:1,Claims_Settled:"98.3",Dependency:"776",Discount:0,DisplayMore:null,E2EName:"MAX",E2ESupplier:"MAX",EnquiryID:0,FinalPremium:6018,IsLastSelected:!1,IsSelected:!1,IsSubscribe:!0,MedicalNeeded:"Yes",MinPremium:null,Mortality:0,OneTimePayout:1e7,PlanAnnualIncome:0,PlanAnnualIncomeTerm:"",PlanAnnualIncomeTermYr:0,PlanAnnualIncomeMonth:"",PlanFeature:"TP",PlanType:"TERM",Plan_Category:["8","10","22","23","31","34","38","40"],Plan_Id:776,Plan_Name:"Online Term Plus One Time Lumpsum Plan",PolicyFee:0,PolicyTerm:42,PrefText:"<li> Comprehensive Accident Benefit Rider</li><li> 10 days claim settlement guarantee</li><li> Lower rates for female lives",PremiumSorting:null,Priority:90,QuotePref:"",RedirectUrlForMail:null,RedirectionURL:"http://onlinesales.reliancelife.com/online-term/get-quote",RenderOrder:0,ServiceTax:0,StandardlPremium:6018,SumAssured:1e7,SumassuredID:7,Supplier_FullName:"Max Life insurance Co. Ltd",Supplier_Id:10,Supplier_Name:"MAX",TROPPriority:0,Tcps_PlanId:"776",TermPageCounter:"",TotalCover:1e7,TotalPremium:6018,URLToBrochure:"http://documents.policybazaar.com/documents/life-insurance/Information/MaxLife_OnlineTermPlan.pdf",claimsettlementRatio:98.3,comboID:0,isE2E:!1,IsE2E:!0,lstRiders:null,maxMaturityAge:85,orgSumassured:1e7,planShortName:"Online Term Plus",tATData:"10",NPVValue:1e7,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,planProfile:"N",maxCoverageAge:68,monthlyIncome:0,maxTotalPremium:6018,riderIdCategory:[{riderId:103,catrgoryId:10},{riderId:904,catrgoryId:14},{riderId:104,catrgoryId:38},{riderId:906,catrgoryId:15}],ridersPremium:[],isServiceCallRequired:!0,isOneTimePlan:!0,annualIncomeValidations:[{age:60,annualIncome:24e4}],minimumPremium:2200,isWOPRiderComboExist:!0,Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:3.3,riderPremiumObject:[{name:"Waiver Of Premium",categoryId:38,sortValue:2,premium:80,monthlyPremium:7,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:10,$$hashKey:"object:3754",isSecondary:!1,sumAssured:0,riderId:104,notAvailable:!1,doNotPopFromObject:!1},{name:"Enhanced Critical illness",categoryId:15,sortValue:4,premium:1676,monthlyPremium:148,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:20,$$hashKey:"object:3753",isSecondary:!1,sumAssured:1e6,riderId:906,notAvailable:!1,doNotPopFromObject:!1},{name:"Death due to accident",categoryId:10,sortValue:1,premium:743,monthlyPremium:67,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3752",isSecondary:!0,sumAssured:1e6,riderId:106,notAvailable:!1,doNotPopFromObject:!1},{name:"Pay till 60 years",isSelected:!1,hasRiderStatus:"Available",checked:!0,inBuildAddOn:!1,isDefaultAdded:!1,isHiddenOnMobile:!0,$$hashKey:"object:3756",isSecondary:!0,notAvailable:!1,doNotPopFromObject:!1}],paymentFrequency:["Yearly","Half-yearly","Quarterly","Monthly"],premiumPayingTerm:"Regular pay: Same as Policy term; Limited pay: Pay till age 60yrs",BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Max_OTP_Plus_Leaflet4.pdf",originalSupplierId:10,topTwoRiderCategoryId:[{categoryId:38,riderId:104,riderPriority:10},{categoryId:15,riderId:906,riderPriority:20}],newCoverageUpto:60,newBasicPremium:6018,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:530,halfYearlyTotalPremium:3087,quarterlyTotalPremium:1571,monthlyTotalPremium:530,annualPremiumGST:918,annualPremiumWGST:5100,monthlyPremiumGST:80.78399999999999,monthlyPremiumWGST:448.79999999999995,halfYearlyPremiumGST:470.934,halfYearlyPremiumWGST:2616.3,quarterlyPremiumGST:239.598,quarterlyPremiumWGST:1331.1000000000001,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!1,allMonthlyPremium:530,excludeFromMonthlySorting:0,allTotalPremium:6018,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:6018,ComboTotalCover:1e7,CostPerLac:60,isQuotesVisible:!0,featuresObject:[{title:"Only plan with coverage against 40 Critical Illnesses",description:""},{title:"Option to pay till 60 years and get coverage till 85",description:"Premiums will have to be paid only till the age of 60; policy will continue till 42yrs"}],ridersToShowCount:0,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[10,15],premiumDependencyAddOnPremiums:{"[10, 15]":[{categoryId:38,riderPremium:113,monthlyRiderPremium:11,halfYearlyRiderPremium:59,quarterlyRiderPremium:30,annualPremiumGST:17.256255696845052,annualPremiumWGST:95.86808720469475,monthlyPremiumGST:1.5530630127160547,monthlyPremiumWGST:8.628127848422526,halfYearlyPremiumGST:8.973252962359428,halfYearlyPremiumWGST:49.85140534644127,quarterlyPremiumGST:4.57290775966394,quarterlyPremiumWGST:25.405043109244108,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:104,planId:776,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!1,isPolicyTermPresent:!1,riderName:"Waiver of Premium",isRider:!0,isDefaultSelected:!1,description:"All future premiums for a policy and riders will be waived off in case of a Disability/ Dismemberment or occurrence of any of the 11 critical illnesses covered under the plan.",supplierId:10,dependentCategoryIds:[10,15],errorMessage:"",sumAssured:0}],"[10]":[{categoryId:38,riderPremium:91,monthlyRiderPremium:8,halfYearlyRiderPremium:47,quarterlyRiderPremium:24,annualPremiumGST:13.831073596715926,annualPremiumWGST:76.83929775953293,monthlyPremiumGST:1.2447966237044332,monthlyPremiumWGST:6.915536798357963,halfYearlyPremiumGST:7.192158270292282,halfYearlyPremiumWGST:39.95643483495712,quarterlyPremiumGST:3.665234503129721,quarterlyPremiumWGST:20.362413906276227,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:104,planId:776,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!1,isPolicyTermPresent:!1,riderName:"Waiver of Premium",isRider:!0,isDefaultSelected:!1,description:"All future premiums for a policy and riders will be waived off in case of a Disability/ Dismemberment or occurrence of any of the 11 critical illnesses covered under the plan.",supplierId:10,dependentCategoryIds:[10,15],errorMessage:"",sumAssured:0}],"[15]":[{categoryId:38,riderPremium:103,monthlyRiderPremium:9,halfYearlyRiderPremium:53,quarterlyRiderPremium:27,annualPremiumGST:15.735561741185188,annualPremiumWGST:87.41978745102882,monthlyPremiumGST:1.416200556706667,monthlyPremiumWGST:7.867780870592594,halfYearlyPremiumGST:8.182492105416298,halfYearlyPremiumWGST:45.45828947453499,quarterlyPremiumGST:4.169923861414075,quarterlyPremiumWGST:23.16624367452264,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:104,planId:776,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!1,isPolicyTermPresent:!1,riderName:"Waiver of Premium",isRider:!0,isDefaultSelected:!1,description:"All future premiums for a policy and riders will be waived off in case of a Disability/ Dismemberment or occurrence of any of the 11 critical illnesses covered under the plan.",supplierId:10,dependentCategoryIds:[10,15],errorMessage:"",sumAssured:0}]},visibleDependencyAddOnPremiums:{},visibleDependencyCategoryIds:[]},defaultRiderObject:[{categoryId:10,riderPremium:743,monthlyRiderPremium:67,halfYearlyRiderPremium:387,quarterlyRiderPremium:197,annualPremiumGST:113.39999999999999,annualPremiumWGST:630,monthlyPremiumGST:10.206,monthlyPremiumWGST:56.699999999999996,halfYearlyPremiumGST:58.968,halfYearlyPremiumWGST:327.6,quarterlyPremiumGST:30.051000000000002,quarterlyPremiumWGST:166.95000000000002,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:106,planId:777,minSumAssured:5e4,maxSumAssured:1e7,defaultSumAssured:1e6,sumAssuredInterval:1e5,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Comprehensive Accident Death Benefit",isRider:!0,isDefaultSelected:!1,description:"The cover amount (Sum Assured) is paid out in case of death or disability /dismemberment due to an accident.",supplierId:10,errorMessage:"",sumAssured:1e6},{categoryId:14,riderPremium:0,monthlyRiderPremium:0,halfYearlyRiderPremium:0,quarterlyRiderPremium:0,annualPremiumGST:0,annualPremiumWGST:0,monthlyPremiumGST:0,monthlyPremiumWGST:0,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:102,planId:776,minSumAssured:1e6,maxSumAssured:5e6,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:5,isPolicyTermPresent:!0,isDefaultSelected:!1,defaultSumAssured:1e6,riderName:"Max Life Cancer Insurance Plan",isRider:!0,brochureLink:"",brochureLink_old:"",supplierId:10,errorMessage:"",sumAssured:1e6},{categoryId:38,riderPremium:80,monthlyRiderPremium:7,halfYearlyRiderPremium:41,quarterlyRiderPremium:21,annualPremiumGST:12.31037964105606,annualPremiumWGST:68.390998005867,monthlyPremiumGST:1.1079341676950454,monthlyPremiumWGST:6.15518982052803,halfYearlyPremiumGST:6.4013974133491525,halfYearlyPremiumWGST:35.56331896305085,quarterlyPremiumGST:3.262250604879856,quarterlyPremiumWGST:18.123614471554756,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:104,planId:776,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!1,isPolicyTermPresent:!1,riderName:"Waiver of Premium",isRider:!0,isDefaultSelected:!1,description:"All future premiums for a policy and riders will be waived off in case of a Disability/ Dismemberment or occurrence of any of the 11 critical illnesses covered under the plan.",supplierId:10,dependentCategoryIds:[10,15],errorMessage:"",sumAssured:0},{categoryId:15,riderPremium:1676,monthlyRiderPremium:148,halfYearlyRiderPremium:859,quarterlyRiderPremium:438,annualPremiumGST:255.59999227523804,annualPremiumWGST:1419.9999570846558,monthlyPremiumGST:22.492799320220943,monthlyPremiumWGST:124.95999622344969,halfYearlyPremiumGST:131.1227960371971,halfYearlyPremiumWGST:728.4599779844284,quarterlyPremiumGST:66.71159798383712,quarterlyPremiumWGST:370.61998879909515,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,supplierId:10,minSumAssured:5e5,maxSumAssured:5e7,defaultSumAssured:1e6,sumAssuredInterval:5e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Critical Illness Benefit",isRider:!0,isDefaultSelected:!1,description:"",numOfDiseasesCovered:40,errorMessage:"",sumAssured:1e6}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:6404,isOneClickPayment:!1,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Aegon_iTerm+Plus_Brochure.pdf",Claims_Settled:"95.7",E2ESupplier:"AEGON",FinalPremium:6404,MedicalNeeded:"Yes",OneTimePayout:1e7,PlanAnnualIncomeTerm:"",PlanAnnualIncomeMonth:"",Plan_Category:["8","10","11","38","22","23","25","31","32","34","40","20"],Plan_Id:818,Plan_Name:"Life",PolicyTerm:47,Priority:85,SumAssured:1e7,Supplier_Id:1117,Supplier_Name:"Aegon_Religare",TotalCover:1e7,TotalPremium:6404,orgSumassured:1e7,planShortName:"iTerm Plus",tATData:"8",NPVValue:1e7,planProfile:"SNW",maxCoverageAge:80,monthlyIncome:0,maxTotalPremium:6404,riderIdCategory:[{riderId:206,catrgoryId:10}],ridersPremium:[],inbuildAddOns:{10:!1,11:!1,38:!1,101:!1},isServiceCallRequired:!1,isOneTimePlan:!0,subTropId:17,planCategory:"One Time Lumpsum Plan",paymentFrequency:["Yearly","Half-Yearly","Monthly"],Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:2.24000000953674,premiumPayingTerm:"Regular pay: Same as Policy term",medicalExpensesDeductible:!0,shouldIncludeADBRiderPremium:!1,E2EName:"Aegon Religare",BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/iTerm Brochurenew3 22 sept 2016_LINKED.pdf",modeOfPremium:["Yearly","Half-Yearly","Monthly"],annualIncomeValidations:[{age:65,annualIncome:3e5}],originalSupplierId:17,topTwoRiderCategoryId:[{categoryId:10,riderId:206,riderPriority:10}],newCoverageUpto:65,newBasicPremium:6404,PlanAnnualIncome:0,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:557,halfYearlyTotalPremium:3279,quarterlyTotalPremium:0,monthlyTotalPremium:557,CityID:1,annualPremiumGST:976.8600082397461,annualPremiumWGST:5427.000045776367,monthlyPremiumGST:84.98682071685789,monthlyPremiumWGST:472.1490039825439,halfYearlyPremiumGST:500.15232421875,halfYearlyPremiumWGST:2778.6240234375,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,BasicPremium_818:6404,FinalPremium_818:6404,TotalPremium_818:6404,maxTotalPremium_818:6404,newBasicPremium_818:6404,StandardlPremium818:6404,maxHalfYearlyTotalPremium_818:0,maxMonthlyTotalPremium_818:557,halfYearlyTotalPremium_818:3279,quarterlyTotalPremium_818:0,monthlyTotalPremium_818:557,annualPremiumGST_818:976.8600082397461,annualPremiumWGST_818:5427.000045776367,monthlyPremiumGST_818:84.98682071685789,monthlyPremiumWGST_818:472.1490039825439,halfYearlyPremiumGST_818:500.15232421875,halfYearlyPremiumWGST_818:2778.6240234375,riderIdCategory_818:[{riderId:206,catrgoryId:10}],BasicPremium_819:6501,FinalPremium_819:6501,TotalPremium_819:6501,maxTotalPremium_819:6501,newBasicPremium_819:6501,StandardlPremium819:6501,maxHalfYearlyTotalPremium_819:0,maxMonthlyTotalPremium_819:566,halfYearlyTotalPremium_819:3328,quarterlyTotalPremium_819:0,monthlyTotalPremium_819:566,annualPremiumGST_819:991.620002746582,annualPremiumWGST_819:5509.000015258789,monthlyPremiumGST_819:86.27094023895263,monthlyPremiumWGST_819:479.2830013275146,halfYearlyPremiumGST_819:507.70944140625,halfYearlyPremiumWGST_819:2820.6080078125,riderIdCategory_819:[{riderId:207,catrgoryId:10},{riderId:208,catrgoryId:38}],BasicPremium_820:6501,FinalPremium_820:6501,TotalPremium_820:6501,maxTotalPremium_820:6501,newBasicPremium_820:6501,StandardlPremium820:6501,maxHalfYearlyTotalPremium_820:0,maxMonthlyTotalPremium_820:566,halfYearlyTotalPremium_820:3328,quarterlyTotalPremium_820:0,monthlyTotalPremium_820:566,annualPremiumGST_820:991.620002746582,annualPremiumWGST_820:5509.000015258789,monthlyPremiumGST_820:86.27094023895263,monthlyPremiumWGST_820:479.2830013275146,halfYearlyPremiumGST_820:507.70944140625,halfYearlyPremiumWGST_820:2820.6080078125,riderIdCategory_820:[{riderId:209,catrgoryId:38},{riderId:210,catrgoryId:11}],BasicPremium_821:6501,FinalPremium_821:6501,TotalPremium_821:6501,maxTotalPremium_821:6501,newBasicPremium_821:6501,StandardlPremium821:6501,maxHalfYearlyTotalPremium_821:0,maxMonthlyTotalPremium_821:566,halfYearlyTotalPremium_821:3328,quarterlyTotalPremium_821:0,monthlyTotalPremium_821:566,annualPremiumGST_821:991.620002746582,annualPremiumWGST_821:5509.000015258789,monthlyPremiumGST_821:86.27094023895263,monthlyPremiumWGST_821:479.2830013275146,halfYearlyPremiumGST_821:507.70944140625,halfYearlyPremiumWGST_821:2820.6080078125,riderIdCategory_821:[{riderId:211,catrgoryId:38},{riderId:212,catrgoryId:15}],riderPremiumAdded:33,numInterestRate:0,monthlyRiderPremiumAdded:3,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!0,allMonthlyPremium:557,excludeFromMonthlySorting:0,allTotalPremium:6404,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:6404,ComboTotalCover:1e7,CostPerLac:64,isQuotesVisible:!0,riderPremiumObject:[{name:"Death due to accident",categoryId:10,sortValue:1,premium:33,monthlyPremium:3,isSelected:!1,isDisabled:!1,isDefaultAdded:!0,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:10,$$hashKey:"object:3889",isSecondary:!1,sumAssured:5e4,riderId:207,notAvailable:!1,doNotPopFromObject:!1},{name:"Critical illness",categoryId:11,sortValue:3,premium:446,monthlyPremium:38,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3890",isSecondary:!1,riderId:210,notAvailable:!1,doNotPopFromObject:!1},{name:"Enhanced Critical illness",categoryId:15,sortValue:4,premium:629,monthlyPremium:54,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:3891",isSecondary:!0,riderId:212,notAvailable:!1,doNotPopFromObject:!1}],featuresObject:[{title:"Coverage against 36 Critical Illnesses",description:""},{title:"Option to cover yourself till 80 yrs of age.",description:""}],ridersToShowCount:1,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},visibleDependencyAddOnPremiums:{"[10]":[{isHidden:!0},{isHidden:!0}]},visibleDependencyCategoryIds:[10]},defaultRiderObject:[{categoryId:10,riderPremium:33,monthlyRiderPremium:3,halfYearlyRiderPremium:17,annualPremiumGST:5.000400123596191,annualPremiumWGST:27.780000686645508,monthlyPremiumGST:.4350348107528686,monthlyPremiumWGST:2.416860059738159,halfYearlyPremiumGST:2.5602048632812497,halfYearlyPremiumWGST:14.2233603515625,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:207,planId:819,minSumAssured:5e4,maxSumAssured:3e7,defaultSumAssured:5e4,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Accidental Death Benefit",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/Aegon Life AD Rider Brochure_0.pdf",isDefaultSelected:!1,description:"Upon accidental death the nominee shall receive an additional Lump sum payout over & above the base plan payout.",isDisabled:!0,isSelected:!0,e2eRiderIds:[207,208],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/Aegon Life AD Rider Brochure_0.pdf",supplierId:1117,toHideCategoryIds:[11,15],visibilityPriority:0,errorMessage:""}],defaultRiderObject_818:[{categoryId:10,riderPremium:33,monthlyRiderPremium:3,halfYearlyRiderPremium:17,annualPremiumGST:5.000400123596191,annualPremiumWGST:27.780000686645508,monthlyPremiumGST:.4350348107528686,monthlyPremiumWGST:2.416860059738159,halfYearlyPremiumGST:2.5602048632812497,halfYearlyPremiumWGST:14.2233603515625,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:207,planId:819,minSumAssured:5e4,maxSumAssured:3e7,defaultSumAssured:5e4,sumAssuredInterval:1e5,
isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Accidental Death Benefit",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/Aegon Life AD Rider Brochure_0.pdf",isDefaultSelected:!1,description:"Upon accidental death the nominee shall receive an additional Lump sum payout over & above the base plan payout.",isDisabled:!0,isSelected:!0,e2eRiderIds:[207,208],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/Aegon Life AD Rider Brochure_0.pdf",supplierId:1117,toHideCategoryIds:[11,15],visibilityPriority:0,errorMessage:""}],defaultRiderObject_819:[{categoryId:10,riderPremium:87,monthlyRiderPremium:8,halfYearlyRiderPremium:44,annualPremiumGST:5.000400123596191,annualPremiumWGST:27.780000686645508,monthlyPremiumGST:.4350348107528686,monthlyPremiumWGST:2.416860059738159,halfYearlyPremiumGST:2.5602048632812497,halfYearlyPremiumWGST:14.2233603515625,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:207,planId:819,minSumAssured:5e4,maxSumAssured:3e7,defaultSumAssured:5e4,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Accidental Death Benefit",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/Aegon Life AD Rider Brochure_0.pdf",isDefaultSelected:!1,description:"Upon accidental death the nominee shall receive an additional Lump sum payout over & above the base plan payout.",isDisabled:!0,isSelected:!0,e2eRiderIds:[207,208],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/Aegon Life AD Rider Brochure_0.pdf",supplierId:1117,toHideCategoryIds:[11,15],visibilityPriority:0,errorMessage:"",sumAssured:5e4,quarterlyRiderPremium:0},{categoryId:38,riderPremium:0,monthlyRiderPremium:0,halfYearlyRiderPremium:0,annualPremiumGST:8.170948573036194,annualPremiumWGST:45.39415873908997,monthlyPremiumGST:.7108725258541488,monthlyPremiumWGST:3.949291810300827,halfYearlyPremiumGST:4.183525669394531,halfYearlyPremiumWGST:23.241809274414063,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:211,planId:821,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,isSumAssuredPresent:!1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Waiver of Premium Rider on Enhanced Critical Illness",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/AL WOP Rider on CI Brochure_1.pdf",isDefaultSelected:!1,description:"If diagnosed with any of theses illnesses ( Cancer, Stroke, Coronary artery bypass surgery & heart attack), The plan & rider premiums shall be waived off & policy will continue.",isDisabled:!0,isSelected:!0,e2eRiderIds:[212],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/AL WOP Rider on CI Brochure_1.pdf",supplierId:1117,errorMessage:"",sumAssured:0,quarterlyRiderPremium:0}],defaultRiderObject_820:[{categoryId:38,riderPremium:0,monthlyRiderPremium:0,halfYearlyRiderPremium:0,annualPremiumGST:9.588965475654602,annualPremiumWGST:53.272030420303345,monthlyPremiumGST:.8342399963819503,monthlyPremiumWGST:4.634666646566391,halfYearlyPremiumGST:4.909550323535156,halfYearlyPremiumWGST:27.275279575195313,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:211,planId:821,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,isSumAssuredPresent:!1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Waiver of Premium Rider on Enhanced Critical Illness",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/AL WOP Rider on CI Brochure_1.pdf",isDefaultSelected:!1,description:"If diagnosed with any of theses illnesses ( Cancer, Stroke, Coronary artery bypass surgery & heart attack), The plan & rider premiums shall be waived off & policy will continue.",isDisabled:!0,isSelected:!0,e2eRiderIds:[212],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/AL WOP Rider on CI Brochure_1.pdf",supplierId:1117,errorMessage:"",sumAssured:0,quarterlyRiderPremium:0},{categoryId:11,riderPremium:446,monthlyRiderPremium:38,halfYearlyRiderPremium:227,annualPremiumGST:58.419003295898435,annualPremiumWGST:324.5500183105469,monthlyPremiumGST:5.0824532867431635,monthlyPremiumWGST:28.235851593017575,halfYearlyPremiumGST:29.9105296875,halfYearlyPremiumWGST:166.169609375,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:210,planId:820,minSumAssured:5e5,defaultSumAssured:5e5,maxSumAssured:5e6,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Basic Critical Illness",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/AL iCI Rider Brochure.pdf",isDefaultSelected:!1,description:"This rider offers a critical illness cover which pays out a lump sum benefit on occurrence of any of the 4 illnesses.( Cancer, Stroke, Open chest CABG, First heart attack).",isDisabled:!0,isSelected:!0,e2eRiderIds:[210],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/AL iCI Rider Brochure.pdf",supplierId:1117,toHideCategoryIds:[10,15],visibilityPriority:0,errorMessage:"",sumAssured:5e5,quarterlyRiderPremium:0}],defaultRiderObject_821:[{categoryId:38,riderPremium:0,monthlyRiderPremium:0,halfYearlyRiderPremium:0,annualPremiumGST:12.990222378273009,annualPremiumWGST:72.16790210151672,monthlyPremiumGST:1.1301493469097517,monthlyPremiumWGST:6.278607482831954,halfYearlyPremiumGST:6.650993857675781,halfYearlyPremiumWGST:36.94996587597656,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:211,planId:821,minSumAssured:-1,maxSumAssured:-1,sumAssuredInterval:-1,isSumAssuredPresent:!1,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Waiver of Premium Rider on Enhanced Critical Illness",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/AL WOP Rider on CI Brochure_1.pdf",isDefaultSelected:!1,description:"If diagnosed with any of theses illnesses ( Cancer, Stroke, Coronary artery bypass surgery & heart attack), The plan & rider premiums shall be waived off & policy will continue.",isDisabled:!0,isSelected:!0,e2eRiderIds:[212],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/AL WOP Rider on CI Brochure_1.pdf",supplierId:1117,errorMessage:"",sumAssured:0,quarterlyRiderPremium:0},{categoryId:15,riderPremium:629,monthlyRiderPremium:54,halfYearlyRiderPremium:320,annualPremiumGST:82.95299835205078,annualPremiumWGST:460.84999084472656,monthlyPremiumGST:7.216910856628417,monthlyPremiumWGST:40.093949203491206,halfYearlyPremiumGST:42.47193515625,halfYearlyPremiumWGST:235.9551953125,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:212,planId:821,defaultSumAssured:5e5,minSumAssured:5e5,maxSumAssured:5e6,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Enhanced Critical Illness Rider",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Aegon/AL iCI Rider Brochure.pdf",isDefaultSelected:!1,description:"This rider offers a critical illness cover which pays out a lump sum benefit on occurrence of any of the 4 illnesses.( Cancer, Stroke, Open chest CABG, First heart attack).",isDisabled:!0,isSelected:!0,e2eRiderIds:[212],brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Aegon/AL iCI Rider Brochure.pdf",supplierId:1117,toHideCategoryIds:[10,11],visibilityPriority:0,errorMessage:"",sumAssured:5e5,quarterlyRiderPremium:0}],adbObj:{818:{premium:33,monthlyPremium:0,sumAssured:5e4,monthlyRiderPremium:3},819:{premium:87,monthlyPremium:0,sumAssured:5e4,monthlyRiderPremium:8}},selectedRiderIds:[207],enhancedCiSelected:!1,basicCiSelected:!1},{isDummyPlan:!0,BasicPremium:7788,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/iRaksha-supreme.pdf",Claims_Settled:"98.0",E2ESupplier:"TATAAIA",FinalPremium:7788,MedicalNeeded:"Yes",OneTimePayout:1e7,PlanAnnualIncomeTerm:"",PlanAnnualIncomeMonth:"",Plan_Category:["40","10","11","12","16","18"],Plan_Id:814,Plan_Name:"Tata Sampoorna Raksha Lumpsum",PolicyTerm:40,Priority:83,SumAssured:1e7,Supplier_Id:22,Supplier_Name:"TATA_AIA",TotalCover:1e7,TotalPremium:7788,isE2E:!0,IsE2E:!0,orgSumassured:1e7,planShortName:"Sampoorna Raksha",tATData:"",NPVValue:1e7,planProfile:"N",maxCoverageAge:58,monthlyIncome:0,maxTotalPremium:7788,riderIdCategory:[{riderId:202,catrgoryId:12},{riderId:15899,catrgoryId:11}],ridersPremium:[],isServiceCallRequired:!1,isOneTimePlan:!0,dependentRiderIds:[],planCategory:"One Time Lumpsum Plan",homeMedicalAvailable:!0,freeLookPeriod:5,Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:3.22,medicalExpensesDeductible:!0,paymentFrequency:["Yearly","Half-yearly","Quarterly","Monthly"],premiumPayingTerm:"Regular pay: Same as Policy Term; Limited pay: 5/ 10yrs",E2EName:"TATA AIA",BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/iRaksha-supreme.pdf",originalSupplierId:2,topTwoRiderCategoryId:[{categoryId:12,riderId:202,riderPriority:10}],newCoverageUpto:58,newBasicPremium:7788,PlanAnnualIncome:0,StandardlPremium:7788,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:688,halfYearlyTotalPremium:3972,quarterlyTotalPremium:2025,monthlyTotalPremium:688,CityID:1,annualPremiumGST:1188,annualPremiumWGST:6600,monthlyPremiumGST:104.90039999999999,monthlyPremiumWGST:582.78,halfYearlyPremiumGST:605.88,halfYearlyPremiumWGST:3366,quarterlyPremiumGST:308.88,quarterlyPremiumWGST:1716,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!1,allMonthlyPremium:688,excludeFromMonthlySorting:0,allTotalPremium:7788,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:7788,ComboTotalCover:1e7,CostPerLac:77,isQuotesVisible:!0,riderPremiumObject:[{name:"Disability due to accident",categoryId:12,sortValue:5,premium:118,monthlyPremium:11,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:10,$$hashKey:"object:4008",isSecondary:!1,sumAssured:5e4,riderId:202,notAvailable:!1,doNotPopFromObject:!1},{name:"Critical illness",categoryId:11,sortValue:3,premium:2357,monthlyPremium:208,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4009",isSecondary:!1,sumAssured:5e5,riderId:15899,notAvailable:!1,doNotPopFromObject:!1},{name:"Pay for 10 years",isSelected:!0,hasRiderStatus:"Available",checked:!0,inBuildAddOn:!1,isDefaultAdded:!1,isHiddenOnMobile:!0,$$hashKey:"object:4010",isSecondary:!1,isClicked:!0,notAvailable:!1,doNotPopFromObject:!1}],featuresObject:[{title:"Option to pay for 5 years and get coverage upto 60 years",description:""},{title:"Double your life cover in 20 years",description:""}],ridersToShowCount:0,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},visibleDependencyAddOnPremiums:{},visibleDependencyCategoryIds:[]},defaultRiderObject:[{categoryId:12,riderPremium:118,monthlyRiderPremium:11,halfYearlyRiderPremium:60,quarterlyRiderPremium:31,annualPremiumGST:18,annualPremiumWGST:100,monthlyPremiumGST:1.5894,monthlyPremiumWGST:8.83,halfYearlyPremiumGST:9.18,halfYearlyPremiumWGST:51,quarterlyPremiumGST:4.68,quarterlyPremiumWGST:26,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:202,planId:814,minSumAssured:5e4,maxSumAssured:2147483647,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isPolicyTermPresent:!1,riderName:"Accidental Death and Dismemberment",isRider:!0,brochureLink:"",isDefaultSelected:!1,brochureLink_old:"",supplierId:22,defaultSumAssured:5e4,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:5e4},{categoryId:11,riderPremium:2357,monthlyRiderPremium:208,halfYearlyRiderPremium:1226,quarterlyRiderPremium:625,annualPremiumGST:359.5275,annualPremiumWGST:1997.375,monthlyPremiumGST:31.74627825,monthlyPremiumWGST:176.3682125,halfYearlyPremiumGST:186.9543,halfYearlyPremiumWGST:1038.635,quarterlyPremiumGST:95.2747875,quarterlyPremiumWGST:529.304375,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,supplierId:22,minSumAssured:5e5,defaultSumAssured:5e5,maxSumAssured:5e6,isSumAssuredPresent:!0,sumAssuredInterval:1e6,minPolicyTerm:10,defaultPolicyTerm:10,maxPolicyTerm:30,policyTermInterval:5,policyTermValues:[10,15,20,25,30],isPolicyTermPresent:!0,riderName:"Critical Illness Cover ",isRider:!0,brochureLink:"",isDefaultSelected:!1,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:5e5}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:7670,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/PNB MetLife_Mera_Term_Plan1.pdf",Claims_Settled:"91.1",E2ESupplier:"PNBMetlife",FinalPremium:7670,MedicalNeeded:"Yes",OneTimePayout:1e7,PlanAnnualIncomeTerm:"",PlanAnnualIncomeMonth:"",Plan_Category:["40","10","11","12","16","18","13"],Plan_Id:749,Plan_Name:"Mera Term Plan-Full Lumpsum payout",PolicyTerm:42,Priority:80,SumAssured:1e7,Supplier_Id:31,Supplier_Name:"PNB_Metlife",TotalCover:1e7,TotalPremium:7670,isE2E:!1,orgSumassured:1e7,planShortName:"Mera Term Plan",tATData:"16",NPVValue:1e7,planProfile:"SNW",maxCoverageAge:99,monthlyIncome:0,maxTotalPremium:7670,riderIdCategory:[{riderId:228,catrgoryId:14},{riderId:66,catrgoryId:10},{riderId:67,catrgoryId:12},{riderId:81,catrgoryId:11},{riderId:81,catrgoryId:16},{riderId:183,catrgoryId:13},{riderId:227,catrgoryId:17},{riderId:229,catrgoryId:18}],ridersPremium:[],isServiceCallRequired:!1,isOneTimePlan:!0,dependentRiderIds:[66,67,81],annualIncomeValidations:[{age:59,annualIncome:2e5},{age:80,annualIncome:3e5}],sumAssuredInterval:1e3,modeOfPremium:["Yearly","Monthly"],isWholeLifePlan:!0,Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:2.14000010490417,paymentFrequency:["Yearly","Monthly"],premiumPayingTerm:"Regular pay: Same as Policy term",E2EName:"PNB Metlife",BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/PNB MetLife_Mera_Term_Plan1.pdf",originalSupplierId:31,topTwoRiderCategoryId:[{categoryId:11,riderId:68,riderPriority:10},{categoryId:10,riderId:66,riderPriority:20}],isLowIncomePlan:!0,newCoverageUpto:60,newBasicPremium:7670,PlanAnnualIncome:0,StandardlPremium:7670,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:680,halfYearlyTotalPremium:0,quarterlyTotalPremium:0,monthlyTotalPremium:680,CityID:1,annualPremiumGST:1170,annualPremiumWGST:6500,monthlyPremiumGST:103.66199999999999,monthlyPremiumWGST:575.9,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!1,allMonthlyPremium:680,excludeFromMonthlySorting:0,allTotalPremium:7670,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:7670,ComboTotalCover:1e7,CostPerLac:76,isQuotesVisible:!0,riderPremiumObject:[{name:"Critical illness",categoryId:11,sortValue:3,premium:904,monthlyPremium:80,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:10,$$hashKey:"object:4111",isSecondary:!1,sumAssured:5e5,riderId:81,notAvailable:!1,doNotPopFromObject:!1},{name:"Death due to accident",categoryId:10,sortValue:1,premium:904,monthlyPremium:80,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:20,$$hashKey:"object:4109",isSecondary:!1,sumAssured:1e6,riderId:66,notAvailable:!1,doNotPopFromObject:!1},{name:"Disability due to accident",categoryId:12,sortValue:5,premium:177,monthlyPremium:16,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4110",isSecondary:!0,sumAssured:1e6,riderId:67,notAvailable:!1,doNotPopFromObject:!1},{name:"Heart and Cancer Cover",categoryId:18,sortValue:10,premium:3094,monthlyPremium:274,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4113",isSecondary:!0,sumAssured:1e6,riderId:229,notAvailable:!1,doNotPopFromObject:!1}],featuresObject:[{title:"Option to extend Coverage till 99 years available.",description:""},{title:"Option to get Coverage against Heart & Cancer illnesses.",description:""}],ridersToShowCount:0,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},visibleDependencyAddOnPremiums:{},visibleDependencyCategoryIds:[]},defaultRiderObject:[{categoryId:14,typeSelected:"Gold",riderPremium:0,monthlyRiderPremium:0,halfYearlyRiderPremium:1071,riderPremiumExclusiveTax:1768.8999485969543,monthlyRiderPremiumExclusiveTax:156.72453544569015,annualPremiumGST:318.40199074745175,annualPremiumWGST:1768.8999485969543,monthlyPremiumGST:28.210416380224228,monthlyPremiumWGST:156.72453544569015,halfYearlyPremiumGST:163.3720614525175,halfYearlyPremiumWGST:907.6225636250973,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:228,planId:749,supplierId:31,minSumAssured:5e5,defaultSumAssured:5e5,defaultPolicyTerm:10,defaultType:"Gold",maxSumAssured:4e6,sumAssuredInterval:1e3,isSumAssuredPresent:!0,riderType:["Gold","Platinum"],minPolicyTerm:10,maxPolicyTerm:20,policyTermInterval:5,riderName:"Cancer Care",isPolicyTermPresent:!0,isRider:!1,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/PNG/Mera Heart & Cancer care Brochure_tcm47-60489.pdf",isDefaultSelected:!1,description:"Upon diagnosis of Cancer get Lumpsum or Income Benefit.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/PNB_Cancer_Heart.pdf",policyTermSelected:10,policyTermDetails:{isPolicyTermPresent:!0,maxPolicyTerm:20,minPolicyTerm:10,policyTermInterval:5,policyTermValues:[]},errorMessage:"",sumAssured:0,riderSumAssured:0,isHidden:!0},{categoryId:10,riderPremium:904,monthlyRiderPremium:80,riderPremiumExclusiveTax:766.3,monthlyRiderPremiumExclusiveTax:67.89417999999999,annualPremiumGST:137.934,annualPremiumWGST:766.3,monthlyPremiumGST:12.220952399999998,monthlyPremiumWGST:67.89417999999999,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:66,planId:749,minSumAssured:5e5,maxSumAssured:1e7,sumAssuredInterval:1e3,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Accidental Death Benefit Rider",isPolicyTermPresent:!1,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/MetLifeAccidentalDeathBenefit_%20Rider_Plus_tcm47-27644.pdf",isDefaultSelected:!1,description:"The Accidental Death Benefit Rider covers the life insured against accidental death. 100% of the Rider Cover Amount (Sum Assured) shall be paid in case of death due to accident.",defaultSumAssured:1e6,brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/MetLifeAccidentalDeathBenefit_%20Rider_Plus_tcm47-27644.pdf",supplierId:31,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6},{categoryId:12,riderPremium:177,monthlyRiderPremium:16,riderPremiumExclusiveTax:150,monthlyRiderPremiumExclusiveTax:13.29,annualPremiumGST:27,annualPremiumWGST:150,monthlyPremiumGST:2.3922,monthlyPremiumWGST:13.29,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:67,planId:749,minSumAssured:5e5,maxSumAssured:1e7,sumAssuredInterval:1e3,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Accidental Disability",isPolicyTermPresent:!1,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/accidental_disability_rider_brochure_1115_tcm47-50869.pdf",isDefaultSelected:!1,description:"In case of disability due to an accident during the policy term, 100% of the cover amount under the rider shall be paid.",defaultSumAssured:1e6,brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/accidental_disability_rider_brochure_1115_tcm47-50869.pdf",supplierId:31,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6},{categoryId:11,riderPremium:904,monthlyRiderPremium:80,riderPremiumExclusiveTax:766.300020813942,monthlyRiderPremiumExclusiveTax:67.89418184411525,annualPremiumGST:137.93400374650955,annualPremiumWGST:766.300020813942,monthlyPremiumGST:12.220952731940745,monthlyPremiumWGST:67.89418184411525,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:81,planId:749,minSumAssured:5e5,maxSumAssured:5e6,defaultSumAssured:5e5,sumAssuredInterval:1e3,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Serious Illness",isPolicyTermPresent:!1,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/PNG/MSIR (MetLife Serious Illness Rider) Brochure - 2016 V1_tcm47-27713.pdf",isDefaultSelected:!1,description:"The Rider Cover Amount (Sum Assured) shall be paid upon survival for 30 days on diagnosis of covered Critical Illness. 10 Critical Illnesses mentioned in Brochure.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/PNG/MSIR (MetLife Serious Illness Rider) Brochure - 2016 V1_tcm47-27713.pdf",supplierId:31,policyTermSelected:30,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:30,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:5e5},{categoryId:13,riderPremium:0,monthlyRiderPremium:0,riderPremiumExclusiveTax:0,monthlyRiderPremiumExclusiveTax:0,annualPremiumGST:0,annualPremiumWGST:0,monthlyPremiumGST:0,monthlyPremiumWGST:0,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:183,planId:749,minSumAssured:-1,maxSumAssured:1e7,sumAssuredInterval:1e3,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Joint Life",isPolicyTermPresent:!1,isRider:!0,brochureLink:"",isDefaultSelected:!1,description:"Get life cover for your spouse under the same policy, In your absence the life cover will continue for your spouse with all future premiums waived off.",brochureLink_old:"",supplierId:31,policyTermSelected:42,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:42,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:0,isRiderDisabled:!0},{categoryId:17,typeSelected:"Gold",riderPremium:2093,monthlyRiderPremium:185,halfYearlyRiderPremium:1074,riderPremiumExclusiveTax:1773.7999439239502,monthlyRiderPremiumExclusiveTax:157.15867503166197,annualPremiumGST:319.28398990631104,annualPremiumWGST:1773.7999439239502,monthlyPremiumGST:28.288561505699153,monthlyPremiumWGST:157.15867503166197,halfYearlyPremiumGST:163.82461522092817,halfYearlyPremiumWGST:910.1367512273788,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:227,planId:749,supplierId:31,minSumAssured:5e5,defaultSumAssured:5e5,defaultPolicyTerm:10,defaultType:"Gold",maxSumAssured:4e6,sumAssuredInterval:1e3,isSumAssuredPresent:!0,minPolicyTerm:10,maxPolicyTerm:20,riderType:["Gold","Platinum"],policyTermInterval:5,riderName:"Heart Care",isPolicyTermPresent:!0,isRider:!1,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/PNG/Mera Heart & Cancer care Brochure_tcm47-60489.pdf",isDefaultSelected:!1,description:"Get coverage against 16 heart conditions with options to get Lump sum or  Income benefit",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/PNB_Cancer_Heart.pdf",policyTermSelected:10,policyTermDetails:{isPolicyTermPresent:!0,maxPolicyTerm:20,minPolicyTerm:10,policyTermInterval:5,policyTermValues:[]},errorMessage:"",sumAssured:5e5},{categoryId:18,riderPremiumExclusiveTax:2621.5979204654695,monthlyRiderPremiumExclusiveTax:232.27357575324058,riderPremium:3094,halfYearlyRiderPremium:1587,quarterlyRiderPremium:0,monthlyRiderPremium:274,group1RiderPremium:0,group2RiderPremium:0,wopRiderPremium:0,lumpsumRiderPremium:0,groupOneTerm:"0",groupTwoTerm:"0",errorMessage:"",riderSumAssured:1e6,annualPremiumGST:471.88762568378445,annualPremiumWGST:2621.5979204654695,monthlyPremiumGST:41.8092436355833,monthlyPremiumWGST:232.27357575324058,supplierId:31,minSumAssured:1e6,defaultSumAssured:1e6,defaultPolicyTerm:10,defaultType:"Gold",maxSumAssured:8e6,sumAssuredInterval:1e3,minPolicyTerm:10,riderType:["Gold","Platinum"],maxPolicyTerm:20,policyTermInterval:5,riderName:"Heart and Cancer Care",brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/PNG/Mera Heart & Cancer care Brochure_tcm47-60489.pdf",isDefaultSelected:!1,description:" Get coverage against 16 heart conditions & Cancer under the same plan.",premiumDiscountFlag:!0,isRider:!1,sumAssured:1e6,typeSelected:"Gold",policyTermSelected:10,policyTermDetails:{isPolicyTermPresent:!0,maxPolicyTerm:20,minPolicyTerm:10,policyTermInterval:5,policyTermValues:[]}}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:6844,isOneClickPayment:!1,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",CalculateServiceTax:null,CityID:1,Claims_Settled:"93.7",Dependency:"883",Discount:0,DisplayMore:null,E2EName:"KOTAK",E2ESupplier:"KOTAK",EnquiryID:0,FinalPremium:6844,IsLastSelected:!1,IsSelected:!1,IsSubscribe:!0,MedicalNeeded:"Yes",MinPremium:0,Mortality:0,OneTimePayout:1e7,PlanAnnualIncome:0,PlanAnnualIncomeTermYr:0,PlanAnnualIncomeTerm:"",PlanAnnualIncomeMonth:"",PlanFeature:"TP",PlanType:"TERM",Plan_Category:["8","10","11","38","22","23","25","31","32","34","40","20"],Plan_Id:883,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,Plan_Name:"e-Term",PolicyFee:0,PolicyTerm:40,PrefText:"<li> Only Term plan which offers an inbuilt Terminal illness Benefit.</li><li> Longest term of 75 years.</li><li> 4 riders to choose from. Critical Illness rider available.</li>",PremiumSorting:null,Priority:78,QuotePref:"PB Recommended",RedirectUrlForMail:null,RedirectionURL:"/life-insurance/TAegon.aspx",RenderOrder:0,ServiceTax:0,StandardlPremium:6844,SumAssured:1e7,SumassuredID:7,Supplier_FullName:"Kotak",Supplier_Id:3,Supplier_Name:"kotak",TROPPriority:0,Tcps_PlanId:"883",TermPageCounter:"",TotalCover:1e7,TotalPremium:6844,URLToBrochure:"http://documents.policybazaar.com/documents//Life-Insurance/Information/AR_iTerm_Brochure.pdf",claimsettlementRatio:93.7,comboID:0,IsE2E:!1,lstRiders:null,maxMaturityAge:75,orgSumassured:1e7,planShortName:"e-Term Life",tATData:"",NPVValue:1e7,spousePremium:0,planProfile:"N",maxCoverageAge:75,monthlyIncome:0,maxTotalPremium:6844,riderIdCategory:[{riderId:293,catrgoryId:38},{riderId:291,catrgoryId:10},{riderId:292,catrgoryId:15}],ridersPremium:[],inbuildAddOns:{10:!1,11:!1,38:!1,101:!1},isServiceCallRequired:!0,isOneTimePlan:!0,riderPremiumObject:[{name:"Waiver Of Premium",categoryId:38,sortValue:2,premium:354,monthlyPremium:31,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:10,$$hashKey:"object:4253",isSecondary:!1,sumAssured:1e7,riderId:293,notAvailable:!1,doNotPopFromObject:!1},{name:"Enhanced Critical illness",categoryId:15,sortValue:4,premium:2525,monthlyPremium:223,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,riderPriority:20,$$hashKey:"object:4252",isSecondary:!1,sumAssured:1e6,riderId:292,notAvailable:!1,doNotPopFromObject:!1},{name:"Death due to accident",categoryId:10,sortValue:1,premium:5900,monthlyPremium:519,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4251",isSecondary:!0,sumAssured:1e7,riderId:291,notAvailable:!1,doNotPopFromObject:!1},{name:"Lower your Cover Amount Option",isSelected:!1,hasRiderStatus:"Available",checked:!0,inBuildAddOn:!1,isDefaultAdded:!1,isHiddenOnMobile:!0,$$hashKey:"object:4254",isSecondary:!0,notAvailable:!1,doNotPopFromObject:!1}],modeOfPremium:["Yearly","Monthly"],isE2E:!1,BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",Free_Lookup_Period:30,paymentFrequency:["Single","Yearly","Monthly"],premiumPayingTerm:"Single pay: Single; Regular pay: Same as Policy Term; Limited pay: 5/10yrs",originalSupplierId:3,topTwoRiderCategoryId:[{categoryId:38,riderId:293,riderPriority:10},{categoryId:15,riderId:292,riderPriority:20}],newCoverageUpto:58,newBasicPremium:6844,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:602,halfYearlyTotalPremium:0,quarterlyTotalPremium:0,monthlyTotalPremium:602,annualPremiumGST:1043.999969959259,annualPremiumWGST:5799.999833106995,monthlyPremiumGST:91.87199735641478,monthlyPremiumWGST:510.39998531341547,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!1,allMonthlyPremium:602,excludeFromMonthlySorting:0,allTotalPremium:6844,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:6844,ComboTotalCover:1e7,CostPerLac:68,isQuotesVisible:!0,featuresObject:[{title:"Exclusive plan with option to reduce cover amount with age",description:""},{title:"Coverage against 37 Critical Illnesses (know more)",description:""}],ridersToShowCount:0,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},
visibleDependencyAddOnPremiums:{"[38, 10]":[{riderId:291,planId:883,supplierId:3,categoryId:10,minSumAssured:-1,maxSumAssured:2147483647,sumAssuredInterval:-1,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Accidental Death Benefit Rider",isPolicyTermPresent:!1,riderTillTotalCover:80,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",isDefaultSelected:!1,description:"This Rider covers accidental death. In case of death due to accident during the policy term, 100% of the cover amount (Sum Assured) under the rider shall be paid.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",toHideCategoryIds:[38],visibilityPriority:0,isHidden:!0}],"[38]":[{riderId:291,planId:883,supplierId:3,categoryId:10,minSumAssured:-1,maxSumAssured:2147483647,sumAssuredInterval:-1,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Accidental Death Benefit Rider",isPolicyTermPresent:!1,riderTillTotalCover:80,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",isDefaultSelected:!1,description:"This Rider covers accidental death. In case of death due to accident during the policy term, 100% of the cover amount (Sum Assured) under the rider shall be paid.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",toHideCategoryIds:[38],visibilityPriority:0,isHidden:!0}],"[10]":[{riderId:293,planId:883,supplierId:3,categoryId:38,minSumAssured:-1,maxSumAssured:2147483647,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Waiver of premium",isPolicyTermPresent:!1,riderTillTotalCover:80,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",isDefaultSelected:!1,description:"In case of total & permanent disability due sickness or accident, all future premiums are paid by the company on your behalf.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",toHideCategoryIds:[10],visibilityPriority:1,isHidden:!0}]},visibleDependencyCategoryIds:[38,10]},defaultRiderObject:[{categoryId:38,riderPremium:354,monthlyRiderPremium:31,annualPremiumGST:54.00005578994751,annualPremiumWGST:300.00030994415283,monthlyPremiumGST:4.752004909515392,monthlyPremiumWGST:26.400027275085506,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:293,planId:883,supplierId:3,minSumAssured:-1,maxSumAssured:2147483647,sumAssuredInterval:1e5,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Waiver of premium",isPolicyTermPresent:!1,riderTillTotalCover:80,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",isDefaultSelected:!1,description:"In case of total & permanent disability due sickness or accident, all future premiums are paid by the company on your behalf.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",toHideCategoryIds:[10],visibilityPriority:1,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e7,halfYearlyRiderPremium:0,quarterlyRiderPremium:0},{categoryId:10,riderPremium:5900,monthlyRiderPremium:519,annualPremiumGST:900,annualPremiumWGST:5e3,monthlyPremiumGST:79.2,monthlyPremiumWGST:440.00000000000006,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:291,planId:883,supplierId:3,minSumAssured:-1,maxSumAssured:2147483647,sumAssuredInterval:-1,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Accidental Death Benefit Rider",isPolicyTermPresent:!1,riderTillTotalCover:80,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",isDefaultSelected:!1,description:"This Rider covers accidental death. In case of death due to accident during the policy term, 100% of the cover amount (Sum Assured) under the rider shall be paid.",brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Kotak%20e-Term%20Plan%20Leaflet%20-%20Online%20Final.pdf",toHideCategoryIds:[38],visibilityPriority:0,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e7,halfYearlyRiderPremium:0,quarterlyRiderPremium:0},{categoryId:15,riderPremium:2525,monthlyRiderPremium:223,annualPremiumGST:387,annualPremiumWGST:2150,monthlyPremiumGST:34.056,monthlyPremiumWGST:189.2,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:0,quarterlyPremiumGST:0,quarterlyPremiumWGST:0,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,riderId:292,planId:883,supplierId:3,minSumAssured:25e3,maxSumAssured:2147483647,sumAssuredInterval:-1,isSumAssuredPresent:!0,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,riderName:"Enhanced Critical Illness",isPolicyTermPresent:!1,isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/Kotak%20Critical%20Illness%20Plus%20Benefit%20Rider%20Brochure.pdf",isDefaultSelected:!1,description:"If diagnosed with any of the specified 37 illnesses , a lump sum payment equal to rider sum assured is paid out.",defaultSumAssured:1e6,brochureLink_old:"http://pbstatic.policybazaar.com/Term/brochures/Rider/Kotak%20Critical%20Illness%20Plus%20Benefit%20Rider%20Brochure.pdf",numOfDiseasesCovered:37,policyTermSelected:40,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:6844,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/ABSLI-DigiShield-Plan-Brochure.pdf",Claims_Settled:"96.4",E2ESupplier:"BIRLA",FinalPremium:6844,MedicalNeeded:"Yes",Plan_Category:["8","22","23","31","34","40","37","47","101"],Plan_Id:906,Plan_Name:"ABSLI DigiShield Plan",PolicyTerm:40,Priority:50,SumAssured:1e7,Supplier_Id:41,Supplier_Name:"Birla_Sun_Life",TotalCover:1e7,TotalPremium:6844,isE2E:!1,orgSumassured:1e7,planShortName:"DigiShield Plan",tATData:"14",NPVValue:1e7,planProfile:"N",maxCoverageAge:58,monthlyIncome:0,maxTotalPremium:6844,riderIdCategory:[{riderId:328,catrgoryId:12},{riderId:329,catrgoryId:10},{riderId:330,catrgoryId:11},{riderId:331,catrgoryId:47},{riderId:332,catrgoryId:48}],ridersPremium:[],inbuildAddOns:{10:!1,11:!1,38:!1,101:!0},isServiceCallRequired:!0,isOneTimePlan:!0,annualIncomeValidations:[{age:80,annualIncome:3e5}],paymentFrequency:["Single","Yearly","HalfYearly","Quarterly","Monthly"],Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:2.11,modeOfPremium:["Yearly","Half-Yearly","Quarterly","Monthly"],premiumPayingTerm:"Single pay: Single; Regular pay: Same as Policy Term; Limited pay: 5 / 7 yrs",E2EName:"Birla Sun Life",BrochuresLink_old:"http://pbstatic.policybazaar.com/Term/brochures/BSLIProtectAtEase.pdf",originalSupplierId:4,topTwoRiderCategoryId:[{categoryId:101,riderId:-1,riderPriority:10},{categoryId:38,riderId:262,riderPriority:20}],newCoverageUpto:58,newBasicPremium:6844,OneTimePayout:1e7,PlanAnnualIncome:0,StandardlPremium:6844,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,maxAnnualReturn:0,maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:616,halfYearlyTotalPremium:3559,quarterlyTotalPremium:1814,monthlyTotalPremium:616,CityID:1,annualPremiumGST:1044,annualPremiumWGST:5800,monthlyPremiumGST:93.96,monthlyPremiumWGST:522,halfYearlyPremiumGST:542.88,halfYearlyPremiumWGST:3016,quarterlyPremiumGST:276.65999999999997,quarterlyPremiumWGST:1537,riderPremiumAdded:0,numInterestRate:0,monthlyRiderPremiumAdded:0,annualIncomeSort:!1,isRiderLoaded:!1,isRiderSelectedForMobile:!0,allMonthlyPremium:616,excludeFromMonthlySorting:0,allTotalPremium:6844,profileSort:3,ComboPlans:[],isCombo:!1,ComboTotalPremium:6844,ComboTotalCover:1e7,CostPerLac:68,isQuotesVisible:!0,riderPremiumObject:[{name:"Terminal Illness",categoryId:101,sortValue:6,premium:0,monthlyPremium:0,isSelected:!1,isDisabled:!1,isHidden:!1,isDefaultAdded:!1,inBuildAddOn:!0,isHiddenOnMobile:!0,riderPriority:10,$$hashKey:"object:4374",isSecondary:!1,notAvailable:!1,doNotPopFromObject:!1},{name:"Death due to accident",categoryId:10,sortValue:1,premium:757,monthlyPremium:68,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4370",isSecondary:!1,sumAssured:1e6,riderId:329,notAvailable:!1,doNotPopFromObject:!1},{name:"Disability due to accident",categoryId:12,sortValue:5,premium:1681,monthlyPremium:147,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4371",isSecondary:!0,sumAssured:1e6,riderId:328,notAvailable:!1,doNotPopFromObject:!1},{name:"Critical illness",categoryId:11,sortValue:3,premium:2959,monthlyPremium:266,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4372",isSecondary:!0,sumAssured:1e6,riderId:330,notAvailable:!1,doNotPopFromObject:!1},{name:"Cash for hospitalization",categoryId:47,sortValue:8,premium:8273,monthlyPremium:745,isSelected:!1,isDisabled:!1,isDefaultAdded:!1,inBuildAddOn:!1,isHiddenOnMobile:!1,$$hashKey:"object:4373",isSecondary:!0,sumAssured:1e6,riderId:331,notAvailable:!1,doNotPopFromObject:!1}],featuresObject:[{title:"Early claim on Terminal illness",description:"Incase the policyholder is diagnosed with a terminal illness the claim will be paid by the company even before his/her death"}],ridersToShowCount:1,isCompareSelected:!1,alreadyAddedForCompare:!0,dependentPremiums:{premiumDependencyCategoryIds:[],premiumDependencyAddOnPremiums:{},visibleDependencyAddOnPremiums:{"[10, 12]":[{planId:906,minSumAssured:75e3,defaultSumAssured:1e6,maxSumAssured:5e6,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Accidental Death and Disability Rider",toHideCategoryIds:[10],isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Accidental-Death-and-Disability-Rider-Brochure.pdf",isDefaultSelected:!1,description:"Rider offers coverage against both death & disability. 100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy. If disability has occurred due to an accident then a percentage of Sum Assured is paid out. This percentage depends on degree of severity of the disability.",brochureLink_old:"",categoryId:12,supplierId:41,isHidden:!0}],"[10]":[{planId:906,minSumAssured:75e3,defaultSumAssured:1e6,maxSumAssured:5e6,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Accidental Death and Disability Rider",toHideCategoryIds:[10],isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Accidental-Death-and-Disability-Rider-Brochure.pdf",isDefaultSelected:!1,description:"Rider offers coverage against both death & disability. 100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy. If disability has occurred due to an accident then a percentage of Sum Assured is paid out. This percentage depends on degree of severity of the disability.",brochureLink_old:"",categoryId:12,supplierId:41,isHidden:!0}],"[12]":[{planId:906,categoryId:10,supplierId:41,minSumAssured:1e5,defaultSumAssured:1e6,maxSumAssured:1e7,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Accidental Death Benefit Rider Plus",isRider:!0,toHideCategoryIds:[12],brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Accidental-Death-Benefit-Rider-Plus-Brochure.pdf",isDefaultSelected:!1,description:"100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy",isHidden:!0}]},visibleDependencyCategoryIds:[10,12]},defaultRiderObject:[{categoryId:12,riderPremium:1681,monthlyRiderPremium:147,halfYearlyRiderPremium:858,quarterlyRiderPremium:437,annualPremiumGST:256.49999999999994,annualPremiumWGST:1424.9999999999998,monthlyPremiumGST:22.443749999999994,monthlyPremiumWGST:124.68749999999997,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:130.81499999999997,quarterlyPremiumGST:66.68999999999998,quarterlyPremiumWGST:370.49999999999994,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6,planId:906,minSumAssured:75e3,defaultSumAssured:1e6,maxSumAssured:5e6,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Accidental Death and Disability Rider",toHideCategoryIds:[10],isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Accidental-Death-and-Disability-Rider-Brochure.pdf",isDefaultSelected:!1,description:"Rider offers coverage against both death & disability. 100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy. If disability has occurred due to an accident then a percentage of Sum Assured is paid out. This percentage depends on degree of severity of the disability.",brochureLink_old:"",supplierId:41,riderSumAssured:1e6},{categoryId:10,riderPremium:757,monthlyRiderPremium:68,halfYearlyRiderPremium:393,quarterlyRiderPremium:201,annualPremiumGST:115.425,annualPremiumWGST:641.25,monthlyPremiumGST:10.38825,monthlyPremiumWGST:57.7125,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:60.020999999999994,quarterlyPremiumGST:30.587625,quarterlyPremiumWGST:169.93125,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6,planId:906,supplierId:41,minSumAssured:1e5,defaultSumAssured:1e6,maxSumAssured:1e7,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Accidental Death Benefit Rider Plus",isRider:!0,toHideCategoryIds:[12],brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Accidental-Death-Benefit-Rider-Plus-Brochure.pdf",isDefaultSelected:!1,description:"100% of the rider cover is paid out in case of accidental death of life insured during tenure of the policy",riderSumAssured:1e6},{categoryId:11,riderPremium:2959,monthlyRiderPremium:266,halfYearlyRiderPremium:1539,quarterlyRiderPremium:784,annualPremiumGST:451.4400179386139,annualPremiumWGST:2508.000099658966,monthlyPremiumGST:40.62960161447525,monthlyPremiumWGST:225.72000896930695,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:234.7488093280792,quarterlyPremiumGST:119.63160475373267,quarterlyPremiumWGST:664.620026409626,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6,planId:906,defaultSumAssured:1e6,minSumAssured:75e3,maxSumAssured:5e6,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Critical illness Rider",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Critical-Illness-Rider-Brochure.pdf",isDefaultSelected:!1,description:"The plan covers 4 critical illnesses, 100% of rider cover is paid out if life insured survives for 30 days upon diagnosis of any of the specified critical illnesses. 4 Critical Illnesses covered are: 1. First Heart Attack 2. Cancer of a particular severity 3. Stroke which results In Permanent Symptoms   4. Organ or Bone Marrow Transplant",brochureLink_old:"",numOfDiseasesCovered:4,supplierId:41,riderSumAssured:1e6},{categoryId:47,riderPremium:8273,monthlyRiderPremium:745,halfYearlyRiderPremium:4302,quarterlyRiderPremium:2192,annualPremiumGST:1261.9800195693967,annualPremiumWGST:7011.000108718871,monthlyPremiumGST:113.57820176124571,monthlyPremiumWGST:630.9900097846984,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:656.2296101760863,quarterlyPremiumGST:334.42470518589016,quarterlyPremiumWGST:1857.9150288105009,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6,planId:906,defaultSumAssured:1e6,minSumAssured:15e4,maxSumAssured:15e5,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Hospital Care Rider",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Hospital-Care-Rider-Brochure.pdf",isDefaultSelected:!1,description:"Incase life insured is hospitalized for a minimum 24 hrs , A daily benefit shall be paid for each day of hospitalization. The rider Sum Assured is 250 times the daily benefit, Min daily benefit: Rs 600 & Max Daily benefit: Rs 6000. An additional 15 days of daily benefit is payable if admitted to ICU.",brochureLink_old:"",supplierId:41,riderSumAssured:1e6},{categoryId:48,riderPremium:6984,monthlyRiderPremium:629,halfYearlyRiderPremium:3632,quarterlyRiderPremium:1851,annualPremiumGST:1065.330003261566,annualPremiumWGST:5918.500018119811,monthlyPremiumGST:95.87970029354094,monthlyPremiumWGST:532.665001630783,halfYearlyPremiumGST:0,halfYearlyPremiumWGST:553.9716016960143,quarterlyPremiumGST:282.312450864315,quarterlyPremiumWGST:1568.40250480175,monthlyGroupOnePremium:0,monthlyGroupTwoPremium:0,halfYearlyGroupOnePremium:0,halfYearlyGroupTwoPremium:0,policyTermDetails:{isPolicyTermPresent:!1,maxPolicyTerm:40,minPolicyTerm:-1,policyTermInterval:-1,policyTermValues:[]},errorMessage:"",sumAssured:1e6,planId:906,supplierId:41,defaultSumAssured:1e6,minSumAssured:15e4,maxSumAssured:15e5,sumAssuredInterval:1e3,minPolicyTerm:-1,maxPolicyTerm:-1,policyTermInterval:-1,isSumAssuredPresent:!0,isPolicyTermPresent:!1,riderName:"Surgical Care Rider",isRider:!0,brochureLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/Rider/ABSLI-Surgical-Care-Rider-Brochure.pdf",isDefaultSelected:!1,description:"Incase life insured is hospitalized for undergoing medically necessary in India for a minimum 24 hrs , A lump sum benefit shall be paid. The rider Sum Assured is 50 times this benefit amount, Min benefit amount: Rs 3,000 & Max benefit amount: Rs 30,000.",brochureLink_old:"",riderSumAssured:1e6}],selectedRiderIds:[]},{isDummyPlan:!0,BasicPremium:5912,BrochuresLink:"https://s3.ap-south-1.amazonaws.com/termstatic/Term/brochures/ET_Zindagi_Plus_Brochure.pdf",isOneClickPayment:!1,Claims_Settled:"95.2",E2ESupplier:"ET",FinalPremium:5912,MedicalNeeded:"Yes",OneTimePayout:1e7,PlanAnnualIncomeTerm:"",PlanAnnualIncomeMonth:"",Plan_Category:["8","10","12","38","22","23","31","34","40","20"],Plan_Id:911,Plan_Name:"Zindagi Plus+ Lump sum",PolicyTerm:39,Priority:0,SumAssured:1e7,Supplier_Id:1124,Supplier_Name:"Edelweiss_Tokio_Zindagi_Plus",TotalCover:1e7,TotalPremium:5912,isE2E:!1,orgSumassured:1e7,planShortName:"Zindagi +",tATData:"27",NPVValue:1e7,maxCoverageAge:80,monthlyIncome:0,maxTotalPremium:5912,riderIdCategory:[{riderId:345,catrgoryId:10},{riderId:346,catrgoryId:12},{riderId:347,catrgoryId:38},{riderId:348,catrgoryId:13},{riderId:349,catrgoryId:47},{riderId:350,catrgoryId:15}],ridersPremium:[],annualIncomeValidations:[{age:35,annualIncome:35e4},{age:60,annualIncome:5e5}],isServiceCallRequired:!0,payOutLabel:"One Time Lumpsum Plan",isOneTimePlan:!0,minimumPremium:3e3,E2EName:"Edelweiss Tokio",modeOfPremium:["Yearly","Half-Yearly","Quarterly","Monthly"],paymentFrequency:["Yearly","Half-Yearly","Quarterly","Monthly"],Home_Medicals:1,Free_Lookup_Period:30,Solvency_Ratio:2.29,premiumPayingTerm:"Regular pay: Same as Policy Term; Limited pay:  Pay till age 60 yrs",originalSupplierId:24,topTwoRiderCategoryId:[{categoryId:38,riderId:126,riderPriority:10},{categoryId:15,riderId:127,riderPriority:20}],isLevelMonthlyPlan:!0,isQuotesVisible:!0,planProfile:"SNW",minimumAnnualPremium:3e3,onlineDiscount:1,newCoverageUpto:60,newBasicPremium:5912,PlanAnnualIncome:0,StandardlPremium:5912,spouseDisplayTerm:"",spouseOneTimePayout:0,spouseMonthlyPayout:0,spouseTotalCover:0,spousePremium:0,maxAnnualReturn:"0",maxOneTimePayout:1e7,maxTotalCover:1e7,maxDisplayTerm:"",maxSumAssured:1e7,maxHalfYearlyTotalPremium:0,maxQuarterlyTotalPremium:0,maxMonthlyTotalPremium:520,halfYearlyTotalPremium:3027,quarterlyTotalPremium:1537,monthlyTotalPremium:520,CityID:1,annualPremiumGST:901.7999768257141,annualPremiumWGST:5009.999871253967,monthlyPremiumGST:79.35839796066284,monthlyPremiumWGST:440.8799886703491,halfYearlyPremiumGST:461.7215881347656,halfYearlyPremiumWGST:2565.1199340820312,quarterlyPremiumGST:234.46799397468567,quarterlyPremiumWGST:1302.5999665260315,annualOfflinePremium:7055,halfYearlyOfflinePremium:3612,quarterlyOfflinePremium:1834,monthlyOfflinePremium:621}],this.populateDummyPlans=function(){var deferred=$q.defer();return deferred.resolve(this.dummyPlansData),deferred.promise},that.callMultipleTimes=function(){return!1},this.assignCustomerEligibility=function(plans,eligibilityData,isMonthly){var objKey=isMonthly?"Plan_Id":"Supplier_Id";return angular.forEach(plans,function(plan,key){plan.isCustomerEligible=eligibilityData[plan[objKey]],void 0==plan.isCustomerEligible&&(plan.isCustomerEligible=void 0==eligibilityData[plan.originalSupplierId]||isMonthly?"NA":eligibilityData[plan.originalSupplierId])}),plans},this.showStarOnPlan=function(plan,isNri){return plan.Priority>0||1124===plan.Supplier_Id&&!isNri},this.showNriPlansSeperation=function(plans,isNonTropPlanVisible){var planIdentified;return _.each(plans,function(plan,index){!isNonTropPlanVisible(plan)||planIdentified||plan.Priority||(plan.firstNonNriPlan=!0,planIdentified=!0)}),plans},this.assignMedicalInfo=function(plans,medicalData,isAffiliates){return _.each(plans,function(plan){plan.MedicalNeeded=medicalData[plan.Plan_Id]||"Yes",plan.MedicalResolved=!0,isAffiliates&&(plan.MedicalNeeded="affiliate")}),plans},this.nriPlansSeperationMessage="Below plans are not available outside India",this}]),app.service("RiderService",["$rootScope","ServerUtilityService","GenericService","CommonServiceTerm","$cookies","$q",function($rootScope,ServerUtilityService,GenericService,CommonServiceTerm,$cookies,$q){"use strict";function manupulateRiderResponse(quote,categoryIdList){var planId=quote.Plan_Id||quote.planId;return _.each(categoryIdList,function(resRider){resRider&&GenericService.hideAParticularRider(resRider.categoryId,planId,quote)&&(resRider.riderPremium=0,resRider.monthlyRiderPremium=0,resRider.riderSumAssured=0,resRider.sumAssured=0,resRider.isHidden=!0)}),categoryIdList}function selectTerminalIllness(quote,selectedRiders){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id);return!(!(selectedRiders&&selectedRiders.length>0&&isDHFLPlan&&selectedRiders.indexOf(101)==-1)||selectedRiders.indexOf(10)==-1&&selectedRiders.indexOf(15)==-1)}function fakeRiderAddition(quote,selectedRiders){return 891===quote.Plan_Id&&(quote.preservedComboTotalPremium=quote.totalAnnualPremium||quote.ComboTotalPremium,quote.PreservedMonthlyTotalPremium=quote.totalMonthlyPremium||quote.monthlyTotalPremium,selectedRiders.indexOf(12)>-1&&selectedRiders.indexOf(10)===-1?(quote.ComboTotalPremium=quote.totalAnnualPremiumATPD||quote.ComboTotalPremium,quote.monthlyTotalPremium=quote.totalMonthlyPremiumATPD||quote.monthlyTotalPremium):selectedRiders.indexOf(10)>-1&&selectedRiders.indexOf(12)===-1?(quote.ComboTotalPremium=quote.totalAnnualPremiumADB||quote.ComboTotalPremium,quote.monthlyTotalPremium=quote.totalMonthlyPremiumADB||quote.monthlyTotalPremium):selectedRiders.indexOf(10)>-1&&selectedRiders.indexOf(12)>-1?(quote.ComboTotalPremium=quote.totalAnnualPremiumAllRiders||quote.ComboTotalPremium,quote.monthlyTotalPremium=quote.totalMonthlyPremiumAllRiders||quote.monthlyTotalPremium):(quote.ComboTotalPremium=quote.preservedComboTotalPremium,quote.monthlyTotalPremium=quote.PreservedMonthlyTotalPremium)),quote}function doNotAddPremium(planId,selectedRiders,categoryId){return!!(CommonServiceTerm.isAegonItermPlusPlan(planId)&&11==categoryId&&selectedRiders.indexOf(15)>-1)||(!(!CommonServiceTerm.isAegonItermPlusPlan(planId)||10!=categoryId||!(selectedRiders.indexOf(15)>-1||selectedRiders.indexOf(11)>-1))||(890===planId&&15===categoryId||891===planId&&(10===categoryId||12===categoryId)))}var riderPremiumUrl="/api/quotes/wrapper/addons",_self=this,allSupplierIds=termConfigObj.getAllSupplierIds();return _self.getCategoryIdList=function(quote){var categoryList=[],categoryListLength=quote.riderIdCategory?quote.riderIdCategory.length:0;if(categoryListLength>0)for(var i=0;i<=categoryListLength;i++)"undefined"!=typeof quote.riderIdCategory[i]&&categoryList.push({categoryId:quote.riderIdCategory[i].catrgoryId});return categoryList},_self.buildAddOnRequestList=function(quotes,custInfo){var arr=[];return allSupplierIds.forEach(function(supplierId){var obj={};obj[supplierId]={supplierId:supplierId,planIdSAList:[]};for(var i=0;i<=quotes.length;i++)"undefined"!=typeof quotes[i]&&quotes[i].Supplier_Id===supplierId&&(obj[supplierId].supplierTag=quotes[i].E2ESupplier,obj[supplierId].term=obj[supplierId].term||quotes[i].PolicyTerm,obj[supplierId].ppt="LimitedPay"===quotes[i].payOptionType?quotes[i].ppt:"SinglePay"===quotes[i].payOptionType?1:quotes[i].PolicyTerm,obj[supplierId].stateId=custInfo.stateId,$rootScope.profile.spouse&&custInfo.spouse&&"undefined"!=typeof custInfo.spouse.age&&(obj[supplierId].spouse=custInfo.spouse),obj[supplierId].payOptionType=quotes[i].payOptionType,obj[supplierId].planIdSAList.push({planId:quotes[i].Plan_Id,basePremium:10===supplierId?quotes[i].annualPremiumWGST:quotes[i].maxTotalPremium,annualPremiumGST:quotes[i].annualPremiumGST,annualPremiumWGST:quotes[i].annualPremiumWGST,planSumAssured:quotes[i].SumAssured,categoryIdList:_self.getCategoryIdList(quotes[i]),halfYearlyPremium:quotes[i].halfYearlyPremium,quarterlyPremium:quotes[i].quarterlyPremium,monthlyPremium:quotes[i].monthlyTotalPremium,monthlyPremiumGST:quotes[i].monthlyPremiumGST,monthlyPremiumWGST:quotes[i].monthlyPremiumWGST,halfYearlyPremiumGST:quotes[i].halfYearlyPremiumGST,halfYearlyPremiumWGST:quotes[i].halfYearlyPremiumWGST,quarterlyPremiumGST:quotes[i].quarterlyPremiumGST,quarterlyPremiumWGST:quotes[i].quarterlyPremiumWGST}),818==quotes[i].Plan_Id&&[819,820,821].forEach(function(val){var tempQuote=angular.copy(quotes[i]);tempQuote=GenericService.modifyAegonItermPlusPlanDetails(tempQuote,val),tempQuote.riderIdCategory&&tempQuote.riderIdCategory.length>0&&tempQuote.isQuotesVisible&&obj[supplierId].planIdSAList.push({planId:tempQuote.Plan_Id,basePremium:tempQuote.maxTotalPremium,planSumAssured:tempQuote.SumAssured,categoryIdList:_self.getCategoryIdList(tempQuote),annualPremiumWGST:tempQuote.annualPremiumWGST})}),1124!=quotes[i].Supplier_Id||$rootScope.profile.spouse||(obj[supplierId].spouse={age:custInfo.spouse&&custInfo.spouse.age?custInfo.spouse.age:custInfo.customerAge,isWorking:custInfo.spouse&&custInfo.spouse.isWorking?custInfo.spouse.isWorking:0,tobacco:custInfo.spouse&&custInfo.spouse.tobacco?custInfo.spouse.tobacco:0}));obj[supplierId].planIdSAList.length&&arr.push(obj[supplierId])}),arr},_self.buildRiderRequest=function(quotes,custInfo){var obj={age:custInfo.customerAge,gender:custInfo.gender,tobacco:custInfo.isTobaccoUser,addOnRequestList:[]};return obj.addOnRequestList=_self.buildAddOnRequestList(quotes,custInfo),obj},_self.getRidersPremium=function(quotes,custInfo){var request=_self.buildRiderRequest(quotes,custInfo);return ServerUtilityService.postWebService(riderPremiumUrl,request).success(function(data,status,headers,config){return data}).error(function(data,status,headers,config){})},_self.formatRiderPremiumResponse=function(data){for(var response={},i=0;i<=data.length;i++)if("undefined"!=typeof data[i]&&"undefined"!=typeof data[i].planIdSAList)for(var j=0;j<=data[i].planIdSAList.length;j++)"undefined"!=typeof data[i].planIdSAList[j]&&(response[data[i].planIdSAList[j].planId]=data[i].planIdSAList[j]);return response},_self.assignRiderPremiums=function(quote,response,quotesObj){var isDHFLPlan=CommonServiceTerm.isDHFLPlan(quote.Plan_Id),adbPremium=(CommonServiceTerm.isPNBPlan(quote.Plan_Id),{riderPremium:0,monthlyRiderPremium:0}),ciPremium={riderPremium:0,monthlyRiderPremium:0},resp=response[quote.Plan_Id];return resp&&(resp.categoryIdList=manupulateRiderResponse(quote,resp.categoryIdList),quote.dependentPremiums=angular.copy(resp.dependentPremiums),quote.defaultRiderObject=angular.copy(resp.categoryIdList),_.each(quote.riderPremiumObject,function(rider){_.each(resp.categoryIdList,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured||resRider.sumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium),isDHFLPlan&&1*resRider.categoryId==10&&(adbPremium.riderPremium+=resRider.riderPremium,adbPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium),isDHFLPlan&&1*resRider.categoryId==15&&(ciPremium.riderPremium+=resRider.riderPremium,ciPremium.monthlyRiderPremium+=resRider.monthlyRiderPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,quotesObj.isMonthly)}),isDHFLPlan&&110==rider.categoryId&&(rider.premium="LimitedPay"===quote.payOptionType?0:adbPremium.riderPremium+ciPremium.riderPremium,rider.monthlyPremium="LimitedPay"===quote.payOptionType?0:adbPremium.monthlyRiderPremium+ciPremium.monthlyRiderPremium)})),818==quote.Plan_Id&&(quote.defaultRiderObject_818=response[818]?angular.copy(response[818].categoryIdList):[],quote.defaultRiderObject_819=response[819]?angular.copy(response[819].categoryIdList):[],quote.defaultRiderObject_820=response[820]?angular.copy(response[820].categoryIdList):[],quote.defaultRiderObject_821=response[821]?angular.copy(response[821].categoryIdList):[],quote.adbObj={818:{premium:0,monthlyPremium:0,sumAssured:0},819:{premium:0,monthlyPremium:0,sumAssured:0}},_.each(quote.riderPremiumObject,function(rider){_.each(response[818].categoryIdList,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId==10&&(quote.adbObj[818].premium=resRider.riderPremium,
quote.adbObj[818].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[818].riderSumAssured=resRider.riderSumAssured,quote.adbObj[818].sumAssured=resRider.sumAssured)}),response[819]&&_.each(response[819].categoryIdList,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId!=38&&(quote.adbObj[819].premium=resRider.riderPremium,quote.adbObj[819].monthlyRiderPremium=resRider.monthlyRiderPremium,quote.adbObj[819].riderSumAssured=resRider.riderSumAssured,quote.adbObj[819].sumAssured=resRider.sumAssured),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,quotesObj.isMonthly)}),response[820]&&_.each(response[820].categoryIdList,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId!=38&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured||resRider.sumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,quotesObj.isMonthly)}),response[821]&&_.each(response[821].categoryIdList,function(resRider){resRider&&1*rider.categoryId===1*resRider.categoryId&&1*rider.categoryId!=38&&(rider.premium=resRider.riderPremium,rider.monthlyPremium=resRider.monthlyRiderPremium,rider.sumAssured=resRider.riderSumAssured||resRider.sumAssured,rider.riderId=resRider.riderId,rider.isDefaultAdded&&(quote.riderPremiumAdded=quote.riderPremiumAdded+rider.premium,quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+rider.monthlyPremium)),rider.isHiddenOnMobile=GenericService.hideRiderOnMobile(rider,quote,quotesObj.isMonthly)})})),891===quote.Plan_Id&&resp&&(quote.totalAnnualPremium=resp.totalAnnualPremium,quote.totalMonthlyPremium=resp.totalMonthlyPremium,quote.totalAnnualPremiumAllRiders=resp.totalAnnualPremiumAllRiders,quote.totalMonthlyPremiumAllRiders=resp.totalMonthlyPremiumAllRiders,quote.totalAnnualPremiumADB=resp.totalAnnualPremiumADB,quote.totalMonthlyPremiumADB=resp.totalMonthlyPremiumADB,quote.totalAnnualPremiumATPD=resp.totalAnnualPremiumATPD,quote.totalMonthlyPremiumATPD=resp.totalMonthlyPremiumATPD),quote.isRiderLoaded=!0,quote},_self.isRiderDefaultAdded=function(quote,rider){return(!CommonServiceTerm.isDHFLPlan(quote.Plan_Id)||101!=rider.categoryId)&&(819==quote.Plan_Id&&10==rider.categoryId||rider.isDefaultAdded)},_self.getAllTotalPremium=function(quote){return $rootScope.pTabName.allPlans?quote.allTotalPremium=quote.maxTotalPremium:$rootScope.pTabName.onetimePlans||$rootScope.pTabName.tropPlans?quote.allTotalPremium=quote.TotalPremium:quote.allTotalPremium=quote.maxTotalPremium,quote},_self.addRiderValues=function(quotes,selectedRiders,isMonthly,modifySelection,enquiryId){var deferred=$q.defer(),onlyTiSelected=!(!selectedRiders||1!=selectedRiders.length||selectedRiders.indexOf(101)==-1);return _.each(quotes,function(quote){var selectedRidersArray=angular.copy(selectedRiders),premiumDependencySelectedCategoryIds=[],visibleDependencySelectedCategoryIds=[];CommonServiceTerm.isAegonItermPlusPlan(quote.Plan_Id)&&(quote=GenericService.modifyAegonItermPlusPlanDetails(quote,quote.Plan_Id,selectedRidersArray)),quote=_self.getAllTotalPremium(quote),quote.riderPremiumAdded=0,quote.monthlyRiderPremiumAdded=0,quote.selectedRiderIds=[],selectTerminalIllness(quote,selectedRidersArray)&&selectedRidersArray.push(101),quote.dependentPremiums&&quote.dependentPremiums.premiumDependencyCategoryIds&&_.each(quote.dependentPremiums.premiumDependencyCategoryIds,function(dependentCategoryId){selectedRidersArray.indexOf(dependentCategoryId)!=-1&&premiumDependencySelectedCategoryIds.push(dependentCategoryId)}),quote.dependentPremiums&&quote.dependentPremiums.visibleDependencyCategoryIds&&_.each(quote.dependentPremiums.visibleDependencyCategoryIds,function(dependentCategoryId){selectedRidersArray.indexOf(dependentCategoryId)!=-1&&visibleDependencySelectedCategoryIds.push(dependentCategoryId)}),_.each(quote.riderPremiumObject,function(eachRider){889==quote.Plan_Id&&20==eachRider.categoryId&&(eachRider.categoryId=15),eachRider.doNotPopFromObject=!1,_.each(quote.defaultRiderObject,function(defaultRider){1*eachRider.categoryId===1*defaultRider.categoryId&&(eachRider.premium=defaultRider.riderPremium,eachRider.monthlyPremium=defaultRider.monthlyRiderPremium,eachRider.riderId=defaultRider.riderId,eachRider.isHidden=defaultRider.isHidden)}),quote.dependentPremiums&&(_.each(quote.dependentPremiums.premiumDependencyAddOnPremiums,function(resRider,key){key.replace(/\s|\[|\]/g,"")===premiumDependencySelectedCategoryIds.toString()&&_.each(resRider,function(dependentRider){1*eachRider.categoryId===1*dependentRider.categoryId&&(eachRider.premium=dependentRider.riderPremium,eachRider.monthlyPremium=dependentRider.monthlyRiderPremium,eachRider.riderId=dependentRider.riderId)})}),_.each(quote.dependentPremiums.visibleDependencyAddOnPremiums,function(resRider,key){key.replace(/\s|\[|\]/g,"")===visibleDependencySelectedCategoryIds.toString()&&_.each(resRider,function(dependentRider){1*eachRider.categoryId===1*dependentRider.categoryId&&(eachRider.premium=dependentRider.riderPremium,eachRider.monthlyPremium=dependentRider.monthlyRiderPremium,eachRider.riderId=dependentRider.riderId,dependentRider.isHidden&&(eachRider.premium=0,eachRider.monthlyPremium=0,eachRider.doNotPopFromObject=!0))})})),"undefined"==typeof eachRider.riderId&&_.each(quote.riderIdCategory,function(planRiderIdCategory){eachRider.categoryId===planRiderIdCategory.catrgoryId&&(eachRider.riderId=angular.copy(planRiderIdCategory.riderId))}),!(selectedRidersArray.indexOf(1*eachRider.categoryId)>-1||_self.isRiderDefaultAdded(quote,eachRider))||CommonServiceTerm.isDHFLPlan(quote.Plan_Id)&&onlyTiSelected||(eachRider.premium>0&&!doNotAddPremium(quote.Plan_Id,selectedRidersArray,1*eachRider.categoryId)&&(quote.riderPremiumAdded=quote.riderPremiumAdded+eachRider.premium),eachRider.monthlyPremium>0&&!doNotAddPremium(quote.Plan_Id,selectedRidersArray,1*eachRider.categoryId)&&(quote.monthlyRiderPremiumAdded=quote.monthlyRiderPremiumAdded+eachRider.monthlyPremium),eachRider.premium>0&&!doNotAddPremium(quote.Plan_Id,selectedRidersArray,1*eachRider.categoryId)&&quote.selectedRiderIds.push(eachRider.riderId),CommonServiceTerm.isAegonItermPlusPlan(quote.Plan_Id)&&(selectedRidersArray.indexOf(15)>-1?quote.enhancedCiSelected=!0:quote.enhancedCiSelected=!1,selectedRidersArray.indexOf(11)>-1?quote.basicCiSelected=!0:quote.basicCiSelected=!1)),quote=fakeRiderAddition(quote,selectedRiders)})}),deferred.resolve(quotes),deferred.promise},this}]),app.directive("typeahead",["$compile","$timeout",function($compile,$timeout){return{restrict:"A",transclude:!0,scope:{ngModel:"=",typeahead:"=",typeaheadCallback:"="},link:function(scope,elem,attrs){var template='<div class="dropdown"><ul class="dropdown-menu" style="display:block;" ng-hide="!ngModel.length || !filitered.length || selected"><li ng-repeat="item in filitered = (typeahead | filter:{name:ngModel} | limitTo:5) track by $index" style="cursor:pointer" ng-class="{active:$index==active}" ng-mouseenter="mouseenter($index)" data-ng-click="selectItem(item)"><a>{{item.name}}</a></li></ul></div>';elem.bind("blur",function(){$timeout(function(){scope.selected=!0},200)}),elem.bind("keydown",function($event){38==$event.keyCode&&scope.active>0?(scope.active--,scope.$digest()):40==$event.keyCode&&scope.active<scope.filitered.length-1?(scope.active++,scope.$digest()):13==$event.keyCode&&scope.$apply(function(){scope.selectItem(scope.filitered[scope.active])})}),scope.selectItem=function(item){var str=item.name;if(str){var ind=str.indexOf("(");if(ind>-1){var s=str.substring(0,ind);item.name=s.trim()}}scope.ngModel=item.name,scope.selected=item,scope.typeaheadCallback&&scope.typeaheadCallback(item),elem[0].blur()},scope.mouseenter=function($index){scope.active=$index},scope.$watch("ngModel",function(input){scope.selected&&scope.selected.name==input||(scope.active=0,scope.selected=!1,input&&angular.isDefined(scope.filitered)&&1==scope.filitered.length&&scope.filitered[0].name.toLowerCase()==input.toLowerCase()&&scope.selectItem(scope.filitered[0]))}),elem.after($compile(template)(scope))}}}]),app.directive("focusMe",["$timeout","$parse",function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.focusMe);scope.$watch(model,function(value){value===!0&&$timeout(function(){element[0].focus()})}),element.bind("blur",function(){scope.$apply(model.assign(scope,!1))})}}}]),app.directive("exitIntentModal",["$timeout","$rootScope","$cookies",function($timeout,$rootScope,$cookies){return{scope:{show:"="},link:function(scope,elem,attrs){scope.custInfo={mobileNumber:null};var visitId=$cookies.get("Cookie_VisitLog"),alreadyAsked=!1;document.addEventListener("mouseleave",function(e){if(e.clientY<0&&(alreadyAsked=$cookies.get("exitintentasked"),"true"!=alreadyAsked&&scope.show&&!$rootScope.isMobileDevice&&"landingnew"===$rootScope.pageClass)){$("#exitIntentModal").modal("show");var expireDate=new Date;expireDate.setDate(expireDate.getDate()+1),$cookies.put("exitintentasked",!0,{expires:expireDate}),pbTrackerObj.logEvent({event:"exit_intent_modal_show",pageName:"PQ1",visitId:1*visitId})}},!1)}}}]),app.directive("keyboardEnter",["$document",function($document){return{require:"ngModel",link:function(scope,elem,attr,ctrl){elem.bind("keyup",function(event){var keycode=event.which?event.which:event.keyCode;if(13==keycode){var tag="";"modifySelection.policyCoverage"==attr.ngModel?tag="payTerm":"modifySelection.totalPayout"==attr.ngModel?tag="totalPayout":"modifySelection.monthlyIncome"==attr.ngModel&&(tag="monthly"),scope.isQuotesInputValid()&&(scope.saveCustomerSelection(tag),scope.handlePayoutFocusBlur("isReadable"),scope.handleMonthlyIncomeFocusBlur("isReadable"),scope.handlePolicyDurationFocusBlur("isReadable"))}})}}}]),app.directive("validSubmit",["$parse",function($parse){return{compile:function(tElement,tAttrs,transclude){return{post:function(scope,element,iAttrs,controller){var form=element.controller("form");form.$submitted=!1;var fn=$parse(iAttrs.validSubmit);element.on("submit",function(event){scope.$apply(function(){element.addClass("ng-submitted"),form.$submitted=!0,form.$valid&&fn(scope,{$event:event})})}),scope.$watch(function(){return form.$valid},function(isValid){form.$submitted===!1})}}}}}]),app.directive("validateEmail",function(){var EMAIL_REGEXP=/^[_a-zA-Z0-9]+(\.[_a-zA-Z0-9]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/;return{require:"ngModel",restrict:"",link:function(scope,elm,attrs,ctrl){ctrl&&ctrl.$validators.email&&(ctrl.$validators.email=function(modelValue){return ctrl.$isEmpty(modelValue)||EMAIL_REGEXP.test(modelValue)})}}}),app.directive("formAutofillFix",function(){return function(scope,elem,attrs){elem.prop("method","POST"),attrs.ngSubmit&&setTimeout(function(){elem.unbind("submit").submit(function(e){e.preventDefault(),elem.find("input, textarea, select").trigger("input").trigger("change").trigger("keydown"),scope.$apply(attrs.ngSubmit)})},0)}}),app.directive("addFixed",function(){return function(scope,elem,attrs){var value=parseInt(attrs.addFixed);$(window).scroll(function(){var scroll=$(window).scrollTop();scroll>=value?elem.addClass("fixed"):elem.removeClass("fixed")})}}),totalPayoutDropDown.$inject=["CommonServiceTerm","$timeout"],app.directive("totalPayoutDropDown",totalPayoutDropDown),monthlyPayoutDropDown.$inject=["CommonServiceTerm","$timeout"],app.directive("monthlyPayoutDropDown",monthlyPayoutDropDown),coverUptoDropDown.$inject=["$timeout"],app.directive("coverUptoDropDown",coverUptoDropDown),payTypeDropDown.$inject=["$timeout"],app.directive("payTypeDropDown",payTypeDropDown),payOutDropDown.$inject=["$timeout"],app.directive("payOutDropDown",payOutDropDown),payTermDropDown.$inject=["$timeout","$localStorage"],app.directive("payTermDropDown",payTermDropDown),tabSwitcher.$inject=["$timeout"],app.directive("tabSwitcher",tabSwitcher),sortByDropDown.$inject=["$timeout"],app.directive("sortByDropDown",sortByDropDown),quoteTile.$inject=["$timeout","QuotesService","GenericService","CommonServiceTerm","$rootScope","$mdToast","$interval","$filter","$routeParams","$cookies"],app.directive("quoteTile",quoteTile),riderModal.$inject=["$timeout"],app.directive("riderModal",riderModal),riderDescriptionText.$inject=["QuotesService"],app.directive("riderDescriptionText",riderDescriptionText),riderWrap.$inject=["QuotesService","$filter"],app.directive("riderWrap",riderWrap),toggleDropDown.$inject=["$timeout"],app.directive("toggleDropDown",toggleDropDown),customerInfoModal.$inject=["$timeout"],app.directive("customerInfoModal",customerInfoModal),angular.module("slick",[]).directive("slick",["$timeout",function($timeout){return{restrict:"AEC",scope:{initOnload:"@",data:"=",currentIndex:"=",accessibility:"@",adaptiveHeight:"@",arrows:"@",asNavFor:"@",appendArrows:"@",appendDots:"@",autoplay:"@",autoplaySpeed:"@",centerMode:"@",centerPadding:"@",cssEase:"@",customPaging:"&",dots:"@",draggable:"@",easing:"@",fade:"@",focusOnSelect:"@",infinite:"@",initialSlide:"@",lazyLoad:"@",onBeforeChange:"&",onAfterChange:"&",onInit:"&",onReInit:"&",onSetPosition:"&",pauseOnHover:"@",pauseOnDotsHover:"@",responsive:"=",rtl:"@",slide:"@",slidesToShow:"@",slidesToScroll:"@",speed:"@",swipe:"@",swipeToSlide:"@",touchMove:"@",touchThreshold:"@",useCSS:"@",variableWidth:"@",vertical:"@",prevArrow:"@",nextArrow:"@"},link:function(scope,element,attrs){var destroySlick,initializeSlick,isInitialized;return destroySlick=function(){return $timeout(function(){var slider;return slider=$(element),slider.slick("unslick"),slider.find(".slick-list").remove(),slider})},initializeSlick=function(){return $timeout(function(){var currentIndex,customPaging,slider;return slider=$(element),null!=scope.currentIndex&&(currentIndex=scope.currentIndex),customPaging=function(slick,index){return scope.customPaging({slick:slick,index:index})},slider.slick({accessibility:"false"!==scope.accessibility,adaptiveHeight:"true"===scope.adaptiveHeight,arrows:"false"!==scope.arrows,asNavFor:scope.asNavFor?scope.asNavFor:void 0,appendArrows:scope.appendArrows?$(scope.appendArrows):$(element),appendDots:scope.appendDots?$(scope.appendDots):$(element),autoplay:"true"===scope.autoplay,autoplaySpeed:null!=scope.autoplaySpeed?parseInt(scope.autoplaySpeed,10):3e3,centerMode:"true"===scope.centerMode,centerPadding:scope.centerPadding||"50px",cssEase:scope.cssEase||"ease",customPaging:attrs.customPaging?customPaging:void 0,dots:"true"===scope.dots,draggable:"false"!==scope.draggable,easing:scope.easing||"linear",fade:"true"===scope.fade,focusOnSelect:"true"===scope.focusOnSelect,infinite:"false"!==scope.infinite,initialSlide:scope.initialSlide||0,lazyLoad:scope.lazyLoad||"ondemand",beforeChange:attrs.onBeforeChange?scope.onBeforeChange:void 0,onReInit:attrs.onReInit?scope.onReInit:void 0,onSetPosition:attrs.onSetPosition?scope.onSetPosition:void 0,pauseOnHover:"false"!==scope.pauseOnHover,responsive:scope.responsive||void 0,rtl:"true"===scope.rtl,slide:scope.slide||"div",slidesToShow:null!=scope.slidesToShow?parseInt(scope.slidesToShow,10):1,slidesToScroll:null!=scope.slidesToScroll?parseInt(scope.slidesToScroll,10):1,speed:null!=scope.speed?parseInt(scope.speed,10):300,swipe:"false"!==scope.swipe,swipeToSlide:"true"===scope.swipeToSlide,touchMove:"false"!==scope.touchMove,touchThreshold:scope.touchThreshold?parseInt(scope.touchThreshold,10):5,useCSS:"false"!==scope.useCSS,variableWidth:"true"===scope.variableWidth,vertical:"true"===scope.vertical,prevArrow:scope.prevArrow?$(scope.prevArrow):void 0,nextArrow:scope.nextArrow?$(scope.nextArrow):void 0}),slider.on("init",function(sl){if(attrs.onInit&&scope.onInit(),null!=currentIndex)return sl.slideHandler(currentIndex)}),slider.on("afterChange",function(event,slick,currentSlide,nextSlide){if(scope.onAfterChange&&scope.onAfterChange(),null!=currentIndex)return scope.$apply(function(){return currentIndex=currentSlide,scope.currentIndex=currentSlide})}),scope.$watch("currentIndex",function(newVal,oldVal){if(null!=currentIndex&&null!=newVal&&newVal!==currentIndex)return slider.slick("slickGoTo",newVal)})})},scope.initOnload?(isInitialized=!1,scope.$watch("data",function(newVal,oldVal){if(null!=newVal)return isInitialized&&destroySlick(),initializeSlick(),isInitialized=!0})):initializeSlick()}}}]),app.filter("searchCity",["GenericService",function(GenericService){return function(value,searchText){var arr=[];return null!==searchText.search&&searchText.search.length>1&&(void 0===value&&null===value||(arr=searchText.search?GenericService.createFilterForFirstValues(value,searchText.search):[])),arr}}]),app.filter("addCommas",function(){return function(value){if(void 0!==value&&null!==value){if(value.toString().indexOf(",")!=-1&&(value=value.replace(/,/g,"")),void 0!==value){value=value.toString().replace(/,/g,""),value+="";var x=value.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"",lastThree=x1.substring(x1.length-3),otherNumbers=x1.substring(0,x1.length-3);""!==otherNumbers&&(lastThree=","+lastThree);var res=otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g,",")+lastThree;return res+x2}return""}}});